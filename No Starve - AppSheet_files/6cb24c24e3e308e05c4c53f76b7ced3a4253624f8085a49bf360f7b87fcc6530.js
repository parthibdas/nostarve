(self.webpackChunkappsheet_app=self.webpackChunkappsheet_app||[]).push([["scripts__shared_models_datalayer_AppModel_ts"],{238435:e=>{e.exports='"use strict";\n\n// http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerwithlabel/docs/reference.html\n\n/* eslint-disable */\nfunction inherits(e, t) {\n  function i() {}\n\n  i.prototype = t.prototype, e.superClass_ = t.prototype, e.prototype = new i(), e.prototype.constructor = e;\n}\n\nfunction MarkerLabel_(e, t, i) {\n  this.marker_ = e, this.handCursorURL_ = e.handCursorURL, this.labelDiv_ = document.createElement("div"), this.labelDiv_.style.cssText = "position: absolute; overflow: hidden;", this.eventDiv_ = document.createElement("div"), this.eventDiv_.style.cssText = this.labelDiv_.style.cssText, this.eventDiv_.setAttribute("onselectstart", "return false;"), this.eventDiv_.setAttribute("ondragstart", "return false;"), this.crossDiv_ = MarkerLabel_.getSharedCross(t);\n}\n\nfunction MarkerWithLabel(e) {\n  e = e || {}, e.labelContent = e.labelContent || "", e.labelAnchor = e.labelAnchor || new google.maps.Point(0, 0), e.labelClass = e.labelClass || "markerLabels", e.labelStyle = e.labelStyle || {}, e.labelInBackground = e.labelInBackground || !1, "undefined" == typeof e.labelVisible && (e.labelVisible = !0), "undefined" == typeof e.raiseOnDrag && (e.raiseOnDrag = !0), "undefined" == typeof e.clickable && (e.clickable = !0), "undefined" == typeof e.draggable && (e.draggable = !1), "undefined" == typeof e.optimized && (e.optimized = !1), e.crossImage = e.crossImage || "http" + ("https:" === document.location.protocol ? "s" : "") + "://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png", e.handCursor = e.handCursor || "http" + ("https:" === document.location.protocol ? "s" : "") + "://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur", e.optimized = !1, this.label = new MarkerLabel_(this, e.crossImage, e.handCursor), google.maps.Marker.apply(this, arguments);\n}\n\ninherits(MarkerLabel_, google.maps.OverlayView), MarkerLabel_.getSharedCross = function (e) {\n  var t;\n  return "undefined" == typeof MarkerLabel_.getSharedCross.crossDiv && (t = document.createElement("img"), t.style.cssText = "position: absolute; z-index: 1000002; display: none;", t.style.marginLeft = "-8px", t.style.marginTop = "-9px", t.src = e, MarkerLabel_.getSharedCross.crossDiv = t), MarkerLabel_.getSharedCross.crossDiv;\n}, MarkerLabel_.prototype.onAdd = function () {\n  var e,\n      t,\n      i,\n      s,\n      a,\n      r,\n      o,\n      l = this,\n      n = !1,\n      g = !1,\n      p = 20,\n      _ = "url(" + this.handCursorURL_ + ")",\n      h = function h(e) {\n    e.preventDefault && e.preventDefault(), e.cancelBubble = !0, e.stopPropagation && e.stopPropagation();\n  },\n      v = function v() {\n    l.marker_.setAnimation(null);\n  };\n\n  this.getPanes().overlayImage.appendChild(this.labelDiv_), this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_), "undefined" == typeof MarkerLabel_.getSharedCross.processed && (this.getPanes().overlayImage.appendChild(this.crossDiv_), MarkerLabel_.getSharedCross.processed = !0), this.listeners_ = [google.maps.event.addDomListener(this.eventDiv_, "mouseover", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (this.style.cursor = "pointer", google.maps.event.trigger(l.marker_, "mouseover", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "mouseout", function (e) {\n    !l.marker_.getDraggable() && !l.marker_.getClickable() || g || (this.style.cursor = l.marker_.getCursor(), google.maps.event.trigger(l.marker_, "mouseout", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "mousedown", function (e) {\n    g = !1, l.marker_.getDraggable() && (n = !0, this.style.cursor = _), (l.marker_.getDraggable() || l.marker_.getClickable()) && (google.maps.event.trigger(l.marker_, "mousedown", e), h(e));\n  }), google.maps.event.addDomListener(document, "mouseup", function (t) {\n    var i;\n\n    if (n && (n = !1, l.eventDiv_.style.cursor = "pointer", google.maps.event.trigger(l.marker_, "mouseup", t)), g) {\n      if (a) {\n        i = l.getProjection().fromLatLngToDivPixel(l.marker_.getPosition()), i.y += p, l.marker_.setPosition(l.getProjection().fromDivPixelToLatLng(i));\n\n        try {\n          l.marker_.setAnimation(google.maps.Animation.BOUNCE), setTimeout(v, 1406);\n        } catch (r) {}\n      }\n\n      l.crossDiv_.style.display = "none", l.marker_.setZIndex(e), s = !0, g = !1, t.latLng = l.marker_.getPosition(), google.maps.event.trigger(l.marker_, "dragend", t);\n    }\n  }), google.maps.event.addListener(l.marker_.getMap(), "mousemove", function (s) {\n    var _;\n\n    n && (g ? (s.latLng = new google.maps.LatLng(s.latLng.lat() - t, s.latLng.lng() - i), _ = l.getProjection().fromLatLngToDivPixel(s.latLng), a && (l.crossDiv_.style.left = _.x + "px", l.crossDiv_.style.top = _.y + "px", l.crossDiv_.style.display = "", _.y -= p), l.marker_.setPosition(l.getProjection().fromDivPixelToLatLng(_)), a && (l.eventDiv_.style.top = _.y + p + "px"), google.maps.event.trigger(l.marker_, "drag", s)) : (t = s.latLng.lat() - l.marker_.getPosition().lat(), i = s.latLng.lng() - l.marker_.getPosition().lng(), e = l.marker_.getZIndex(), r = l.marker_.getPosition(), o = l.marker_.getMap().getCenter(), a = l.marker_.get("raiseOnDrag"), g = !0, l.marker_.setZIndex(1e6), s.latLng = l.marker_.getPosition(), google.maps.event.trigger(l.marker_, "dragstart", s)));\n  }), google.maps.event.addDomListener(document, "keydown", function (e) {\n    g && 27 === e.keyCode && (a = !1, l.marker_.setPosition(r), l.marker_.getMap().setCenter(o), google.maps.event.trigger(document, "mouseup", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "click", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (s ? s = !1 : (google.maps.event.trigger(l.marker_, "click", e), h(e)));\n  }), google.maps.event.addDomListener(this.eventDiv_, "dblclick", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (google.maps.event.trigger(l.marker_, "dblclick", e), h(e));\n  }), google.maps.event.addListener(this.marker_, "dragstart", function (e) {\n    g || (a = this.get("raiseOnDrag"));\n  }), google.maps.event.addListener(this.marker_, "drag", function (e) {\n    g || a && (l.setPosition(p), l.labelDiv_.style.zIndex = 1e6 + (this.get("labelInBackground") ? -1 : 1));\n  }), google.maps.event.addListener(this.marker_, "dragend", function (e) {\n    g || a && l.setPosition(0);\n  }), google.maps.event.addListener(this.marker_, "position_changed", function () {\n    l.setPosition();\n  }), google.maps.event.addListener(this.marker_, "zindex_changed", function () {\n    l.setZIndex();\n  }), google.maps.event.addListener(this.marker_, "visible_changed", function () {\n    l.setVisible();\n  }), google.maps.event.addListener(this.marker_, "labelvisible_changed", function () {\n    l.setVisible();\n  }), google.maps.event.addListener(this.marker_, "title_changed", function () {\n    l.setTitle();\n  }), google.maps.event.addListener(this.marker_, "labelcontent_changed", function () {\n    l.setContent();\n  }), google.maps.event.addListener(this.marker_, "labelanchor_changed", function () {\n    l.setAnchor();\n  }), google.maps.event.addListener(this.marker_, "labelclass_changed", function () {\n    l.setStyles();\n  }), google.maps.event.addListener(this.marker_, "labelstyle_changed", function () {\n    l.setStyles();\n  })];\n}, MarkerLabel_.prototype.onRemove = function () {\n  var e;\n\n  for (this.labelDiv_.parentNode.removeChild(this.labelDiv_), this.eventDiv_.parentNode.removeChild(this.eventDiv_), e = 0; e < this.listeners_.length; e++) {\n    google.maps.event.removeListener(this.listeners_[e]);\n  }\n}, MarkerLabel_.prototype.draw = function () {\n  this.setContent(), this.setTitle(), this.setStyles();\n}, MarkerLabel_.prototype.setContent = function () {\n  var e = this.marker_.get("labelContent");\n  "undefined" == typeof e.nodeType ? (this.labelDiv_.innerHTML = e, this.eventDiv_.innerHTML = this.labelDiv_.innerHTML) : (this.labelDiv_.innerHTML = "", this.labelDiv_.appendChild(e), e = e.cloneNode(!0), this.eventDiv_.appendChild(e));\n}, MarkerLabel_.prototype.setTitle = function () {\n  this.eventDiv_.title = this.marker_.getTitle() || "";\n}, MarkerLabel_.prototype.setStyles = function () {\n  var e, t;\n  this.labelDiv_.className = this.marker_.get("labelClass"), this.eventDiv_.className = this.labelDiv_.className, this.labelDiv_.style.cssText = "", this.eventDiv_.style.cssText = "", t = this.marker_.get("labelStyle");\n\n  for (e in t) {\n    t.hasOwnProperty(e) && (this.labelDiv_.style[e] = t[e], this.eventDiv_.style[e] = t[e]);\n  }\n\n  this.setMandatoryStyles();\n}, MarkerLabel_.prototype.setMandatoryStyles = function () {\n  this.labelDiv_.style.position = "absolute", this.labelDiv_.style.overflow = "hidden", "undefined" != typeof this.labelDiv_.style.opacity && "" !== this.labelDiv_.style.opacity && (this.labelDiv_.style.MsFilter = \'"progid:DXImageTransform.Microsoft.Alpha(opacity=\' + 100 * this.labelDiv_.style.opacity + \')"\', this.labelDiv_.style.filter = "alpha(opacity=" + 100 * this.labelDiv_.style.opacity + ")"), this.eventDiv_.style.position = this.labelDiv_.style.position, this.eventDiv_.style.overflow = this.labelDiv_.style.overflow, this.eventDiv_.style.opacity = .01, this.eventDiv_.style.MsFilter = \'"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"\', this.eventDiv_.style.filter = "alpha(opacity=1)", this.setAnchor(), this.setPosition(), this.setVisible();\n}, MarkerLabel_.prototype.setAnchor = function () {\n  var e = this.marker_.get("labelAnchor");\n  this.labelDiv_.style.marginLeft = -e.x + "px", this.labelDiv_.style.marginTop = -e.y + "px", this.eventDiv_.style.marginLeft = -e.x + "px", this.eventDiv_.style.marginTop = -e.y + "px";\n}, MarkerLabel_.prototype.setPosition = function (e) {\n  var t = this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());\n  "undefined" == typeof e && (e = 0), this.labelDiv_.style.left = Math.round(t.x) + "px", this.labelDiv_.style.top = Math.round(t.y - e) + "px", this.eventDiv_.style.left = this.labelDiv_.style.left, this.eventDiv_.style.top = this.labelDiv_.style.top, this.setZIndex();\n}, MarkerLabel_.prototype.setZIndex = function () {\n  var e = this.marker_.get("labelInBackground") ? -1 : 1;\n  "undefined" == typeof this.marker_.getZIndex() ? (this.labelDiv_.style.zIndex = parseInt(this.labelDiv_.style.top, 10) + e, this.eventDiv_.style.zIndex = this.labelDiv_.style.zIndex) : (this.labelDiv_.style.zIndex = this.marker_.getZIndex() + e, this.eventDiv_.style.zIndex = this.labelDiv_.style.zIndex);\n}, MarkerLabel_.prototype.setVisible = function () {\n  this.marker_.get("labelVisible") ? this.labelDiv_.style.display = this.marker_.getVisible() ? "block" : "none" : this.labelDiv_.style.display = "none", this.eventDiv_.style.display = this.labelDiv_.style.display;\n}, inherits(MarkerWithLabel, google.maps.Marker), MarkerWithLabel.prototype.setMap = function (e) {\n  google.maps.Marker.prototype.setMap.apply(this, arguments), this.label.setMap(e);\n};\n/* eslint-enable */\n// need this explicitly because use-strict prevents $.globalEval from modifying global namespace\n\nwindow.google.maps.MarkerWithLabel = MarkerWithLabel;'},368142:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(627424)),i=n(a(856690)),o=n(a(689728)),l=n(a(861655)),u=n(a(994993)),s=n(a(73808)),c=n(a(496486)),d=n(a(667294)),f=n(a(236377)),p=n(a(314247)),h=n(a(593186)),v=n(a(190644)),m=a(365914),g=n(a(571524)),y=n(a(498967)),b=a(46239),T=a(166089),S=a(235049);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.default)(this,a)}}var w=!1,C=b.ImageMapType.CACHE_MAX_ZOOM-1,E={"far fa-search":"fal fa-search"},k=function(e){(0,l.default)(a,e);var t=A(a);function a(e){var n;return(0,i.default)(this,a),(n=t.call(this,e)).onMount=function(e){n.domNode=e},n.repaint=function(){var e=p.default.getMapInstance(n.state.mountId);e&&e.repaint()},n.onCustomMapReady=function(e){null==e&&n.setState(n.state)},n.onMountCallback=function(e){e.map&&!c.default.isEmpty(e.map.mapTypes)&&n.updateMap(e)},n.state={mountId:Math.random()},n}return(0,o.default)(a,[{key:"name",get:function(){return"ClusterMapPane"}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.repaint),this.componentDidUpdate()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.repaint),this.stopWatchingLocation(),p.default.unmountMap(this.state.mountId)}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.showMap,a=e.table,n=e.mapColumn,r=e.customMapType;if(!1!==t&&this.domNode){var i=a&&a.name(),o=this.onMountCallback;p.default.mountMap(this.domNode,this.state.mountId,{tableName:i,mapColumn:n,callback:o,isXY:!!r})}else this.componentWillUnmount()}},{key:"render",value:function(){var e;return this.props.blockLinkToMaps&&(e=d.default.createElement("div",{className:"GoogleMapPane__link-blocker"})),d.default.createElement("div",{className:"GoogleMapPane"},d.default.createElement("div",{className:"GoogleMapPane__map-parent",ref:this.onMount}),e)}},{key:"updateMarkerClustererOptions",value:function(e){var t=this.props,a=t.mapMode,n=t.minimumClusterSize,r=t.customMapType;e.zoomOnClick_="fixed"!==a,r?e.setMaxZoom(C):e.setMaxZoom(18),n&&e.getMinClusterSize()!==n&&(e.setMinClusterSize(n),e.resetViewport())}},{key:"updateMap",value:function(e){var t=this,a=e.map,n=p.default.api;this.repaint();var r=this.props,i=r.appModel,o=r.table,l=r.mapColumn,u=r.customMapType,s=r.hidePointsOfInterest,d=r.selectedItem,f=r.draggablePinCoordinates,h=this.props,y=h.zoom,A=h.minimumClusterSize;if(i&&o){this.mapInstance=e;var C,E=this.props.layers||[],k=this.props.mapEventHandlers||{},I=this.props.items||[],O=this.props.mapType||n.maps.MapTypeId.ROADMAP,M=this.props.mapOptions,N=o.name(),_={disableDefaultUI:!!d,draggableCursor:null};1===A&&(A=2),null!=A&&A<1&&(A=1e6),u?(C=u.id(),a.mapTypes.set(C,u.definition(n)),u.isReady()||u.whenReady(this.onCustomMapReady)):C=p.default.normalizeMapType(O),a.mapTypeId!==C&&(_.mapTypeId=C),s&&(_.styles=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"on"}]}]);var D=o&&l&&o.tableSchema.findAttributeByName(l);D&&D.auxData()&&D.auxData().KMLFileUrl?(e.kmlLayer&&e.kmlLayer.url!==D.auxData().KMLFileUrl&&(e.kmlLayer.setMap(null),e.kmlLayer=null),e.kmlLayer||(e.kmlLayer=new n.maps.KmlLayer(D.auxData().KMLFileUrl,{suppressInfoWindows:!1,preserveViewport:!0,map:a}))):e.kmlLayer&&(e.kmlLayer.setMap(null),e.kmlLayer=null),e.clearListeners();var P,x,F=function(t){var r=k[t],i=a.addListener(t,(function(e){r(e,a,n)}));e.registerListener(i)};for(var G in k)F(G);for(var V=!1,B=0,U=c.default.concat(I,c.default.flatMap(E,(function(e){return e.mapItems})));null==P||null==x;){switch(B){case 0:P=v.default.normalizeLatOrLng(this.props.centerLat),x=v.default.normalizeLatOrLng(this.props.centerLng);break;case 1:d&&(P=v.default.normalizeLatOrLng(d.Latitude),x=v.default.normalizeLatOrLng(d.Longitude));break;case 2:U.length>0&&(P=U[0].Latitude,x=U[0].Longitude,V=U.length>1);break;case 3:null==v.default.lastPosition||u||(P=v.default.lastPosition.coords.latitude,x=v.default.lastPosition.coords.longitude,V=U.length>1);break;case 4:P=p.default.defaultLat,x=p.default.defaultLng,null!=y&&y>2&&(y=2);break;default:P=0,x=0}B++}var H=p.default.getMountedPins(e.id);w;var W=T.AppGlobals.ViewManager.theme.getThemeColor("themeMainColor"),j={tableName:N,mapColumn:l,mapItems:I,defaultFormatting:{color:R(W,-.2),scale:6,noMarkerWithLabel:!0}},q=V;this.filterAndSortLayerItems(j,P,x,q);var Y=this.updatePins(H,j),z=Y.pinsToAdd,K=Y.pinsToShow,J=Y.selectedPin,Q=W;E.forEach((function(e){e.defaultFormatting={color:R(Q,.3),scale:6,noMarkerWithLabel:!0},Q=e.defaultFormatting.color,t.filterAndSortLayerItems(e,P,x,q);var a=t.updatePins(H,e);J=J||a.selectedPin,z=c.default.union(z,a.pinsToAdd),K=c.default.union(K,a.pinsToShow)}));var $=c.default.values(H);w,p.default.unmountPins(e.id,H);var X=c.default.union(z,K);setTimeout((function(){var a,n;t.showPins(X),t.hidePins($),(a={pinsToAdd:z,pinsToHide:$,pinsToShow:K},n=new m.NestedStore,c.default.keys(a).forEach((function(e){a[e].forEach((function(t){var a=L(t);n.for(a).push(e,t)}))})),n).forEach((function(a,n){var r=e.initMarkerClusterer(a);t.updateMarkerClustererOptions(r);var i=n.toSimpleObject(),o=i.pinsToAdd,l=void 0===o?[]:o,u=i.pinsToHide,s=void 0===u?[]:u,c=i.pinsToShow,d=void 0===c?[]:c;r.getTotalMarkers()!==d.length+s.length?(r.clearMarkers(),r.addMarkers(l),r.addMarkers(d)):(s.length||l.length)&&(r.removeMarkers(s),r.addMarkers(l))}))}),0);var Z=e.state.activePin;if(null!=J?null!=Z?Z.map===a&&Z.position===J.position||Z.setOptions({position:J.position,map:a}):Z=new n.maps.Marker({map:a,position:J.position,draggable:!1}):null!=Z&&Z.setMap(null),e.setState({activePin:Z}),V){var ee=new n.maps.LatLngBounds;X.map((function(e){return e.position})).forEach((function(e){return ee.extend(e)}));var te=ee.getNorthEast();!te||te.equals(ee.getSouthWest())?V=!1:a.fitBounds(ee)}if(V||(_.center={lat:P,lng:x},null!=y&&y!==a.getZoom()&&(_.zoom=y)),g.default.InMobileWebView()&&i.AppTemplate.Behavior.FullOfflineCaching){var ae=!navigator.onLine||!(0,S.isConnected)();_.maxZoom=ae&&u?b.ImageMapType.CACHE_MAX_ZOOM:u?b.ImageMapType.MAX_ZOOM:22}this.updateCurrentLocation(e),f&&this.updateDraggablePins(f,e),this.updateDraggablePin(e),a.setOptions(c.default.extend(_,M))}}},{key:"maxPins",value:function(e){var t=e.maxPins;if(null==t){try{t=e.appModel.AppTemplate.Presentation.MapPinMax}catch(e){h.default.ReportErrorOnce({errorMessage:"null reference from nextProps.appModel.AppTemplate.Presentation.MapPinMax"})}null==t&&(t=g.default.InMobileWebView()?250:1e3)}return t}},{key:"hidePins",value:function(e){null!=e&&(e=null!=e.length?e:[e]).forEach((function(e){null!=e&&null!=e.map&&"function"==typeof e.setVisible&&e.setVisible(!1)}))}},{key:"showPins",value:function(e){var t=this,a=this.mapInstance.map;if(null!=e&&null!=a){var n=this.props.selectedItem;(e=null!=e.length?e:[e]).forEach((function(e){t.formatPin(e),n&&n.Id===e.appsheetItem.Id?e.setVisible(!1):e.visible||e.setVisible(!0)}))}}},{key:"formatPin",value:function(e){var t=L(e),a=function(e){var t=e.appsheetFormatting;return t&&t.icon&&t.icon[0]}(e);null==e.icon&&(a?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=arguments.length>3?arguments[3]:void 0,r=[e,a,t].join(", "),i=D[r];if(null==i){w,D[r]=[n];var o=new Image,l=_(t,a);o.src=l,o.onload=function(){var t=document.createElement("i");e.match(/^fa[rls]?\s/)||(e="fas "+e),e=E[e]||e,t.className=e,document.body.appendChild(t);var n=window.getComputedStyle(t,":before"),i=n.content.replace(/'|"/g,"").charCodeAt(0),l=n.fontWeight;document.body.removeChild(t);var u=o.height,s=O(a,u),c=s.getContext("2d");c.drawImage(o,0,0,a,u),c.fillStyle="white",c.font="".concat(l,' 9px "Font Awesome 5 Pro"'),c.textAlign="center",c.fillText(String.fromCharCode(i),.5*a,.51*u);var d=s.toDataURL(),f=new p.default.api.maps.Size(a,u),h={url:d,size:f,scaledSize:f},v=D[r];Array.isArray(v)&&v.forEach((function(e){return e(h)})),D[r]=h},o.onerror=function(){var e=D[r];Array.isArray(e)&&e.forEach((function(e){return e(l)})),D[r]=l}}else Array.isArray(i)?i.push(n):n(i)}(a,t,20,(function(t){return e.setIcon(t)})):e.setIcon(_(t,12)))}},{key:"stopWatchingLocation",value:function(){null!=this.locationUpdateListener&&(v.default.removeListener(this.locationUpdateListener),this.locationUpdateListener=null)}},{key:"updateCurrentLocation",value:function(e){var t=e.state.currentLocMarker,a=e.map,n=this.props;if(n.showCurrentLocation){null==t&&(t=new p.default.api.maps.Marker({icon:{path:p.default.api.maps.SymbolPath.CIRCLE,scale:7,fillOpacity:1,fillColor:"#2B6FF6",strokeColor:"white",strokeWeight:2},draggable:!1,map:a}),e.setState({currentLocMarker:t}));var r=function(e,n){var r=t.position;t.map!==a&&t.setOptions({map:a}),null!=r&&r.lat()===e&&r.lng()===n||t.setOptions({position:new p.default.api.maps.LatLng(e,n)}),p.default.getCenterLat(a)===p.default.defaultLat&&p.default.getCenterLng(a)===p.default.defaultLng&&a.setCenter(new p.default.api.maps.LatLng(e,n))};"High"===n.locationMode?this.locationUpdateListener||(this.locationUpdateListener=v.default.addListener({interval:200,maximumAge:200,enableHighAccuracy:!0,callback:function(e){return r(e.coords.latitude,e.coords.longitude)}})):(v.default.fetchLatLong(r),this.stopWatchingLocation())}else null!=t&&t.setMap(null)}},{key:"updateDraggablePins",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=this.props,n=t.state.pendingPins||[],i=a.draggablePinEventHandlers||{},o=[];c.default.zip(e,n).forEach((function(e,n){var l=(0,r.default)(e,2),u=l[0],s=l[1];u?function(){var e=c.default.extend({draggable:!0,map:t.map,position:u},a.draggablePinOptions),r=s||new p.default.api.maps.Marker;r.setOptions(e),p.default.api.maps.event.clearInstanceListeners(r);var l=function(e){var a=i[e],o=r.addListener(e,(function(e){a(e,r,t.map,p.default.api,n)}));t.registerListener(o)};for(var d in a.draggablePinEventHandlers)l(d);o.push(r)}():s.setMap(null)})),t.setState({pendingPins:o})}},{key:"updateDraggablePin",value:function(e){var t=this.props,a=e.state.draggablePin,n=t.draggablePinEventHandlers,r=t.draggablePinCoordinates,i=t.draggablePinOptions||{},o=e.map;if(n&&!r){if(null==a){var l={url:"https://www.appsheet.com/content/img/pageart/draggable-pin-white-2x.png",size:new p.default.api.maps.Size(44,78),scaledSize:new p.default.api.maps.Size(33,58.5),anchor:new p.default.api.maps.Point(16.5,58.5)};a=new p.default.api.maps.Marker({icon:l,animation:p.default.api.maps.Animation.BOUNCE,position:o.center,draggable:!0,map:o}),e.setState({draggablePin:a})}null!=i.latitude&&null!=i.longitude&&a.setPosition(new p.default.api.maps.LatLng(i.latitude,i.longitude));var u=function(t){var r=n[t],i=a.addListener(t,(function(e){r(e,a,o,p.default.api)}));e.registerListener(i)};for(var s in n)u(s)}else null!=a&&(a.setMap(null),e.setState({draggablePin:null}),a=null)}},{key:"filterAndSortLayerItems",value:function(e,t,a){var n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(c.default.get(e,"mapItems.length"),new Map);if(!r){var o=this.mapInstance.map.getBounds(),l=o.getNorthEast();n=1.5*I(t,a,l.lat(),l.lng())}e.mapItems=e.mapItems.filter((function(e){var r=I(t,a,e.Latitude,e.Longitude);return(!n||r<n)&&(i.set(e,r),!0)}));var u=function(e,t){var a=i.get(e),n=i.get(t);return a>n?1:a<n?-1:0};y.default.sort(e.mapItems,u)}},{key:"updatePins",value:function(e,t){for(var a=this,n=this.props,r=n.appModel||T.AppGlobals.AppModel,i=t.tableName,o=t.mapColumn,l=t.mapItems,u=t.defaultFormatting,s=r&&r.findTableCollection(i).table,d=n.selectedItem,h=d?d.Id:null,m=n.pinEventHandlers||{},g={},y={},b=0;b<l.length&&b<this.maxPins(n);b++){var S=l[b];g[S.Id]=S;var A=void 0;S.Hash in y&&(A=y[S.Hash]||(0,f.default)(S.Hash),S.Latitude+=3e-4*(A()-.5),S.Longitude+=3e-4*(A()-.5),S.Hash=v.default.hashLatLng(S.Latitude,S.Longitude)),y[S.Hash]=A}var w,C=[],E=[],k=n.selectedTable||(n.table?n.table.name():""),R=n.selectedColumn||n.mapColumn,I=function(t){var n=g[t],r=s&&s.lookupTableRow(t),l=r&&r.getColumnFormatting(o),d=c.default.extend({},u,l),f=v.default.normalizeLatOrLng(n.Latitude),y=v.default.normalizeLatOrLng(n.Longitude),b=p.default.makePinCacheKey(i,o,t,d),T=e[b];if(T)delete e[b],C.push(T);else{var S=p.default.getPin(d,n);T=S.pin,S.created,p.default.cacheMountedPin(a.mapInstance.id,b,T),E.push(T)}null==f||null==y||null!=T.position&&T.position.lat()===f&&T.position.lng()===y||T.setPosition({lat:f,lng:y});var A=function(e){var t=m[e],n=T.addListener(e,(function(e){t(e,T,p.default.api)}));a.mapInstance.registerListener(n)};for(var I in m)A(I);T.appsheetItem=n,null!=h&&h===t&&k===i&&R===o&&(w=T)};for(var O in g)I(O);return{pinsToAdd:E,pinsToShow:C,selectedPin:w}}}]),a}(d.default.Component);function R(e,t){var a=parseInt(e.slice(1),16),n=t<0?0:255,r=t<0?-1*t:t,i=a>>16,o=a>>8&255,l=255&a;return"#"+(16777216+65536*(Math.round((n-i)*r)+i)+256*(Math.round((n-o)*r)+o)+(Math.round((n-l)*r)+l)).toString(16).slice(1)}function I(e,t,a,n){var r=Math.abs(n-t),i=Math.min(r,360-r);return Math.pow(a-e,2)+Math.pow(i,2)}function O(e,t,a){if(!a){var n=document.createElement("canvas").getContext("2d");a=(window.devicePixelRatio||1)/(n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1)}var r=document.createElement("canvas");return r.width=e*a,r.height=t*a,r.style.width=e+"px",r.style.height=t+"px",r.getContext("2d").setTransform(a,0,0,a,0,0),r}function M(e,t){return"data:image/svg+xml;base64,"+window.btoa('\n        <svg\n        xmlns:dc="http://purl.org/dc/elements/1.1/"\n        xmlns:cc="http://creativecommons.org/ns#"\n        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n        xmlns:svg="http://www.w3.org/2000/svg"\n        xmlns="http://www.w3.org/2000/svg"\n        id="svg8"\n        version="1.1"\n        viewBox="0 0 5.2916665 7.2680725"\n        height="'.concat(1.373494*t,'"\n        width="').concat(t,'">\n        <defs id="defs2">\n        </defs>\n        <g\n            transform="translate(-99.991578,-200.12094)"\n            id="layer1">\n    <path\n       d="m 103.704,205.33857 c 0.63411,-0.57806 1.35611,-1.33382 1.35611,-2.41032 0,-1.40729 -1.08027,-2.54809 -2.42268,-2.54809 -1.34243,0 -2.4227,1.1408 -2.4227,2.54809 0,1.0765 0.722,1.83226 1.35611,2.41032 1.10843,1.01046 0.62534,1.81113 1.06659,1.81113 0.44124,0 -0.0418,-0.80067 1.06657,-1.81113 z"\n       style="opacity:1;fill:').concat(e,';fill-opacity:0.98016998;stroke:#ffffff;stroke-width:0.26;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       id="path879" />\n        </g>\n        </svg>\n    '))}k.defaultProps={labelSize:22,mapOptions:{},showCurrentLocation:!0};var N={};function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=t+e;return N[a]=N[a]||M(e,t),N[a]}var D={};function L(e){var t=e.appsheetFormatting;return t?t.highlightColor||t.textColor||t.color:T.AppGlobals.ViewManager.theme.getThemeColor("actionIcon")}var P=k;t.default=P},685650:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.preloadForOffline=function(){d.default.whenReady((function(){v||(v=new f.default({state:{appModel:p.AppGlobals.AppModel,appState:p.AppGlobals.AppState},render:function(e){return s.default.createElement(m,e)}}),setTimeout((function(){v.setState({showMap:!0})}),1e3),setTimeout((function(){v.setState({showMap:!1})}),3e3),$("body").append(v.$el))}))};var r=n(a(856690)),i=n(a(689728)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808)),s=n(a(667294)),c=n(a(368142)),d=n(a(314247)),f=n(a(523930)),p=a(166089);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var v,m=function(e){(0,o.default)(a,e);var t=h(a);function a(){return(0,r.default)(this,a),t.apply(this,arguments)}return(0,i.default)(a,[{key:"render",value:function(){return s.default.createElement("div",{className:"PreloadGoogleMap"},s.default.createElement(c.default,Object.assign({},this.props,{showCurrentLocation:!1})))}}]),a}(s.default.Component)},50295:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Toasts=t.MLKitWarningToast=t.MLKitUnsupportedToast=t.DeprecationWarningToast=void 0;var r=n(a(667294)),i=a(697211),o=n(a(572063)),l=n(a(21870)),u=a(202079),s=a(56749),c=a(400078),d=n(a(571524)),f=n(a(587191)),p=a(351101),h=function(){return d.default.InAndroidWebView()?"https://play.google.com/store/apps/details?id=x1Trackmaster.x1Trackmaster":d.default.InIOSWebView()?"https://apps.apple.com/us/app/appsheet/id732548900":""},v=(0,i.makeStyles)({alert:{padding:"8px 32px 16px 16px",width:"480px",maxWidth:"90vw",fontSize:"0.9rem"},header:{fontSize:"1.2rem"},alertDialog:{width:"320px",maxWidth:"90vw",fontSize:"0.9rem"},alertDialogCenterColumn:{display:"flex",flexDirection:"column",height:"100%",marginTop:"8px"},alertDialogContent:{flexGrow:1,padding:"8px 0px"}});function m(e){var t=e.children,a=e.isOpen,n=e.close,o=e.autoHideDuration,l=e.anchorOrigin;return r.default.createElement(s.ASThemeProvider,null,r.default.createElement(i.Snackbar,{anchorOrigin:l,open:a,autoHideDuration:o,onClose:n},t))}var g=(0,u.observer)((function(){var e=v();if(l.default.toasts.length){var t=l.default.toasts[0],a=t.config,n=t.contentProps,i=void 0===n?{}:n,o=a.autoHideDuration,u=a.anchorOrigin,s=a.renderContent;return r.default.createElement(m,{isOpen:!0,close:l.default.dismissToast,autoHideDuration:o,anchorOrigin:u},s(i,e))}return r.default.createElement(m,{isOpen:!1})}));function y(e){var t=e.title,a=e.content,n=e.onClick,i=void 0===n?l.default.dismissToast:n,u=v();return r.default.createElement(c.Alert,{className:u.alert,severity:"error",icon:r.default.createElement(o.default,{fontSize:"large"}),onClick:i},t&&r.default.createElement(c.AlertTitle,{className:u.header},t),a)}t.Toasts=g;var b={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(){var e=r.default.createElement(r.default.Fragment,null,"Your barcode scanner will stop working within a few days. To continue using the scanner ",r.default.createElement(i.Link,{underline:"always",href:h()},"please update AppSheet"),"."),t=d.default.IsWhitelabelBrowser()?"Your barcode scanner will stop working within a few days. To avoid this, please reach out to the admin of this app to get an update.":e;return r.default.createElement(y,{title:"You are using an outdated app version.",content:t})}}};t.MLKitWarningToast=b;var T={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(){var e=r.default.createElement(r.default.Fragment,null,"Your barcode scanner is no longer supported. To continue using the scanner ",r.default.createElement(i.Link,{underline:"always",href:h()},"please update AppSheet"),"."),t=d.default.IsWhitelabelBrowser()?"Your barcode scanner is no longer supported. To continue using the scanner, please reach out to the admin of this app to get an update.":e;return r.default.createElement(y,{title:"You are using an outdated app version.",content:t})}}};t.MLKitUnsupportedToast=T;var S={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(e,t){var a=(0,p.mapActionName)("App update available"),n=(0,p.mapActionName)("You're using an older version of the app. To update the app, contact the app owner."),o=(0,p.mapActionName)("A new version of AppSheet is available");return r.default.createElement("div",null,r.default.createElement(c.Alert,{className:t.alertDialog,severity:"warning",icon:r.default.createElement(f.default,{fontSize:"large"})},r.default.createElement("div",{className:t.alertDialogCenterColumn},r.default.createElement(c.AlertTitle,{className:t.header},a),r.default.createElement(i.DialogContent,{className:t.alertDialogContent},d.default.IsWhitelabelBrowser()?n:o),r.default.createElement(i.DialogActions,null,d.default.IsWhitelabelBrowser()?r.default.createElement(i.Button,{onClick:l.default.dismissToast},"OK"):r.default.createElement(r.default.Fragment,null,r.default.createElement(i.Button,{onClick:l.default.dismissToast},"Not now"),r.default.createElement(i.Button,{onClick:function(){return window.InputHandler.switchToUrl(h(),!0)}},"Update"))))))}}};t.DeprecationWarningToast=S},343611:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var r=n(a(600861)),i=n(a(856690)),o=n(a(689728)),l=n(a(627424)),u=n(a(888861)),s=a(740127);function c(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var f=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};function p(e,t){var a=(0,l.default)(e,3),n=a[1],r=a[2],i=t.findAttributeByName(n),o=(0,s.getFilterForAttribute)(i);if(null===o)return null;var u={filterType:o,attribute:i,tableSchema:t,state:r};return Object.freeze(u),u}var h=function(){function e(t,a){if((0,i.default)(this,e),this.tableSchema=a,a){this.filters=[];var n,r=c(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(Array.isArray(o)){var l=p(o,a);null!==l&&this.filters.push(l)}else this.filters.push(o)}}catch(e){r.e(e)}finally{r.f()}}else this.filters=[];Object.freeze(this.filters),Object.freeze(this)}return(0,o.default)(e,[{key:"toExpression",value:function(){return this.tableSchema?u.default.createAnd.apply(u.default,(0,r.default)(this.filters.map((function(e){var t=e.filterType,a=f(e,["filterType"]);return t.toExpression(a)})))):null}},{key:"serialize",value:function(){return this.tableSchema?this.filters.filter((function(e){var t=e.filterType,a=f(e,["filterType"]);return!t.isEmpty(a)})).map((function(e){var t=e.attribute,a=e.state;return["attribute",t.name(),a]})):[]}},{key:"cloneAndRemoveEmptyFilters",value:function(){if(!this.tableSchema)return this;var e=this.filters.filter((function(e){var t=e.filterType,a=f(e,["filterType"]);return!t.isEmpty(a)}));return this.clone(e)}},{key:"clone",value:function(t){return new e(t,this.tableSchema)}},{key:"withFilterApplied",value:function(e,t){var a=this.tableSchema;if(!a)return this;var n=e.name(),r=(0,s.getFilterForAttribute)(e);if(null===r)throw new Error("cannot filter unsupported attribute ".concat(n));var i,o={filterType:r,attribute:e,tableSchema:a,state:t},l=[],u=!1,d=c(this.filters);try{for(d.s();!(i=d.n()).done;){var f=i.value;f.attribute.name()!==n?l.push(f):(l.push(o),u=!0)}}catch(e){d.e(e)}finally{d.f()}return u||l.push(o),this.clone(l)}}]),e}();t.Query=h},740127:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeMap=void 0,t.getFilterForAttribute=function(e){return p(e.type())},t.getFilterForType=p;var n=a(469255),r=a(278036),i=a(287291),o=a(768609),l=a(497629),u=a(896197),s=a(550372),c=a(984213),d=a(34650),f={Text:u.TextFilter,Enum:i.EnumFilter,EnumList:o.EnumListFilter,LongText:u.TextFilter,Name:u.TextFilter,ChangeCounter:s.NumericFilter,Number:s.NumericFilter,PostalCode:u.TextFilter,Address:u.TextFilter,LatLong:c.LatLongFilter,ChangeLocation:c.LatLongFilter,DateTime:d.DateTimeFilter,ChangeTimestamp:d.DateTimeFilter,Percent:s.NumericFilter,Decimal:s.NumericFilter,Price:s.NumericFilter,Url:u.TextFilter,File:l.FileFilter,Image:l.FileFilter,Drawing:l.FileFilter,Signature:l.FileFilter,Thumbnail:l.FileFilter,Video:l.FileFilter,Date:d.DateTimeFilter,Time:d.DateTimeFilter,Email:u.TextFilter,Phone:u.TextFilter,Color:i.EnumFilter,Progress:i.EnumFilter,Ref:r.RefFilter,"Yes/No":n.BooleanFilter};function p(e){return f[e]||null}t.TypeMap=f},319598:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.HIDE_FILTERS_FOR_VIEWS=void 0,t.getFilterQuery=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{if(t&&!l.has(e||"")){var n=(0,i.getAppModel)(),u=(null==n?void 0:n.findTableCollection(t))||{},s=u.tableSchema;return new o.Query(a,s)}}catch(e){r.default.ReportError({errorMessage:"Error in getFilterQuery",error:e})}return new o.Query([])};var r=n(a(593186)),i=a(351101),o=a(343611),l=new Set(["dashboard","detail","form","search"]);t.HIDE_FILTERS_FOR_VIEWS=l},469255:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanFilter=void 0;var r=n(a(385857)),i=a(351101),o=a(287291),l=Object.assign(Object.assign({},o.EnumFilter),{labelValue:function(e){var t=e.attribute,a=e.tableSchema,n=e.value,o=(0,i.getAppModel)(),l=new r.default(o,a),u=t.booleanTypeLabels(l),s=t.valueFromWireFormat(n);return!0===s?u.yesLabel:!1===s?u.noLabel:null===s?(0,i.mapActionName)("(empty)"):n},stateKeyToRealValue:function(e){return"true"===e?"TRUE":"false"===e?"FALSE":"null"===e?"":e}});t.BooleanFilter=l},740365:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ContinuousFilter=void 0;var r=n(a(238416)),i=n(a(918698)),o=n(a(667294)),l=a(697211),u=n(a(888861)),s=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},c=function(){throw new Error("unimplemented abstract static method")},d={valueIsValid:c,ValueEditor:c,valueToNumber:Number,valueToString:function(e,t){return t.localizeWireValue(e)},valueToExpression:function(e,t){return u.default.createConstantValue(e,t.type(),t.auxData())},initialState:function(){return{}},isValid:function(e){var t=e.state,a=e.attribute;return"object"===(0,i.default)(t)&&!Array.isArray(t)&&Object.keys(t).every((function(e){return"start"===e||"end"===e}))&&Object.keys(t).length<=2&&(void 0===t.start||this.valueIsValid(t.start,a))&&(void 0===t.end||this.valueIsValid(t.end,a))&&!(void 0!==t.start&&void 0!==t.end&&this.valueIsValid(t.start,a)&&this.valueIsValid(t.end,a)&&this.valueToNumber(t.end,a)<this.valueToNumber(t.start,a))},isEmpty:function(e){var t=e.state;return void 0===t.start&&void 0===t.end},toExpression:function(e){var t=e.state,a=e.tableSchema,n=e.attribute,r=[],i=u.default.createColumnLookup(a,n);return void 0!==t.start&&r.push(u.default.create({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"GreaterThanOrEquals",IsAtomic:!0,Children:[i.model,this.valueToExpression(t.start,n).model]})),void 0!==t.end&&r.push(u.default.create({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"LessThanOrEquals",IsAtomic:!0,Children:[i.model,this.valueToExpression(t.end,n).model]})),u.default.createAnd.apply(u.default,r)},activeFilterValues:function(e){var t=e.state,a=e.attribute,n="",r=void 0!==t.start?this.valueToString(t.start,a):null,i=void 0!==t.end?this.valueToString(t.end,a):null;return null!==r&&null!==i?n="".concat(r," – ").concat(i):null!==r?n="≥ ".concat(r):null!==i&&(n="≤ ".concat(i)),[n]},Summary:function(e){var t=e.self,a=s(e,["self"]),n=t.activeFilterValues(a).toString();return o.default.createElement(o.default.Fragment,null,n)},Editor:function(e){var t=e.self,a=e.state,n=e.onChange,i=e.onClose,u=e.attribute,s=t.ValueEditor,c=function(e){return function(t){return n(Object.assign(Object.assign({},a),(0,r.default)({},e,t)))}};return o.default.createElement(l.Grid,{container:!0,spacing:2},o.default.createElement(s,{bound:"start",value:a.start,onChange:c("start"),onClose:i,attribute:u}),o.default.createElement(s,{bound:"end",value:a.end,onChange:c("end"),onClose:i,attribute:u}))}};t.ContinuousFilter=d},34650:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimeFilter=void 0;var r=n(a(667294)),i=a(101225),o=n(a(775916)),l=a(740365),u=a(697211),s=n(a(365914)),c=a(351101);function d(e,t){switch(t.type()){case"Time":return s.default.toLocaleTimeString(e,!0);case"Date":return s.default.toLocaleDateString(e,!1);case"DateTime":case"ChangeTimestamp":return s.default.localizeDateTime(e,!0,!1)}return""}var f=Object.assign(Object.assign({},l.ContinuousFilter),{valueIsValid:function(e,t){return!isNaN(this.valueToNumber(e,t))},valueToNumber:function(e,t){return t.valueFromWireFormat(e).getTime()},valueToString:function(e,t){return d(t.valueFromWireFormat(e),t)},Summary:function(e){var t=e.self,a=e.state,n=e.attribute,i="",o=void 0!==a.start?t.valueToString(a.start,n):null,l=void 0!==a.end?t.valueToString(a.end,n):null;return null!==o&&null!==l?i="".concat(o," – ").concat(l):null!==o?i="after ".concat(o):null!==l&&(i="before ".concat(l)),r.default.createElement(r.default.Fragment,null,i)},ValueEditor:function(e){var t,a,n=e.bound,l=e.value,s=e.onChange,f=e.attribute,p=f.type();"Date"===p?(t=i.DatePicker,a=!1):"Time"===p?(t=i.TimePicker,a=!1):(t=i.DateTimePicker,a=!0);var h,v=(0,c.mapActionName)(("start"===n?"Start":"End")+" "+("Time"===p?"time":"date"));return r.default.createElement(u.Grid,{item:!0,xs:a?12:6},r.default.createElement(i.MuiPickersUtilsProvider,{utils:o.default},r.default.createElement(t,{inputVariant:"outlined",labelFunc:function(e){return e?d(e.toDate(),f):""},value:l?f.valueFromWireFormat(l):null,onChange:function(e){return s(e?f.valueToWireFormat(e.toDate()):void 0)},label:v,initialFocusedDate:(h=new Date,h.setHours(12),h.setMinutes(0),h.setSeconds(0),h.setMilliseconds(0),h),cancelLabel:(0,c.mapActionName)("Cancel"),clearLabel:(0,c.mapActionName)("Clear"),okLabel:(0,c.mapActionName)("OK"),todayLabel:(0,c.mapActionName)("Today"),clearable:!0,fullWidth:!0})))}});t.DateTimeFilter=f},287291:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.EnumFilter=void 0,t.checkboxChangeHandler=y;var i=n(a(627424)),o=n(a(600861)),l=n(a(918698)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(667294)),s=n(a(3674)),c=a(697211),d=n(a(888861)),f=a(351101),p=a(240684);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}function v(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var g=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};function y(e,t,a){return function(n){var r=Object.assign({},e);if(n.target.checked){var i,o=v(a);try{for(o.s();!(i=o.n()).done;){r[i.value]=!0}}catch(e){o.e(e)}finally{o.f()}}else{var l,u=v(a);try{for(u.s();!(l=u.n()).done;){delete r[l.value]}}catch(e){u.e(e)}finally{u.f()}}t(r)}}var b={allowedValues:function(e){var t,a,n,r=e.attribute,i=e.tableSchema,o=i.sourceTableName(),l=null===(t=(0,f.getAppModel)())||void 0===t?void 0:t.findTableCollection(o).table,u=null===(a=null==l?void 0:l.indexedTableRows())||void 0===a?void 0:a.getIndex(r),s={},c=v(((null==u?void 0:u.distinctValues())||[]).map((function(e){var t=u.lookup(e).allRows()[0],a=null==t?void 0:t.values[r.name()];return null!=a?a:e})));try{for(c.s();!(n=c.n()).done;){var d=n.value,p=this.labelValue({attribute:r,tableSchema:i,value:d});s[p]=s[p]||[],s[p].push(d)}}catch(e){c.e(e)}finally{c.f()}return s},labelValue:p.getLabelValueFromRefRow,isEmpty:function(e){var t=e.state,a=e.tableSchema,n=e.attribute,r=this.allowedValues({attribute:n,tableSchema:a}),i=Object.keys(r).length,o=Object.values(t).filter((function(e){return!0===e})).length;return!(o>0&&o!==i)},initialState:function(){return{}},isValid:function(e){var t=e.state;return"object"===(0,l.default)(t)&&null!==t&&Object.values(t).every((function(e){return"boolean"==typeof e}))},stateKeyToRealValue:function(e){return e},toExpression:function(e){var t=this,a=e.state,n=e.tableSchema,r=e.attribute;return this.isEmpty(e)?null:d.default.createOr.apply(d.default,(0,o.default)(Object.keys(a).filter((function(e){return a[e]})).map((function(e){return d.default.createColFilter(t.stateKeyToRealValue(e),n,r)}))))},activeFilterValues:function(e){for(var t=e.state,a=e.attribute,n=e.tableSchema,r=this.allowedValues({attribute:a,tableSchema:n}),o={},l=0,u=Object.entries(r);l<u.length;l++){var c,d=(0,i.default)(u[l],2),f=d[0],p=v(d[1]);try{for(p.s();!(c=p.n()).done;){var h=c.value;o[h]=f}}catch(e){p.e(e)}finally{p.f()}}return Array.from(new Set((0,s.default)(t).filter((function(e){return t[e]})).map((function(e){return o[e]}))))},Summary:function(e){var t=e.self,a=g(e,["self"]),n=t.activeFilterValues(a).join(", ");return u.default.createElement(u.default.Fragment,null,n)},Editor:function(e){var t,a,n=e.self,r=e.state,l=e.attribute,s=e.tableSchema,d=e.onChange,p=(0,u.useState)(""),h=(0,i.default)(p,2),v=h[0],m=h[1],g=n.allowedValues({attribute:l,tableSchema:s}),b=Object.keys(g).length>10?u.default.createElement(c.TextField,{variant:"outlined",label:(0,f.mapActionName)("Search"),value:v,onChange:function(e){m(e.target.value)}}):null;return v?(t=Object.entries(g).filter((function(e){var t=(0,i.default)(e,2),a=t[0],n=t[1];return[a].concat((0,o.default)(n)).some((function(e){return e.toLowerCase().startsWith(v.toLowerCase())}))})).sort((function(e,t){var a=(0,i.default)(e,2),n=(a[0],a[1]),r=(0,i.default)(t,2),o=(r[0],r[1]);return n.length-o.length})),a=(0,f.mapActionName)("No results")):(t=Object.entries(g),a=(0,f.mapActionName)("No available values")),u.default.createElement(c.FormGroup,null,b,t.map((function(e){var t=(0,i.default)(e,2),a=t[0],n=t[1];return u.default.createElement(c.FormControlLabel,{key:a,control:u.default.createElement(c.Checkbox,{checked:n.some((function(e){return r[e]}))||!1,onChange:y(r,d,n)}),label:a})})),0===t.length?a:null)}};t.EnumFilter=b},768609:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.EnumListFilter=void 0;var r=n(a(600861)),i=n(a(888861)),o=a(287291),l=a(351101),u=a(240684);function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var d=Object.assign(Object.assign({},o.EnumFilter),{toExpression:function(e){var t=this,a=e.state,n=e.tableSchema,o=e.attribute;return this.isEmpty(e)?null:i.default.createAnd.apply(i.default,(0,r.default)(Object.keys(a).filter((function(e){return a[e]})).map((function(e){return i.default.createColFilter(t.stateKeyToRealValue(e),n,o)}))))},labelValue:u.getLabelValueFromRefRow,allowedValues:function(e){var t,a,n,r=e.attribute,i=e.tableSchema,o=i.sourceTableName(),u=null===(t=(0,l.getAppModel)())||void 0===t?void 0:t.findTableCollection(o).table,c=null===(a=null==u?void 0:u.indexedTableRows())||void 0===a?void 0:a.getIndex(r),d=(null==c?void 0:c.distinctValues())||[],f=new Set,p=s(d);try{for(p.s();!(n=p.n()).done;){var h,v=n.value,m=c.lookup(v).allRows()[0],g=null==m?void 0:m.values[r.name()],y=s((null!=g?g:v)?r.splitEnumListValue(null!=g?g:v):[""]);try{for(y.s();!(h=y.n()).done;){var b=h.value;f.add(b)}}catch(e){y.e(e)}finally{y.f()}}}catch(e){p.e(e)}finally{p.f()}var T,S={},A=s(f);try{for(A.s();!(T=A.n()).done;){var w=T.value,C=this.labelValue({attribute:r,tableSchema:i,value:w});S[C]=S[C]||[],S[C].push(w)}}catch(e){A.e(e)}finally{A.f()}return S}});t.EnumListFilter=d},497629:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.FileFilter=void 0;var r=n(a(238416)),i=a(351101),o=n(a(888861)),l=a(287291),u=Object.assign(Object.assign({},l.EnumFilter),{allowedValues:function(){var e;return e={},(0,r.default)(e,(0,i.mapActionName)("Has attachment"),["hasAttachment"]),(0,r.default)(e,(0,i.mapActionName)("No attachment"),["noAttachment"]),e},toExpression:function(e){var t=e.state,a=e.tableSchema,n=e.attribute;if(this.isEmpty(e))return null;var r=o.default.createIsBlank(o.default.createColumnLookup(a,n));return t.hasAttachment?o.default.createNot(r):r}});t.FileFilter=u},984213:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.LatLongFilter=void 0;var r,i,o=n(a(918698)),l=n(a(238416)),u=n(a(667294)),s=a(697211),c=a(888861),d=a(240684),f=a(351101),p=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};!function(e){e.Feet="ft",e.Kilometers="km",e.Meters="m",e.Miles="mi",e.Yards="yd"}(i||(i={}));var h=30.48,v=(r={},(0,l.default)(r,i.Feet,h),(0,l.default)(r,i.Yards,91.44),(0,l.default)(r,i.Miles,160934.4),(0,l.default)(r,i.Meters,100),(0,l.default)(r,i.Kilometers,1e5),r),m=i.Feet,g=(0,s.makeStyles)({distanceTextField:{paddingRight:0},distanceInput:{border:"0 !important"},inputAdornment:{marginLeft:0}}),y=(0,s.withStyles)((function(e){return{root:{padding:e.spacing(1)},input:{"&:focus":{backgroundColor:"transparent"}}}}))(s.InputBase),b={initialState:function(){return{mode:"null"}},isValid:function(e){var t=e.state;return"object"===(0,o.default)(t)&&!Array.isArray(t)&&("null"===t.mode&&1===Object.keys(t).length||"distance"===t.mode&&"number"==typeof t.distance&&t.unit in i)},isEmpty:function(e){var t=e.state;return"null"===t.mode||"distance"===t.mode&&null===t.distance},toExpression:function(e){var t=e.state,a=e.tableSchema,n=e.attribute;if("null"===t.mode)return null;if("distance"===t.mode){var r=t.distance,o=t.unit;if(!r)return null;var l=(0,c.create)({ResultType:"LatLong",EvalType:"FUNCTION",FunctionName:"HERE"}).model,u=(0,c.createColumnLookup)(a,n).model,s=(0,c.create)({ResultType:"Decimal",EvalType:"FUNCTION",FunctionName:"DISTANCE",IsPure:!0,Children:[l,u]}).model,d=(0,c.createConstantValueNative)(r*v[o]/v[i.Kilometers],"Number").model;return(0,c.create)({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"LessThanOrEquals",IsAtomic:!0,Children:[s,d]})}return null},activeFilterValues:function(e){var t=e.state;return"distance"!==t.mode?[]:["within ".concat(t.distance," ").concat(t.unit)]},Summary:function(e){var t=e.self,a=p(e,["self"]),n=t.activeFilterValues(a).join(", ");return u.default.createElement(u.default.Fragment,null,n)},Editor:function(e){var t=e.state,a=e.onChange,n=e.onClose,r=g(),o=function(e,t){a({mode:"distance",distance:e,unit:t})},l=null,c=i.Feet;return"distance"===t.mode&&(l=t.distance,c=t.unit),u.default.createElement(s.Grid,{container:!0,spacing:2},u.default.createElement(s.Grid,{item:!0,xs:12},u.default.createElement(s.TextField,Object.assign({type:"number",label:(0,f.mapActionName)("From current location"),variant:"outlined",autoFocus:!0,value:l||"",onChange:function(e){return function(e){o(Number(e),"distance"===t.mode?t.unit:m)}(e.target.value)}},(0,d.getPressEnterProps)(n),{InputProps:{classes:{root:r.distanceTextField,input:r.distanceInput},endAdornment:u.default.createElement(s.InputAdornment,{position:"end",classes:{root:r.inputAdornment}},u.default.createElement(s.Select,{value:c,onChange:function(e){return function(e){o("distance"===t.mode?t.distance:null,e)}(e.target.value)},input:u.default.createElement(y,null)},Object.values(i).map((function(e){return u.default.createElement(s.MenuItem,{key:e,value:e},e)}))))}}))))}};t.LatLongFilter=b},550372:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.NumericFilter=void 0;var r=n(a(667294)),i=a(697211),o=a(740365),l=a(240684),u=a(351101),s=Object.assign(Object.assign({},o.ContinuousFilter),{valueIsValid:function(e){return"number"==typeof e&&!isNaN(e)},ValueEditor:function(e){var t,a,n=e.attribute,o=e.bound,s=e.value,c=e.onChange,d=e.onClose,f=!0;return"Price"===n.type()&&(t=n.currencySymbol(),f=!1),"Percent"===n.type()&&(a="%",void 0!==s&&(s*=100)),r.default.createElement(i.Grid,{item:!0,xs:f?6:12},r.default.createElement(i.TextField,{type:"number",label:(0,u.mapActionName)("start"===o?"Min":"Max"),variant:"outlined",value:void 0===s?"":s,onChange:function(e){if(""===e.target.value)c(void 0);else{var t=Number(e.target.value);"Percent"===n.type()&&(t/=100),c(t)}},autoFocus:"start"===o,inputProps:(0,l.getPressEnterProps)(d),InputProps:{startAdornment:t?r.default.createElement(i.InputAdornment,{position:"start"},t):null,endAdornment:a?r.default.createElement(i.InputAdornment,{position:"end"},a):null},fullWidth:!0}))}});t.NumericFilter=s},278036:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefFilter=void 0;var n=a(240684),r=a(287291),i=Object.assign(Object.assign({},r.EnumFilter),{labelValue:n.getLabelValueFromRefRow});t.RefFilter=i},896197:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.TextFilter=void 0;var r=n(a(667294)),i=a(697211),o=n(a(888861)),l=a(240684),u=a(351101),s=(0,i.makeStyles)({multiline:{minHeight:"4rem"}}),c=new Set(["LongText","Address"]),d={initialState:function(){return""},isValid:function(e){return e.state.length>0},isEmpty:function(e){return 0===e.state.trim().length},toExpression:function(e){if(this.isEmpty(e))return null;var t=e.tableSchema,a=e.attribute,n=e.state,r=o.default.createColumnLookup(t,a).model,i=o.default.createConstantValue(n,"Text",a.auxData()).model;return o.default.create({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"CONTAINS",Children:[r,i]})},activeFilterValues:function(e){return[e.state]},Summary:function(e){var t,a=e.state;return r.default.createElement(r.default.Fragment,null,null===(t=(0,u.getAppModel)())||void 0===t?void 0:t.MapActionName("Contains")," ",a)},Editor:function(e){var t=e.attribute,a=e.state,n=e.onChange,o=e.onClose,d=s(),f=(0,u.getAppModel)(),p=c.has(t.type()),h=p?{className:d.multiline}:(0,l.getPressEnterProps)(o);return r.default.createElement(i.TextField,{variant:"outlined",label:null==f?void 0:f.MapActionName("Search"),value:a,onChange:function(e){n(e.target.value)},inputProps:h,multiline:p,fullWidth:!0,autoFocus:!0})}};t.TextFilter=d},178314:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLabelValueFromRefRow=function(e){var t,a=e.attribute,l=e.value,u=function(e){var t,a,i,l=n.get(e);if(!l){var u=e.referencedTable()||(null===(t=e.nestedAttribute())||void 0===t?void 0:t.referencedTable()),s=null===(a=null==u?void 0:u.tableSchema.labelBasicAttribute())||void 0===a?void 0:a.name(),c=null==u?void 0:u.keyAttribute();l={index:c&&(null===(i=null==u?void 0:u.indexedTableRows())||void 0===i?void 0:i.getIndex(c)),labelAttributeName:s},n.set(e,l)}return clearTimeout(r),r=setTimeout(o,1e3),l}(a),s=u.index,c=u.labelAttributeName;if(""===l)return(0,i.mapActionName)("(empty)");return(null===(t=null==s?void 0:s.lookup(l).allRows()[0])||void 0===t?void 0:t.get(c))||l};var n,r,i=a(351101);function o(){n=new WeakMap}o()},157614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPressEnterProps=function(e){return{onKeyPress:function(t){"Enter"===t.key&&e()}}}},240684:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LabelValueParams",{enumerable:!0,get:function(){return n.LabelValueParams}}),Object.defineProperty(t,"getLabelValueFromRefRow",{enumerable:!0,get:function(){return n.getLabelValueFromRefRow}}),Object.defineProperty(t,"getPressEnterProps",{enumerable:!0,get:function(){return r.getPressEnterProps}});var n=a(178314),r=a(157614)},957831:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppState=o,t.getViewSpecificUIState=l,t.useTableSchema=function(){return(0,r.useMemo)(u,[o().CurrentUIState])};var n=a(166089),r=a(667294),i=a(351101);function o(){return n.AppGlobals.AppState}function l(){var e=o();return e.CurrentUIState?e.GetSpecificState(e.CurrentUIState):null}function u(){var e=(0,i.getAppModel)(),t=l(),a=null==t?void 0:t.TableName;return((null==e?void 0:e.findTableCollection(a))||{}).tableSchema}},606610:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.actionTypes=void 0;var i=n(a(627424)),o=n(a(496486)),l=n(a(280129)),u=n(a(687714)),s=n(a(130778)),c=n(a(730381)),d=n(a(962553)),f=n(a(150198)),p=n(a(385857)),h=n(a(593186)),v=n(a(571524)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=I(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(365914)),g=a(957831),y=a(263198),b=a(635672),T=a(646317),S=a(84690),A=a(166089),w=a(149313),C=a(557310),E=a(783252),k=n(a(819433)),R=a(250617);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(I=function(e){return e?a:t})(e)}var O,M=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},N="USER_CANCELED";function _(e){return C.ReactRootUIConfig.isReactRoot()?e:(e(),!0)}function D(e){var t="string"==typeof e?e:null==e?void 0:e.responseText;if(o.default.startsWith(t,"{")&&o.default.endsWith(t,"}"))try{var a=JSON.parse(t),n="";return a.Message&&(n+="Message: "+a.Message+"\r\n\r\n"),a.ExceptionType&&(n+="ExceptionType: "+a.ExceptionType+"\r\n\r\n"),a.ExceptionMessage&&(n+="ExceptionMessage: "+a.ExceptionMessage+"\r\n\r\n"),a.ErrorDescription&&(n+="ErrorDescription: "+a.ErrorDescription+"\r\n\r\n"),n}catch(e){var r=e;h.default.ReportErrorOnce({errorMessage:"Error in handleJsonError",error:r})}return null!=t?t:"Failure"}var L=function(e){e!==N&&(h.default.warnToDevConsole("Action Failed: ",e),A.AppGlobals.ViewManager.ShowInfoDialog("Action Failed",e))},P=function(e,t){return t&&t.rootTable()===e?t:e};var x={DELETE_RECORD:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!0,requireUpdatePermission:!1,modifiesData:!0,navigatesApp:!0,navigatesExternal:!1,runAsync:function(e,t,a){var n=a.appModel,r=a.table,i=a.transaction;return new Promise((function(e){var a,l,u,s,c,d=!1,f=!1,p=new Set;t.forEach((function(e){var t=i.delete(r.name(),e);d=d||null!=t,p.add(e)}));var h=null===(l=null===(a=null===window||void 0===window?void 0:window.AppState)||void 0===a?void 0:a.CurrentUIState)||void 0===l?void 0:l.SlideshowUIState;if(h&&p.has(h.RowKey))if(n.ShouldDelaySync()||A.AppGlobals.AppState.IsTopLevel()){var v=A.AppGlobals.ViewManager.KnownHandlers.detail||A.AppGlobals.ViewManager.KnownHandlers.slideshow,m=null===(c=null===(s=null===(u=null==v?void 0:v.RootPage())||void 0===u?void 0:u.data("reactView"))||void 0===s?void 0:s.component)||void 0===c?void 0:c.nearbyRowKey();if(null==m)f=function(){return A.AppGlobals.AppState.ChoosePreviousState()};else{var g=o.default.extend(A.AppGlobals.AppState.CurrentUIState,{SlideshowUIState:o.default.extend(A.AppGlobals.AppState.CurrentUIState.SlideshowUIState,{RowKey:m})});f=function(){return A.AppGlobals.AppState.ReplaceState(g)}}}else f=function(){return A.AppGlobals.AppState.ChoosePreviousState()};e({actionModifiedData:d,actionNavigatedExternal:!1,actionNavigatedApp:f})}))}},EDIT_RECORD:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!0,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,a){var n,r=t.table,i=t.sourceTable,o=t.rowId,u=P(r,i),s=null===(n=e.action.ActionDefinition)||void 0===n?void 0:n.DesktopEditBehavior;if(!C.ReactRootUIConfig.isInDesktopExperience()||"Edit in place"!==s&&null!=s){var c="#".concat(l.default.stringify({table:u.name(),row:o,page:"form"}));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:_((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(c,void 0,void 0,a)}))}}return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:function(){(0,k.default)().dispatch((0,R.mutateViewInEditMode)(a))}}}},ADD_RECORD:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,requireAddPermission:!0,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,a){var n=t.table,r=t.sourceTable,i=t.defaultValues,o=P(n,r),u="#".concat(l.default.stringify({table:o.name(),page:"form",defaults:i&&JSON.stringify(i)}));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:_((function(){A.AppGlobals.StateChangeHandler.SwitchApp(u,void 0,void 0,a)}))}}},SET_COLUMN_VALUE:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!1,requireUpdatePermission:!0,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,a,n){var r=a.appModel,l=a.table,u=a.tableSchema,c=a.transaction,d=a.inputParameterValues;return new Promise((function(a){var f,p=!1,v=o.default.compact(t.map((function(e){return l.lookupTableRow(e,c)})));v.length!==t.length&&h.default.warnToDevConsole("some rows were missing",t,v);var m=e.assignments();if(m.length&&v.length){var g=r&&r.inRollout("promptUserAction"),y=o.default.partition(m,(function(e){var t,a,n,r;return g&&!e.valueEvalTree||"PARAM"===(null===(a=null===(t=e.valueEvalTree)||void 0===t?void 0:t.model)||void 0===a?void 0:a.EvalType)&&(!d||void 0===d[null===(r=null===(n=e.valueEvalTree.model)||void 0===n?void 0:n.Name)||void 0===r?void 0:r.toLowerCase()])})),b=(0,i.default)(y,2),T=b[0],S=b[1],w=function(){for(var e,t=0;t<v.length;t++){var a=void 0,r=!1,i=l.getPendingRow(v[t],c),o=i.dataContext.augmentWith(n,c),s=o.inputParameterValues;o.inputParameterValues=d,S.length>1&&c.startGroup();for(var f=0;f<S.length;f++){var h=S[f],m=h.valueEvalTree,g=h.ColumnToEdit,y=u.findAttributeByName(g);if(y){var b=m?m.run(o):"";b=y.coerceValue(b),b=y.valueToWireFormat(b),c.update(l.name(),i.stableId,g,b,"action")&&(r=!0)}}S.length>1&&c.endGroup(),r&&((a=a||c.validate([i]).message)?(e=a,c.undo()):p=!0),o.inputParameterValues=s}return e};if(T.length){var C=T.map((function(e){return e.ColumnToEdit})),E=A.AppGlobals.ViewManager.modalForm,k=(0,s.default)(a);return void E.setState({open:!0,errorMessage:null,rowIds:t,columns:C,transaction:c,tableName:l.rootName(),title:e.displayName(r),onCancel:function(){E.setState({open:!1}),k({error:N,actionModifiedData:p,actionNavigatedExternal:!1,actionNavigatedApp:!1})},onSave:function(){var e=w();e?E.setState({errorMessage:e}):(E.setState({open:!1}),k({error:f,actionModifiedData:!0,actionNavigatedExternal:!1,actionNavigatedApp:!1}))}})}var R=w();f=R||f}a({error:f,actionModifiedData:p,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},ADD_RECORD_TO:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,a,n){var r=a.appModel,i=a.table,o=a.transaction;return new Promise((function(a){var l,u,s,c=!1,d=r.findTableCollection(e.referencedTable()).table;if(d)for(var f=function(a){var r=void 0,f=i.lookupTableRow(t[a],o),p=i.getPendingRow(f,o).dataContext.augmentWith(n,o),h={};e.assignments().forEach((function(e){var t=e.ColumnToEdit,a=e.valueEvalTree,n=d.tableSchema.findAttributeByName(t),r=a.run(p);r=n.coerceValue(r,n.type(),n.auxData()),r=n.valueToWireFormat(r),h[t]=r}));var v=o.create(d.name(),h);if(v){c=!0;var m=v.invalidatesRow;if(m){var g=null===(l=null==m?void 0:m.invalid)||void 0===l?void 0:l[0],y=null===(u=null==m?void 0:m.missingRequired)||void 0===u?void 0:u[0];r=m.message||"Could not create row because "+(g?"".concat(g," would be invalid"):"".concat(y," is required"))}r&&(s=r,o.undo())}},p=0;p<t.length;p++)f(p);a({error:s,actionModifiedData:c,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},REF_ACTION:{requireValueEvalTree:!1,bulkRunnable:!1,runAsync:function(e,t,a,n){var r=a.appModel,i=a.table,o=a.actionRunInvocationId,l=a.transaction;return new Promise((function(a){var u,s,c=i.rootTable().lookupTableRow(t[0],l),d=null!==(u=null==c?void 0:c.dataContext.augmentWith(n,l))&&void 0!==u?u:r.dataContext().augmentWith(n,l),f=e.referencedTable(),p=r.findTableCollection(f).table,h=r.appTemplate.actions().findByName(f,e.referencedAction()),v=null==p?void 0:p.keyAttribute(),m=(null==v?void 0:v.valuesToWireFormat((null===(s=e.referencedRowsEvalTree())||void 0===s?void 0:s.run(d))||[]))||[],g=O.getInputParamValues(e,d);O.run(h,{appModel:r,rowIds:m,sourceLocationName:e.name(),sourceTable:p,inputParameterValues:g,actionRunInvocationId:o},(function(e){if("error"in(r=e)&&r.error){var t=e.error,n=M(e,["error"]);L(t),a(n)}else a(e);var r}),n)}))}},NAVIGATE_URL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,tableScopeWhenStatic:!0,run:function(e,t){var a=t.appModel,n=t.tableSchema,r=t.row,i=new p.default(a,n,r),o=e.valueEvalTree().run(i),l=(0,S.sanitizeHref)(o.url||o||""),u=e.launchExternal(),s=v.default.InMobileWebView()&&!u?f.default.toHttpsUrl(l):f.default.normalizeUrlValue(l),c=!1;return s&&(c=!0,InputHandler.switchToUrl(s,u)),{actionModifiedData:!1,actionNavigatedExternal:c,actionNavigatedApp:!1}}},IMPORT_FILE:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!0,requireAddPermission:!0,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,a){var n=a.appModel,r=a.table;return new Promise((function(t){var a=document.createElement("input");a.accept=".csv",a.type="file",a.addEventListener("change",(function(){var i=e.csvLocale(n);if(null!=i&&""!==i){var o;o="Uploading records to table: ".concat(r.name(),"\r\n")+"Locale: ".concat(i,"\r\n\r\n")+"This may take a while.\r\nWe will let you know when it completes.",A.AppGlobals.ViewManager.ShowInfoDialog("Import CSV Started",o,"OK");var l=a.files[0],u=new FormData;u.append("file",l),u.append("userSettings",JSON.stringify(n.GetUserSettings())),u.append("options",JSON.stringify({CsvLocale:i})),(0,b.ajaxPost)("/api/template/".concat(n.AppTemplate.Id,"/table/").concat(r.name(),"/importCsv"),u,{processData:!1,contentType:!1,dataType:"json"}).then((function(e){!function(e){e!==N&&A.AppGlobals.ViewManager.ShowInfoDialog("Import CSV Succeeded",e,"OK")}(e?e.ImportCsvResult:"Success"),A.AppGlobals.StateChangeHandler.RefreshAppData({initiatedBy:"PushedChanges"}),t({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})})).catch((function(e){t({error:D(e),actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}else t({error:"Importing records to table: "+r.name()+" failed because CSV file locale is missing.",actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})})),a.click()}))}},EXPORT_VIEW:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,requireAddPermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,runAsync:function(e,t,n,r){var i=n.appModel,l=n.sourceTable;return new Promise((function(t){var n,u,s=a(673275).getUIStateByKey,d=r?s(r):A.AppGlobals.AppState.CurrentUIState,f=Object.assign({},d);if("DashboardUIState"in f){(0,w.$TSFixMeMaybeNull)(null===(n=f.DashboardUIState)||void 0===n?void 0:n.viewEntries);var p=null===(u=f.DashboardUIState)||void 0===u?void 0:u.viewEntries.reduce((function(e,t){return e.add(t.ViewName)}),new Set),v=l.name(),m=i.appTemplate.viewControls().filter((function(e){return e.TableOrFolderName===v&&"detail"!==e.Action&&p.has(e.Name)}));if(0===m.length&&(m=i.appTemplate.viewControls().filter((function(e){return e.TableOrFolderName===v&&p.has(e.Name)}))),m.length>0){var y=m[0];f.ControlName=y.Name,(0,w.$TSFixMeMaybeNull)(y.Action),f.Root=y.Action}}var b,T=A.AppGlobals.AppState.ComputeHash(f),S=e.csvLocale(i);null!=S&&""!==S?(b="Exporting records from view: ".concat(l.name(),"\r\n")+"Locale: ".concat(S,"\r\n\r\n")+"This may take a while.\r\nWe will let you know when it completes.",A.AppGlobals.ViewManager.ShowInfoDialog("Export CSV Started",b,"OK"),i.MakeGetAppTemplateParams(i.appTemplate.model.Id,!1,(function(e){var a,n,l,u="/api/template/".concat(i.appTemplate.model.Id,"/exportView");try{l=null!=r?null===(a=d[E.SPECIFIC_STATE_NAME_MAP[d.Root]])||void 0===a?void 0:a.FilterExpr:null===(n=(0,g.getViewSpecificUIState)())||void 0===n?void 0:n.FilterExpr}catch(e){var s=e;h.default.ReportErrorOnce({errorMessage:"Error getting filter expression for CSV export",error:s})}var f=o.default.pickBy({appLink:T,version:e.version,localVersion:e.localVersion,tzOffset:e.tzOffset,settings:e.settings,location:e.location,locale:e.locale,csvLocale:S,FilterExpr:null==l?void 0:l.toJSON()});$.postJSON(u,f,(function(e){!function(e){e!==N&&A.AppGlobals.ViewManager.ShowInfoDialog("Export CSV Succeeded",e,"OK")}("Success");var a=new Blob([e],{type:"text/csv"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="AppSheet.ViewData.".concat((0,c.default)().format("YYYY-MM-DD"),".csv"),r.click(),URL.revokeObjectURL(n),t({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}),(function(e){t({error:D(e),actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}))):t({error:"Exporting records from table: "+l.name()+" to a CSV file failed because CSV file locale is missing.",actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},NAVIGATE_APP:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,tableScopeWhenStatic:!0,run:function(e,t,a){var n=t.appModel,r=t.tableSchema,i=t.row,o=t.sourceTable,l=t.filterExpr,u=t.defaultValues,s=new p.default(n,r,i),c=e.valueEvalTree().run(s),d=!1;if(c){if(c.toLowerCase()==="#control=_PARENTVIEW".toLowerCase())return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:y.JeeneeBrowserAPI.navigateBack()};if(e.isAutoCreated())try{var f=A.AppGlobals.AppState.ParseHash(c),v=!1;if(f.table&&o&&o.isSlice()&&o.rootTable().name()===f.table){var m=r.findAttributeByName(e.columnToEdit());"Address"!==m.type()&&"LatLong"!==m.type()||(f.table=o.name(),v=!0)}l&&!f.filterExpr&&(f.filter=JSON.stringify(l.model),v=!0),u&&!f.defaults&&(f.defaults=JSON.stringify(u),v=!0),v&&(c="#"+$.param(f))}catch(e){h.default.warnToDevConsole(e)}d=_((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(c,void 0,void 0,a)}))}return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:d}}},NAVIGATE_BACK:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,tableScopeWhenStatic:!0,run:function(){return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:y.JeeneeBrowserAPI.navigateBack()}}},COPY_EDIT_ROW:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,a){var n=t.table,r=t.tableSchema,i=t.row,l=t.sourceTable,u=r.keyAttributes().map((function(e){return e.name()})),s=o.default.omit(i,u),c=n.name();try{l&&l.isSlice()&&l.rootTable().name()===n.name()&&(c=l.name())}catch(e){h.default.warnToDevConsole(e)}var d="#table=".concat(encodeURIComponent(c))+"&page=form"+"&defaults=".concat(encodeURIComponent(JSON.stringify(s)));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:_((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(d,void 0,void 0,a)}))}}},COMPOSITE:{requireValueEvalTree:!1,bulkRunnable:!1,run:function(){throw new Error("Composite action should not be run directly")}},OPEN_FILE:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,tableScopeWhenStatic:!0,run:function(e,t){var a=t.appModel,n=t.table,r=t.tableSchema,i=t.row,o=new p.default(a,r,i),l=e.valueEvalTree().run(o),u=A.AppGlobals.AppModel.ResolveFile(l,n.rootName()),s=!1;return u&&(s=!0,InputHandler.switchToUrl(u)),{actionModifiedData:!1,actionNavigatedExternal:s,actionNavigatedApp:!1}}},EMAIL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var a=t.appModel,n=t.tableSchema,r=t.row,i=a&&a.IsWhitelabelApp(),o=new p.default(a,n,r),l=e.valueEvalTree().run(o),u=e.messageSubjectEvalTree(),s=u?u.run(o):" ",c=e.messageBodyEvalTree(),d=c?c.run(o):" ",f=m.default.mailToUrl(l,s,d,i),h=!1;return f&&(h=!0,InputHandler.switchToUrl(f)),{actionModifiedData:!1,actionNavigatedExternal:h,actionNavigatedApp:!1}}},CALL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var a=t.appModel,n=t.tableSchema,r=t.row,i=new p.default(a,n,r),o=e.valueEvalTree().run(i),l=m.default.phoneUrl(o),u=!1;return l&&(u=!0,InputHandler.switchToUrl(l)),{actionModifiedData:!1,actionNavigatedExternal:u,actionNavigatedApp:!1}}},SMS:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var a=t.appModel,n=t.tableSchema,r=t.row,i=new p.default(a,n,r),o=e.valueEvalTree().run(i),l=e.messageBodyEvalTree(),u=l?l.run(i):null,s=m.default.smsUrl(o,u),c=!1;return s&&(c=!0,InputHandler.switchToUrl(s)),{actionModifiedData:!1,actionNavigatedExternal:c,actionNavigatedApp:!1}}},TRIGGER_PROCESS:{requireValueEvalTree:!1,bulkRunnable:!1,runAsync:function(e,t,a){var n,r=a.appModel,i=a.table,o=a.transaction,l=t[0],u=null===(n=i.lookupTableRow(l,o))||void 0===n?void 0:n.values;if(!u)return Promise.resolve({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1,error:"Could not find row with id '".concat(l,"' in table '").concat(i.name(),"'")});var s=JSON.stringify(u),c=m.default.makeGuid();return(0,b.ajaxPost)("/api/apps/".concat(r.AppTemplate.Id,"/userAppEvent"),{appTemplateId:r.AppTemplate.Id,appTemplateVersion:r.AppTemplate.Version,eventID:e.triggerEventId(),eventInstanceId:c,tableName:i.name(),payload:s,triggerCondition:"UPDATE"},{dataType:"json",contentType:"application/json"}).then((function(){return{actionModifiedData:!0,actionNavigatedExternal:!1,actionNavigatedApp:!1}})).catch((function(e){return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1,error:e.message}}))}}};var F=null,G=new Map,V=function(e){var t=G.get(e);return null==t&&(t={runsStarted:0,runsFinished:0,averageTime:0,maxTime:0},G.set(e,t)),t},B=function(e){return{id:(0,T.makeGuid)(),actionName:e.name(),actionType:e.type(),timestamp:Date.now(),needsConfirmation:e.needsConfirmation(),awaitingConfirmation:!1}};var U=O={confirmAction:function(e,t,a,n,r,i){var o;if(e.needsConfirmation()){var l=r.dataManager.currentTransaction,u=1===(null==t?void 0:t.length)?null===(o=a.lookupTableRow(t[0],l))||void 0===o?void 0:o.values:null,s=e.confirmationMessage(r,n,u),c=Date.now(),d={name:e.displayName(r,n,u),callback:function(){return i(!0,Date.now()-c)},classes:"btn-danger",dismiss:!0},f={name:r.MapActionName("No"),callback:function(){return i(!1,Date.now()-c)},dismiss:!0},p=r.MapActionName("Confirm"),h=[f,d];setTimeout((function(){A.AppGlobals.ViewManager.ShowDynamicReactModal({title:p,message:s,buttons:h})}),200)}else i(!0,0)},run:function(e,t,a,n){var r=t.appModel,i=void 0===r?A.AppGlobals.AppModel:r,l=t.rowId,s=t.rowIds,c=t.sourceLocationName,f=t.sourceTable,v=t.defaultValues,g=t.filterExpr,y=t.inputParameterValues,b=t.actionRunInvocationId;null!=l&&null!=s&&h.default.warnToDevConsole("ActionRunner run was given rowId and rowIds");var T=!0;null!=l&&(s=[l],T=!1);var S=null==l&&null==s&&e.dynamicTableScope();s=s||[];var w,C,E,k,R=[e],I=(w=e.name(),V(w).runsStarted+=1,Date.now());if(null==F)F=C=B(e);else if(F.id!==b){var M=F.timestamp-I,N=V(e.name());h.default.ReportErrorOnce(Object.assign({errorMessage:"Transaction Error: Attempting to run a new action when the previous one did not complete",newActionName:e.name(),newActionType:e.type(),lastActionName:F.actionName,lastActionType:F.actionType,timeSinceLastInvocation:M,withinAverage:M<N.averageTime},N)),F=C=B(e)}else C=F;h.default.AddTraceContext("DataAction Triggered",{"Action Location":c,"Action Source Table Name":f&&"function"==typeof f.name?f.name():null,"Action Type":e.type(),"Action Name":e.name(),"Action Nested Types":"COMPOSITE"===e.type()?R.map((function(e){return e.type()})).join(", "):null,"Action Bulk Mode":T,"Action Row Count":s.length,"Action Created By":e.createdBy()});var _=!1,D=!1,P=!1,G=null,U=!1,H=0;(0,u.default)((function(e){e(void 0,!(D||U||G||R.length<1))}),(function(t){var a,r=R.shift();try{a=function(e,t){if(null==t)throw new Error("ActionRunner requires an appModel");var a=d.default.findByName(e.table(),t),n=a.table,r=a.tableSchema;if(null==n||null==r)throw new Error("Error running action, unknown table:"+e.table());var i=x[e.type()];if(null==i)throw new Error("Unknown action type:"+e.type());return{actionRunner:i,table:n,tableSchema:r}}(r,i)}catch(e){return G=e.message,void h.default.errorToDevConsole(G)}var l=a,u=l.actionRunner,c=l.table,m=l.tableSchema,b=c.rootTable();if(b){var T=function(e,t,a,n,r,i,o){var l=t.dataManager.currentTransaction,u=new p.default(t,i,null,void 0,void 0,void 0,o?{viewStateKey:o}:void 0,l),s=n.filter((function(t){var a,n=null===(a=r.lookupTableRow(t,l))||void 0===a?void 0:a.values;return n?(u.replaceRowData(n),e.isValidForRow(n,u)):(h.default.errorToDevConsole({rowId:t,error:"Unable to find row ".concat(t," in target table ").concat(r.name())}),!1)}));return s}(r,i,0,s,b,m,n);if(r.tableScope()||S||0!==T.length){if("COMPOSITE"===r.type()){var A=e.nestedActions(i);R=A.concat(R)}C.awaitingConfirmation=!0,O.confirmAction(r,T,b,m,i,(function(e,a){if(H=a,C.awaitingConfirmation=!1,!e)return U=!0,void t();if("COMPOSITE"!==r.type()){var l=c.rootTable();if(!l)return h.default.warnToDevConsole("Unable to find root table for slice ".concat(c.name())),void t();if(u.navigatesExternal&&P)t();else{(E=i.dataManager.currentTransaction).closed&&h.default.ReportErrorOnce({errorMessage:"Transaction Error: transaction already closed on action confirmation"}),(k=!E.started)&&E.start();var s,d={appModel:i,table:c,tableSchema:m,sourceTable:f,transaction:E,defaultValues:v,filterExpr:g,rowIds:T,inputParameterValues:y,actionRunInvocationId:C.id},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G=e.error||G,_=e.actionModifiedData||_,D=e.actionNavigatedApp||D,P=e.actionNavigatedExternal||P},b=function(){G&&L(G),k?E.commit((function(e){e&&(E.abort(),G=e.message,L(G),"function"==typeof D&&(D=!1)),t()})):t()};"runAsync"in(s=u)&&"function"==typeof s.runAsync?r.tableScope()||S||u.bulkRunnable?(h.default.logToDevConsole("running async",r.name()),u.runAsync(r,T,d,n).then(p).then(b)):Promise.all(T.map((function(e){return u.runAsync(r,[e],d,n).then(p)}))).then(b):(r.tableScope()||S?p(u.run(r,d,n)):T.forEach((function(e){var t,a=null===(t=l.lookupTableRow(e,E))||void 0===t?void 0:t.values;p(u.run(r,o.default.extend({},d,{row:a,rowId:e}),n))})),b())}}else t()}))}else t()}else h.default.warnToDevConsole("Unable to find root table for slice ".concat(c.name()))}),(function(){null!=b||C!==F||(F=null),function(e,t,a){var n=Date.now()-t-a,r=V(e),i=r.runsFinished,o=i+1;r.averageTime=(i*r.averageTime+n)/o,r.runsFinished=o,r.maxTime=Math.max(r.maxTime,n)}(e.name(),I,H),"function"==typeof D&&(D(),D=!0),"function"==typeof a?a({actionModifiedData:_,actionNavigatedApp:D,actionNavigatedExternal:P,error:G}):_&&(!i.ShouldDelaySync()||(0,m.isMonitoringApp)(i.appTemplate.id())&&"Select This App to Monitor"===e.action.Name)?window.InputHandler.ProcessSync():D||A.AppGlobals.StateChangeHandler.ShowUIState(!0),h.default.logToDevConsole("all actions have finished for rootAction",e.name())}))},getInputParamValues:function(e,t){var a={},n=e.action.ActionDefinition.InputAssignments;if(null!=n)for(var r=0;r<n.length;r++){var i=n[r],o=e.inputParameterValueEvalTree(r);null!=o&&(a[i.InputName.toLowerCase()]=o.run(t))}return a}};t.default=U;var H=x;t.actionTypes=H},440587:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t,a){(0,r.default)(this,e),this.url=t||"",this.linkText=a||""}return(0,i.default)(e,[{key:"toString",value:function(){return this.url?String(this.url):""}}],[{key:"from",value:function(t){return new e(null==t?void 0:t.Url,null==t?void 0:t.LinkText)}}]),e}();t.default=o},302443:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLatLong=t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(190644)),l=function(){function e(t,a){(0,r.default)(this,e),this.latitude=parseFloat(t||0),this.longitude=parseFloat(a||0)}return(0,i.default)(e,[{key:"toString",value:function(){return this.latitude.toFixed(6)+", "+this.longitude.toFixed(6)}}],[{key:"fromString",value:function(t){if(!t)return null;if("string"!=typeof t)return null;var a=t.split(", ");return 2===a.length&&o.default.isValidLatLng(a[0],a[1])?new e(a[0],a[1]):null}}]),e}(),u=Object.freeze(new l(0,0));t.defaultLatLong=u;var s=l;t.default=s},523930:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(667294)),u=n(a(973935));window.React=l.default;var s=function(){function e(t){(0,r.default)(this,e),this.state=t.state||{},this.initialState=o.default.clone(this.state),this.$parent=t.parent?$(t.parent):null,this.renderCb=t.render,this.dispose=t.dispose,this.$el=$("<div >"),this.$el.addClass("WidgetHelperRoot"),this.$parent&&this.$parent.append(this.$el),this.$el.data("widget",this),this.$bus=$(this),this.render()}return(0,i.default)(e,[{key:"on",value:function(e,t){this.$bus.on(e,t)}},{key:"_trigger",value:function(e){this.$bus.trigger(e)}},{key:"updateHandler",value:function(){var e=this,t=o.default.toArray(arguments);return function(){for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];t.forEach((function(t,a){e.state[t]=n[a]})),e.render(),e._trigger("change")}}},{key:"render",value:function(){function t(){var t=this;this.reactElement=this.renderCb(this.state);var a=function(){t.component=u.default.render(t.reactElement,t.$el[0])};e.deferMode?e._queuedRenders.push(a):a()}if(location.host.indexOf("appsheet.com")>=0)try{t.call(this)}catch(e){var a=e;if(-1===a.toString().indexOf("parentNode"))throw a}else t.call(this)}},{key:"replaceState",value:function(e){this.state=e,this.render()}},{key:"setState",value:function(e){o.default.extend(this.state,e),this.render()}},{key:"getState",value:function(){return this.state}},{key:"unmount",value:function(){return null!=this.dispose&&this.dispose(),window.ReactDOM.unmountComponentAtNode(this.$el[0])}},{key:"reinitializeComponent",value:function(e){if(this.component){var t;t=this.component.getInitialState?this.component.getInitialState():this.component.initialState?this.component.initialState():{},this.component.state=t;var a=o.default.clone(this.initialState);a.refreshId=Math.random(),this.state=o.default.extend(a,e||{})}}}],[{key:"fromEl",value:function(e){return e.data("widget")}},{key:"startBatch",value:function(){window.Common.RunningInTestFramework||(e.deferMode=!0)}},{key:"clearBatch",value:function(){e._queuedRenders=[]}},{key:"flush",value:function(t){if(t){var a=e._queuedRenders.splice(0,100);for(e.deferMode=!1;a.length;){a.pop()()}e._queuedRenders.length&&setTimeout((function(){e.flush(!0)}),100)}else setTimeout((function(){e.flush(!0)}),window.Common.FADE_OUT_DURATION_MS)}}]),e}();t.default=s,s._queuedRenders=[]},304878:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t,a){(0,r.default)(this,e),this.x=parseFloat(t||0),this.y=parseFloat(a||0)}return(0,i.default)(e,[{key:"toString",value:function(){return this.x.toFixed(6)+", "+this.y.toFixed(6)}}],[{key:"isValidXOrY",value:function(e){var t=Number(e);return null!=e&&""!==e&&!isNaN(t)&&t>=0&&t<=100}},{key:"fromString",value:function(t){if(!t)return null;if("string"!=typeof t)return null;var a=t.split(", ");return 2===a.length&&e.isValidXOrY(a[0])&&e.isValidXOrY(a[1])?new e(a[0],a[1]):null}}]),e}();t.default=o},852468:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ZERO_RESULTS=t.REQUEST_DENIED=t.OVER_QUERY_LIMIT=t.OK=t.INVALID_REQUEST=void 0;var r=n(a(856690)),i=n(a(689728));t.OK="OK";var o="OVER_QUERY_LIMIT";t.OVER_QUERY_LIMIT=o;t.ZERO_RESULTS="ZERO_RESULTS";t.REQUEST_DENIED="REQUEST_DENIED";t.INVALID_REQUEST="INVALID_REQUEST";var l=function(){function e(){(0,r.default)(this,e),this.BASE_MAX_CALL_RATE=1e3,this.maxCallRateMs=this.BASE_MAX_CALL_RATE,this.queue=[],this.timer=null,this.maxQueueLength=0}return(0,i.default)(e,[{key:"queueApiCall",value:function(e){var t=this,a=e.address,n=e.lat,r=e.lng,i=e.region,l=e.interactive,u=function(e){l?t.queue.unshift(e):t.queue.push(e),t.flush()};return new Promise((function(e){u((function l(){return t.makeApiCall({address:a,lat:n,lng:r,region:i}).then((function(a){var n=a.results,r=a.status;if("OK"===(r=t.normalizeStatus(r,n))&&n&&n.length)n=t.normalizeResults(n),e({results:n});else if(r===o){var i=2*t.maxCallRateMs;console.log("\nQuery limit hit after "+(t.maxQueueLength-t.queue.length)+" with remaining queue length "+t.queue.length),console.log("increasing timeout to "+i),t.maxQueueLength=t.queue.length,t.maxCallRateMs=i,clearInterval(t.timer),t.timer=null,u(l)}else e({status:r})}))}))}))}},{key:"flush",value:function(){var e=this;this.queue.length>this.maxQueueLength&&(this.maxQueueLength=this.queue.length),null==this.timer&&(this.timer=setInterval((function(){var t=e.queue.shift();t?t():(clearInterval(e.timer),e.timer=null,console.log("queue finished"),e.maxCallRateMs=e.BASE_MAX_CALL_RATE,e.maxQueueLength=0)}),this.maxCallRateMs))}}]),e}();t.default=l},431335:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.CSV=void 0;var r=n(a(757460)),i=n(a(571524)),o=n(a(593186)),l="__dummyHeader",u={parse:function(e){var t;i.default.IsChromeBrowser()&&(t=function(e){return(" "+e).substr(1)});var a=r.default.parse(e,{header:!0,skipEmptyLines:!0,delimiter:",",transform:t}),n=a.data,l=!1;if(a.errors.length){l=!0;try{var u="q12i65o6a3530q5s9p",s=new RegExp(u,"g");if(!e.match(u)){var c=e.replace(/\r(?!\n)/g,u),d=r.default.parse(c,{header:!0,skipEmptyLines:!0});if(!d.errors.length){var f=[];d.data.forEach((function(e){var t={};for(var a in e)e[a]&&"function"==typeof e[a].replace?t[a]=e[a].replace(s,"\r"):t[a]=e[a];f.push(t)})),n=f,l=!1}}}catch(e){o.default.ReportErrorOnce({error:e,errorMessage:"Error trying to fix CSV input"})}}return l&&a.errors.forEach((function(e){o.default.ReportErrorOnce({errorMessage:"Unfixable error parsing CSV",error:e})})),n},stringify:function(e){var t;if(Array.isArray(e))t=e;else for(var a in t=[],e)e.hasOwnProperty(a)&&t.push(e[a]);var n="";if(t.length>0){var r="";for(var i in t[0])if(t[0].hasOwnProperty(i)){if(l===i)continue;""!==r&&(r+=","),r+=i}n+=r+"\r\n"}for(var o=0;o<t.length;o++)if(!t[o].hasOwnProperty(l)){var u="";for(var s in t[o])t[o].hasOwnProperty(s)&&(""!==u&&(u+=","),u+='"'+t[o][s]+'"');n+=u+"\r\n"}return n}};t.CSV=u},56749:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ASThemeProvider=void 0,t.cacheMuiTheme=c,t.themeColor=function(e){var t,a=null===(t=i.AppGlobals.ViewManager)||void 0===t?void 0:t.theme;return a?a.getThemeColor(e):null};var r=a(697211),i=a(166089),o=n(a(496486)),l=n(a(667294)),u=a(557310),s=(0,r.createTheme)({typography:{useNextVariants:!0,fontSize:18,fontFamily:"inherit"}});function c(e){var t=new WeakMap;return function(){var a,n,l=null===(n=null===(a=i.AppGlobals.ViewManager)||void 0===a?void 0:a.theme)||void 0===n?void 0:n.themeData;if(!l)return s;var c,d=t.get(l);if(d)return d;var f=i.AppGlobals.ViewManager.theme.getMuiThemeOptions();c=e?o.default.merge({},f,e(f)):f;var p=(0,r.createTheme)(Object.assign(Object.assign({},c),u.ReactRootUIConfig.isInDesktopExperience()&&{props:{MuiButton:{disableElevation:!0}}}));return t.set(l,p),p}}var d,f=c(),p=c((function(){var e=i.AppGlobals.ViewManager.theme.getHeaderMuiThemeOptions();return d?o.default.merge({},e,d(e)):e})),h=(0,r.createGenerateClassName)({disableGlobal:!0,seed:"h"}),v=(0,r.createGenerateClassName)({disableGlobal:!0,seed:"m"});t.ASThemeProvider=function(e){var t=e.header,a=e.children,n=t?p():f(),i=t?h:v;return l.default.createElement(r.StylesProvider,{generateClassName:i},l.default.createElement(r.MuiThemeProvider,{theme:n},a))}},469534:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.maybeSubscribeToPunctual=function(e){try{var t=function(){if(!window.getPunctualClient)return{v:void 0};if(g(),s.dynamicRollouts.includeByOwnerId("DisableNotificationSync"))return{v:void 0};if(!(null==e?void 0:e.Id))return{v:void 0};for(var t=function(e){var t,a=((null===(t=null==e?void 0:e.AppData)||void 0===t?void 0:t.DataSets)||[]).filter((function(e){return"native"!==e.ProviderName}));return a.length>0&&u.default.every(a,(function(e){return"google_tables"===e.ProviderName}))}(e),a=function(e,t){var a=[];if(!(null==e?void 0:e.Id))return a;a.push({name:"DATA_ONLY_".concat(e.Id.replace(/-/g,"_")),rootId:"topics"}),t&&a.push.apply(a,(0,o.default)(function(e){var t,a=[];if(!(null==e?void 0:e.Id))return a;var n=((null===(t=null==e?void 0:e.AppData)||void 0===t?void 0:t.DataSets)||[]).filter((function(e){return"google_tables"===(null==e?void 0:e.ProviderName)})).map((function(e){var t;return{name:"tuples-"+p(null!==(t=e.Source)&&void 0!==t?t:""),rootId:"tables"}})).filter((function(e){return!!e.name}));return a.push.apply(a,(0,o.default)(n)),a}(e)));return a}(e,t),n=function(e){l.default.logToDevConsole("Subscribing notifications for ",a[e].rootId,a[e].name),r=window.getPunctualClient().subscribe(a[e].name,(function(e){!function(e,t){if(s.dynamicRollouts.includeByOwnerId("DisableNotificationSync"))return;if(l.default.logToDevConsole("DATA NOTIFICATION RECEIVED : ",e),t&&function(e){var t,a,n;if(!e)return!1;if("tables"!==(null===(t=e.objectId)||void 0===t?void 0:t[0]))return!1;if(!(null===(n=null===(a=e.objectId)||void 0===a?void 0:a[1])||void 0===n?void 0:n.startsWith("tuples-")))return!1;return!0}(e))return void h();if(!e.payload)return;try{var a=JSON.parse((new TextDecoder).decode(e.payload));if("ProviderCache"===a.messageType)v(a);else m()}catch(e){l.default.ReportErrorOnce({errorMessage:"Failed to parse data notification",error:e})}}(e,t)}),(function(e){l.default.ReportError({errorMessage:"Error processing message from punctual. Updates for this app will halt.",error:e}),g()}),(function(){l.default.logToDevConsole("Unsubscribed notifications for ",a[e].rootId,a[e].name)}),a[e].rootId)},i=0;i<a.length;i++)n(i)}();if("object"===(0,i.default)(t))return t.v}catch(e){l.default.ReportError({errorMessage:"Error subscribing to punctual",error:e})}};var r,i=n(a(918698)),o=n(a(600861)),l=n(a(593186)),u=n(a(496486)),s=a(44617),c=a(354632),d=a(166089),f=a(609464);function p(e){var t;return(t=e.match(/^(?:ID=)?tables\/([^/]+)$/))||(t=e.match(/^(?:ID=)?base\/[^/]+\/tables\/([^/]+)$/))?t[1]:""}var h=u.default.throttle((function(){var e,t;c.syncCountMetric.record({Visibility:"Hidden",InitiatedBy:"Notification",NotificationType:"TablesOnlyApp"}),null===(t=null===(e=d.AppGlobals.AppModel)||void 0===e?void 0:e.startBackgroundSync)||void 0===t||t.call(e,{initiatedBy:"Notification"})}),Math.ceil(2e3+5e3*Math.random())),v=u.default.throttle((function(e){var t;null===(t=d.AppGlobals.AppModel)||void 0===t||t.startBackgroundSync({initiatedBy:"Notification",notification:e})}),Math.ceil(2e3+5e3*Math.random())),m=u.default.throttle((function(){s.dynamicRollouts.includeByOwnerId("SendDataNotificationsOnChangeRollout")&&(c.syncCountMetric.record({Visibility:"Hidden",InitiatedBy:"Notification",NotificationType:"DataChange"}),(0,f.deltaNotificationInstance)().checkChanges().catch((function(e){l.default.ReportError({errorMessage:"Error processing data change notification",error:e})})))}),Math.ceil(200+1e3*Math.random()));function g(){try{r&&r.unsubscribe(),r=void 0}catch(e){l.default.ReportError({errorMessage:"Ignoring error while unsubscribing to punctual",error:e})}}},609464:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DeltaNotificationClient=void 0,t.deltaNotificationInstance=function(){y||(y=new b);return y};var r=n(a(364687)),i=n(a(856690)),o=n(a(689728)),l=n(a(593186)),u=a(635672),s=n(a(962553)),c=n(a(496486)),d=a(166089),f=n(a(385857)),p=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))};function h(e,t){return e.sliceDefinition?function(e,t){for(var a={},n=0;n<e.Columns.length;n++){var r=e.Columns[n];null!=r&&null!=t[n]&&(a[r]=t[n])}return a}(e.sliceDefinition,t):function(e,t){for(var a={},n=e.allAttributes(),r=0;r<n.length;r++){var i=n[r];null!=i&&i.isValid()&&null!=t[r]&&!i.isVirtual()&&(a[i.name()]=t[r])}return a}(e,t)}function v(e,t){var a=e.keyAttribute().name();return c.default.trim(t[a])}function m(e){var t=d.AppGlobals.AppModel.AppTemplate;if(t&&e.Id===t.Id&&e.Version===t.Version){var a=function(e,t,a){for(var n=[],r=0;r<t.Changes.length;r++)for(var i=t.Changes[r],o=s.default.findByName(i.TableName).tableSchema,l=new f.default(d.AppGlobals.AppModel,o,void 0),u=0;u<i.Changes.length;u++){var c=i.Changes[u],p=h(o,c.ChangedValues);l.rowData=p,l.recomputeVirtualColumns({recomputeKey:!0});var m={tableName:i.TableName,row:p,appName:e.Name,appId:e.Id,appVersion:e.Version,userSettings:a,mechanism:"Notification"};if("Insert"===c.Type){var g=Object.assign({actionType:"AddTableRow",type:"AddTableRow"},m);n.push(g)}else if("Update"===c.Type){var y=Object.assign({actionType:"UpdateTableRow",type:"UpdateTableRow"},m);n.push(y)}else if("Delete"===c.Type){var b=Object.assign(Object.assign({actionType:"DeleteTableRow",type:"DeleteTableRow"},m),{rowKey:v(o,m.row)});n.push(b)}}return n}(t,e,d.AppGlobals.AppModel.GetUserSettings());d.AppGlobals.AppModel.AddDeleteOrUpdateTableRows(a,(function(t){l.default.logToDevConsole("DELTA_NOTIFICATION: SUCCESS ".concat(e.Timestamp))}),(function(t){l.default.logToDevConsole("DELTA_NOTIFICATION: FAILURE ".concat(e.Timestamp))}),{skipWriteTables:!0,usedTransactions:!1,bypassSubmitToServer:!0})}else l.default.logToDevConsole("DELTA_NOTIFICATION: IGNORING ".concat(e.Id,"|").concat(e.Version," != ").concat(t.Id,"|").concat(t.Version))}function g(e){for(var t=0;t<e.length;t++)m(e[t])}var y,b=function(){function e(){(0,i.default)(this,e),this.latestSyncToken$=Promise.resolve(""),this.appId="",this.appVersion=""}return(0,o.default)(e,[{key:"setLatestWatermark",value:function(e,t){return this.latestSyncToken$=Promise.resolve(t||""),this.appId=e.Id,this.appVersion=e.Version,l.default.logToDevConsole("DELTA_NOTIFICATION: ".concat(this.appId,"|").concat(this.appVersion,"|").concat(t)),this}},{key:"checkChanges",value:function(){return p(this,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.latestSyncToken$=this.checkChangesImpl(),e.next=3,this.latestSyncToken$;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"checkChangesImpl",value:function(){return p(this,void 0,void 0,r.default.mark((function e(){var t,a,n,i,o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appId){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.latestSyncToken$;case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return","");case 7:if(!d.AppGlobals.AppModel){e.next=11;break}if(!d.AppGlobals.AppModel.NumDelayedActions()&&!d.AppGlobals.AppModel.NumProcessingActions()){e.next=11;break}return l.default.logToDevConsole("Ignoring delta notification, pending queue items"),e.abrupt("return",t);case 11:return e.prev=11,a="/api/app/notifications/".concat(this.appId,"?version=").concat(this.appVersion),n={contentType:"application/json"},i={DeltaNotificationSyncToken:t,UserSettings:JSON.stringify(d.AppGlobals.AppModel.GetUserSettings())},e.next=17,(0,u.ajaxPost)(a,i,n);case 17:if(o=e.sent,t=o.DeltaNotificationSyncToken,!d.AppGlobals.AppModel){e.next=23;break}if(!d.AppGlobals.AppModel.NumDelayedActions()&&!d.AppGlobals.AppModel.NumProcessingActions()){e.next=23;break}return l.default.logToDevConsole("Ignoring delta notification after fetch, pending queue items"),e.abrupt("return",t);case 23:l.default.logToDevConsole("DELTA_NOTIFICATION: ".concat(this.appId,"|").concat(this.appVersion,"|").concat(t,"|").concat(o)),g(o.Changes),StateReflector.ShowUIState(!0),l.default.logToDevConsole("Processed changes ".concat(JSON.stringify(o))),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(11),l.default.ReportError({errorMessage:"Error processing updates from notification queue",error:e.t0});case 32:return e.abrupt("return",t);case 33:case"end":return e.stop()}}),e,this,[[11,29]])})))}}]),e}();t.DeltaNotificationClient=b},386350:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.EDITOR_IFRAME_PREVIEW_SOURCE=void 0,t.onEditorIframePreviewMessage=function(e){var t=function(e){return function(t){var a=t.data||{},n=a.source,i=a.event,l=a.data;t.isTrusted&&(t.origin===r.WindowWrapper.location.origin||window.APPSHEET_TEST_CONTEXT)&&n===o&&e(i||"",l||{})}}(e);return window.addEventListener("message",t,!1),function(){window.removeEventListener("message",t)}},t.sendEditorMessage=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.default.IsEditorIFramePreview()&&(null===(t=window.parent)||void 0===t?void 0:t.postMessage)&&window.parent.postMessage({source:o,event:e,data:a},"*")};var r=a(892148),i=n(a(571524)),o="editor-iframe-preview";t.EDITOR_IFRAME_PREVIEW_SOURCE=o},315847:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(249e3)),i=n(a(881052)),o=a(351101),l={BAD_GEO_VALUE:181,get disabled(){var e;return!0===(null===(e=(0,o.getAppModel)())||void 0===e?void 0:e.appTemplate.isGoogleMapsDisabled)},region:function(e){var t="US";if(e=e||r.default.language()){var a=e.match(/^\w{2}-(\w{2})$/),n=null==a?void 0:a[1];n&&(t=n.toLowerCase())}return t},_knownAddresses:{},addressHasBeenQueued:function(e){return l._knownAddresses[e]},geocodeAddress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.region,n=t.interactive;return l.disabled?Promise.reject(new Error("geocodeAddress requested but geocoding is disabled")):(l._knownAddresses[e]=!0,i.default.queueApiCall({address:e,region:a,interactive:n}))},lookupAddress:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.region,r=a.interactive;return l.disabled?Promise.reject(new Error("lookupAddress requested but geocoding is disabled")):i.default.queueApiCall({lat:e,lng:t,region:n,interactive:r})}},u=l;t.default=u},190644:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.GeolocationClass=t.Geolocation=void 0;var r=n(a(689728)),i=n(a(856690)),o=n(a(496486)),l=n(a(112368)),u=n(a(593186)),s=a(891666),c=a(44617),d=n(a(571524)),f=a(892148);function p(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var v=function(e){return e*(Math.PI/180)},m=2e4,g=1e3,y=6e4;function b(e){var t={};for(var a in e.coords)t[a]=e.coords[a];return{timestamp:Date.now(),coords:t}}var T=(0,r.default)((function e(t){var a=this;(0,i.default)(this,e),this.options=t,this.id=-1,this.status="stopped",this.stop=function(){"stopped"!==a.status&&(u.default.logToDevConsole("stopped watching position",a),a.status="stopped",navigator.geolocation.clearWatch(a.id))},this.start=function(){if("watching"!==a.status){u.default.logToDevConsole("started watching position",a),a.status="watching";var e=a.options,t=e.callback,n=void 0===t?function(){}:t,r=e.failureCallback,i=void 0===r?function(){}:r;a.id=navigator.geolocation.watchPosition((function(e){return n(b(e))}),(function(e){a.stop(),i(new Error(e.message))}),a.options)}},this.start()})),S=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this.available=null,this.pending=!1,this.lastPosition=null,this.history=[],this._activeWatchers=new Set,this.pauseAllWatchers=function(){var e,a=p(t._activeWatchers);try{for(a.s();!(e=a.n()).done;){(0,e.value.stop)()}}catch(e){a.e(e)}finally{a.f()}},this.resumeAllWatchers=function(){var e,a=p(t._activeWatchers);try{for(a.s();!(e=a.n()).done;){(0,e.value.start)()}}catch(e){a.e(e)}finally{a.f()}},this.getPollingUpdateInterval=function(){if(!1===t.available)return m;if(t.history.length>=2){var e=t.history[0],a=Math.min(e.kmph,130),n=o.default.meanBy(t.history.filter((function(e){return null!=e.kmph})),(function(e){return e.kmph}));a=Math.max(a,n);var r=Math.floor(m-1900*Math.pow(a/130,.05)*10);return isNaN(r)?m:Math.min(Math.max(r,g),m)}return g},this.kmDistance=function(e,t,a,n){var r=v(a-e),i=v(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(v(e))*Math.cos(v(a))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},this.ifAvailable=function(e,a){return!0===t.available?"function"==typeof e?e():null:!1===t.available?"function"==typeof a?a():null:(null===t.available&&(t.pending?f.WindowWrapper.setTimeout((function(){t.ifAvailable(e,a)}),3e3):t.fetchLatLong(e,a,{enableHighAccuracy:!1})),null)},this.lastPositionAge=function(){return t.lastPosition&&t.lastPosition.timestamp?Date.now()-t.lastPosition.timestamp:1/0},this.logNewPosition=function(e){var a,n=Object.assign(Object.assign({},e),{timestamp:null!==(a=e.timestamp)&&void 0!==a?a:Date.now()}),r=t.history[0];if(r){t.history=t.history.filter((function(e){return n.timestamp-e.timestamp<18e4}));var i=n.timestamp-r.timestamp;if(i>5e3){var o=t.kmDistance(r.coords.latitude,r.coords.longitude,n.coords.latitude,n.coords.longitude);isNaN(o)||(n.kmph=Math.floor(o/(i/1e3/3600)),t.history.unshift(n))}}t.lastPosition=n},this.supportsNativeLocation=function(){var e;return c.dynamicRollouts.includeByUserId("ClientAndroidNativeLocation")&&"function"==typeof(null===(e=window.JeeneeAndroid)||void 0===e?void 0:e.startLocationUpdates)&&l.default.IsAndroidAppWithMinVersion(14)||c.dynamicRollouts.includeByUserId("ClientIOSNativeLocation")&&d.default.InIOSWebView()&&l.default.IsIOSAppWithMinVersion(14.6)},this.onPositionResult=function(e){u.default.logToDevConsole("Geolocation.onPositionResult",e),t.available=!0,t.pending=!1,t.logNewPosition(e)},this.onErrorResult=function(e){u.default.logToDevConsole("Geolocation.onErrorResult",e),t.available=!1,t.pending=!1},this.fetchLatLong=function(e,a,n){var r;if(null!=(null===(r=window.navigator)||void 0===r?void 0:r.geolocation)||t.supportsNativeLocation()){t.pending=!0,null==(n=n||{enableHighAccuracy:!0,maximumAge:2e4}).timeout&&(n.timeout=5e4);var i,o=!1,l=function(e){if(!o){clearTimeout(i);var n=e instanceof Error?e:new Error(e.message);t.onErrorResult(n),t.resumeAllWatchers(),"function"==typeof a&&a(n)}};t.pauseAllWatchers(),(t.supportsNativeLocation()?s.nativeGeolocationManager:navigator.geolocation).getCurrentPosition((function(a){return function(a){if(!o){clearTimeout(i),t.onPositionResult(a),t.resumeAllWatchers();var n=a.coords,r=n.latitude,l=n.longitude;"function"==typeof e&&e(r,l)}}(b(a))}),l,n),i=f.WindowWrapper.setTimeout((function(){l(new Error("getCurrentLocation timed out")),o=!0,t.resumeAllWatchers()}),n.timeout+1e3)}else t.available=!1},this.fetchAccurateLatLong=function(e,a,n,r){var i;if(u.default.logToDevConsole("Geolocation.fetchAccurateLatLong"),null!=(null===navigator||void 0===navigator?void 0:navigator.geolocation)||t.supportsNativeLocation()){var o;t.pending=!0;var l,c,d,p=0,h=function(a){t.pending=!1,t.available=!0,t.logNewPosition(a),e(a)},v=function(){clearTimeout(c),t.supportsNativeLocation()?s.nativeGeolocationManager.removeListener(d):navigator.geolocation.clearWatch(l)},m=function(e){var t,a=null===(t=null==o?void 0:o.coords)||void 0===t?void 0:t.accuracy;(null==a||e.coords.accuracy<=a)&&(o=e,p+=1,null!=(null==r?void 0:r.desiredAccuracy)&&e.coords.accuracy<=r.desiredAccuracy&&p>1?(v(),h(e)):n(e))},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.abort,a=void 0!==t&&t;v(),o&&!a&&h(o)},T=function(e){v(),t.pending=!1,t.available=!1,"function"==typeof a&&a(new Error(e.message))},S=(r=r||{}).timeout,A=void 0===S?y:S;if(null==r.desiredAccuracy&&(r.desiredAccuracy=5),t.supportsNativeLocation()){var w={callback:m,failureCallback:T,enableHighAccuracy:!0,interval:null!==(i=r.interval)&&void 0!==i?i:5e3};return d=s.nativeGeolocationManager.addListener(w),c=f.WindowWrapper.setTimeout(g,A),g}return r.maximumAge=0,r.enableHighAccuracy=!0,l=navigator.geolocation.watchPosition((function(e){return m(b(e))}),T,r),c=f.WindowWrapper.setTimeout(g,A),g}return t.available=!1,null},this.watchPosition=function(e){var a,n=e.callback,r=void 0===n?function(){}:n,i=e.failureCallback,o=void 0===i?function(){}:i,l=e.interval,u=void 0===l?y:l,s=e.maximumAge,c=void 0===s?u:s,d=e.enableHighAccuracy,f=void 0===d||d;if(null!=(null===(a=window.navigator)||void 0===a?void 0:a.geolocation)){t.pending=!0;var p=new T({enableHighAccuracy:f,maximumAge:c,callback:function(e){t.onPositionResult(e),r(e)},failureCallback:function(e){t.onErrorResult(e),o(e),t.removeListener(p)}});return t._activeWatchers.add(p),p}},this.isValidLatLng=function(e,a){return t.isValidLatOrLng(e)&&t.isValidLatOrLng(a)},this.isValidLatOrLng=function(e){var t=Number(e);return null!=e&&""!==e&&!isNaN(t)&&t>-181&&t<181},this.normalizeLatOrLng=function(e){if(null!=e&&""!==e){var t=Number(e);if(!isNaN(t)&&t>-181&&t<181)return t}return null},this.stringifyLatOrLng=function(e,a){if(null==a&&(a=6),t.isValidLatOrLng(e)){var n=(Math.round(1e6*Number(e))/1e6).toString(),r=n.match(/^-?\d+(\.\d+)?/);if(r){r[1]?a-=r[1].length-1:n+=".";for(var i=0;i<a;i++)n+="0";return n}}return null},this.stringifyLatLng=function(e,a){return t.stringifyLatOrLng(e)+", "+t.stringifyLatOrLng(a)},this.hashLatLng=function(e,t){var a=e>=0?2*e:-2*e-1,n=t>=0?2*t:-2*t-1,r=(a>=n?a*a+a+n:a+n*n)/2;return e<0&&t<0||e>=0&&t>=0?r:-r-1},this.addListener=function(e){var a;return u.default.logToDevConsole("Geolocation.addListener",e),t.lastPositionAge()<y&&(null===(a=e.callback)||void 0===a||a.call(e,t.lastPosition)),t.supportsNativeLocation()?s.nativeGeolocationManager.addListener(Object.assign(Object.assign({},e),{callback:function(a){var n;t.onPositionResult(a),null===(n=e.callback)||void 0===n||n.call(e,a)},failureCallback:function(a){var n;t.onErrorResult(a),null===(n=e.failureCallback)||void 0===n||n.call(e,a)}})):t.watchPosition(e)},this.removeListener=function(e){u.default.logToDevConsole("Geolocation.removeListener",e),e instanceof T?(e.stop(),t._activeWatchers.delete(e)):"NativeGeolocationManager"===(null==e?void 0:e.type)&&s.nativeGeolocationManager.removeListener(e)},this.removeAllListeners=function(){var e,a=p(t._activeWatchers);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.removeListener(n)}}catch(e){a.e(e)}finally{a.f()}s.nativeGeolocationManager.removeAllListeners()}}));t.GeolocationClass=S;var A=new S;t.Geolocation=A;var w=A;t.default=w},881052:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(856690)),o=n(a(689728)),l=n(a(861655)),u=n(a(994993)),s=n(a(73808)),c=n(a(314247)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=f(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(852468));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(f=function(e){return e?a:t})(e)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.default)(this,a)}}var h=new(function(e){(0,l.default)(a,e);var t=p(a);function a(){return(0,i.default)(this,a),t.apply(this,arguments)}return(0,o.default)(a,[{key:"makeApiCall",value:function(e){var t,a=e.address,n=e.region,r=e.lat,i=e.lng;return null==a&&null!=r&&null!=i&&(t={lat:r,lng:i}),new Promise((function(e){c.default.whenReady((function(){return c.default.geocoder.geocode({address:a,region:n,location:t},(function(t,a){e({results:t,status:a})}))}))}))}},{key:"normalizeStatus",value:function(e){var t,a,n,r,i,o,l,u,s,f,p,h,v,m,g;switch(e){case null===(n=null===(a=null===(t=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===t?void 0:t.maps)||void 0===a?void 0:a.GeocoderStatus)||void 0===n?void 0:n.OK:return d.OK;case null===(o=null===(i=null===(r=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===r?void 0:r.maps)||void 0===i?void 0:i.GeocoderStatus)||void 0===o?void 0:o.OVER_QUERY_LIMIT:return d.OVER_QUERY_LIMIT;case null===(s=null===(u=null===(l=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===l?void 0:l.maps)||void 0===u?void 0:u.GeocoderStatus)||void 0===s?void 0:s.INVALID_REQUEST:return d.INVALID_REQUEST;case null===(h=null===(p=null===(f=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===f?void 0:f.maps)||void 0===p?void 0:p.GeocoderStatus)||void 0===h?void 0:h.REQUEST_DENIED:return d.REQUEST_DENIED;case null===(g=null===(m=null===(v=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===v?void 0:v.maps)||void 0===m?void 0:m.GeocoderStatus)||void 0===g?void 0:g.ZERO_RESULTS:return d.ZERO_RESULTS;default:return e}}},{key:"normalizeResults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){return{latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng(),formattedAddress:e.formatted_address,lowQuality:!1}}))}}]),a}(d.default));t.default=h},787146:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=$("<div >");t.addClass("GoogleMapDomNode");$();var a=$(),n=[],p=!1,h=!1,v={};this.map=null,this.id=Math.random(),this.isXY=e,this.initialState=function(){return{pins:[],pinsById:{},tableName:null,mapColumn:null,activePin:null,currentLocMarker:null}},this.state=this.initialState(),this.matches=function(e,t){return this.state.tableName===e&&this.state.mapColumn===t},this.repaint=function(){this.map&&u.default.api.maps.event.trigger(this.map,"resize")},this.registerListener=function(e){p?setTimeout(function(){this.registerListener(e)}.bind(this),500):n.push(e)},this.clearListeners=function(){if(u.default.api){var e;for(p=!0;n.length;)e=n.pop(),u.default.api.maps.event.removeListener(e);p=!1}},this.setState=function(e){r.default.extend(this.state,e)},this.mountTo=function(e,n){var i=this;a.off("scroll.mapDomNode"),$(e).append(t[0]),t.css({position:"absolute"});var d=t.parents().filter((function(){var e=$(this);return e[0].scrollHeight>e.innerHeight()&&r.default.includes(["auto","scroll"],e.css("overflow"))}));d.length>0&&(d.on("scroll.mapDomNode",(function(){$(window).height()-t.offset().top>t.height()&&(t.hide().show(0),d.off("scroll.mapDomNode"))})),a=d),null!=this.map||h?n&&n(this):(h=!0,u.default.whenReady((function(e){var a,r;c++;var d=7;if((null===(r=null===(a=s.AppGlobals.AppModel)||void 0===a?void 0:a.AppTemplate)||void 0===r?void 0:r.OwnerInPremiumPlan)&&(d=10),c>d)l.default.IsIFrameAuthPreview()||o.default.ReportErrorOnce({errorMessage:"Attempted to exceed map limit for app",mapLimit:d}),h=!1;else{var f={center:{lat:u.default.defaultLat,lng:u.default.defaultLng},zoom:15,zoomControlOptions:{position:e.maps.ControlPosition.LEFT_BOTTOM},controlSize:32,streetViewControl:!0,streetViewControlOptions:{position:e.maps.ControlPosition.LEFT_BOTTOM},gestureHandling:"greedy"};i.map=new e.maps.Map(t[0],f),e.maps.event.addListenerOnce(i.map,"idle",(function(){h=!1,o.default.logToDevConsole("\nCreated new Google Map"),n&&n(i)}))}})))},this.unmount=function(){t.detach(),$(),this.clearListeners(),this.clearMarkerClusterers(),this.setState(this.initialState),a.off("scroll.mapDomNode")},this.initMarkerClusterer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.AppGlobals.ViewManager.theme.getThemeColor("actionIcon"),t=v[e];return t||(v[e]=t=new i.default(this.map,[],{maxZoom:16,zoomOnClick:!0,minimumClusterSize:5})),t.setStyles(d.map((function(t){return{url:f(e,t),height:t,width:t,textColor:"white"}}))),t},this.clearMarkerClusterers=function(){r.default.values(v).forEach((function(e){return e.clearMarkers()}))}};var r=n(a(496486)),i=n(a(304820)),o=n(a(593186)),l=n(a(571524)),u=n(a(314247)),s=a(166089),c=0,d=[20,25,30],f=function(e,t){return"data:image/svg+xml;base64,"+window.btoa('\n        <svg\n            xmlns:dc="http://purl.org/dc/elements/1.1/"\n            xmlns:cc="http://creativecommons.org/ns#"\n            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n            xmlns:svg="http://www.w3.org/2000/svg"\n            xmlns="http://www.w3.org/2000/svg"\n            id="svg8"\n            version="1.1"\n            viewBox="0 0 5.2916665 5.4239602"\n            height="'.concat(t,'"\n            width="').concat(t,'">\n            <defs\n                id="defs2" />\n            <g\n                transform="translate(-99.867724,-198.60313)"\n                id="layer1">\n                <circle\n                r="2.5135417"\n                style="opacity:1;fill:').concat(e,';fill-opacity:1;stroke:#ffffff;stroke-width:0.26458332;stroke-miterlimit:4;stroke-dasharray:none"\n                id="circle821"\n                cx="102.51356"\n                cy="201.20000" />\n            </g>\n        </svg>\n    '))}},314247:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i,o=n(a(459400)),l=n(a(238435)),u=n(a(496486)),s=n(a(190644)),c=a(46239),d=n(a(787146)),f=n(a(385857)),p=n(a(888861)),h=a(504674),v=a(351101),m=n(a(429815)),g=a(166089),y=a(268547),b=a(555792),T=!1,S=[],A=[],w=[],C={},E={mounted:{},unmounted:{}},k={},R={_api:null,geocoder:null,defaultLat:0,defaultLng:0,getStaticImageURLMultipleLatLongs:function(e,t,a){var n,r,i;if(this.disabled)return"";var o="";e.forEach((function(e){o+="&markers=color:red%7Clabel:"+e.name.charAt(0)+"%7C"+encodeURIComponent(e.value)}));var l=(null===(i=null===(r=null===(n=null===window||void 0===window?void 0:window.AppModel)||void 0===n?void 0:n.AppTemplate)||void 0===r?void 0:r.Behavior)||void 0===i?void 0:i.GoogleMapsKey)||h.GOOGLE;return"https://maps.googleapis.com/maps/api/staticmap?markers="+o+"&size="+t+"x"+a+"&key="+l},getStaticImageURL:function(e,t,a){var n,r,i;return this.disabled?"":"https://maps.googleapis.com/maps/api/staticmap?center="+e+"&zoom=12&size="+t+"x"+a+"&key="+((null===(i=null===(r=null===(n=null===window||void 0===window?void 0:window.AppModel)||void 0===n?void 0:n.AppTemplate)||void 0===r?void 0:r.Behavior)||void 0===i?void 0:i.GoogleMapsKey)||h.GOOGLE)},mountMap:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.callback,r=a.tableName,i=a.mapColumn,o=a.isXY;if(t in C){var l=C[t];return n?n(l):l}var s,c=o?w:A;return r&&i&&(s=c.filter((function(e){return e.matches(r,i)}))[0],s&&u.default.pull(c,s)),s||(s=c.pop()||new d.default(o)),s.mountTo(e,n),C[t]=s,s},getMapInstance:function(e){return C[e]},unmountMap:function(e){var t=this.getMapInstance(e);t&&(t.unmount(),(t.isXY?w:A).push(t));delete C[e]},getMountedPins:function(e){return u.default.clone(E.mounted[e])||{}},getPin:function(e,t){var a,n=JSON.stringify(e),r=E.unmounted[n]||[],i=!1;return r.length?a=r.pop():(a=R.createPin(t,e),i=!0),a.setTitle(Common.RunningInTestFramework?t.Id:t.Label),a.appsheetItem=t,a.appsheetFormatting=e,a.appsheetFormatString=n,{pin:a,created:i}},createPin:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=R.api,r=!!(null===(t=null==a?void 0:a.icon)||void 0===t?void 0:t[0]),i=r&&!a.noMarkerWithLabel?n.maps.MarkerWithLabel:n.maps.Marker,o=new i({draggable:!1});return o},makePinCacheKey:function(e,t,a,n){return JSON.stringify([e,t,a,n])},cacheMountedPin:function(e,t,a){var n=E.mounted[e]||{};n[t]=a,E.mounted[e]=n},unmountPins:function(e,t){var a=E.mounted[e]||{},n=E.unmounted;u.default.keys(t).forEach((function(e){var r=t[e];delete a[e];var i=n[r.appsheetFormatString]||[];i.push(r),n[r.appsheetFormatString]=i}))},get disabled(){var e;return!0===(null===(e=(0,v.getAppModel)())||void 0===e?void 0:e.appTemplate.isGoogleMapsDisabled)},get api(){return this.disabled?null:this._api},shouldBeUnloaded:function(e){var t=m.default.getExternalServiceSettings(e).EnableMapsAndGeocoding;return!(!T&&null==this._api||t)},ready:function(){return null!=this.api},init:function(){var e,t,a,n=this;if(!this.disabled&&!T&&null==this.api){T=!0,window.mapReadyCallback=function(){if(n._api=window.google,n.geocoder=new window.google.maps.Geocoder,T=!1,!window.APPSHEET_TEST_CONTEXT){var e=(0,y.scriptSafeByReview)(l.default,"MarkerWithLabelRaw is static");$.globalEval(e)}for(;S.length;){var t=S.shift();"function"==typeof t.callback&&(t.callback(n.api),delete t.callback)}};var i=document.createElement("script"),u=(null===(a=null===(t=null===(e=null===window||void 0===window?void 0:window.AppModel)||void 0===e?void 0:e.AppTemplate)||void 0===t?void 0:t.Behavior)||void 0===a?void 0:a.GoogleMapsKey)||h.GOOGLE,s=(0,b.trustedResourceUrl)(r||(r=(0,o.default)(["https://maps.googleapis.com/maps/api/js?key=","&callback=mapReadyCallback"])),u);i.setAttribute("src",s),i.setAttribute("type","text/javascript"),i.setAttribute("async","async"),i.setAttribute("defer","defer"),document.head.appendChild(i)}},whenReady:function(e,t){if(this.ready())return e(this.api),!1;if(T||this.init(),null==t){var a={callback:e};return S.push(a),a}return t.callback=e,t},zoomScaling:{20:1128.49722,19:2256.99444,18:4513.98888,17:9027.977761,16:18055.95552,15:36111.91104,14:72223.82209,13:144447.6442,12:288895.2884,11:577790.5767,10:1155581.153,9:2311162.307,8:4622324.614,7:9244649.227,6:18489298.45,5:36978596.91,4:73957193.82,3:147914387.6,2:295828775.3,1:591657550.5},normalizeMapType:function(e){var t;switch(e){case"Road":case"Automatic":t="roadmap";break;case"Aerial":t="hybrid";break;default:t=e}return t},getMapItems:function(e,t,a,n,r,i,o,l,u){var s=[],c=null;if(null!=a){var d=a.tableSchema.findAttributeByName(e),h=new f.default(n,a.tableSchema);if(d&&l){var v=p.default.createFilter(l,d.baseImageEvalTree());r&&v?r=p.default.createAnd(r,v):v&&(r=v)}var m=a.queryRowValues({searchQuery:o,filterExpr:r,filterDefaults:i,transaction:u});if(null!=m&&(s=m.filter((function(e){var t=!0;return n.AppTemplate.Presentation.RespectShowIfEverywhere&&d&&d.showIfEvalTree()&&(h.replaceRowData(e),t=d.showIfEvalTree().run(h)),t})).map((function(t){return R.getMapItem(t,a,a.tableSchema,e)})).filter((function(e){return null!=e})),null!=t))for(var g=0;g<s.length;g++)if(s[g].Id===t){c=s[g];break}}return{all:s,selected:c}},getMapItem:function(e,t,a,n){i!==t.timestamp()&&(k={},i=t.timestamp());var r=e[a.keyAttribute().name()],o=k[t.name()]||{},l=o[r]||{};if(null==l[n]){var u=this.makeMapItem(e,t,a,n);null!=u&&(l[n]=u,o[r]=l,k[t.name()]=o)}return l[n]},makeMapItem:function(e,t,a,n){if(null==e||null==t||null==a)return null;var r,i,o=null,l=null,u=s.default.normalizeLatOrLng,d=a.keyAttribute();if(null!=n&&(i=a.findAttributeByName(n))&&e[n])switch(i.basestType()){case g.AppGlobals.AppModel.LATLONG_TYPE:case AppModel.CHANGELOCATION_TYPE:null!=(r=e[n].split(","))&&2===r.length&&(o=u(r[0]),l=u(r[1]));break;case g.AppGlobals.AppModel.XY_TYPE:var f=c.ImageMapType.fromXYStringToLatLng(e[n]);o=f.lat,l=f.lng}if(null!=o&&null!=l||(null==n&&null!=(i=a.findAttributesByType(g.AppGlobals.AppModel.ADDRESS_TYPE)[0])&&(n=i.name()),o=u(e["_latitude"+n]),l=u(e["_longitude"+n])),null==o||null==l){var p=e["_geo_"+n];null!=p&&p.match(new RegExp(/.*,.*/))&&null!=(r=p.split(","))&&2===r.length&&(o=u(r[0]),l=u(r[1]))}if(null==o||null==l)return null;var h=e[d.name()];return{Id:h,Label:t.labelTextForId(h),TableName:t.name(),Latitude:o,Longitude:l,Hash:s.default.hashLatLng(o,l),MapCol:n}},getCenterLat:function(e){return e.center.lat()},getCenterLng:function(e){for(var t=e.center.lng();t<-180;)t+=360;for(;t>180;)t-=360;return t}},I=R;t.default=I},263198:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.missingImageError=t.ifIOSHandlerExists=t.UNABLE_TO_LOAD_IMAGE_PREFIX=t.JeeneeBrowserAPI=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(571524)),l=n(a(112368)),u=n(a(593186)),s=n(a(21870)),c=n(a(496486)),d=a(429815),f=a(351101),p=a(318926),h=a(804758),v=a(218546),m=a(635672),g=a(50295),y=a(143249),b=n(a(895466)),T=a(629503),S=a(646317),A=a(166089),w=a(892148),C=a(399713),E=n(a(266522)),k="Unable to load image data. ";t.UNABLE_TO_LOAD_IMAGE_PREFIX=k;var R=function(e){return k+e};t.missingImageError=R;var I=function(e){return{postMessage:function(t){var a,n=null===(a=window.webkit)||void 0===a?void 0:a.messageHandlers[e];return null!=n&&n.postMessage("function"==typeof t?t():t),{else:function(e){null==n&&e()}}}}};t.ifIOSHandlerExists=I;var O=new(function(){function e(){(0,r.default)(this,e),this.DEFAULT_SCAN_RESULT="111122333",this.pendingCallbacks={},this.closeAfterNextSync=!1,this.scanComplete=function(e){},this.lastNativeMedia={nativeResourceId:"",fileUploadUtilsId:"",time:0,count:0},this.log={barcodeScan:function(e){p.logger.logEvent(new h.BarcodeScanEvent(e))},videoTaken:function(e,t,a,n){p.logger.logEvent(new h.VideoTakenEvent(e,t,a,n))},appSubscription:function(e){p.logger.logEvent(new h.AppSubscriptionEvent(e))},receivedNotification:function(){p.logger.logEvent(new h.ReceivedNotificationEvent)},shortcutAppStart:function(){p.logger.logEvent(new h.ShortcutAppStartEvent)},webviewCrash:function(){p.logger.logEvent(new h.WebviewCrashEvent)},cachedFileRecovered:function(e){p.logger.logEvent(new h.NativeCachedFileRecoveredEvent(e))},cachedFilesDeleted:function(e){p.logger.logEvent(new h.NativeCachedFilesDeletedEvent(e))}}}return(0,i.default)(e,[{key:"logNativeError",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=null===(t=window.JeeneeAndroid)||void 0===t?void 0:t.logError;null!=n&&("string"!=typeof a&&(a=JSON.stringify(a)),n(e,a))}},{key:"OnAppTemplateLoad",value:function(e){var t,a,n=E.default.getThemeData(e.Presentation.DisplayTheme,e);this.setNotchColorIOS(n.headerBackground,"#333"!==n.interfaceText),l.default.IsIOSAppWithMinVersion(6.3)?this.setMaxImageResolutionIOS({width:(0,d.getMaxImageResolution)()}):!l.default.IsAndroidAppWithMinVersion(6.4)||l.default.IsAndroidAppWithMinVersion(15.6)||o.default.IsUnsupportedAndroidVersion()||window.JeeneeAndroid.setMaxImageResolution((0,d.getMaxImageResolution)());var r=null!==(t=e.Presentation.ActionNameMappings)&&void 0!==t?t:[];this.setNativeLocalizationStrings(r);try{!l.default.IsAndroidAppWithMinVersion(10.6)||l.default.IsAndroidAppWithMinVersion(15.6)||o.default.IsUnsupportedAndroidVersion()||window.JeeneeAndroid.setGalleryEnabledForImagePicker(e.Presentation.AllowGalleryAccess),l.default.IsIOSAppWithMinVersion(10)&&this.setGalleryEnableIOS({galleryEnabled:!!e.Presentation.AllowGalleryAccess})}catch(e){u.default.ReportError({errorMessage:"Error calling setGalleryEnabledForImagePicker",error:e})}this.closeAfterNextSync&&!o.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.closeAppSheet(),this.closeAfterNextSync="true"===(null===(a=(0,S.parseUrlQuery)().closeAfterSync)||void 0===a?void 0:a.toLowerCase()),void 0!==l.default&&l.default.IsAndroidAppWithMinVersion(8.3)&&!o.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.hideLoadingView()}},{key:"setAuthCookie",value:function(){try{if(l.default.IsAndroidAppWithMinVersion(8.2)&&!o.default.IsUnsupportedAndroidVersion()){var e=("; "+document.cookie).split("; .JEENEEATH="),t="";2===e.length&&(t=e.pop().split(";").shift()),window.JeeneeAndroid.setAuthCookie(t)}}catch(e){u.default.ReportError({errorMessage:"Error calling setAuthCookie",error:e})}}},{key:"subscribeToApps",value:function(e,t){var a,n,r;try{if(70007!==(null===(n=null===(a=null===window||void 0===window?void 0:window.AppState)||void 0===a?void 0:a.UserInformation)||void 0===n?void 0:n.Id)&&!o.default.IsWhitelabelBrowser()&&(l.default.IsAndroidAppWithMinVersion(8.2)&&!o.default.IsUnsupportedAndroidVersion()&&(u.default.AddTraceContext("JeeneeAndroid.subscribeToApps"),null===(r=window.JeeneeAndroid)||void 0===r||r.subscribeToApps(e,JSON.stringify(t))),l.default.IsIOSAppWithMinVersion(9.9))){var i={appGallery:e,apps:JSON.stringify(t)};I("SubscribeToApps").postMessage(i).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=subscribeToApps",data:i})}))}}catch(e){u.default.ReportError({errorMessage:"Error calling subscribeToApps",error:e})}}},{key:"cacheFiles",value:function(e,t){var a=e.Id,n=e.Name;if(l.default.IsAndroidAppWithMinVersion(6.4)&&!o.default.IsUnsupportedAndroidVersion()&&(u.default.AddTraceContext("appModel.fetchCache (Android)"),T.Common.BeginOfflineCaching(),window.JeeneeAndroid.cacheFiles(JSON.stringify(t),n,"Common.FinishedCachingCallback('"+n+"')")),l.default.IsIOSAppWithMinVersion(4.4)){u.default.AddTraceContext("appModel.fetchCache (iOS)"),T.Common.BeginOfflineCaching();var r={urls:t.toString(),TemplateId:l.default.IsIOSAppWithMinVersion(12.3)?a:n,callback:"Common.FinishedCachingCallback('"+n+"')"};I("CacheFiles").postMessage(r).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=CacheFiles",data:r})}))}}},{key:"onNewNotificationToken",value:function(e,t,a){t="true"===t,a=a||null,A.AppGlobals.AppState.UserInformation.Id!==A.AppGlobals.AppState.GuestUserInformation.Id&&(0,m.ajaxPost)("/api/notif/settoken/",{token:e,whitelabelGuid:a,isWhitelabel:t}).then((function(){u.default.logToDevConsole("uploaded token for notification")})).catch((function(){u.default.logToDevConsole("error uploading token for notification")}))}},{key:"navigateBack",value:function(){return A.AppGlobals.ViewManager.photoGallery&&"loading"!==A.AppGlobals.ViewManager.photoGallery?(A.AppGlobals.ViewManager.photoGallery.close(),!0):$(".ReactModalPortal .Modal").length?($(".ReactModalPortal .Modal").click(),!0):A.AppGlobals.ViewManager.sideMenu.component.isOpen()?(A.AppGlobals.ViewManager.sideMenu.component.close(),!0):$("#FormPage.ActivePage").length&&null!=window.formViewComponent&&"function"==typeof window.formViewComponent.cancelForm?(window.formViewComponent.cancelForm(),!0):!A.AppGlobals.AppState.IsTopLevel()&&(A.AppGlobals.AppState.ChoosePreviousState(),!0)}},{key:"notifyJavaScriptLoaded",value:function(){window.JeeneeAndroid&&"function"==typeof window.JeeneeAndroid.onJavaScriptLoaded&&window.JeeneeAndroid.onJavaScriptLoaded()}},{key:"openScanner",value:function(e){var t,a=this;u.default.AddTraceContext(".ScanInputControl"),this.scanComplete=function(t){u.default.AddTraceContext(".scanComplete"),e(c.default.trim(t)),a.scanComplete=function(e){}};var n=A.AppGlobals.AppModel.appTemplate.barcodeScanner,r=(null===(t=n.key)||void 0===t?void 0:t.startsWith("W3EJE"))||!1;if(p.logger.logEvent(new h.ScanInputControlEvent(n.type,r)),l.default.SupportsBarcodeScan()){if(!n.enabled)return;if(o.default.InIOSWebView())return n.type===d.SCANNER.MLKIT&&l.default.mlkitUnsupported()&&s.default.showToast(g.MLKitWarningToast),void this._openScannerIOS(n.type,n.key);if(o.default.InAndroidWebView())return n.type===d.SCANNER.MLKIT&&l.default.mlkitUnsupported()?void s.default.showToast(g.MLKitUnsupportedToast):void this._openScannerAndroid(n.type,n.key);this.scanComplete(this.DEFAULT_SCAN_RESULT)}}},{key:"_openScannerAndroid",value:function(e,t){e===d.SCANNER.MLKIT?window.JeeneeAndroid.scanBarcode("JeeneeBrowserAPI.scanComplete('{0}')"):l.default.IsAndroidAppWithMinVersion(14.8)&&t?window.JeeneeAndroid.scanCode("JeeneeBrowserAPI.scanComplete('{0}')",t):window.JeeneeAndroid.scanCode("JeeneeBrowserAPI.scanComplete('{0}')")}},{key:"_openScannerIOS",value:function(e,t){I("ScanCode").postMessage((function(){return l.default.IsIOSAppWithMinVersion(14.4)?{callback:"JeeneeBrowserAPI.scanComplete('{0}');",scannerType:e,scannerKey:t}:{callback:"JeeneeBrowserAPI.scanComplete('{0}');",iOSmlkit:A.AppGlobals.AppModel.inRollout("iOSmlkitScanner")}})).else((function(){w.WindowWrapper.location="jeenee_method?ScanCode?callback=JeeneeBrowserAPI.scanComplete('{0}');"}))}},{key:"startNfcScan",value:function(e){var t=this;if(this.nfcScanComplete=function(a){p.logger.logAppEvent(v.AppEventName.NfcScanResult),u.default.AddTraceContext(".nfcScanComplete"),e(function(e){if(e)try{var t=JSON.parse(e);return c.default.trim(t[0].record)||""}catch(e){u.default.ReportErrorOnce({errorMessage:"Error parsing json",error:e})}return""}(a)),t.nfcScanComplete=function(){}},o.default.InIOSWebView()&&l.default.SupportsNfcScan()){var a={callback:"JeeneeBrowserAPI.nfcScanComplete('{0}')"};I("StartNFCScan").postMessage(a).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startNFCScan",data:a})}))}else o.default.InAndroidWebView()&&l.default.SupportsNfcScan()&&window.JeeneeAndroid&&"function"==typeof window.JeeneeAndroid.startNFCScan?window.JeeneeAndroid.startNFCScan("JeeneeBrowserAPI.nfcScanComplete('{0}')"):this.nfcScanComplete(JSON.stringify([{record:this.DEFAULT_SCAN_RESULT}]));p.logger.logAppEvent(v.AppEventName.StartNfcScan)}},{key:"startSpeechRecognition",value:function(e,t){if(l.default.SupportsSpeechRecognition())if(this.speechRecognitionComplete=function(a,n){n&&"{1}"!==n?t(a):(u.default.AddTraceContext(".speechRecognitionComplete"),e(a))},o.default.InIOSWebView()){var a={callback:"JeeneeBrowserAPI.speechRecognitionComplete('{0}', '{1}')"};I("StartSpeechRecognition").postMessage(a).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startSpeechRecognition",data:a})}))}else o.default.InAndroidWebView()&&window.JeeneeAndroid.startSpeechRecognition("JeeneeBrowserAPI.speechRecognitionComplete('{0}', '{1}')")}},{key:"stopSpeechRecognition",value:function(){l.default.SupportsSpeechRecognition()&&(o.default.InIOSWebView()?I("StopSpeechRecognition").postMessage({}).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=stopSpeechRecognition"})})):o.default.InAndroidWebView()&&window.JeeneeAndroid.stopSpeechRecognition())}},{key:"offlineProgressChanged",value:function(e){var t,a;if(A.AppGlobals.ViewManager)if((null===(a=null===(t=A.AppGlobals.AppModel)||void 0===t?void 0:t.AppTemplate)||void 0===a?void 0:a.OwnerId)&&y.Rollout.get("newOfflineCacheInfoBox").includeByOwner(A.AppGlobals.AppModel.AppTemplate))A.AppGlobals.ViewManager.sideMenu.setState(e),s.default.setCachingProgress(e);else{var n=A.AppGlobals.ViewManager.sideMenu.state.filesCached||0,r=(A.AppGlobals.ViewManager.sideMenu.state.totalFilesToCache||e.totalFilesToCache)-e.totalFilesToCache;A.AppGlobals.ViewManager.sideMenu.setState({filesCached:Math.max(r+e.filesCached,n)}),s.default.setCachingProgress({filesCached:Math.max(r+e.filesCached,n)})}}},{key:"onLocationUpdate",value:function(e){if(this.nativeLocationCallback){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return JSON.parse(e)}catch(e){return u.default.ReportErrorOnce({errorMessage:"Error parsing json",error:e}),t}}(e);t&&this.nativeLocationCallback(t)}}},{key:"startLocationUpdates",value:function(e){var t=e.callback,a=e.failureCallback,n=e.interval,r=e.enableHighAccuracy,i=void 0!==r&&r;if(u.default.logToDevConsole("starting native location updates",{interval:n,enableHighAccuracy:i}),this.nativeLocationCallback=function(e){"error"in e?a(new Error(e.error)):t(e)},o.default.InAndroidWebView()){var l=i?3:2,s=n/1e3;window.JeeneeAndroid.startLocationUpdates("JeeneeBrowserAPI.onLocationUpdate({0})",s,Math.min(1,s),l)}else if(o.default.InIOSWebView()){var c={callback:"JeeneeBrowserAPI.onLocationUpdate('{0}')",desiredAccuracy:i?2:3};I("StartLocationUpdates").postMessage(c).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startLocationUpdates",data:c})}))}}},{key:"stopLocationUpdates",value:function(){u.default.logToDevConsole("stopping native location updates"),o.default.InAndroidWebView()?window.JeeneeAndroid.stopLocationUpdates():o.default.InIOSWebView()&&I("StopLocationUpdates").postMessage({}).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=stopLocationUpdates"})}))}},{key:"clearPhotoStorageForCurrentApp",value:function(){var e;(null===(e=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===e?void 0:e.clearPhotoStorageForCurrentApp)&&(u.default.AddTraceContext("Called clearPhotoStorage from app ".concat(A.AppGlobals.AppModel.AppTemplate.Name)),this.lastClearPhotoStorageTime=(new Date).toISOString(),window.JeeneeAndroid.clearPhotoStorageForCurrentApp())}},{key:"clearPhotoStorageAndroid",value:function(e,t,a){var n,r;if(null===(n=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===n?void 0:n.clearPhotoStorageForApp)try{window.JeeneeAndroid.clearPhotoStorageForApp(e,t)}catch(e){u.default.ReportError({errorMessage:"clearPhotoStorageForApp unexpected error",error:e})}else if(null===(r=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===r?void 0:r.clearPhotoStorageForCurrentApp){var i=a.length>0;try{var o=this.currentAppKnownToNative,l=A.AppGlobals.AppModel.AppTemplate.Id!==e||A.AppGlobals.AppModel.AppTemplate.Id!==(null==o?void 0:o.Id);i||l?u.default.ReportError({errorMessage:"clearPhotoStorageForCurrentApp data loss averted",appMismatch:l,appId:e,appKnownToNative:null==o?void 0:o.Id,windowAppId:A.AppGlobals.AppModel.AppTemplate.Id,hasPendingImages:i}):this.clearPhotoStorageForCurrentApp()}catch(e){u.default.ReportError({errorMessage:"clearPhotoStorage unexpected error",error:e})}}}},{key:"clearPhotoStorageForApp",value:function(e,t){if(o.default.InMobileWebView()){var a=(0,f.getAppModel)().findPendingImages(),n=new Date(t),r=n.getTime();if(a.some((function(e){return new Date(e.timestamp())<=n})))return void u.default.ReportError({errorMessage:"clearPhotoStorageForApp data loss averted"});this.lastClearPhotoStorageTime=t,o.default.InAndroidWebView()?this.clearPhotoStorageAndroid(e,r,a):I("ClearPhotoStorageForApp").postMessage({appId:e,timestamp:r})}}},{key:"openInNativeBrowserIOS",value:function(e){I("OpenInNativeBrowser").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=OpenInNativeBrowser",data:e})}))}},{key:"takePhoto",value:function(e){var t,a,n=e.RequestId,r={galleryEnabled:null===(t=A.AppGlobals.AppModel.AppTemplate.Presentation.AllowGalleryAccess)||void 0===t||t,exposeToGallery:null===(a=A.AppGlobals.AppModel.AppTemplate.Behavior.SaveToGallery)||void 0===a||a,photoWidth:e.preferredWidth||(0,d.getMaxImageResolution)(),drzZone:(0,C.getDrz)()};if(o.default.InAndroidWebView())if(l.default.IsAndroidAppWithMinVersion(15.6)){var i=Object.assign(Object.assign({},r),{callback:"JeeneeBrowserAPI.onAndroidPhotoTaken('".concat(n,"','{0}');")});window.JeeneeAndroid.takePhoto(JSON.stringify(i))}else window.JeeneeAndroid.takePhoto("JeeneeBrowserAPI.onAndroidPhotoTaken('".concat(n,"',{0});"));else{var u=Object.assign(Object.assign({},r),{phphoto:"true",callback:"JeeneeBrowserAPI.onIOSPhotoTaken('".concat(n,"','{0}');")});I("TakePhoto").postMessage(u).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=TakePhoto",data:u})}))}}},{key:"chooseFile",value:function(e){var t=e.RequestId;if(o.default.InAndroidWebView())l.default.IsAndroidAppWithMinVersion(15.7)?window.JeeneeAndroid.chooseFile("JeeneeBrowserAPI.onAndroidFileChosen('".concat(t,"','{0}','{1}');"),(0,C.getDrz)()):window.JeeneeAndroid.chooseFile("JeeneeBrowserAPI.onAndroidFileChosen('".concat(t,"','{0}','{1}');"));else{var a={callback:"JeeneeBrowserAPI.onIOSFileChosen('".concat(t,"','{0}','{1}');")};I("ChooseFile").postMessage(a).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=ChooseFile",data:a})}))}}},{key:"takeVideo",value:function(e){var t,a,n=e.RequestId,r={galleryEnabled:null===(t=A.AppGlobals.AppModel.AppTemplate.Presentation.AllowGalleryAccess)||void 0===t||t,exposeToGallery:null===(a=A.AppGlobals.AppModel.AppTemplate.Behavior.SaveToGallery)||void 0===a||a,drzZone:(0,C.getDrz)()};if(o.default.InAndroidWebView())if(l.default.IsAndroidAppWithMinVersion(15.6)){var i=Object.assign(Object.assign({},r),{callback:"JeeneeBrowserAPI.onAndroidVideoTaken('".concat(n,"','{0}');")});window.JeeneeAndroid.takeVideo(JSON.stringify(i))}else window.JeeneeAndroid.takeVideo("JeeneeBrowserAPI.onAndroidVideoTaken('".concat(n,"',{0})"))}},{key:"handleNativeMedia",value:function(e,t,a,n,r){if(a===this.lastNativeMedia.nativeResourceId){this.lastNativeMedia.count+=1;var i=T.Common.uploadRequests,o=T.Common.awaitingUploadRequests,l="Multiple media callback calls for the same token";u.default.ReportError({errorMessage:l,context:e,fileUploadUtilsId:t,mediaType:n,nativeResourceId:a,uploadRequestFound:!!i[t],awaitingUploadRequestFound:!!o[t],uploadRequestCount:Object.keys(i).length,awaitingUploadRequestCount:Object.keys(o).length,msSinceLastCall:performance.now()-this.lastNativeMedia.time,totalCalls:this.lastNativeMedia.count,sameFileInput:t===this.lastNativeMedia.fileUploadUtilsId}),this.logNativeError(l,{fileUploadUtilsId:t,nativeResourceId:a})}else this.lastNativeMedia={nativeResourceId:a,fileUploadUtilsId:t,time:performance.now(),count:1};T.Common.awaitUploadRequest(t,(function(t){var i=b.default.from({type:e,value:a,mediaType:n,preferredWidth:t.preferredWidth});i.setFileName(r),T.Common.finishImageRead(t,i)}))}},{key:"onAndroidPhotoTaken",value:function(e,t){u.default.AddTraceContext("Photo Taken (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent(v.AppEventName.PhotoTaken),this.handleNativeMedia("Android",e,t,"photo")}},{key:"onAndroidFileChosen",value:function(e,t,a){u.default.AddTraceContext("File Chosen (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent(v.AppEventName.FileChosen),this.handleNativeMedia("Android",e,t,"file",a)}},{key:"onAndroidVideoTaken",value:function(e,t){u.default.AddTraceContext("Video Taken (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent(v.AppEventName.VideoTaken),this.handleNativeMedia("Android",e,t,"video")}},{key:"onIOSPhotoTaken",value:function(e,t,a){u.default.AddTraceContext("Photo Taken (iOS)",{fileUploadUtilsId:e}),p.logger.logAppEvent(v.AppEventName.PhotoTaken),this.handleNativeMedia("IOS",e,t,"photo",a)}},{key:"onIOSFileChosen",value:function(e,t,a){u.default.AddTraceContext("File Chosen (iOS)",{fileUploadUtilsId:e}),p.logger.logAppEvent(v.AppEventName.FileChosen),this.handleNativeMedia("IOS",e,t,"file",a)}},{key:"getBase64DataAndroid",value:function(e,t){var a;if(l.default.IsAndroidAppWithMinVersion(6.8)&&e.value()&&e.value().length<50){var n;try{n=window.JeeneeAndroid.getBase64Photo(e.value())}catch(e){var r=e;u.default.ReportErrorOnce({errorMessage:"Failed to load image data on Android (probably out of memory)",error:r}),n=R("Image may be missing or upload size may be too large for this device.")}t(n)}else t(null!==(a=e.value())&&void 0!==a?a:"")}},{key:"getBase64DataIOS",value:function(e,t){var a=this;I("GetBase64Photo").postMessage((function(){var n=(0,S.makeGuid)();return a.pendingCallbacks[n]=t,{path:encodeURIComponent(e.value()),callback:"JeeneeBrowserAPI.onBase64ResultIOS('".concat(n,"', '{0}');"),maxWidth:e.preferredWidth||(0,d.getMaxImageResolution)()}})).else((function(){a.getBase64FromIOSFallback(e,t)}))}},{key:"onBase64ResultIOS",value:function(e,t){t||(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS"}),t=R("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device."));var a=this.pendingCallbacks[e];null==a?u.default.ReportErrorOnce({errorMessage:"callback not found in onBase64ResultIOS"}):a(t),delete this.pendingCallbacks[e]}},{key:"getBase64FromIOSFallback",value:function(e,t){$.ajax({url:"/jeenee_url?path="+encodeURIComponent(e.value())+"&id=5",dataType:"text",success:function(e){(null==e?void 0:e.target)&&0!==e.target.trim().indexOf("<!")?t(e.target):(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS (preWK.success)"}),t(R("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device.")))},error:function(e){var a=e.responseText;a&&0!==a.trim().indexOf("<!")?t(a):(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS (preWK.error)"}),t(R("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device.")))},cache:!1})}},{key:"setGalleryEnableIOS",value:function(e){I("SetGalleryEnabledForImagePicker").postMessage(e).else((function(){l.default.IsIOSAppWithMinVersion(14.3)||$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setGalleryEnabledForImagePicker",data:e})}))}},{key:"setMaxImageResolutionIOS",value:function(e){I("SetMaxImageResolution").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=SetMaxImageResolution",data:e})}))}},{key:"getBase64PhotoFromCacheIOS",value:function(e,t){var a=this;I("GetBase64PhotoFromCache").postMessage((function(){var n=String(Math.random());return a.pendingCallbacks[n]=t,{callback:"JeeneeBrowserAPI.onResult('".concat(n,"', '{0}')"),url:e}})).else((function(){t("")}))}},{key:"onResult",value:function(e,t){var a=this.pendingCallbacks[e];a&&a(t),delete this.pendingCallbacks[e]}},{key:"setOnTokenRefreshListenerIOS",value:function(e){I("SetOnTokenRefreshListener").postMessage(e).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setOnTokenRefreshListener",data:e})}))}},{key:"setOnNetworkConnectivityChangedListenerIOS",value:function(e){I("SetOnNetworkConnectivityChangedListener").postMessage(e)}},{key:"clearCookiesIOS",value:function(){I("ClearCookies").postMessage({}).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=ClearCookies"})}))}},{key:"shareIOS",value:function(e,t,a){I("Share").postMessage({text:e,url:t,imageurl:a}).else((function(){w.WindowWrapper.location="jeenee_method?Share?text="+e+"&url="+t+"&imageurl="+a}))}},{key:"disableScrollBounceIOS",value:function(){I("DisableBounce").postMessage({})}},{key:"setNotchColorIOS",value:function(e,t){I("SetNotchColor").postMessage({notchColor:e,notchTextStyle:t?"light":"dark"})}},{key:"setStorageAuth",value:function(e){o.default.InAndroidWebView()?window.JeeneeAndroid.setStorageAuth&&window.JeeneeAndroid.setStorageAuth(e):o.default.InIOSWebView()}},{key:"getFileStorageUrl",value:function(e,t){if(o.default.InAndroidWebView()&&window.JeeneeAndroid){var a=String(Math.random());this.pendingCallbacks[a]=t,window.JeeneeAndroid.getFileStorageUrl(e,"JeeneeBrowserAPI.onResult('".concat(a,"', '{0}')"))}else t("")}},{key:"setCurrentApp",value:function(e){try{var t=null!=e?e:{},a=t.Name,n=t.Id;if(null==a||null==n)return void u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp got null Name or Id",Name:a,Id:n});if(l.default.IsAndroidAppWithMinVersion(7.6)&&!o.default.IsUnsupportedAndroidVersion())if(window.JeeneeAndroid.setCurrentTemplate(a),36===n.length){var r=e.Behavior.AutoBackgroundUpdate;l.default.IsAndroidAppWithMinVersion(13.4)?window.JeeneeAndroid.setCurrentAppGuid(n,r):window.JeeneeAndroid.setCurrentAppGuid(n)}else u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp got invalid Id",Id:n});else l.default.IsIOSAppWithMinVersion(12.3)?this.setCurrentTemplateIOS({TemplateId:n,TemplateName:a}):l.default.IsIOSAppWithMinVersion(4.4)&&this.setCurrentTemplateIOS({TemplateId:a});this.currentAppKnownToNative=e}catch(e){u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp failed",error:e})}}},{key:"setCurrentTemplateIOS",value:function(e){I("SetCurrentTemplate").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=SetCurrentTemplate",data:e})}))}},{key:"getCurrentAppGuid",value:function(e){var t=this;I("GetCurrentAppGuid").postMessage((function(){var a=(0,S.makeGuid)();return t.pendingCallbacks[a]=e,{callback:"JeeneeBrowserAPI.onResult('".concat(a,"', '{0}')")}})).else((function(){e("")}))}},{key:"setNativeLocalizationStrings",value:function(e){e=e.filter((function(e){return e.ActionName!==e.DisplayName}));var t=c.default.reduce(e,(function(e,t){return e[t.ActionName]=c.default.toString(A.AppGlobals.AppModel.MapActionName(t.ActionName)),e}),{});l.default.IsAndroidAppWithMinVersion(13.6)&&window.JeeneeAndroid.setNativeLocalizationStrings?window.JeeneeAndroid.setNativeLocalizationStrings(JSON.stringify(t)):I("SetNativeLocalizationString").postMessage({localizationStrings:JSON.stringify(t)})}}]),e}());t.JeeneeBrowserAPI=O,window.JeeneeBrowserAPI=O},710304:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.toLowerCase()){case"hy-am":case"zh":case"zh-cn":case"zh-tw":case"zh-hk":case"ga-ie":case"he-il":case"bn-in":case"gu-in":case"hi-in":case"kn-in":case"ml-in":case"mr-in":case"ta-in":case"te-in":case"ar-eg":case"ja-jp":case"ko-kr":case"ms-my":case"es-mx":case"mn-mn":case"th-th":case"en":case"en-au":case"en-ca":case"en-ie":case"en-in":case"en-gb":case"en-us":case"en-ph":return{thousands:",",decimal:"."};case"de-ch":case"it-ch":return{thousands:"'",decimal:"."};case"fr-ch":return{thousands:" ",decimal:"."};case"az-latn-az":case"pt-br":case"hr-hr":case"da":case"da-dk":case"de":case"de-de":case"el-gr":case"id-id":case"it-it":case"ms-bn":case"nl-nl":case"ro-ro":case"sr-cyrl-rs":case"sr-latn-rs":case"sl-si":case"ca-es":case"tr-tr":case"vi-vn":case"es-ar":case"es":case"es-bo":case"es-cl":case"es-co":case"es-ec":case"es-py":case"es-es":case"es-uy":case"es-ve":return{thousands:".",decimal:","};case"az-cyrl-az":case"bg-bg":case"fr":case"fr-fr":case"fr-ca":case"cs-cz":case"fi":case"fi-fi":case"ka-ge":case"hu-hu":case"lv-lv":case"lt-lt":case"nb-no":case"nn-no":case"pl-pl":case"pt":case"pt-pt":case"ru-ru":case"sk-sk":case"sv-se":case"uk-ua":case"en-za":return{thousands:" ",decimal:","};default:return null}}},249e3:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(496486)),i=n(a(730381)),o=n(a(365914)),l=n(a(710304));n(a(571524)).default.detectIfNeeded();var u=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};function s(e){return null==e||""===e?e:"string"==typeof e?e.split("").reverse().join(""):"function"==typeof e.reverse?e.reverse():e}function c(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return!1}var d={language:function(){return window.navigator.language||window.navigator.browserLanguage},_decimal:null,decimal:function(){return null==d._decimal&&(d._decimal=d.initDecimal()),d._decimal},_date:null,date:function(){return null==d._date&&(d._date=d.initDate()),d._date},reset:function(){d._decimal=null,d._date=null},initDecimal:function(){var e,t=",",a=".",n=!1,i=!1,o=d.language(),f=c()?o:void 0;try{var p=65432.1.toLocaleString(f);if("65432.1"===p){if(i=!0,o){var h=(0,l.default)(o);h||(h=(0,l.default)(o.slice(0,2))),h&&(a=h.decimal,t=h.thousands,n=!0)}}else{var v=p.match(new RegExp("^65(.)?432(.)1$"));null==v||3!==v.length?n=!1:(t=v[1]||"",a=v[2],n=!0)}n&&(e=new RegExp("^[-−]?\\d*(?:"+u(t)+"\\d{3})*(?:"+u(a)+"\\d*)?$"),n=!0)}catch(e){n=!1}return{supported:n,unformatted:i,thousandSeparator:t,decimalSeparator:a,pattern:e,fromLocaleString:function(r){if(!n||!r.match(e))return null;var i=r.split(a),o=i[0].replace(new RegExp(u(t),"g"),""),l=null!=i[1]?i[1]:"",s=o+(l.length?"."+l:"");return(null==s?void 0:s.indexOf("−"))>=0&&(s=s.replace(/−/g,"-")),isNaN(Number(s))?null:s},toLocaleString:function(e,t){return null==(t=t||{}).maximumFractionDigits||t.maximumFractionDigits>20?t.maximumFractionDigits=20:t.maximumFractionDigits<0&&(t.maximumFractionDigits=0),null==t.minimumIntegerDigits||t.minimumIntegerDigits<1?t.minimumIntegerDigits=1:t.minimumIntegerDigits>21&&(t.minimumIntegerDigits=21),i&&n&&"function"==typeof this.fallbackToLocaleString?this.fallbackToLocaleString(e,t):e.toLocaleString(f,t)},fallbackToLocaleString:function(e,n){var i=t;!1===n.useGrouping&&(i="");try{var o=Number(e).toString().split("."),l=o[0],u=o[1];null!=n.minimumIntegerDigits&&(l=r.default.padStart(l,n.minimumIntegerDigits,"0"));var c=s(l),d=c.match(/\d{3}/g);if(!d)return e.toString();var f=c.split(d.join(""))[1];(null==f?void 0:f.length)&&"-"!==f&&d.push(f);var p=s(d.join(i))+(null!=u&&u.length?a+u:"");return"-"===f&&(p="-"+p),p}catch(t){return e.toLocaleString(void 0,n)}}}},initDate:function(){var e,t,a=d.language(),n=c()?a:void 0;try{var r=new Date("11/22/3333").toLocaleDateString(n).replace(/&lrm;|\u200E/gi,"");e=r.replace("11","MM").replace("22","DD").replace("3333","YYYY");var l="08/31/2016",u=new Date(l).toLocaleDateString(n).replace(/&lrm;|\u200E/gi,"");if(o.default.MDYformat((0,i.default)(u,e).toDate(),!0)!==l)throw new Error("unsupported");t=!0}catch(a){t=!1,e="MM/DD/YYYY"}return{supported:t,dateFormat:e,wireFormat:"MM/DD/YYYY",momentFromWireFormat:function(e){return(0,i.default)(e,"M/D/YYYY",!0)},fromLocaleString:function(a){if(!t)return null;if(null==a||""===a)return"";var n=e.replace(/[MDY]{4}/g,"\\d{4}").replace(/[MDY]{2}/g,"\\d{1,2}").replace(/\./g,"\\.").replace(/\s/g,"\\s"),r=new RegExp(n);if(a.match(r)){var l=(0,i.default)(a,e).toDate();return isNaN(l.getTime())?null:o.default.MDYformat(l,!0)}return null}}}},f=d;t.default=f},65706:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.makeKey,a=e.limit,n=e.fn,o=e.getTimestamp,l={timestamp:void 0,data:[]};function u(){for(var e,s,c,d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];try{e=t.apply(null,f),s=null==o?void 0:o.apply(null,f),l.timestamp!==s&&u.invalidate(s),c=l.data;var h=r.default.findIndex(c,(function(t){return t.key===e}));if(-1!==h)return c[h].value}catch(e){(0,i.errorToDevConsole)(e)}var v=performance.now(),m=n.apply(null,f),g=performance.now()-v;if(null!=e){var y={key:e,value:m,evalTime:g};g<10?c.unshift(y):c.push(y),a&&c.length>a&&(c[0].evalTime>10&&(l.data=r.default.sortBy(c,(function(e){return e.evalTime}))),l.data.shift())}return m}return u.invalidate=function(e){l.timestamp=e,l.data.length=0},u};var r=n(a(496486)),i=a(593186)},21870:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SyncUI=t.SyncState=t.DEFAULT_HEADER_HEIGHT=t.DEFAULT_FOOTER_HEIGHT=t.DEFAULT_DRAWER_OPEN_WIDTH=t.DEFAULT_DRAWER_CLOSE_WIDTH=void 0;var i=n(a(856690)),o=n(a(689728)),l=n(a(918698)),u=a(166089),s=n(a(496486)),c=a(722188),d=n(a(907673)),f=a(629503),p=a(351101),h=n(a(455127)),v=n(a(69411)),m=a(557310),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=T(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(593186)),y=a(44617),b=a(365914);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(T=function(e){return e?a:t})(e)}function S(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return A(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var w,C=function(e,t,a,n){var r,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"==typeof Reflect?"undefined":(0,l.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,n);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(o=(i<3?r(o):i>3?r(t,a,o):r(t,a))||o);return i>3&&o&&Object.defineProperty(t,a,o),o};t.SyncUI=w,function(e){e[e.Hidden=0]="Hidden",e[e.Subtle=1]="Subtle",e[e.Detailed=2]="Detailed",e[e.Blocking=3]="Blocking"}(w||(t.SyncUI=w={}));var E=function(){function e(){var t=this;(0,i.default)(this,e),this.refreshing=!1,this.initiatedBy="AppStart",this.fakeProgress=0,this.ui=w.Hidden,this.legacyOverlay=new v.default,setInterval((function(){if(t.info&&t.info.remainingSteps){var e=t.fakeProgress+10*Math.random();e>100&&(e=100),t.fakeProgress=e}}),200)}return(0,o.default)(e,[{key:"visibility",get:function(){return w[this.ui]}},{key:"setPreferredUI",value:function(e){e>this.ui&&(this.ui=e,this.ui===w.Blocking&&this.refreshing&&(g.default.logToDevConsole("showing Launch screen"),this.onSyncingStatus(!0),u.AppGlobals.ViewManager.ShowLaunchScreen(),this.legacyOverlay.onSyncingStatus(!0)))}},{key:"reset",value:function(){this.error=void 0,this.warning=void 0,this.refreshing=!1,this.info=void 0,this.fakeProgress=0}},{key:"onStart",value:function(e){var t=e.initiatedBy,a=e.notification;g.default.logToDevConsole("Sync started (".concat(w[this.ui],")")),this.legacyOverlay.onStart(),this.reset(),this.refreshing=!0,this.initiatedBy=t,this.notification=a}},{key:"onFinish",value:function(){g.default.logToDevConsole(this.refreshing?"Sync finished":"Startup from local cache"),this.legacyOverlay.onFinish(),this.reset(),this.ui=w.Hidden}},{key:"onError",value:function(e){this.legacyOverlay.onError(e),this.reset(),y.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")&&e===g.SYNC_CANCELED_ERROR_MESSAGE?this.ui=w.Hidden:(this.error=e,g.default.logToDevConsole("Sync errored",e))}},{key:"onWarning",value:function(e){this.legacyOverlay.onWarning(e),this.warning=e,g.default.logToDevConsole("Sync warning",e)}},{key:"onProgress",value:function(e){this.legacyOverlay.onProgress(e),e.remainingSteps&&this.info&&e.remainingSteps===this.info.remainingSteps||(this.fakeProgress=0),this.info=e}},{key:"onSyncingStatus",value:function(e){this.legacyOverlay.onSyncingStatus(e)}},{key:"close",value:function(){this.ui=w.Hidden,this.refreshing||this.reset()}},{key:"message",get:function(){var e=(0,p.mapActionName)("Saving changes"),t=(0,p.mapActionName)("Syncing...");if(this.info){var a=this.info,n=a.remainingSteps,r=a.totalSteps;if(null!=n&&null!=r)return n>0?"".concat(e," (").concat(r-n+1,"/").concat(r,")"):t}return t}},{key:"percentDone",get:function(){if(this.info){var e=this.info,t=e.remainingSteps,a=e.totalSteps,n=e.percentDone;if(null!=t&&null!=a&&null==n)return this.fakeProgress/Number(a.toFixed(2))+(a-t)/Number(a.toFixed(2))*100}return 0}}]),e}();t.SyncState=E,C([c.observable],E.prototype,"info",void 0),C([c.observable],E.prototype,"error",void 0),C([c.observable],E.prototype,"warning",void 0),C([c.observable],E.prototype,"refreshing",void 0),C([c.observable],E.prototype,"initiatedBy",void 0),C([c.observable],E.prototype,"fakeProgress",void 0),C([c.observable],E.prototype,"ui",void 0),C([c.observable],E.prototype,"notification",void 0),C([c.action.bound],E.prototype,"setPreferredUI",null),C([c.action.bound],E.prototype,"reset",null),C([c.action.bound],E.prototype,"onStart",null),C([c.action.bound],E.prototype,"onFinish",null),C([c.action.bound],E.prototype,"onError",null),C([c.action.bound],E.prototype,"onWarning",null),C([c.action.bound],E.prototype,"onProgress",null),C([c.action.bound],E.prototype,"close",null);t.DEFAULT_FOOTER_HEIGHT=60;t.DEFAULT_HEADER_HEIGHT=56;t.DEFAULT_DRAWER_CLOSE_WIDTH=56;t.DEFAULT_DRAWER_OPEN_WIDTH=256;var k=function(){function e(){var t,a,n=this;(0,i.default)(this,e),this.widescreenBreakpoint=768,this.throttledToasts=new Map,this.toasts=[],this.showSearchControl=!0,this.showFooter=!0,this.headerSelectedTabIndex=new Map,this.headerHeight=56,this.drawerCloseWidth=56,this.drawerOpenWidth=256,this.headerTitle="",this.headerActionButtons=[],this.sideMenuOpen=!1,this.syncQueueCount=0,this.appTemplate=null,this.searchQuery=null,this.searchEnabled=!1,this.showAboutView=!1,this.localStorageState=new Map,this.totalFilesToCache=null,this.filesCached=null,this.filesWithError=null,this.hashState={general:{},specific:{},selectionCount:null},this.windowWidth=(null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.clientWidth)||0,this.windowHeight=(null===(a=null===document||void 0===document?void 0:document.body)||void 0===a?void 0:a.clientHeight)||0,this.flexBackgroundWidth=(0,b.maxDimensionPixels)(this.windowWidth,this.windowHeight),this.dataStamp=null,this.syncState=new E,this.initialized=!1,window.addEventListener("resize",(function(){return n.onResize()}))}return(0,o.default)(e,[{key:"setHash",value:function(e,t,a){e=e||{},t=t||{},this.hashState={general:e,specific:t,selectionCount:a}}},{key:"hash",get:function(){return this.hashState}},{key:"currentView",get:function(){return this.appTemplate?this.appTemplate.getView(this.hash.general.ControlName):null}},{key:"headerTabs",get:function(){var e=this,t=this.currentView;if(t){var a=t.definition();if("dashboard"===t.viewType()&&a.ShowTabs&&this.windowWidth<=this.widescreenBreakpoint)return a.ViewEntries.map((function(t){var a=e.appTemplate.getView(t.ViewName);return a.shouldBeShown(u.AppGlobals.AppModel)?(0,b.makePrettyTitle)(a.displayName(u.AppGlobals.AppModel),a):null})).filter((function(e){return null!==e}))}return[]}},{key:"footerEntries",get:function(){var e,t=(null===(e=this.appTemplate)||void 0===e?void 0:e.viewControls())||[],a=function(e){return u.AppGlobals.AppModel.POSITIONS_ORDERED.indexOf(e)};return t.filter((function(e){return e.IsValid&&e.Position!==u.AppGlobals.AppModel.POSITION_MENU&&e.Position!==u.AppGlobals.AppModel.POSITION_REF})).sort((function(e,t){return a(e.Position)-a(t.Position)}))}},{key:"footerHeight",get:function(){return this.showFooter?60:0}},{key:"viewWidth",get:function(){return this.windowWidth}},{key:"viewHeight",get:function(){return this.windowHeight-this.headerHeight-this.footerHeight}},{key:"headerTabIndex",get:function(){return this.currentView&&this.headerSelectedTabIndex.get(this.currentView.name())||0}},{key:"selectHeaderTab",value:function(e){this.currentView&&this.headerSelectedTabIndex.set(this.currentView.name(),e)}},{key:"showToast",value:function(e){this.toasts.includes(e)||this.toasts.push(e)}},{key:"dismissToast",value:function(){this.toasts.shift()}},{key:"showToastThrottled",value:function(e,t){var a=this,n=this.throttledToasts.get(e),r=null==n?void 0:n.throttled;r&&(null==n?void 0:n.cooldown)===t||(r=s.default.throttle((function(){return a.showToast(e)}),t,{trailing:!1,leading:!0}),this.throttledToasts.set(e,{throttled:r,cooldown:t})),r()}},{key:"isWideScreen",get:function(){return this.windowWidth>this.widescreenBreakpoint}},{key:"showResetDash",get:function(){return this.isWideScreen&&"dashboard"===this.hash.general.Root}},{key:"onResize",value:function(){var e=document.documentElement,t=e.clientWidth,a=e.clientHeight;this.windowWidth=t,this.windowHeight=a;var n=(0,b.maxDimensionPixels)(t,a);n>this.flexBackgroundWidth&&(this.flexBackgroundWidth=n)}},{key:"flexLaunchBackgroundUrl",get:function(){var e,t=null===(e=this.appTemplate)||void 0===e?void 0:e.model.Presentation.BackgroundImageUrl;return t?f.Common.FlexImageUrl(t,this.flexBackgroundWidth):""}},{key:"flexPageBackgroundUrl",get:function(){var e,t=null===(e=this.appTemplate)||void 0===e?void 0:e.model.Presentation.PageBackgroundImageUrl;return t?f.Common.FlexImageUrl(t,this.flexBackgroundWidth):""}},{key:"syncProgressHandle",get:function(){return(null==this._syncProgressHandle||this._syncProgressHandle.disabled)&&(this._syncProgressHandle=new h.default(this.syncState)),this._syncProgressHandle}},{key:"navigateToView",value:function(e){u.AppGlobals.AppState.SetActiveControl(e.control(),InputHandler.rootStateForControl,e.isFullScreen())}},{key:"navigateToPreviousHashState",value:function(){u.AppGlobals.AppState.NavigationStack.pop();var e=u.AppGlobals.AppState.NavigationStack[u.AppGlobals.AppState.NavigationStack.length-1],t=(null==e?void 0:e.HashState)||"",a=u.AppGlobals.AppState.ParseHash(t),n=a.page;if(""!==t&&(null!=n&&"empty"!==n||a.view))e.AppTemplateName!==u.AppGlobals.AppModel.AppTemplate.Name?this.PushState({Root:"empty"}):(e.scrollTop&&(this.restoreScrollPosition=e.scrollTop),u.AppGlobals.AppState.SetWindowHash(e.HashState));else{var r,i,o,l,s,c,d;u.AppGlobals.AppModel.AppTemplate.Presentation.Controls.filter((function(e){return e.IsValid&&"form"!==e.Action&&e.Action!==u.AppGlobals.AppState.CurrentUIState.Root&&null!=u.AppGlobals.AppModel.DisplayActions[e.Action]})).forEach((function(e){e.Name===u.AppGlobals.AppModel.AppTemplate.Presentation.DefaultStartView&&(r=e),e.Position===u.AppGlobals.AppModel.POSITION_FAR_LEFT&&(i=e),e.Position===u.AppGlobals.AppModel.POSITION_LEFT&&(o=e),e.Position===u.AppGlobals.AppModel.POSITION_RIGHT&&(l=e),e.Position===u.AppGlobals.AppModel.POSITION_FAR_RIGHT&&(s=e),e.Position===u.AppGlobals.AppModel.POSITION_CENTER&&(c=e),e.Position===u.AppGlobals.AppModel.POSITION_MENU&&(d=e)}));var f=r||i||o||l||s||c||d;f?u.AppGlobals.AppState.SetActiveControl(f,InputHandler.rootStateForControl):(u.AppGlobals.AppState.ActiveControl=null,u.AppGlobals.AppState.ResetState({Root:"empty"}))}}},{key:"setSearch",value:function(e){var t=e.searchQuery,a=void 0===t?this.searchQuery:t,n=e.searchEnabled,r=void 0===n?this.searchEnabled:n;this.searchQuery=a,this.searchEnabled=r}},{key:"setCachingProgress",value:function(e){var t=e.totalFilesToCache,a=void 0===t?this.totalFilesToCache:t,n=e.filesCached,r=void 0===n?this.filesCached:n,i=e.filesWithError,o=void 0===i?this.filesWithError:i;this.totalFilesToCache=a,this.filesCached=r,this.filesWithError=o}},{key:"setSideMenuOpen",value:function(e){this.sideMenuOpen=e,u.AppGlobals.StateChangeHandler.ShowUIState(!0)}},{key:"setAppTemplate",value:function(e){this.appTemplate=e}},{key:"initStateFromLocalStorage",value:function(e){var t=this;this.initialized?e&&e(this.localStorageState):(u.AppGlobals.AppModel.GetViewState().then((function(a){a||(a={}),t.localStorageState=new Map(Object.entries(a)),e&&e(t.localStorageState)})),this.initialized=!0)}}]),e}();C([c.observable],k.prototype,"widescreenBreakpoint",void 0),C([c.action.bound],k.prototype,"setHash",null),C([c.computed],k.prototype,"hash",null),C([c.computed],k.prototype,"currentView",null),C([c.computed],k.prototype,"headerTabs",null),C([c.computed],k.prototype,"footerEntries",null),C([c.computed],k.prototype,"footerHeight",null),C([c.computed],k.prototype,"viewWidth",null),C([c.computed],k.prototype,"viewHeight",null),C([c.computed],k.prototype,"headerTabIndex",null),C([c.action.bound],k.prototype,"selectHeaderTab",null),C([c.observable],k.prototype,"toasts",void 0),C([c.action.bound],k.prototype,"showToast",null),C([c.action.bound],k.prototype,"dismissToast",null),C([c.action.bound],k.prototype,"showToastThrottled",null),C([c.observable],k.prototype,"showSearchControl",void 0),C([c.observable],k.prototype,"showFooter",void 0),C([c.observable],k.prototype,"headerSelectedTabIndex",void 0),C([c.observable],k.prototype,"headerHeight",void 0),C([c.observable],k.prototype,"drawerCloseWidth",void 0),C([c.observable],k.prototype,"drawerOpenWidth",void 0),C([c.observable],k.prototype,"headerTitle",void 0),C([c.observable],k.prototype,"headerActionButtons",void 0),C([c.observable],k.prototype,"sideMenuOpen",void 0),C([c.observable],k.prototype,"syncQueueCount",void 0),C([c.observable],k.prototype,"appTemplate",void 0),C([c.observable],k.prototype,"searchQuery",void 0),C([c.observable],k.prototype,"searchEnabled",void 0),C([c.observable],k.prototype,"showAboutView",void 0),C([c.observable],k.prototype,"localStorageState",void 0),C([c.observable],k.prototype,"totalFilesToCache",void 0),C([c.observable],k.prototype,"filesCached",void 0),C([c.observable],k.prototype,"filesWithError",void 0),C([c.observable],k.prototype,"hashState",void 0),C([c.observable],k.prototype,"windowWidth",void 0),C([c.observable],k.prototype,"windowHeight",void 0),C([c.observable],k.prototype,"flexBackgroundWidth",void 0),C([c.observable],k.prototype,"dataStamp",void 0),C([c.observable],k.prototype,"syncState",void 0),C([c.computed],k.prototype,"isWideScreen",null),C([c.computed],k.prototype,"showResetDash",null),C([c.action.bound],k.prototype,"onResize",null),C([c.computed],k.prototype,"flexLaunchBackgroundUrl",null),C([c.computed],k.prototype,"flexPageBackgroundUrl",null),C([c.action.bound],k.prototype,"setSearch",null),C([c.action.bound],k.prototype,"setCachingProgress",null),C([c.action.bound],k.prototype,"setSideMenuOpen",null),C([c.action.bound],k.prototype,"setAppTemplate",null);var R=!0===window.APPSHEET_TEST_CONTEXT||m.ReactRootUIConfig.isReactRoot()?(0,d.default)(new k):new k;(0,c.autorun)((function(){var e,t,a=S(R.localStorageState.values());try{for(a.s();!(t=a.n()).done;)t.value}catch(e){a.e(e)}finally{a.f()}var n=R.localStorageState;(null===(e=u.AppGlobals.AppModel)||void 0===e?void 0:e.SetViewState)&&u.AppGlobals.AppModel.SetViewState(n)}));var I=R;t.default=I},891666:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.nativeGeolocationManager=t.NativeGeolocationManager=void 0;var r=n(a(689728)),i=n(a(856690)),o=n(a(496486)),l=n(a(593186)),u=n(a(190644)),s=a(263198);function c(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var f=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this._nextId=1,this.highAccuracy=!1,this.isFetching=!1,this.listeners=[],this.shortestInterval=1/0,this.shouldStartFetching=function(e){var a=e.interval,n=e.enableHighAccuracy;return!t.isFetching||a&&a<t.shortestInterval||!0===n&&!t.highAccuracy},this.getCurrentPosition=function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.enableHighAccuracy,i=void 0!==r&&r,o=n.timeout,s=void 0===o?1e4:o,c=n.maximumAge,d=void 0===c?6e4:c;if(u.default.pending||t.shouldStartFetching({enableHighAccuracy:i})){var f;l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition adding a listener");var p=t.addListener({callback:function(a){clearTimeout(f),t.removeListener(p),e(a)},failureCallback:function(e){clearTimeout(f),t.removeListener(p),a(e)},enableHighAccuracy:i,interval:d});setTimeout((function(){t.removeListener(p),a(new Error("getCurrentPosition timed out"))}),s)}else u.default.lastPosition?(l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition using lastPosition"),e(u.default.lastPosition)):(l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition location not available"),a(new Error("Location is not available")))},this.addListener=function(e){var a=e.callback,n=void 0===a?function(){}:a,r=e.failureCallback,i=void 0===r?function(){}:r,o=e.interval,u=void 0===o?6e4:o,s=e.enableHighAccuracy,c=void 0!==s&&s,d={id:t._nextId++,type:"NativeGeolocationManager",callback:n,failureCallback:i,interval:u,enableHighAccuracy:c};return t.listeners.push(d),l.default.logToDevConsole("adding listener"),t.shouldStartFetching(d)&&(d.interval&&(t.shortestInterval=t.shortestInterval?Math.min(t.shortestInterval,d.interval):d.interval),d.enableHighAccuracy&&(t.highAccuracy=!0),t._startFetching()),d},this.removeListener=function(e){if(e){var a=t.listeners.findIndex((function(t){return t.id===e.id}));if(a>=0){l.default.logToDevConsole("removing listener");var n=t.listeners[a];if(t.listeners.splice(a,1),0===t.listeners.length)t._stopFetching(),t.shortestInterval=1/0,t.highAccuracy=!1;else{var r=!1;n.interval===t.shortestInterval&&n.interval!==t._findNewShortestInterval()&&(r=!0),n.enableHighAccuracy&&!t._findNewAccuracy()&&(r=!0),r&&t._startFetching()}}}},this.removeAllListeners=function(){t.listeners.forEach(t.removeListener)},this.getFetchInterval=function(){return t.shortestInterval},this._locationCallback=function(e){var a,n=c(t.listeners);try{for(n.s();!(a=n.n()).done;){(0,a.value.callback)({coords:e})}}catch(e){n.e(e)}finally{n.f()}},this._failureCallback=function(e){var a,n=c(t.listeners);try{for(n.s();!(a=n.n()).done;){(0,a.value.failureCallback)(e)}}catch(e){n.e(e)}finally{n.f()}},this._startFetching=function(){s.JeeneeBrowserAPI.startLocationUpdates({callback:t._locationCallback,failureCallback:t._failureCallback,interval:t.shortestInterval,enableHighAccuracy:t.highAccuracy}),t.isFetching=!0},this._stopFetching=function(){s.JeeneeBrowserAPI.stopLocationUpdates(),t.isFetching=!1},this._findNewShortestInterval=function(){return t.shortestInterval=t.listeners.map((function(e){return e.interval})).reduce((function(e,t){return e<t?e:t})),t.shortestInterval},this._findNewAccuracy=function(){return t.highAccuracy=o.default.some(t.listeners,(function(e){return e.enableHighAccuracy})),t.highAccuracy}}));t.NativeGeolocationManager=f;var p=new f;t.nativeGeolocationManager=p},75212:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.parseHash=void 0;var r=n(a(280129));t.parseHash=function(e){e=(e||"").replace(/^#/,"");try{return r.default.parse(e)}catch(e){return{}}}},498967:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(166089),i=n(a(496486)),o=n(a(674823)),l=n(a(365914));function u(e,t){return e<t?-1:e>t?1:0}function s(e){return i.default.toLower(i.default.toString(e))}var c=new Map;function d(e){var t=c.get(e);if(null!=t)return t;t=[];for(var a,n,r=0,i=-1,o=0;a=(n=e.charAt(r++)).charCodeAt(0);){var l=46===a||a>=48&&a<=57;l!==o&&(t[++i]="",o=l),t[i]+=n}return c.set(e,t),t}var f=/[0-9]/;var p=function(){function e(e,t,a,n,r,i){for(var o=a,l=n+1,u=a;;){if(i(e[o],e[l])<=0){if(t[u++]=e[o++],o>n){do{t[u++]=e[l++]}while(l<=r);break}}else if(t[u++]=e[l++],l>r){do{t[u++]=e[o++]}while(o<=n);break}}}function t(t,n,r,i,o){if(!(i<r))if(i!=r){var l=Math.floor(r+(i-r)/2);a(t,n,r,l,o),a(t,n,l+1,i,o),e(t,n,r,l,i,o)}else n[r]=t[r]}function a(a,n,r,i,o){if(!(i<=r)){var l=Math.floor(r+(i-r)/2);t(a,n,r,l,o),t(a,n,l+1,i,o),e(n,a,r,l,i,o)}}return function(e,t){var n=e.slice(0);return a(e,n,0,e.length-1,t),e}}(),h=i.default.memoize((function(e){return new Date(e).getTime()})),v=i.default.memoize((function(e){return l.default.timeToDate(e).getTime()})),m={numericComparer:function(e,t){var a=Number(e),n=Number(t);return null!=e&&""!==e&&!isNaN(a)||null!=t&&""!==t&&!isNaN(n)?null==e||""===e||isNaN(a)?-1:null==t||""===t||isNaN(n)?1:a<n?-1:a>n?1:0:0},timeComparer:function(e,t){return m.utcMsComparer(v(e),v(t))},dateComparer:function(e,t){return m.utcMsComparer(h(e),h(t))},nativeDateComparer:function(e,t){return m.utcMsComparer(null==e?void 0:e.getTime(),null==t?void 0:t.getTime())},utcMsComparer:function(e,t){return isNaN(e)&&isNaN(t)?0:isNaN(e)?-1:isNaN(t)?1:e<t?-1:e>t?1:0},durationComparer:function(e,t){return null==e||null==t?0:m.numericComparer(e.replace(/:/g,""),t.replace(/:/g,""))},textComparer:function(e,t){return function(e,t){if(e=(0,o.default)(e),t=(0,o.default)(t),!f.test(e)&&!f.test(t))return u(e,t);for(var a=d(e),n=d(t),r=0;a[r]&&n[r];r++)if(a[r]!==n[r]){var i=Number(a[r]),l=Number(n[r]);if(i!=a[r]||l!=n[r])return a[r]>n[r]?1:-1;if(i!==l)return i-l}return e!==t&&a.length===n.length?u(e,t):a.length-n.length}(e?e.toLowerCase():"",t?t.toLowerCase():"")},genericComparer:u,listComparer:function(e,t,a){var n=e.indexOf(t),r=e.indexOf(a);return-1===n&&-1===r?this.genericComparer(t,a):-1===n?1:-1===r||n<r?-1:n>r?1:t===a?0:-1},labelComparer:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(a||(a={}),a.keyLabelMap&&a.labelComparer){var r=a.keyLabelMap[e],o=a.keyLabelMap[t];if(n<50){if(null!=r&&null!=o)return a.labelComparer(r,o,a,n+1);if(a.labelComparer!==m.labelComparer)return a.labelComparer(s(e),s(t),a,n+1)}}var l=function(e){return e?i.default.isString(e)?e.toLowerCase():e:""};return m.genericComparer(l(e),l(t))},sort:p,findSortInfo:function(e,t){var a;null!=t&&0!==t.length||((a=e.findAttributeByName(r.AppGlobals.AppModel.ROW_NUMBER_ATTRNAME))||(a=e.keyAttribute()),t=a.name());var n=!1;return 0===t.indexOf(r.AppGlobals.AppModel.DESC_SORT_PREFIX)&&(n=!0,t=t.replace(r.AppGlobals.AppModel.DESC_SORT_PREFIX,"")),{attribute:e.findAttributeByName(t),inverted:n}}},g=m;t.default=g},266522:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=n(a(627424)),o=n(a(856690)),l=n(a(689728)),u=a(166089),s=n(a(6767)),c=n(a(496486)),d=n(a(400568)),f=a(646514),p=n(a(593186)),h=a(714067),v=n(a(571524)),m=a(557310),g=a(646317),y=n(a(365914)),b=n(a(112368)),T={colorInputRed:"#fa5252",colorInputOrange:"#ff922b",colorInputYellow:"#ffd43b",colorInputGreen:"#51cf66",colorInputBlue:"#329af0",colorInputPurple:"#cc5de8",colorInputBlack:"#444",colorInputWhite:"#eee",cardBorderStyleDefault:"1px solid",cardBorderStyleSelected:"2px solid",cardBorderRadiusDefault:"4px",cardTopBorderRadiusLarge:"4px 4px 0 0",cardBottomBorderRadiusLarge:"0 0 4px 4px",nonCardHeaderTextOverlay:"linear-gradient(to bottom, rgba(255,0,0,0), 40%, rgba(0,0,0,0.6))"},S={Red:{mainColor:"#d95050",secondaryColor:"#ce4444",tertiaryColor:"#a93131",highlightColor:"#ce3737",mainTextColor:f.GOOGLE_WHITE},Orange:{mainColor:"#ff9b3d",secondaryColor:"#ea8e38",tertiaryColor:"#d47a26",highlightColor:"#ff8616",mainTextColor:f.GOOGLE_WHITE},LightGreen:{mainColor:"#64b161",secondaryColor:"#56a753",tertiaryColor:"#468c44",highlightColor:"#559e52",mainTextColor:f.GOOGLE_WHITE},ForestGreen:{mainColor:"#1b7c14",secondaryColor:"#196d13",tertiaryColor:"#125d0c",highlightColor:"#1d6b17",mainTextColor:f.GOOGLE_WHITE},Teal:{mainColor:"#2db2c5",secondaryColor:"#2aa7b9",tertiaryColor:"#228f9e",highlightColor:"#2798a9",mainTextColor:f.GOOGLE_WHITE},MediumBlue:{mainColor:"#4891db",secondaryColor:"#3f85cc",tertiaryColor:"#3675B5",highlightColor:"#2e7ac7",mainTextColor:f.GOOGLE_WHITE},NavyBlue:{mainColor:"#303aa5",secondaryColor:"#232d98",tertiaryColor:"#1c2373",highlightColor:"#27308e",mainTextColor:f.GOOGLE_WHITE},Purple:{mainColor:"#9575cd",secondaryColor:"#8c6ec1",tertiaryColor:"#7156a0",highlightColor:"#8666bb",mainTextColor:f.GOOGLE_WHITE},Magenta:{mainColor:"#d94da6",secondaryColor:"#ce489d",tertiaryColor:"#b14288",highlightColor:"#CF3697",mainTextColor:f.GOOGLE_WHITE},Almond:{mainColor:"#8d6e63",secondaryColor:"#826257",tertiaryColor:"#75554a",highlightColor:"#775e54",mainTextColor:f.GOOGLE_WHITE},"AppSheet Official":{mainColor:"#3dbfea",secondaryColor:"#37b1da",tertiaryColor:"#2a9abf",highlightColor:"#2daed8",mainTextColor:f.GOOGLE_WHITE}},A={Red:{mainColor:"#B71C1C",mainTextColor:"#EEE"},Orange:{mainColor:"#D08025",mainTextColor:"#EEE"},Yellow:{mainColor:"#FFCC06",mainTextColor:"#111"},LightGreen:{mainColor:"#68B366",mainTextColor:"#EEE"},ForestGreen:{mainColor:"#1b7c14",mainTextColor:"#EEE"},Teal:{mainColor:"#1792A0",mainTextColor:"#EEE"},MediumBlue:{mainColor:"#4891DB",mainTextColor:"#EEE"},NavyBlue:{mainColor:"#3F51B5",mainTextColor:"#EEE"},Purple:{mainColor:"#9575CD",mainTextColor:"#EEE"},Magenta:{mainColor:"#da4ea6",mainTextColor:"#EEE"}},w={White:{Blue:"#1e88e5",Red:"#e53935",Amber:"#ffa000",Green:"#43a047",Orange:"#e8710a",Pink:"#d81b60",Purple:"#8e24aa",Cyan:"#00acc1"},Dark:{Blue:"#90caf9",Red:"#ef9a9a",Amber:"#ffe082",Green:"#a5d6a7",Orange:"#ffcc80",Pink:"#f48fb1",Purple:"#ce93d8",Cyan:"#80deea"}},C=function(e,t){var a,n,r=null===(a=null==t?void 0:t.Presentation)||void 0===a?void 0:a.HeaderStyle,i=null===(n=null==t?void 0:t.Presentation)||void 0===n?void 0:n.FooterStyle,o=f.LIGHT_ELEVATION,l=f.LIGHT_ELEVATION,u=(0,s.default)(e.mainColor);return{mainBackground:f.GOOGLE_SURFACE_LIGHT,mainContentBackground:f.GOOGLE_WHITE,mainBackgroundVariant:"#F3F3F3",mainContentBackgroundList:f.GOOGLE_SURFACE_LIGHT,mainBackgroundVariantTranslucent:"rgba(0, 0, 0, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_200,mainBackgroundTranslucent:(0,s.default)(f.GOOGLE_GREY_900).fade(.4).rgb().string(),formTabHover:"rgba(255,255,255,.8)",inputBackground:f.GOOGLE_WHITE,disabledInputBackground:"#EEE",detailBackground:f.LIGHT_ELEVATION,dividerColor:"#DDD",mainBorderColor:f.GOOGLE_GREY_300,weakAccentColor:f.STATE_FOCUS,mediumAccentColor:"#C2C2C2",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_100,buttonDisabledBorder:f.GOOGLE_GREY_300,buttonDisabledBackground:"rgba(0, 0, 0, 0.12)",faintBorderColor:"rgba(0, 0, 0, 0.12)",buttonOutline:e.mainColor,buttonTextColor:f.GOOGLE_WHITE,elevationTone1:f.LIGHT_ELEVATION,elevationTone2:f.LIGHT_ELEVATION2,elevationBoxShadow2:"3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:f.LIGHT_ELEVATION3,elevationBoxShadow3:"0px 6px 10px rgba(0, 0, 0, 0.14), 0px 1px 18px rgba(0, 0, 0, 0.12), 0px 3px 5px rgba(0, 0, 0, 0.2)",bottomDrawerText:f.GOOGLE_GREY_800,bottomDrawerIcon:f.GOOGLE_GREY_700,cardOutlineDefault:f.GOOGLE_GREY_300,cardHoverShadowDefault:"0px 2px 2px rgba(0,0,0,0.14), 0px 3px 1px rgba(0,0,0,0.12), 0px 1px 5px rgba(0,0,0,0.2)",cardHoverBackgroundNarrowscreen:f.STATE_HOVER,cardHoverBackgroundDefault:f.GOOGLE_WHITE,tableBackground:o,tableGroupedHeaderTitle:f.GOOGLE_GREY_700,tableGroupedHeader:f.GOOGLE_SURFACE_LIGHT,tableGroupedAggregateContent:f.GOOGLE_GREY_800,tableAggregateBackground:f.GOOGLE_GREY_300,tableRow:l,tableRowFocus:f.STATE_FOCUS,tableRowHover:f.STATE_HOVER,tableRowSelectedHover:f.STATE_HOVER_SELECTED,tableRowSelectedHoverUpdate:u.alpha(.06).rgb().string(),chipHover:f.STATE_HOVER,drilldownArrow:f.GOOGLE_GREY_900,inputBorder:f.GOOGLE_GREY_400,inputBorderHover:f.GOOGLE_GREY_600,inputBorderDisabled:f.GOOGLE_GREY_200,inputInlineButtons:f.GOOGLE_GREY_700,inputBlockerBackground:(0,s.default)(f.GOOGLE_WHITE).fade(.2).rgb().string(),codeBackgroundColor:f.GOOGLE_GREY_50,codeTextColor:f.GOOGLE_GREY_800,slideshowArrowColor:f.GOOGLE_GREY_900,slideshowArrowBackgroundHover:f.GOOGLE_GREY_200,slideshowArrowBackgroundColor:f.GOOGLE_GREY_300,groupedByAggregateBackground:f.GOOGLE_GREY_200,groupedByAggregateContent:f.GOOGLE_GREY_700,calendarDivider:f.GOOGLE_GREY_200,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",modalContentBorder:f.GOOGLE_GREY_300,focusColorRgb:u.fade(.88).rgb().string(),hoverColorRgb:u.fade(.96).rgb().string(),primaryText:f.GOOGLE_GREY_900,secondaryText:f.GOOGLE_GREY_800,minorText:f.GOOGLE_GREY_700,minorBodyText:f.GOOGLE_GREY_700,disabledText:"rgba(0, 0, 0, 0.38)",highlightOverlay:(0,s.default)(e.highlightColor).mix((0,s.default)(f.GOOGLE_WHITE),.82).rgb().string(),highlightOverlayUpdate:u.alpha(.13).rgb().string(),highlightOverlayTransparent:(0,s.default)(e.highlightColor).fade(.5).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:"#333",interfaceHighlightText:e.highlightColor,interfaceTextShadow:"transparent",interfaceBackground:"#F8F8F8",headerText:r===h.HEADERSTYLE_COLOR?e.mainTextColor:"#333",headerBackground:r===h.HEADERSTYLE_COLOR?e.mainColor:"#FFFFFF",footerText:i===h.FOOTERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_700,footerBackground:i===h.FOOTERSTYLE_COLOR?e.mainColor:"#FFFFFF",interfaceSecondaryBackground:"#efefef",interfaceTertiaryBackground:"#d6d6d6",interfaceHighlightBackground:"#F8F8F8",interfaceIndicator:"#cc0b0b",actionIcon:e.highlightColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_700,actionButtonDeselectedBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonDeselectedBorder:f.GOOGLE_GREY_300,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_800,actionButtonHoverBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_800,actionButtonPressBackground:f.GOOGLE_GREY_200,actionButtonPressBorder:f.GOOGLE_GREY_300,flatControlBackground:"rgba(0, 0, 0, 0.1)",flatControlForeground:e.mainTextColor,flatControlHighlight:e.highlightColor,attentionItemText:e.mainTextColor,attentionBackground:e.mainColor,errorColor:"#E66",warningColor:"#E4D58D",webpageBarColor:f.GOOGLE_WHITE,androidSystemBarColor:"black",amplifyColor:"rgba(0, 0, 0, 0.3)",amplifyColorTransparent:"rgba(0, 0, 0, 0)",signatureBackground:"#F8F8F8",themeMainColor:e.mainColor,themeTextColor:e.mainColor,themeBackgroundColor:u.alpha(.13).rgb().string(),themeBackgroundHover:u.alpha(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_200,sideMenuBackgroundColor:f.LIGHT_ELEVATION4,sideMenuBackgroundColorTransparent:"rgba(253,253,253,0)",sideMenuScrollShadow:"rgb(240, 240, 240)",sideMenuScrollShadowTransparent:"rgb(240, 240, 240, 0)",sideMenuSelected:u.fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_800,sideMenuIconColor:f.GOOGLE_GREY_700,sideMenuBackgroundOverlay:f.SURFACE_DARK,thinScrollbarColor:f.GOOGLE_GREY_700,dropdownChipBackgroundColor:f.GOOGLE_WHITE,dropdownChipBorderColor:"#DADCE0",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_700,dropdownOverflowNumberColor:"#5F6368",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_WHITE,syncErrorIconColor:f.GOOGLE_RED_600,syncButtonBorderColor:"#dadce0",syncSeverityInfo:f.GOOGLE_THEME_INFO_LIGHT,syncSeverityWarning:f.GOOGLE_THEME_WARNING_LIGHT,syncSeverityError:f.GOOGLE_THEME_ERROR_LIGHT,syncSeverityOffline:f.GOOGLE_GREY_100,syncBadgeForUnsyncedChanges:"rgb(241,152,1)",syncErrorButtonBackground:f.GOOGLE_THEME_ERROR_LIGHT,syncErrorButtonTextAndBorder:f.GOOGLE_RED_500,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_500,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_WHITE,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#cc0b0b","formattingRule-orange":"#da7a00","formattingRule-yellow":"#c3ad00","formattingRule-green":"#00b11f","formattingRule-cyan":"#01cebc","formattingRule-blue":"#037be4","formattingRule-purple":"#7c00ff","formattingRule-pink":"#fb0a82","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"light",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}},E=["red","orange","yellow","green","cyan","blue","purple","pink","primaryText","secondaryText","minorText","themeMainColor"],k=c.default.keyBy(E),R=function(){function e(t){(0,o.default)(this,e),this.themeFile=t;var a=document.getElementById("storybook-style");a?this.stylesheet=a:(this.stylesheet=document.createElement("style"),document.head.appendChild(this.stylesheet))}return(0,l.default)(e,[{key:"buildThemeCSS",value:function(e){var t=this.themeFile;for(var a in e){var n=new RegExp("\\b"+a+"\\b","g");t=t.replace(n,e[a])}return t}},{key:"setTheme",value:function(t,a){this.themeData=e.getThemeData(t,a);var n=this.buildThemeCSS(this.themeData);this.writeThemeData(n,this.themeData)}},{key:"getThemeColor",value:function(e){return this.themeData?this.themeData[e]:""}},{key:"getMuiThemeOptions",value:function(){var e,t;return{palette:(null===(e=this.themeData)||void 0===e?void 0:e.muiPalette)||{},typography:Object.assign({htmlFontSize:u.AppGlobals.AppModel.appTemplate.normalizedFontSize(),fontFamily:"inherit",h2:{paddingBottom:0}},m.ReactRootUIConfig.isInDesktopExperience()&&{button:{textTransform:"none",fontWeight:400}}),overrides:{MuiCard:{root:{backgroundColor:null===(t=this.themeData)||void 0===t?void 0:t.mainContentBackground}}}}}},{key:"getHeaderMuiThemeOptions",value:function(){var e;return Object.assign(Object.assign({},this.getMuiThemeOptions()),{palette:(null===(e=this.themeData)||void 0===e?void 0:e.headerMuiPalette)||{}})}},{key:"getThemeBackgroundDimmer",value:function(){return this.themeData?"linear-gradient("+this.themeData.mainBackgroundTranslucent+", "+this.themeData.mainBackgroundTranslucent+")":(p.default.warnToDevConsole("No theme loaded when getThemeBackgroundDimmer was called"),"#ffffff")}},{key:"writeThemeData",value:function(e,t){var a,n=this;this.stylesheet.textContent=e,a=t.webpageBarColor,null==r&&(r=$("<meta>").attr("name","theme-color"),$("head").append(r)),r.attr("content",a),b.default.IsAndroidAppWithMinVersion(9)&&!v.default.IsUnsupportedAndroidVersion()&&setTimeout((function(){var e;null===(e=window.JeeneeAndroid)||void 0===e||e.setStatusBarColor(t.androidSystemBarColor)}),0),this.sfx&&this.sfx.sounds&&c.default.each(this.sfx.sounds,(function(e,t){n.sfx.remove(t)})),t.sounds&&(this.sfx||(this.sfx=new d.default),c.default.each(t.sounds,(function(e,t){n.sfx.load(e,t)})))}},{key:"triggerSound",value:function(e){this.sfx&&this.sfx.play(e)}}],[{key:"applyQueryTheme",value:function(e){var t;try{var a=e.split(" - "),n=(null!==(t=(0,g.parseUrlQuery)().theme)&&void 0!==t?t:"").split("-").map(c.default.upperFirst),r=(0,i.default)(n,2),o=r[0],l=r[1];if(c.default.includes(["Light","White","Dark"],o))a[0]=o.replace("Light","White"),l in("Dark"===o?A:S)&&(a[1]=l);return a.join(" - ")}catch(e){p.default.ReportErrorOnce({errorMessage:"Error in applyQueryTheme",error:e})}return e}},{key:"getThemeData",value:function(t,a){var n,r={WhiteRed:"White - Red",WhiteOrange:"White - Orange",WhiteLightGreen:"White - LightGreen",WhiteForestGreen:"White - ForestGreen",WhiteTeal:"White - Teal",WhiteMediumBlue:"White - MediumBlue",WhiteNavyBlue:"White - NavyBlue",WhitePurple:"White - Purple",WhiteMagenta:"White - Magenta",light:"White - MediumBlue",Light:"White - MediumBlue",dark:"Dark - Orange",Dark:"Dark - Orange",Clown:"White - Red"};if(r[t]&&(p.default.warnToDevConsole("Auto-migrating theme",t,"to",r[t]),t=r[t]),t in S)n=function(e){var t=f.LIGHT_ELEVATION,a=f.LIGHT_ELEVATION,n=(0,s.default)(e.mainColor);return{mainBackground:f.GOOGLE_SURFACE_LIGHT,mainContentBackground:"#ffffff",mainBackgroundVariant:"#F3F3F3",mainBackgroundVariantTranslucent:"rgba(0, 0, 0, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_200,mainBackgroundTranslucent:(0,s.default)(f.GOOGLE_GREY_900).fade(.4).rgb().string(),formTabHover:"rgba(255,255,255,.8)",inputBackground:f.GOOGLE_WHITE,disabledInputBackground:"#DEDEDE",detailBackground:f.LIGHT_ELEVATION,dividerColor:"rgba(221, 221, 221, 0.6)",mainBorderColor:f.GOOGLE_GREY_300,weakAccentColor:f.STATE_FOCUS,mediumAccentColor:"#C2C2C2",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_100,primaryText:f.GOOGLE_GREY_900,secondaryText:f.GOOGLE_GREY_800,minorText:f.GOOGLE_GREY_700,minorBodyText:f.GOOGLE_GREY_700,disabledText:"rgba(0, 0, 0, 0.38)",highlightOverlay:(0,s.default)(e.highlightColor).mix((0,s.default)(f.GOOGLE_WHITE),.82).rgb().string(),highlightOverlayUpdate:(0,s.default)(e.mainColor).alpha(.13).rgb().string(),highlightOverlayTransparent:(0,s.default)(e.highlightColor).fade(.5).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:f.GOOGLE_WHITE,interfaceHighlightText:f.GOOGLE_WHITE,interfaceTextShadow:"transparent",interfaceBackground:e.mainColor,headerText:f.GOOGLE_WHITE,headerBackground:e.mainColor,footerText:f.GOOGLE_WHITE,footerBackground:e.mainColor,interfaceSecondaryBackground:e.secondaryColor,interfaceTertiaryBackground:e.tertiaryColor,interfaceHighlightBackground:e.highlightColor,interfaceIndicator:f.GOOGLE_WHITE,tableBackground:t,tableGroupedHeaderTitle:f.GOOGLE_GREY_700,tableGroupedHeader:f.GOOGLE_SURFACE_LIGHT,tableGroupedAggregateContent:f.GOOGLE_GREY_800,tableAggregateBackground:f.GOOGLE_GREY_300,tableRow:a,tableRowFocus:f.STATE_FOCUS,tableRowHover:f.STATE_HOVER,tableRowSelectedHover:f.STATE_HOVER_SELECTED,tableRowSelectedHoverUpdated:f.STATE_HOVER_SELECTED,chipHover:f.STATE_HOVER,drilldownArrow:f.GOOGLE_GREY_900,inputBorder:f.GOOGLE_GREY_400,inputBorderHover:f.GOOGLE_GREY_600,inputBorderDisabled:f.GOOGLE_GREY_200,inputInlineButtons:f.GOOGLE_GREY_700,inputBlockerBackground:(0,s.default)("white").fade(.2).rgb().string(),activeButtonText:f.GOOGLE_GREY_100,codeBackgroundColor:f.GOOGLE_GREY_50,codeTextColor:f.GOOGLE_GREY_800,slideshowArrowColor:f.GOOGLE_WHITE,slideshowArrowBackgroundHover:f.GOOGLE_GREY_200,slideshowArrowBackgroundColor:f.GOOGLE_GREY_300,groupedByAggregateBackground:f.GOOGLE_GREY_200,groupedByAggregateContent:f.GOOGLE_GREY_700,calendarDivider:f.GOOGLE_GREY_200,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",actionIcon:e.highlightColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_400,actionButtonDeselectedBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonDeselectedBorder:f.GOOGLE_GREY_300,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_800,actionButtonHoverBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_800,actionButtonPressBackground:f.GOOGLE_GREY_200,actionButtonPressBorder:f.GOOGLE_GREY_300,cardOutlineDefault:f.GOOGLE_GREY_300,cardHoverShadowDefault:"0px 2px 2px rgba(0,0,0,0.14), 0px 3px 1px rgba(0,0,0,0.12), 0px 1px 5px rgba(0,0,0,0.2)",cardHoverBackgroundNarrowscreen:f.STATE_HOVER,cardHoverBackgroundDefault:f.GOOGLE_WHITE,buttonDisabledBorder:f.GOOGLE_GREY_300,buttonDisabledBackground:"rgba(0, 0, 0, 0.12)",faintBorderColor:"rgba(0, 0, 0, 0.12)",buttonOutline:e.mainColor,buttonTextColor:f.GOOGLE_WHITE,elevationTone1:f.LIGHT_ELEVATION,elevationTone2:f.LIGHT_ELEVATION2,elevationBoxShadow2:"3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:f.LIGHT_ELEVATION3,elevationBoxShadow3:"0px 6px 10px rgba(0, 0, 0, 0.14), 0px 1px 18px rgba(0, 0, 0, 0.12), 0px 3px 5px rgba(0, 0, 0, 0.2)",bottomDrawerText:f.GOOGLE_GREY_800,bottomDrawerIcon:f.GOOGLE_GREY_700,modalContentBorder:f.GOOGLE_GREY_300,focusColorRgb:(0,s.default)(e.mainColor).fade(.88).rgb().string(),hoverColorRgb:(0,s.default)(e.mainColor).fade(.96).rgb().string(),flatControlBackground:"rgba(0, 0, 0, 0.1)",flatControlForeground:f.GOOGLE_WHITE,flatControlHighlight:e.highlightColor,attentionItemText:f.GOOGLE_WHITE,attentionBackground:e.highlightColor,errorColor:"#E66",warningColor:"#E4D58D",webpageBarColor:e.mainColor,androidSystemBarColor:e.mainColor,amplifyColor:"rgba(0, 0, 0, 0.3)",amplifyColorTransparent:"rgba(0, 0, 0, 0)",signatureBackground:f.GOOGLE_WHITE,themeMainColor:e.mainColor,themeTextColor:f.GOOGLE_WHITE,themeBackgroundColor:e.mainColor,themeBackgroundHover:n.lighten(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_200,sideMenuBackgroundColor:f.LIGHT_ELEVATION4,sideMenuBackgroundColorTransparent:"rgba(253,253,253,0)",sideMenuScrollShadow:"rgb(240, 240, 240)",sideMenuScrollShadowTransparent:"rgb(240, 240, 240, 0)",sideMenuSelected:(0,s.default)(e.mainColor).fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_800,sideMenuIconColor:f.GOOGLE_GREY_700,sideMenuBackgroundOverlay:f.SURFACE_DARK,thinScrollbarColor:f.GOOGLE_GREY_700,dropdownChipBackgroundColor:f.GOOGLE_WHITE,dropdownChipBorderColor:"#DADCE0",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_700,dropdownOverflowNumberColor:"#5F6368",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_WHITE,syncErrorIconColor:f.GOOGLE_RED_600,syncButtonBorderColor:"#dadce0",syncSeverityInfo:f.GOOGLE_THEME_INFO_LIGHT,syncSeverityWarning:f.GOOGLE_THEME_WARNING_LIGHT,syncSeverityError:f.GOOGLE_THEME_ERROR_LIGHT,syncSeverityOffline:f.GOOGLE_GREY_100,syncBadgeForUnsyncedChanges:"rgb(241,152,1)",syncErrorButtonBackground:f.GOOGLE_THEME_ERROR_LIGHT,syncErrorButtonTextAndBorder:f.GOOGLE_RED_500,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_500,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_WHITE,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#cc0b0b","formattingRule-orange":"#da7a00","formattingRule-yellow":"#c3ad00","formattingRule-green":"#00b11f","formattingRule-cyan":"#01cebc","formattingRule-blue":"#037be4","formattingRule-purple":"#7c00ff","formattingRule-pink":"#fb0a82","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"light",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}}(S[t]);else if(t&&t.includes(" - ")){var o=t.split(" - "),l=(0,i.default)(o,2),u=l[0],c=l[1],d="Dark"===u,v=e.computeColor(c,d);n=d?function(e,t){var a,n,r=null===(a=null==t?void 0:t.Presentation)||void 0===a?void 0:a.HeaderStyle,i=null===(n=null==t?void 0:t.Presentation)||void 0===n?void 0:n.FooterStyle,o=(0,s.default)(e.mainColor),l=f.SURFACE_DARK,u=f.DARK_ELEVATION,c=f.DARK_ELEVATION2,d=f.DARK_ELEVATION3,p=f.DARK_ELEVATION4,v=u,m=u,g=u,y=l,b=u,T=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.12).rgb().string(),S=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.04).rgb().string(),A=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.18).rgb().string(),w=(0,s.default)(e.mainColor).mix((0,s.default)("#242424"),.78).rgb().string();return{mainBackground:l,mainContentBackground:b,mainBackgroundVariant:"#313131",mainContentBackgroundList:l,mainBackgroundVariantTranslucent:"rgba(255, 255, 255, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_600,mainBackgroundTranslucent:(0,s.default)(b).fade(.4).rgb().string(),formTabHover:"rgba(48,48,48,.9)",inputBackground:"#222",disabledInputBackground:"#383838",detailBackground:v,dividerColor:"#4C4C4C",mainBorderColor:f.GOOGLE_GREY_800,weakAccentColor:f.DARK_STATE_FOCUS,mediumAccentColor:"#595959",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_800,primaryText:f.GOOGLE_GREY_100,secondaryText:f.GOOGLE_GREY_200,minorText:f.GOOGLE_GREY_400,minorBodyText:f.GOOGLE_GREY_400,disabledText:"rgba(232, 234, 237, 0.38)",highlightOverlay:w,highlightOverlayUpdate:w,highlightOverlayTransparent:(0,s.default)(e.mainColor).fade(.5).rgb().string(),elevationTone1:u,elevationTone2:c,elevationBoxShadow2:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:d,elevationBoxShadow3:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",buttonDisabledBorder:"rgba(232, 234, 237, 0.38)",buttonDisabledBackground:"rgba(232, 234, 237, 0.12)",faintBorderColor:"rgba(232, 234, 237, 0.12)",buttonOutline:"rgba(232, 234, 237, 0.38)",buttonTextColor:f.GOOGLE_GREY_900,bottomDrawerText:f.GOOGLE_GREY_200,bottomDrawerIcon:f.GOOGLE_GREY_500,tableBackground:g,tableGroupedHeaderTitle:f.GOOGLE_GREY_400,tableGroupedHeader:y,tableGroupedAggregateContent:f.GOOGLE_GREY_200,tableAggregateBackground:f.GOOGLE_GREY_600,tableRow:m,tableRowFocus:T,tableRowHover:S,tableRowSelectedHover:A,tableRowSelectedHoverUpdate:A,chipHover:(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.04).rgb().string(),drilldownArrow:f.GOOGLE_GREY_300,inputBorder:f.GOOGLE_GREY_500,inputBorderHover:f.GOOGLE_GREY_400,inputBorderDisabled:f.GOOGLE_GREY_700,inputInlineButtons:f.GOOGLE_GREY_500,inputBlockerBackground:(0,s.default)(f.GOOGLE_GREY_900).fade(.2).rgb().string(),activeButtonText:f.GOOGLE_GREY_100,codeBackgroundColor:f.GOOGLE_GREY_800,codeTextColor:f.GOOGLE_GREY_100,slideshowArrowColor:f.GOOGLE_WHITE,slideshowArrowBackgroundHover:f.GOOGLE_GREY_700,slideshowArrowBackgroundColor:f.GOOGLE_GREY_800,groupedByAggregateBackground:f.GOOGLE_GREY_600,groupedByAggregateContent:f.GOOGLE_GREY_200,calendarDivider:f.GOOGLE_GREY_700,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",cardOutlineDefault:f.GOOGLE_GREY_800,cardHoverShadowDefault:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",cardHoverBackgroundNarrowscreen:f.DARK_STATE_HOVER,cardHoverBackgroundDefault:c,modalContentBorder:f.GOOGLE_GREY_500,focusColorRgb:(0,s.default)(e.mainColor).fade(.88).rgb().string(),hoverColorRgb:(0,s.default)(e.mainColor).fade(.96).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:"#EEE",interfaceHighlightText:e.mainTextColor,interfaceTextShadow:"transparent",interfaceBackground:"#2b2b2b",headerText:r===h.HEADERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_100,headerBackground:r===h.HEADERSTYLE_COLOR?e.mainColor:c,footerText:i===h.FOOTERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_500,footerBackground:i===h.FOOTERSTYLE_COLOR?e.mainColor:c,interfaceSecondaryBackground:"#252525",interfaceTertiaryBackground:"#0e0e0e",interfaceHighlightBackground:e.mainColor,interfaceIndicator:"#f12b2b",actionIcon:e.mainColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_400,actionButtonDeselectedBackground:f.GOOGLE_GREY_900,actionButtonDeselectedBorder:f.GOOGLE_GREY_500,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_300,actionButtonHoverBackground:l,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_300,actionButtonPressBackground:f.GOOGLE_GREY_900,actionButtonPressBorder:f.GOOGLE_GREY_300,flatControlBackground:"rgba(0, 0, 0, 0.5)",flatControlForeground:e.mainTextColor,flatControlHighlight:e.mainColor,attentionItemText:e.mainTextColor,attentionBackground:e.mainColor,errorColor:"#FC9991",warningColor:"#A9911F",webpageBarColor:"#303030",androidSystemBarColor:"#232323",amplifyColor:"rgba(255, 255, 255, 0.3)",amplifyColorTransparent:"rgba(255, 255, 255, 0)",signatureBackground:"#C2C2C2",themeMainColor:e.mainColor,themeTextColor:f.GOOGLE_WHITE,themeBackgroundColor:e.mainColor,themeBackgroundHover:o.lighten(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_700,sideMenuBackgroundColor:p,sideMenuBackgroundColorTransparent:"rgba(46,46,46,0)",sideMenuScrollShadow:"rgb(38, 38, 38)",sideMenuScrollShadowTransparent:"rgb(38, 38, 38, 0)",sideMenuSelected:(0,s.default)(e.mainColor).fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_300,sideMenuIconColor:f.GOOGLE_GREY_500,sideMenuBackgroundOverlay:l,thinScrollbarColor:f.GOOGLE_GREY_300,dropdownChipBackgroundColor:f.GOOGLE_BLACK,dropdownChipBorderColor:"rgba(255, 255, 255, 0.08)",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_200,dropdownOverflowNumberColor:"#9AA0A6",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_BLACK,syncErrorIconColor:f.GOOGLE_RED_300,syncButtonBorderColor:"#3c4043",syncSeverityInfo:f.GOOGLE_THEME_INFO_DARK,syncSeverityWarning:f.GOOGLE_THEME_WARNING_DARK,syncSeverityError:f.GOOGLE_THEME_ERROR_DARK,syncErrorButtonBackground:"",syncSeverityOffline:f.GOOGLE_GREY_700,syncBadgeForUnsyncedChanges:"rgb(255,159,0)",syncErrorButtonTextAndBorder:f.GOOGLE_RED_100,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_200,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_DARK_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_BLACK,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#f12b2b","formattingRule-orange":"#f19a2b","formattingRule-yellow":"#e0ca18","formattingRule-green":"#14da37","formattingRule-cyan":"#19d0c0","formattingRule-blue":"#2c97f5","formattingRule-purple":"#a24bff","formattingRule-pink":"#ff4bce","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"dark",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}}(v,a):C(v,a)}else{p.default.warnToDevConsole("Unknown theme (using default instead)",t);var m=e.computeColor("MediumBlue",!1);n=C(m,a)}return n.headerMuiPalette=e.createHeaderMuiPalette(n),Object.assign(Object.assign({},T),n)}},{key:"createHeaderMuiPalette",value:function(e){var t=(0,s.default)(e.headerText).dark()?"light":"dark";return Object.assign(Object.assign({},e.muiPalette),{type:t})}},{key:"dynamicFormattingColors",value:function(){return E}},{key:"isDynamicFormattingColor",value:function(e){return!!k[e]}},{key:"getFormattingColorForTheme",value:function(t,a){var n=e.getThemeData(t),r=n["formattingRule-"+a];if(r)return r;var i=n[a];return i||(p.default.warnToDevConsole("Unknown color specified in getFormattingColorForTheme"),"")}},{key:"computeColor",value:function(e,t){if(e||(p.default.warnToDevConsole("Unknown color name",e,"defaulting"),e="MediumBlue"),!y.default.isHexColor(e))return t?A[e]:S[e];var a=(0,s.default)(e),n=a.rotate(120).rgb().string(),r=a.rotate(240).rgb().string(),i=a.darken(.1).rgb().string(),o=f.GOOGLE_GREY_900,l=f.GOOGLE_WHITE;return{mainColor:e,secondaryColor:n,tertiaryColor:r,highlightColor:i,mainTextColor:a.light()?o:l}}},{key:"getColorLabel",value:function(e){var t={LightGreen:"Light green",ForestGreen:"Forest green",MediumBlue:"Medium blue",NavyBlue:"Navy blue"};return e in t?t[e]:e}},{key:"getLegacyColorsForLightOrDark",value:function(e){return e?S:A}},{key:"getColorsForLightOrDark",value:function(e){return w[e?"White":"Dark"]}}]),e}();t.default=R},881219:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abortOutstandingCalls=function(){for(;a.length>0;)a.shift().abort()};var a=[];$(document).ajaxComplete((function(e,t){var n=a.indexOf(t);n>-1&&a.splice(n,1)})),$(document).ajaxSend((function(e,t){a.push(t)}))},307827:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.onAppTemplateLoadCallbacks=t.CallbackGroup=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(593186));function l(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var s=function(){function e(){(0,r.default)(this,e),this.callbacks=[]}return(0,i.default)(e,[{key:"add",value:function(e){this.callbacks.push(e)}},{key:"run",value:function(){var e,t=l(this.callbacks);try{for(t.s();!(e=t.n()).done;){var a=e.value;try{a()}catch(e){o.default.ReportError({errorMessage:"Error in CallbackGroup.run",error:e,suppressBackendPost:!1})}}}catch(e){t.e(e)}finally{t.f()}}}]),e}();t.CallbackGroup=s;var c=new s;t.onAppTemplateLoadCallbacks=c},649431:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ReduxActionEvent=void 0;var r=n(a(689728)),i=n(a(856690)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808)),s=a(377131),c=a(218546);function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var f=function(e){(0,o.default)(a,e);var t=d(a);function a(e,n){return(0,i.default)(this,a),t.call(this,c.AppEventName.ReduxAction,{action:e,payload:n})}return(0,r.default)(a)}(s.AppEvent);t.ReduxActionEvent=f},976661:(e,t)=>{"use strict";function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.valuesOnly,r=void 0===n||n;e.forEach((function(e){e.OrderDirection="Ascending"===e.Order?1:-1}));var i=function(a,n){for(var r,i=0;r=e[i];){var o=t[r.Column],l=r.Comparer(a[r.Column],n[r.Column],o);if(0!==l)return l*r.OrderDirection;i+=1}return 0};return r?i:function(e,t){return i(e.values,t.values)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.makeObjectComparer=a,t.makeSortRulesComparer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.sortBy,n=void 0===a?r:a;return e.forEach((function(e){e.OrderDirection="Ascending"===e.Order?1:-1})),function(t,a){for(var r,i=0;r=e[i];){var o=r,l=o.Comparer,u=o.OrderDirection,s=l(n(t,i,r),n(a,i,r));if(0!==s)return s*u;i+=1}return 0}};var n=a;t.default=n;var r=function(e){return e}},971145:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.FifeMapTiling=void 0;var r=n(a(364687)),i=n(a(856690)),o=n(a(689728));function l(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var s=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},c=["tile_width","tile_height","image_width","image_height","full_pyramid_depth"],d=["num_tiles_x","num_tiles_y","empty_pels_x","empty_pels_y"],f=function(){function e(t,a){(0,i.default)(this,e),this.zoom=t,this.attributes=a}return(0,o.default)(e,[{key:"attrValue",value:function(e){var t;return null===(t=this.attributes.getNamedItem(e))||void 0===t?void 0:t.value}},{key:"xTiles",get:function(){return Number(this.attrValue("num_tiles_x"))}},{key:"yTiles",get:function(){return Number(this.attrValue("num_tiles_y"))}},{key:"emptyX",get:function(){return Number(this.attrValue("empty_pels_x"))}},{key:"emptyY",get:function(){return Number(this.attrValue("empty_pels_y"))}}]),e}(),p=function(){function e(t,a){var n=this;(0,i.default)(this,e),this.url=t,this.tileUrl=function(e,t,a){return"".concat(n.url,"=").concat(["rp","pd","pc0x0","x".concat(e),"y".concat(t),"z".concat(a.zoom)].join("-"))};var r=a.children[0];this.attributes=r.attributes,this.zoomLevels=Array.from(r.children).map((function(e,t){return new f(t,e.attributes)}))}return(0,o.default)(e,[{key:"attrValue",value:function(e){var t;return null===(t=this.attributes.getNamedItem(e))||void 0===t?void 0:t.value}},{key:"zoomLevel",value:function(e){return this.zoomLevels[e]}},{key:"maxZoom",get:function(){return Number(this.attrValue("full_pyramid_depth"))-1}},{key:"tileWidth",get:function(){return Number(this.attrValue("tile_width"))}},{key:"tileHeight",get:function(){return Number(this.attrValue("tile_height"))}},{key:"widthScaling",get:function(){return 1-this.zoomLevels[0].emptyX/this.tileWidth}},{key:"heightScaling",get:function(){return 1-this.zoomLevels[0].emptyY/this.tileHeight}}],[{key:"tryGetFor",value:function(t){return s(this,void 0,void 0,r.default.mark((function a(){var n,i;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(n=new URL(t)).searchParams.append("fifeParameters","g"),a.next=4,fetch(n.href);case 4:return i=a.sent,a.abrupt("return",e.fromFetchResponse(i));case 6:case"end":return a.stop()}}),a)})))}},{key:"fromFetchResponse",value:function(t){var a;return s(this,void 0,void 0,r.default.mark((function n(){var i,o,u,s,f,p,h,v,m,g;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=function(e){if(!e)throw new Error("FifeMapTiling xml did not match expected format")},n.next=3,t.text();case 3:if(!(o=n.sent).startsWith("Error")){n.next=6;break}throw new Error(o);case 6:self.trustedTypes&&self.trustedTypes.createPolicy?(s=self.trustedTypes.createPolicy("fifemaptiling",{createHTML:function(e){return e}}),u=s.createHTML(o)):u=o,f=(new window.DOMParser).parseFromString(u,"text/xml"),p=f.children[0],h=l(c);try{for(h.s();!(v=h.n()).done;)m=v.value,i("string"==typeof(null===(a=p.attributes.getNamedItem(m))||void 0===a?void 0:a.value))}catch(e){h.e(e)}finally{h.f()}return i(p.children.length>0),Array.from(p.children).forEach((function(e){var t,a,n=l(d);try{for(n.s();!(a=n.n()).done;){var r=a.value;i("string"==typeof(null===(t=e.attributes.getNamedItem(r))||void 0===t?void 0:t.value))}}catch(e){n.e(e)}finally{n.f()}})),g=t.url.replace(/(=[\w-]+)?$/,""),n.abrupt("return",new e(g,f));case 15:case"end":return n.stop()}}),n)})))}}]),e}();t.FifeMapTiling=p},46239:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageMapType=void 0;var r=n(a(364687)),i=n(a(627424)),o=n(a(856690)),l=n(a(689728)),u=n(a(593186)),s=a(515128),c=a(714067),d=a(44617),f=a(971145),p=a(186473),h=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},v={},m=function(e){return Math.round(1e8*e)/1e6},g=function(){function e(t){var a=this;(0,o.default)(this,e),this.url=t,this.callbacks=[],this.getTileUrl=function(e,t){var n,r=e.x,i=e.y,o=null===(n=a.tiling)||void 0===n?void 0:n.zoomLevel(t);if(null==o||null==a.tiling)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";var l=a.getNormalizedCoord(r,i,o);return l?(r=l.x,i=l.y,a.tiling.tileUrl(r,i,o)):null},this.getTiling(t)}return(0,l.default)(e,[{key:"getTiling",value:function(e){return h(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!d.dynamicRollouts.includeByOwnerId("ClientFifeMapTiling")||!c.GETIMAGEURL_PATTERN.test(e)&&!c.GETREMOTEIMAGEURL_PATTERN.test(e)){t.next=10;break}return t.prev=1,t.next=4,f.FifeMapTiling.tryGetFor(e);case 4:this.tiling=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),u.default.ReportErrorOnce({errorMessage:"Failed to get FifeMapTiling",error:(0,s.asError)(t.t0)});case 10:if(null!=this.tiling){t.next=21;break}return t.prev=11,t.next=14,p.ImgixMapTiling.tryGetFor(e);case 14:this.tiling=t.sent,t.next=21;break;case 17:t.prev=17,t.t1=t.catch(11),u.default.ReportErrorOnce({errorMessage:"Failed to get ImgixMapTiling",error:(0,s.asError)(t.t1)}),this.error=(0,s.asError)(t.t1);case 21:for(;this.callbacks.length;)this.callbacks.shift()(this.error);case 22:case"end":return t.stop()}}),t,this,[[1,7],[11,17]])})))}},{key:"tileWidth",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.tileWidth)&&void 0!==t?t:1280}},{key:"tileHeight",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.tileHeight)&&void 0!==t?t:1280}},{key:"widthScaling",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.widthScaling)&&void 0!==t?t:1}},{key:"heightScaling",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.heightScaling)&&void 0!==t?t:1}},{key:"id",value:function(){return"image"}},{key:"isReady",value:function(){return null!=this.tiling}},{key:"whenReady",value:function(e){var t=this;this.isReady()?setTimeout(e,1):this.error?setTimeout((function(){e(t.error)}),1):this.callbacks.indexOf(e)<0&&this.callbacks.push(e)}},{key:"getAllTileUrls",value:function(e){var t,a=[],n=null===(t=this.tiling)||void 0===t?void 0:t.zoomLevel(e);if(n)for(var r=0;r<n.xTiles;r++)for(var i=0;i<n.yTiles;i++){var o=this.getTileUrl({x:r,y:i},e);null!=o&&a.push(o)}return a}},{key:"definition",value:function(t){var a,n,r=this,i=new t.maps.ImageMapType({getTileUrl:this.getTileUrl,tileSize:new t.maps.Size(this.tileWidth,this.tileHeight),maxZoom:null!==(n=null===(a=this.tiling)||void 0===a?void 0:a.maxZoom)&&void 0!==n?n:10,minZoom:1,name:"Image"});return i.projection={fromLatLngToPoint:function(a){var n=a.lat(),i=a.lng(),o=e.fromLatLngToPoint(n,i),l=o.x,u=o.y;return new t.maps.Point(l*r.tileWidth*r.widthScaling,u*r.tileHeight*r.heightScaling)},fromPointToLatLng:function(a,n){var i=a.x/r.tileWidth/r.widthScaling,o=a.y/r.tileHeight/r.heightScaling,l=e.fromPointToLatLng(i,o),u=l.lat,s=l.lng;return new t.maps.LatLng(u,s,n)}},i}},{key:"mapOptions",value:function(){return{mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1}}},{key:"wrapX",value:function(){return!1}},{key:"wrapY",value:function(){return!1}},{key:"defaultZoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.focused,a=void 0!==t&&t;return a?3:1}},{key:"getNormalizedCoord",value:function(e,t,a){var n=a.xTiles,r=a.yTiles;if(t<0||t>=r){if(!this.wrapY())return null;t=(t%r+r)%r}if(e<0||e>=n){if(!this.wrapX())return null;e=(e%n+n)%n}return{x:e,y:t}}}],[{key:"MIN_ZOOM",get:function(){return 1}},{key:"MAX_ZOOM",get:function(){return 10}},{key:"CACHE_MAX_ZOOM",get:function(){return 4}},{key:"DEFAULT_ZOOM",get:function(){return 1}},{key:"getForUrl",value:function(t){return t in v&&!v[t].error||(v[t]=new e(t)),v[t]}},{key:"fromLatLngToPoint",value:function(e,t){return{x:.5+4*t/360,y:.5+4*e/180}}},{key:"fromPointToLatLng",value:function(e,t){return{lat:(180*t-90)/4,lng:(360*e-180)/4}}},{key:"fromLatLngToXY",value:function(t,a){var n=e.fromLatLngToPoint(t,a),r=n.x,i=n.y;return{x:m(r),y:m(i)}}},{key:"fromXYToLatLng",value:function(t,a){return e.fromPointToLatLng(t/100,a/100)}},{key:"fromLatLngToXYString",value:function(t,a){var n=e.fromLatLngToPoint(t,a),r=n.x,i=n.y;return"".concat(m(r),", ").concat(m(i))}},{key:"fromXYStringToLatLng",value:function(t){var a=(t=t||"").split(","),n=(0,i.default)(a,2),r=n[0],o=n[1];return e.fromPointToLatLng(Number(r)/100,Number(o)/100)}}]),e}();t.ImageMapType=g},186473:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ImgixMapTiling=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(402568)),l=a(504674),u=256,s=function(e,t){null==t&&(t={});var a=function(e,t){var a=l.IMGIX+e+t,n=(0,o.default)(a);return t.length>0?t+"&s="+n:"?s="+n}(e="/".concat(function(e){return e=e.replace(/^\//,""),/^https?:\/\//.test(e)?encodeURIComponent(e):encodeURI(e)}(e)),function(e){var t,a,n,r,i=[];for(t in e)a=e[t],n=encodeURIComponent(t),r=encodeURIComponent(a),i.push(n+"="+r);return i[0]&&(i[0]="?"+i[0]),i.join("&")}(t));return"https://appsheet.imgix.net"+e+a},c=function(){function e(t,a,n){(0,r.default)(this,e),this.url=t,this.tileWidth=a,this.tileHeight=n,this.widthScaling=1,this.heightScaling=1}return(0,i.default)(e,[{key:"zoomLevel",value:function(e){var t=Math.pow(2,e);return{zoom:e,xTiles:t,yTiles:t}}},{key:"tileUrl",value:function(e,t,a){var n={fit:"crop",crop:"focalpoint",w:this.tileWidth,h:this.tileHeight,"fp-x":(e+.5)/a.xTiles,"fp-y":(t+.5)/a.yTiles,"fp-z":a.xTiles};return s(this.url,n)}}],[{key:"tryGetFor",value:function(t){return new Promise((function(a,n){var r=new Image;r.onload=function(){var n=r.width/r.height,i=n<=1?u:Math.floor(n*u),o=n>=1?u:Math.floor(u/n);a(new e(t,i,o))},r.onerror=function(){n(new Error("XY BaseImage failed to load url "+t))},r.src=s(t,{w:128,h:128,fit:"fill"})}))}}]),e}();t.ImgixMapTiling=c},454852:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=a(606610),u=n(a(888861)),s=n(a(385857)),c=n(a(962553)),d=a(166089),f="Display_Prominently",p="Display_Inline",h=function(){function e(t){(0,r.default)(this,e),this.action=t,this._evalTreeLookup={}}return(0,i.default)(e,[{key:"getFA5CompatibleIcon",value:function(){var e=this.action.Icon;return e.startsWith("fa ")||e.startsWith("fal ")||e.startsWith("far ")||e.startsWith("fas ")?e:"fa "+e}},{key:"getFA5LightIconToReplaceDefault",value:function(){return this.getFA5CompatibleIcon().replace("fa ","fal ")}},{key:"name",value:function(){return this.action.Name}},{key:"createdBy",value:function(){return this.action.CreatedBy||"Unknown"}},{key:"isAutoCreated",value:function(){return o.default.includes(["Auto (column)","Auto (row)","Auto (table)"],this.createdBy())}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.action.ExprLookup||{};try{t[e]&&(this._evalTreeLookup[e]=u.default.create(t[e]))}catch(e){}}return this._evalTreeLookup[e]}},{key:"displayName",value:function(e,t,a,n){if("Delete"===this.action.Name)return e.MapActionName(this.action.Name);var r=this.evalTreeLookup("DisplayName");if(r){var i=r.run(new s.default(e,t,a,void 0,void 0,void 0,n));return i?String(i):this.name()}return this.name()}},{key:"type",value:function(){return"NAVIGATE_DIFFERENT_APP"===this.action.ActionType?"NAVIGATE_APP":this.action.ActionType}},{key:"table",value:function(){return this.action.Table}},{key:"icon",value:function(){return this.action.Icon}},{key:"dynamicTableScope",value:function(){var e=this,t=l.actionTypes[this.type()];return t&&!!t.tableScopeWhenStatic&&0===this.valueFormulaColumnsReferenced().length&&0===this.conditionFormulaColumnsReferenced().length&&["DisplayName"].every((function(t){var a=e.evalTreeLookup(t);return!a||0===a.columnsReferenced().length}))}},{key:"tableScope",value:function(){return this.action.TableScope}},{key:"prominence",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.Prominence||f}},{key:"needsConfirmation",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.NeedsConfirmation||!1}},{key:"confirmationMessage",value:function(e,t,a){var n=this.evalTreeLookup("ConfirmationMessage");if(n){var r=n.run(new s.default(e,t,a));return r?String(r):this.name()}return e.MapActionName("Are you sure?")}},{key:"autoReferencedColumn",value:function(){return this.action.AutoReferencedColumn}},{key:"launchExternal",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.LaunchExternal||!1}},{key:"isValid",value:function(e){if(!this.action.IsValid)return!1;var t=l.actionTypes[this.type()];if(!t)return!1;if(t.requireValueEvalTree&&!this.action.ValueEvaluatable)return!1;if((this.tableScope()||this.dynamicTableScope())&&e){var a=this.conditionEvalTree();if(a&&!a.run(e))return!1}return!0}},{key:"isValidForTable",value:function(e,t,a,n){var r=this;return!(this.requiresDeletePermission(a)&&!e.allowsDelete(a))&&(!(this.requiresUpdatePermission(a)&&!e.allowsUpdate(a))&&(!(this.requiresAddPermission(a)&&!e.allowsAdd(a))&&((!t.isSlice()||!this.isAutoCreated()||null==this.columnToEdit()||0!==t.allAttributes().filter((function(e){return e.name()===r.columnToEdit()})).length)&&!(a&&(this.tableScope()||this.dynamicTableScope())&&!this.isValid(n||a.dataContext())))))}},{key:"isValidForRow",value:function(e,t){var a=this.conditionEvalTree();if(a&&(o.default.isEqual(e,t.rowData)||((t=t.copy()).rowData=e),!a.run(t)))return!1;return!0}},{key:"isBulkRunnable",value:function(){if(this.action.ActionDefinition&&null!=this.action.ActionDefinition.BulkApplicable)return this.action.ActionDefinition.BulkApplicable;var e=l.actionTypes[this.type()];return!!e&&e.bulkRunnable}},{key:"navigatesApp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.navigatesApp(e)})):t.navigatesApp)}},{key:"requiresDeletePermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresDeletePermission(e)})):t.requireDeletePermission)}},{key:"requiresUpdatePermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresUpdatePermission(e)})):t.requireUpdatePermission)}},{key:"requiresAddPermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresAddPermission(e)})):t.requireAddPermission)}},{key:"nestedActions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel;if("COMPOSITE"!==this.type())return[];if(!this.action.ActionDefinition||!this.action.ActionDefinition.Actions)return[];var a=[];return this.action.ActionDefinition.Actions.forEach((function(n){var r=t.appTemplate.actions().findByName(e.table(),n.ActionName);r&&a.push(r)})),a}},{key:"columnToEdit",value:function(){return this.action.ColumnToEdit}},{key:"columnAttachment",value:function(){return this.action.ColumnAttachment}},{key:"conditionEvalTree",value:function(){return this.action.ConditionEvaluatable?(this._conditionEvalTree||(this._conditionEvalTree=u.default.create(this.action.ConditionEvaluatable)),this._conditionEvalTree):null}},{key:"conditionFormulaColumnsReferenced",value:function(){var e=this.conditionEvalTree();return e?e.columnsReferenced():[]}},{key:"valueEvalTree",value:function(){return this.action.ValueEvaluatable?(this._valueEvalTree||(this._valueEvalTree=u.default.create(this.action.ValueEvaluatable)),this._valueEvalTree):null}},{key:"valueFormulaColumnsReferenced",value:function(){var e=this.valueEvalTree();return e?e.columnsReferenced():[]}},{key:"messageBodyEvalTree",value:function(){return this.evalTreeLookup("TextMessage")}},{key:"messageSubjectEvalTree",value:function(){return this.evalTreeLookup("MessageSubject")}},{key:"referencedRowsEvalTree",value:function(){return this.evalTreeLookup("ReferencedRows")}},{key:"inputParameterValueEvalTree",value:function(e){return this.evalTreeLookup("Parameters["+e+"]")}},{key:"assignments",value:function(){var e,t,a=null===(t=null===(e=null==this?void 0:this.action)||void 0===e?void 0:e.ActionDefinition)||void 0===t?void 0:t.Assignments;if(a){for(var n=0;n<a.length;n++)a[n].NewColumnValue&&(a[n].valueEvalTree=this.evalTreeLookup("Assignments["+n+"]"));return a.filter((function(e){var t=e.ColumnToEdit;return null!=t&&""!==t}))}return this.valueEvalTree()?[{ColumnToEdit:this.columnToEdit(),valueEvalTree:this.valueEvalTree()}]:[]}},{key:"csvLocale",value:function(e){var t,a;if(null===(t=this.action.ActionDefinition.CsvLocale)||void 0===t?void 0:t.startsWith("=")){var n=this.evalTreeLookup("CsvLocale");if(n){var r=n.run(new s.default(e));return String(r)}return""}return null!==(a=this.action.ActionDefinition.CsvLocale)&&void 0!==a?a:"en-US"}},{key:"referencedTable",value:function(){return this.action.ActionDefinition?this.action.ActionDefinition.ReferencedTable:null}},{key:"referencedAction",value:function(){return this.action.ActionDefinition?this.action.ActionDefinition.ReferencedAction:null}},{key:"showInlineFor",value:function(e){if(this.prominence()!==p)return!1;var t=this.columnAttachment();return t&&t===e.name()}},{key:"triggerEventId",value:function(){var e,t;return null===(t=null===(e=this.action)||void 0===e?void 0:e.ActionDefinition)||void 0===t?void 0:t.triggerEventId}}],[{key:"DISPLAY_PROMINENTLY",get:function(){return f}},{key:"DO_NOT_DISPLAY",get:function(){return"Do_Not_Display"}},{key:"DISPLAY_INLINE",get:function(){return p}},{key:"DISPLAY_OVERLAY",get:function(){return"Display_Overlay"}},{key:"createFromAttribute",value:function(t,a,n,r){var i=[],l="Ref"===r.type()?r:r.basestAttribute(),s=u.default.createNot(u.default.createIsBlank(u.default.createColumnLookup(a,l))).model;if("Email"===l.type())i.push({ActionType:"EMAIL",ActionDefinition:{Prominence:p},Icon:"fa-envelope",Name:"Compose Email ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(a,l).model});else if("Address"===l.type()||"LatLong"===l.type()||"ChangeLocation"===l.type())i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-map-marker",Name:"View Map ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createConstantValue(t.AppTemplate.Name+"#page=map&table="+n+"&mapcolumn="+l.name()+"&row=","Text"),u.default.createColumnLookup(a,a.keyAttribute())).model});else if("App"===l.type())i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-tasks",Name:"Open App ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(a,l).model});else if("Ref"===l.type()){var d=l.referencedTableName();c.default.findByName(d,t).tableSchema&&i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-chevron-circle-right",Name:"View Ref ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createConstantValue("#page=detail&table="+d+"&row=","Text"),u.default.createColumnLookup(a,l)).model})}else if("Phone"===l.type()){var f=l.evalTreeLookup("TextMessage"),h=f?f.model:null,v=!1!==l.auxData().Callable,m=!1!==l.auxData().Textable;v&&i.push({ActionType:"CALL",ActionDefinition:{Prominence:p},Icon:"fa-phone",Name:"Call Phone ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(a,l).model}),m&&i.push({ActionType:"SMS",ActionDefinition:{Prominence:p},Icon:"fa-comment",Name:"Send SMS ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(a,l).model,ExprLookup:{TextMessage:h}})}else"Url"===l.type()?i.push({ActionType:"NAVIGATE_URL",ActionDefinition:{Prominence:p,LaunchExternal:l.auxData().LaunchExternal},Icon:"fa-external-link",Name:"Open URL ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createColumnLookup(a,l)).model}):"File"===l.type()&&i.push({ActionType:"OPEN_FILE",ActionDefinition:{Prominence:p},Icon:"fa-file-text",Name:"Open File ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(a,l).model});return i.map((function(t){return new e(o.default.extend(t,{ConditionEvaluatable:s,CreatedBy:"Auto (column)",Table:n,IsValid:!0,ColumnToEdit:l.name(),ColumnAttachment:l.name(),AutoReferencedColumn:l.name()}))}))}}]),e}();t.default=h},181405:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(454852)),u=n(a(962553)),s=n(a(385857)),c=n(a(593186)),d=function(){function e(t){(0,r.default)(this,e),this.actions=t.map((function(e){return new l.default(e)})).filter((function(e){return e.isValid()})),this.actionsByTable=o.default.groupBy(this.actions,(function(e){return e.table()}))}return(0,i.default)(e,[{key:"findByName",value:function(e,t){return o.default.find(this.actionsByTable[e],(function(e){return e.name()===t}))}},{key:"hasSystemAddActions",value:function(){return this.actions.filter((function(e){return"ADD_RECORD"===e.type()&&e.isAutoCreated()})).length>0}},{key:"actionsForTable",value:function(e,t,a,n){var r=u.default.findByName(e,t),i=r.table,o=r.tableSchema;if(!i||!o)return[];var l=o.isSlice()?o.sourceTableName():e,s=this.actions.filter((function(e){return e.table()===l}));if(o.isSlice()){var c=o.sliceDefinition.Actions;c&&c.indexOf("**auto**")<0&&(s=c.map((function(e){return s.find((function(t){return t.name()===e}))})))}var d=s.filter((function(e){return e.isValidForTable(i,o,t,n)}));return a?d.filter((function(e){return e.isBulkRunnable()})):d}},{key:"actionsForRows",value:function(e,t,a,n,r){var i=u.default.findByName(t,a).tableSchema;if(!i)return c.default.warnToDevConsole("Error running actionsForRow, unknown table:",t),[];var l=this.actionsForTable(t,a).filter((function(t){if(t.tableScope())return!1;var n=r||new s.default(a,i);return!o.default.some(e,(function(e){return n.replaceRowData(e),t.isValidForRow(e,n)?null:e}))}));return n?l.filter((function(e){return e.isBulkRunnable()})):l}},{key:"actionsForRow",value:function(e,t,a,n){return this.actionsForRows([e],t,a,!1,n)}},{key:"actionsAtTableScope",value:function(e,t,a){return u.default.findByName(e,t).tableSchema?this.actionsForTable(e,t,void 0,a).filter((function(e){return e.tableScope()||e.dynamicTableScope()})):(c.default.warnToDevConsole("Error running actionsAtTableScope, unknown table:",e),[])}}]),e}();t.default=d},429815:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.allExternalServicesEnabled=t.SCANNER_MIN_SUBSCRIPTION=t.SCANNER=void 0,t.getMaxImageResolution=function(){var e;return(null===(e=A.AppGlobals.AppModel)||void 0===e?void 0:e.appTemplate.imageResolution)||600};var r,i=n(a(856690)),o=n(a(689728)),l=n(a(496486)),u=n(a(192137)),s=n(a(282615)),c=n(a(181405)),d=n(a(173861)),f=n(a(593186)),p=n(a(985341)),h=n(a(973289)),v=n(a(455842)),m=n(a(738628)),g=n(a(81873)),y=n(a(454852)),b=a(161171),T=a(506871),S=a(591530),A=a(166089),w=a(714067),C=a(894002),E=S.SubscriptionType.FREE;t.SCANNER_MIN_SUBSCRIPTION=E,t.SCANNER=r,function(e){e[e.DISABLED=0]="DISABLED",e[e.MLKIT=1]="MLKIT",e[e.SCANDIT=2]="SCANDIT"}(r||(t.SCANNER=r={}));var k={EnableMapsAndGeocoding:!0,EnableFirebase:!0,EnableBarcodeScanning:!0,ScanningServiceName:"System Default: Google MLKit"};t.allExternalServicesEnabled=k;var R={ComparisonOperatorBlankValuesMode:b.ExpressionSettingsOption.Legacy,RefRowsParentMode:b.ExpressionSettingsOption.Legacy,NumberDivisionMode:T.NumberDivisionOption.Number};var I=function(){function e(t,a){var n=this;(0,i.default)(this,e),this._cacheStore={},this._ocrExtractors={},this._predictors={},this.model=t,this.appModel=a,this._actions=null,this._viewControlsByName=l.default.keyBy(this.viewControls(),(function(e){return e.Name.toLowerCase()})),this._richViewControlsByName=l.default.mapValues(this._viewControlsByName,(function(e){return new s.default(e)})),this._flatTableSchemasByName=l.default.keyBy(this.rootTableSchemas(),(function(e){return e.Name.toLowerCase()})),this._richTableSchemasByName=l.default.mapValues(this._flatTableSchemasByName,(function(e){return new u.default(e)})),this._tableDefinitionsByName=l.default.keyBy(this.tableDefinitions(),(function(e){return e.Name.toLowerCase()})),this._sliceDefinitionsByName=l.default.keyBy(this.sliceDefinitions(),(function(e){return e.Name.toLowerCase()})),this._schemasByTableName=l.default.mapValues(this._tableDefinitionsByName,(function(e){return n.findSchema(e.SchemaName)})),this._sliceTableSchemasBySliceName=l.default.mapValues(this._sliceDefinitionsByName,(function(e){var t=n.findRootTableDefinition(e.SourceTable),a=((null==t?void 0:t.SchemaName)||"").toLowerCase(),r=n._flatTableSchemasByName[a];return new u.default(r,e)}))}return(0,o.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"id",value:function(){return this.model.Id}},{key:"name",value:function(){return this.model.Name}},{key:"shortName",value:function(){return this.model.ShortName}},{key:"respectShowIf",get:function(){return!(!this.model.Presentation||!this.model.Presentation.RespectShowIfEverywhere)}},{key:"aboutUrl",get:function(){var e,t;return null===(t=null===(e=this.model.Behavior)||void 0===e?void 0:e.Description)||void 0===t?void 0:t.AboutUrl}},{key:"ownerEmail",get:function(){return this.model.OwnerEmail}},{key:"needsUserConsent",get:function(){return this.model.Behavior.UsageScopes!==this.model.Behavior.UserConsentedScopes}},{key:"usageScopes",get:function(){return this.model.Behavior.UsageScopes}},{key:"logoUrl",get:function(){var e;return null===(e=this.model.Presentation)||void 0===e?void 0:e.LogoUrl}},{key:"imageResolution",get:function(){switch(this.model.Presentation&&this.model.Presentation.PhotoResolution){case"Low":return 200;case"Medium":return 800;case"High":return 1600;case"Full":return w.NO_RESIZE_WIDTH;default:return 600}}},{key:"barcodeScanner",get:function(){if(this.model.OwnerId,this.model.OwnerSubscription<E)return{enabled:!1,type:r.DISABLED};var e=this.externalServiceSettings,t=e.EnableBarcodeScanning,a=e.ScanningServiceName,n=this.externalAccounts[a];return t?a&&n?{enabled:!0,type:r.SCANDIT,key:n}:this.appModel.inRollout("mlkitScanner")?{enabled:!0,type:r.MLKIT}:{enabled:!0,type:r.SCANDIT}:{enabled:!1,type:r.DISABLED}}},{key:"scanningDisabled",get:function(){return!this.barcodeScanner.enabled}},{key:"ownedByCurrentUser",get:function(){return A.AppGlobals.AppState.UserInformation.Id===this.model.OwnerId}},{key:"automaticUpdates",get:function(){return!(!this.model.Behavior.AutoBackgroundUpdate||(this.model.IsPublic||this.model.IsTeamPublic)&&!this.ownedByCurrentUser)}},{key:"syncOnStart",get:function(){return this.model.Behavior.SyncOnStart}},{key:"externalServiceSettings",get:function(){return e.getExternalServiceSettings(this.model)}},{key:"externalAccounts",get:function(){var e;return null!==(e=this.model.ExternalAccounts)&&void 0!==e?e:{}}},{key:"isGoogleMapsDisabled",get:function(){return!1===this.externalServiceSettings.EnableMapsAndGeocoding}},{key:"isFirebaseDisabled",get:function(){return!1===this.externalServiceSettings.EnableFirebase}},{key:"isBarcodeScanningDisabled",get:function(){return!1===this.externalServiceSettings.EnableBarcodeScanning}},{key:"lastModified",value:function(){var e=null;if(this.model.LastModified){var t=this.model.LastModified.match(/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d(?::[0-5]\d(?:\.\d+)?)?([+-][0-2]\d:[0-5]\d|[Zz])?$/);t&&(e=this.model.LastModified,null==t[1]&&(e+="Z"))}return e}},{key:"normalizedFontSize",value:function(){var e,t=null===(e=this.model.Presentation)||void 0===e?void 0:e.FontSize;return 16===t?18:t}},{key:"tableDefinitions",value:function(){return(this.model.AppData.DataSets||[]).filter((function(e){return e.IsValid}))}},{key:"actions",value:function(){var e=this;return this._cache("actions",(function(){var t=(e.model.AppData.DataActions||[]).filter((function(e){return e.IsValid&&!(0,C.isEntityEmbedded)(e.Scope)})),a=l.default.sortBy(t,(function(e){return e.ActionOrder}));return new c.default(a)}))}},{key:"getProminentActionsForTable",value:function(e){return this.actions().actionsForTable(e,this.appModel,!1).filter((function(e){return e.prominence()===y.default.DISPLAY_PROMINENTLY})).map((function(e){return e.action}))}},{key:"sliceDefinitions",value:function(){return(this.model.AppData.TableSlices||[]).filter((function(e){return e.IsValid}))}},{key:"rootTableSchemas",value:function(){var e=this.model.AppData.DataSchemas||[];return e.filter((function(e){return e.IsValid}))}},{key:"expressionSettings",value:function(){return this.model.AppData.ExpressionSettings||R}},{key:"viewControls",value:function(){return(this.model.Presentation.Controls||[]).filter((function(e){return e.IsValid}))}},{key:"formattingRules",value:function(){var e=this;return this._cache("formattingRules",(function(){var t=e.model.Presentation.FormatRules||[];return new d.default(l.default.sortBy(t.filter((function(e){return e.IsValid})),(function(e){return e.RuleOrder})),e.appModel)}))}},{key:"predictiveModels",value:function(){var e=this;return this._cache("predictiveModels",(function(){var t;return((null===(t=e.model.Behavior)||void 0===t?void 0:t.AppPredictiveModels)||[]).filter((function(e){return e.IsValid})).map((function(e){return new h.default(e)}))}))}},{key:"ocrModels",value:function(){var e=this;return this._cache("ocrModels",(function(){var t;return((null===(t=e.model.Behavior)||void 0===t?void 0:t.AppOcrModels)||[]).filter((function(e){return e.IsValid})).map((function(e){return new v.default(e)}))}))}},{key:"ocrTextExtractor",value:function(){var e=this;return this._cache("ocrTextExtractor",(function(){var t=e.id();return new g.default({appId:t})}))}},{key:"loadOcrExtractors",value:function(){var e=this;this._cache("loadOcrExtractors",(function(){var t=e.ocrModels(),a=e.id();t.forEach((function(t){var n=new m.default({appId:a,ocrModel:t});e._ocrExtractors[t.name()]=n}))}))}},{key:"loadPredictors",value:function(){var e=this;this._cache("loadPredictors",(function(){e._predictors={};var t=e.predictiveModels().filter((function(e){return e.predictorReady()}));Promise.all(t.map((function(t){return p.default.fromDefinition(e.model,t).then((function(a){e._predictors[t.name()]=a}))}))).catch((function(e){if(!(String(e).indexOf("Unexpected token < in JSON")>=0))throw e})).catch((function(e){return f.default.ReportError({errorMessage:"Error loading predictive models",error:e})}))}))}},{key:"findOcrModel",value:function(e){return this.ocrModels().find((function(t){return t.name()===e}))}},{key:"findOcrExtractor",value:function(e){return this._ocrExtractors?this._ocrExtractors[e]:null}},{key:"findPredictor",value:function(e){return this._predictors?this._predictors[e]:null}},{key:"findSchema",value:function(e){var t=(e=e||"").toLowerCase();return this._richTableSchemasByName[t]}},{key:"findSchemaForTable",value:function(e){var t=(e=e||"").toLowerCase();return this._sliceTableSchemasBySliceName[t]||this._schemasByTableName[t]}},{key:"findRootSchemaForTable",value:function(e){var t;e=e||"";var a=this._sliceTableSchemasBySliceName[e.toLowerCase()];return t=a?(a.sourceTableName()||"").toLowerCase():e.toLowerCase(),this.findSchemaForTable(t)}},{key:"findRootTableDefinition",value:function(e){var t=(e=e||"").toLowerCase(),a=this._tableDefinitionsByName[t];if(!a){var n=this._sliceDefinitionsByName[t];n&&(t=n.SourceTable.toLowerCase(),a=this._tableDefinitionsByName[t])}return a}},{key:"findSliceDefinition",value:function(e){return e=e||"",this._sliceDefinitionsByName[e.toLowerCase()]}},{key:"findControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e||"";var a=this._viewControlsByName[e.toLowerCase()];return a&&t&&t!==a.Action?null:a}},{key:"findControlsForTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=e||"","string"==typeof t&&(t=[t]);var n=l.default.includes(t,"form"),r=this.viewControls().filter((function(r){var i="table"===r.Action?"fastTable":r.Action,o=r.TableOrFolderName&&r.TableOrFolderName.toLowerCase()===e.toLowerCase(),u=l.default.includes(t,i),s="ref"===r.Position;return a?!(!n&&"form"===r.Action)&&(o&&(u||s)):o&&u}));return l.default.sortBy(r,(function(e){return"ref"===e.Position?1:2}))}},{key:"getView",value:function(e){return e=e||"",this._richViewControlsByName[e.toLowerCase()]}},{key:"getViewDefinition",value:function(e){var t=this.getView(e);return t?t.definition():{}}},{key:"views",value:function(){return l.default.values(this._richViewControlsByName)}},{key:"secureImageAccess",get:function(){return(this.model.Behavior||{}).SecureImageAccess}},{key:"usesLocation",get:function(){var e;return null===(e=this.model.Behavior)||void 0===e?void 0:e.UsesGeolocation}},{key:"hasValidUsageScopesConsent",value:function(){return this.model.IsValid&&(!this.model.Behavior.RequireUserConsent||this.model.Behavior.UsageScopes===this.model.Behavior.UserConsentedScopes)}},{key:"recordUsageScopesConsent",value:function(){var e;l.default.set(this.model,"Behavior.UserConsentedScopes",null===(e=this.model.Behavior)||void 0===e?void 0:e.UsageScopes)}}],[{key:"getExternalServiceSettings",value:function(e){var t,a;return null!==(a=null===(t=e.Behavior)||void 0===t?void 0:t.ExternalServiceSettings)&&void 0!==a?a:k}}]),e}();t.default=I},150198:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.typeComparers=t.textTypes=t.temporalTypes=t.presentableImageTypes=t.numberTypes=t.mostlyNumberTypes=t.listTypes=t.imageTypes=t.externalFileTypes=t.enumeratedTypes=t.default=t.decimalTypes=t.colorMap=t.changeTriggeredTypes=t.booleanTypes=t.basicTypes=t.actionTypes=t.ValueFormat=t.LongTextFormatting=t.Attribute=void 0;var i,o,l=n(a(918698)),u=n(a(627424)),s=n(a(856690)),c=n(a(689728)),d=n(a(496486)),f=n(a(593302)),p=n(a(498967)),h=n(a(249e3)),v=n(a(190644)),m=n(a(593186)),g=k(a(365914)),y=n(a(730381)),b=n(a(440587)),T=n(a(302443)),S=n(a(304878)),A=k(a(888861)),w=a(166089),C=n(a(112368));function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(E=function(e){return e?a:t})(e)}function k(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=E(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}t.ValueFormat=i,function(e){e.Native="Native",e.Wire="Wire"}(i||(t.ValueFormat=i={})),t.LongTextFormatting=o,function(e){e.HTML="HTML",e.Markdown="Markdown",e.PlainText="Plain Text"}(o||(t.LongTextFormatting=o={}));var R={green:"green",yellow:"yellow",orange:"orange",red:"red",purple:"purple",blue:"blue",white:"white",black:"black"};t.colorMap=R;var I=d.default.keyBy(["Text","Enum","EnumList","LongText","Name","Number","PostalCode","DateTime","Percent","Decimal","Price","Date","Time","Duration"]);t.basicTypes=I;var O=d.default.keyBy(["Email","Phone","LatLong","XY","Address","File","Url","ChangeLocation"]);t.actionTypes=O;var M=d.default.keyBy(["Image","Drawing","Signature","Thumbnail"]);t.imageTypes=M;var N=d.default.keyBy(["Image","Thumbnail"]);t.presentableImageTypes=N;var _=d.default.keyBy(["Yes/No"]);t.booleanTypes=_;var D=d.default.keyBy(["ChangeCounter","Number","Percent","Decimal","Price","Duration"]);t.numberTypes=D;var L=d.default.keyBy(["Address","Text","LongText","Url","Name","LatLong","XY","ChangeLocation","Phone"]);t.textTypes=L;var P=d.default.keyBy(["Date","Time","DateTime"]);t.temporalTypes=P;var x=d.default.keyBy(["ChangeCounter","ChangeLocation","ChangeTimestamp"]);t.changeTriggeredTypes=x;var F=d.default.keyBy(["Percent","Decimal","Price"]);t.decimalTypes=F;var G=d.default.keyBy(["ChangeCounter","Number","PostalCode","DateTime","ChangeTimestamp","Percent","Decimal","Price","Date","Time","Duration","Phone"]);t.mostlyNumberTypes=G;var V=d.default.keyBy(["Ref","Enum","EnumList","Color","Progress","Yes/No"]);t.enumeratedTypes=V;var B=d.default.keyBy(["List","EnumList"]);t.listTypes=B;var U=d.default.keyBy(["Image","Drawing","Signature","Thumbnail","File"]);t.externalFileTypes=U;var H={Text:p.default.textComparer,LongText:p.default.textComparer,Name:p.default.textComparer,Address:p.default.textComparer,LatLong:p.default.textComparer,XY:p.default.textComparer,ChangeLocation:p.default.textComparer,Number:p.default.numericComparer,ChangeCounter:p.default.numericComparer,Decimal:p.default.numericComparer,Percent:p.default.numericComparer,Price:p.default.numericComparer,Date:p.default.dateComparer,DateTime:p.default.dateComparer,ChangeTimestamp:p.default.dateComparer,Time:p.default.timeComparer,Duration:p.default.durationComparer,Ref:p.default.labelComparer,Enum:"special-enum",Color:"special-enum",Progress:"special-enum"};t.typeComparers=H;var W={Date:p.default.nativeDateComparer,DateTime:p.default.nativeDateComparer,ChangeTimestamp:p.default.nativeDateComparer,Time:p.default.nativeDateComparer},j=function(){function e(t){var a=this;(0,s.default)(this,e),this.model=t,this._evalTreeLookup={},this.getImageLabel=function(e,t){var n;if(a.isImageType())return e;var r=w.AppGlobals.AppModel.findTableCollection(a.auxData().ReferencedTableName),i=r.rootTable,o=r.rootTableSchema,l=null==o?void 0:o.labelImageAttribute();return l&&(null===(n=null==i?void 0:i.lookupTableRow(e,t))||void 0===n?void 0:n.get(l.name()))||""},this.localizeWireValue=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r>50)return t;switch(a.type().toLowerCase()){case"list":case"enumlist":if(!t)return"";if("function"==typeof t.split){var i=a.itemSeparator()||e.inferEnumListDelimiter(t);t=a.splitEnumListValue(t);var o=a.nestedAttribute();return t.map((function(e){return o.localizeWireValue(e,n,r+1)})).join(i)}return t;case"enum":var l=a.nestedAttribute();return l?l.localizeWireValue(t,n,r+1):t;case"ref":if(!n.noRefLabel){var u=1,s=a.referencedLabelCollection(u),c=s.table,d=s.labelBasicAttribute;if(c&&d&&d!==a)return d.localizeWireValue(c.labelTextForId(t,n.transaction),n,r+1)}if(n.noRefKeyFallback)return"";var f=a.nestedAttribute();return f?f.localizeWireValue(t,n,r+1):t;case"time":return t?g.default.toLocaleTimeString(t,a.ignoreSeconds()):"";case"date":return t?g.default.toLocaleDateString(t,a.useLongDateFormat()):"";case"datetime":case"changetimestamp":return t?g.default.localizeDateTime(t,a.ignoreSeconds(),a.useLongDateFormat()):"";case"percent":return a.normalizePercentValueToString(t);case"number":case"decimal":case"price":return e.formatLocalizedNumber(t,{precision:a.decimalDigits(),numericDigits:a.numericDigits(),useGrouping:!n.suppressGrouping&&a.showThousandsSeparator(),currencySymbol:a.currencySymbol()});case"yes/no":var p=a.booleanTypeLabels(n.dataContext),h=p.yesLabel,v=p.noLabel,m=e.booleanValueFromWireFormat(t);return m?h:v;default:return t}},this.getNormalizedLookupValue=function(e){d.default.isNil(e)&&(e="");var t,n=a.type(),r=a.nestedAttribute();switch(n){case"Enum":case"Ref":return d.default.isNil(r)?e:r.getNormalizedLookupValue(e);case"Date":case"DateTime":case"ChangeTimestamp":return new Date(e||0).getTime();case"Time":return e?g.default.timeToDate(e).getTime():"";case"Duration":return g.default.getDurationSecs(g.default.parseDuration(e));case"Yes/No":switch(t=(0,g.toNormalizedString)(e)){case"y":case"yes":case"t":case"true":return!0;case"n":case"no":case"f":case"false":return!1}return t;case"Progress":switch(t=(0,g.toNormalizedString)(e)){case"empty":return"empty";case"quarter":case"one quarter":return"quarter";case"half":return"half";case"three quarter":case"three quarters":return"three quarter";case"full":return"full"}return t;case"Number":case"Decimal":case"Price":case"Percent":case"ChangeCounter":return Number(e);case"File":case"Image":case"Signature":case"Thumbnail":case"Drawing":return g.default.stripRefImageValue(e,n);case"Url":if(e&&"function"==typeof e.indexOf&&0!==e.indexOf("{"))return JSON.stringify(a.valueFromWireFormat(e)).toLowerCase()}return(0,g.toNormalizedString)(e)}}return(0,c.default)(e,[{key:"auxData",value:function(){if(this._auxDataCache)return this._auxDataCache;var t=this.model.TypeAuxData||{};return"string"==typeof t&&(t=e.parseAuxData(t,this)),this._auxDataCache=t,t}},{key:"auxDataString",value:function(){return null==this.model.TypeAuxData?"":"string"==typeof this.model.TypeAuxData?this.model.TypeAuxData:(this._auxDataString||(this._auxDataString=JSON.stringify(this.model.TypeAuxData)),this._auxDataString)}},{key:"setInternalQualifier",value:function(e){this.model.InternalQualifier=e}},{key:"internalQualifier",value:function(){return this.model.InternalQualifier||{}}},{key:"isValid",value:function(){return this.model.IsValid}},{key:"isLabel",value:function(){return!!this.model.IsLabel}},{key:"isHidden",value:function(){return this.model.IsHidden}},{key:"isReadOnly",value:function(){return this.model.IsReadOnly}},{key:"isRequired",value:function(){return this.model.IsRequired}},{key:"isSys",value:function(){return this.model.IsSys}},{key:"isKey",value:function(){return!!this.model.IsKey}},{key:"isScannable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>20)return!1;if(this.model.IsScannable)return!0;if("Ref"===this.type()){var t=this.nestedAttribute();if(t&&t.isScannable(e+1))return!0}return!1}},{key:"isNfcScannable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>20)return!1;if(this.model.IsNfcScannable)return!0;if("Ref"===this.type()){var t=this.nestedAttribute();if(t&&t.isNfcScannable(e+1))return!0}return!1}},{key:"isSearchable",value:function(){return this.model.IsValid&&this.model.Searchable}},{key:"supportsEditsInTableView",value:function(){switch(this.type()){case"LongText":case"Yes/No":case"Text":case"Number":case"Decimal":case"Percent":case"Price":case"Url":case"Date":case"DateTime":case"Time":case"Duration":case"Name":case"Email":case"Address":case"Phone":case"Enum":case"EnumList":case"Ref":return!0}return!1}},{key:"shouldShowScannerButtons",value:function(){if(!this.isScannable()&&!this.isNfcScannable())return!1;if(!C.default.SupportsBarcodeScan())return!1;switch(this.type()){case"Text":case"Ref":case"Enum":case"EnumList":case"Number":case"Decimal":case"Price":case"Percent":return!0}return!1}},{key:"isListOfRefs",value:function(){var e=this.nestedAttribute();return!!e&&("List"===this.type()&&"Ref"===e.type())}},{key:"isReverseRef",value:function(){return this.isListOfRefs()&&this.isSys()}},{key:"isDependentRef",value:function(){return"Ref"===this.type()&&this.auxData().IsAPartOf}},{key:"isReverseDependentRef",value:function(){var e;if(!this.isReverseRef())return!1;var t=this.internalQualifier();return null===(e=null==t?void 0:t.Properties)||void 0===e?void 0:e.IsOwnerOf}},{key:"refListFilterDefaults",value:function(e){var t=(0,A.getFilterDefaultsAndFullyMapped)(this.refListFilter(e)),a=(0,u.default)(t,2),n=a[0];if(a[1])return n}},{key:"refListFilter",value:function(e){var t=this;if(this.isListOfRefs()){var a=this.appFormulaEvalTree();if(a){var n=function(a){return(0,A.createKeyInListFilter)(t.listElementType(),t.listElementTypeQualifier(),a.curry(e))};if("SELECT"===a.FunctionName){var r=a.children[0],i=e.appModel;if(!(null==i?void 0:i.inRollout("currySelect"))){var o=a.currySelectFilterOnly(e);return r.isRowList()?(0,A.createAnd)(n(r),o):o}var l=[this.listElementAttribute().referencedTableName(),r.TableName].map((function(e){return null==i?void 0:i.findTableCollection(e).rootTable})),s=(0,u.default)(l,2);if(s[0]===s[1]){var c=a.currySelectFilterOnly(e);return r.isRowList()?(0,A.createAnd)(n(r),c):c}}return n(a)}}}},{key:"type",value:function(){return this.model.Type}},{key:"nestedAttribute",value:function(){if(!this._nestedAttribute){var t,a=null;if("Enum"===this.type()||"EnumList"===this.type()){if(!(t=this.auxData().BaseType))return null;a=this.auxData().BaseTypeQualifier}else if("Ref"===this.type()){if(!(t=this.auxData().ReferencedType))return null;a=this.auxData().ReferencedTypeQualifier}else{if("List"!==this.type())return null;if(!(t=this.auxData().ElementType))return null;a=this.auxData().ElementTypeQualifier}var n=null;"EnumList"!==this.type()&&"List"!==this.type()&&(n=this.model.InternalQualifier&&this.model.InternalQualifier.ColumnStats),this._nestedAttribute=new e({Name:this.name(),Type:t,TypeAuxData:a,autoFrom:this,InternalQualifier:{ColumnStats:n}})}return this._nestedAttribute}},{key:"basestAttribute",value:function(){var e=this.nestedAttribute();return e=e?e.basestAttribute():this}},{key:"yields",value:function(e){var t;return"Ref"===this.type()||"Enum"===this.type()?!!(null===(t=this.nestedAttribute())||void 0===t?void 0:t.yields(e)):this.type()===e}},{key:"yieldsOneOf",value:function(e){var t;return!!Array.isArray(e)&&("Ref"===this.type()||"Enum"===this.type()?!!(null===(t=this.nestedAttribute())||void 0===t?void 0:t.yieldsOneOf(e)):d.default.includes(e,this.type()))}},{key:"firstNestedRef",value:function(){return this.firstNestedOfType("Ref",!1)}},{key:"firstNestedOfType",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.type()===e)return this;if(this.isListType()&&!t)return null;var a=this.nestedAttribute();return a&&(a=a.firstNestedOfType(e,t)),a}},{key:"allNestedTypes",value:function(){for(var e,t=this.nestedAttribute();t;)(e=e||[]).push(t.type()),t=t.nestedAttribute();return e}},{key:"listElementAttribute",value:function(){return"List"===this.type()?this.nestedAttribute():null}},{key:"enumElementAttribute",value:function(){return"Enum"===this.type()||"EnumList"===this.type()?this.nestedAttribute():null}},{key:"nestedType",value:function(){var e=this.nestedAttribute();return e?e.type():null}},{key:"basestType",value:function(){return this.basestAttribute().type()}},{key:"baseTypeQualifier",value:function(){var e=this.nestedAttribute();return e?e.auxData():null}},{key:"listElementType",value:function(){return"List"===this.type()?this.nestedType():null}},{key:"listElementTypeQualifier",value:function(){if("List"===this.type()){var e=this.nestedAttribute();if(e)return e.model.TypeAuxData}return null}},{key:"referencedTableName",value:function(){var e=this.firstNestedRef();return(null==e?void 0:e.auxData().ReferencedTableName)||null}},{key:"referencedTable",value:function(){var e=this.referencedTableName();return e&&w.AppGlobals.AppModel.findTableCollection(e).table||null}},{key:"referencedLabelCollection",value:function(e){for(var t,a,n,r,i=0,o=this.firstNestedRef();null!=o&&(null==e||i<e);){if(r=r||new Set,null==(n=null===(t=(a=w.AppGlobals.AppModel.findTableCollection(o.referencedTableName())).tableSchema)||void 0===t?void 0:t.labelBasicAttribute())||r.has(n))return{};r.add(n),o=n.firstNestedRef(),i++}return n?Object.assign(Object.assign({},a),{labelBasicAttribute:n}):{}}},{key:"derefRow",value:function(e){var t,a=this.referencedTableName(),n=((null===(t=w.AppGlobals.AppModel)||void 0===t?void 0:t.findTableCollection(a))||{}).rootTable;return null==n?void 0:n.lookupTableRow(e)}},{key:"numericDigits",value:function(){return this.auxData().NumericDigits}},{key:"decimalDigits",value:function(){var e=this.auxData().DecimalDigits;return"number"!=typeof e&&this.isNumericType()?"Number"===this.type()?0:2:e}},{key:"showThousandsSeparator",value:function(){return!1!==this.auxData().ShowThousandsSeparator}},{key:"currencySymbol",value:function(){return this.auxData().CurrencySymbol}},{key:"enumValues",value:function(){var e;return null===(e=this.auxData().EnumValues)||void 0===e?void 0:e.map(g.fastTrim)}},{key:"allowOtherValues",value:function(){return!!this.auxData().AllowOtherValues}},{key:"autoCompleteOtherValues",value:function(){return!!this.allowOtherValues()&&!!this.auxData().AutoCompleteOtherValues}},{key:"ignoreSeconds",value:function(){return!!this.auxData().IgnoreSeconds}},{key:"useLongDateFormat",value:function(){return!!this.auxData().UseLongDateFormat}},{key:"itemSeparator",value:function(){return this.auxData().ItemSeparator}},{key:"launchExternal",value:function(){return this.auxData().LaunchExternal}},{key:"geocodingEnabled",value:function(){return this.auxData().GeocodingEnabled}},{key:"name",value:function(){return this.model.Name}},{key:"lowercaseName",value:function(){return this._normalizedName||(this._normalizedName=this.name().trim().toLowerCase()),this._normalizedName}},{key:"longTextFormatting",value:function(){return this.auxData().LongTextFormatting}},{key:"baseImage",value:function(e){var t=this.baseImageEvalTree();if(t){if(e){var a=t.run(e);return a?String(a):""}return""}return this.auxData().BaseImage||""}},{key:"displayName",value:function(e){var t=this.auxData();if(this.name().indexOf("_Computed")>=0&&t.ComponentFieldNames)return t.ComponentFieldNames.join(" ");var a=this.displayNameField(e);return a||this.name()}},{key:"displayNameField",value:function(e){var t,a=this.evalTreeLookup("DisplayName");if(a&&e){var n=a.run(e);n&&(t=String(n))}return t}},{key:"hasDisplayName",value:function(){return!!this.model.DisplayName}},{key:"verboseName",value:function(e){return this.description(e)||this.model.Name}},{key:"description",value:function(e){var t=this.evalTreeLookup("Description");if(t&&e){var a=t.run(e);return a?String(a):""}return this.model.Description}},{key:"showContent",value:function(e){if(this.isShowType()){var t=this.showContentEvalTree();if(t&&e){var a=t.run(e);return a=this.coerceValue(a,t.resultType(),t.resultTypeQualifier()),a=this.valueToWireFormat(a),this.localizeWireValue(a)}return this.auxData().Content}return null}},{key:"appFormula",value:function(){return this.model.AppFormula}},{key:"hasFormula",value:function(){return!!this.model.Formula}},{key:"hasAppFormula",value:function(){var e;return!!(null!==(e=this.model.AppFormula)&&void 0!==e?e:this.appFormulaEvalTree())}},{key:"hasDefaultExpression",value:function(){var e;return!!(null!==(e=this.model.DefaultExpression)&&void 0!==e?e:this.defaultExpressionEvalTree())}},{key:"hasResetExpression",value:function(){return!!this.resetIfEvalTree()}},{key:"setAppFormula",value:function(e,t){delete this._evalTreeLookup.AppFormulaExpression,delete this._auxDataCache,delete this._auxDataString,delete this._nestedAttribute,this.internalQualifier().AppFormulaExpression=e.model,this.model.Type=e.resultType(),this.model.TypeAuxData=null!=t?t:e.resultTypeQualifier()}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.internalQualifier(),a=t.ExpressionLookup||{},n=this.model.ExprLookup||{};try{n[e]?this._evalTreeLookup[e]=A.default.create(n[e]):a[e]?this._evalTreeLookup[e]=A.default.create(a[e]):t[e]?this._evalTreeLookup[e]=A.default.create(t[e]):"DefaultExpression"===e&&this.model[e]&&(this._evalTreeLookup[e]=A.default.create(this.model[e]))}catch(t){m.default.warnToDevConsole("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"appFormulaEvalTree",value:function(){return this.evalTreeLookup("AppFormulaExpression")}},{key:"defaultExpressionEvalTree",value:function(){return this.evalTreeLookup("DefaultExpression")}},{key:"validIfEvalTree",value:function(){return this.evalTreeLookup("Valid_If_AppEval")}},{key:"suggestedValuesEvalTree",value:function(){return this.evalTreeLookup("Suggested_Values")}},{key:"requiredIfEvalTree",value:function(){return this.evalTreeLookup("Required_If_AppEval")}},{key:"showIfEvalTree",value:function(){return this.evalTreeLookup("Show_If_AppEval")}},{key:"editableIfEvalTree",value:function(){return this.evalTreeLookup("Editable_If_AppEval")}},{key:"resetIfEvalTree",value:function(){return this.evalTreeLookup("Reset_If_AppEval")}},{key:"showContentEvalTree",value:function(){return this.evalTreeLookup("ShowContent")}},{key:"baseImageEvalTree",value:function(){return this.evalTreeLookup("XYBaseImage")}},{key:"displayNameEvalTree",value:function(){return this.evalTreeLookup("DisplayName")}},{key:"publishKeyEvalTree",value:function(){return this.evalTreeLookup("Publish_If_Rowkey")}},{key:"isChangeTriggered",value:function(){return!!x[this.type()]}},{key:"invalidMessageEvalTree",value:function(){return this.evalTreeLookup("Error_Message_If_Invalid")}},{key:"booleanEvalTrees",value:function(){return{yesEvalTree:this.evalTreeLookup("YesLabel"),noEvalTree:this.evalTreeLookup("NoLabel")}}},{key:"isBooleanWithCustomLabel",value:function(){var e=this.booleanEvalTrees(),t=e.yesEvalTree,a=e.noEvalTree;return null!=t||null!=a}},{key:"booleanTypeLabels",value:function(t){var a,n;if(t){var r=this.booleanEvalTrees(),i=r.yesEvalTree,o=r.noEvalTree;i&&(a=i.run(t))&&(a=e.valueToWireFormat(a,i.resultType(),i.resultTypeQualifier())),o&&(n=o.run(t))&&(n=e.valueToWireFormat(n,o.resultType(),o.resultTypeQualifier()))}return a||(a="Y"),n||(n="N"),{yesLabel:a,noLabel:n}}},{key:"isDynamic",value:function(){return this.isChangeTriggered()||this.hasAppFormula()||this.hasDefaultExpression()||this.resetsEachUpdate()||this.hasResetExpression()}},{key:"valueDependsOn",value:function(e,t){var a=this.appFormulaEvalTree(),n=this.defaultExpressionEvalTree(),r=this.resetIfEvalTree();return(null==a?void 0:a.tablesReferenced().includes(e))||(null==r?void 0:r.tablesReferenced().includes(e))||t&&(null==n?void 0:n.tablesReferenced().includes(e))}},{key:"isValidityEnum",value:function(){var e=this.validIfEvalTree();return e&&"function"==typeof e.isThisInCondition&&e.isThisInCondition()}},{key:"hasSuggestedValues",value:function(){return!!this.suggestedValuesEvalTree()}},{key:"isVirtual",value:function(){return!!this.model.IsVirtual}},{key:"isShowType",value:function(){return"Show"===this.type()}},{key:"isShowHeader",value:function(){return this.isPageHeader()||this.isSectionHeader()}},{key:"isPageHeader",value:function(){return this.isShowType()&&"Page_Header"===this.auxData().Category}},{key:"isSectionHeader",value:function(){return this.isShowType()&&"Section_Header"===this.auxData().Category}},{key:"isShowText",value:function(){return this.isShowType()&&"Text"===this.auxData().Category}},{key:"isShowUrl",value:function(){return this.isShowType()&&"Url"===this.auxData().Category}},{key:"isShowImage",value:function(){return this.isShowType()&&"Image"===this.auxData().Category}},{key:"isShowVideo",value:function(){return this.isShowType()&&"Video"===this.auxData().Category}},{key:"isBasicType",value:function(){return!!I[this.type()]}},{key:"isActionType",value:function(){return!!O[this.type()]}},{key:"isImageType",value:function(){return!!M[this.type()]}},{key:"isPresentableImageType",value:function(){return!!N[this.type()]}},{key:"isListType",value:function(){return!!B[this.type()]}},{key:"isBooleanType",value:function(){return!!_[this.type()]}},{key:"isNumericType",value:function(){var e=this.nestedAttribute();return e?!!D[e.type()]:!!D[this.type()]}},{key:"isTextualType",value:function(){var e=this.nestedAttribute();return e?!!L[e.type()]:!!L[this.type()]}},{key:"isTemporalType",value:function(){var e=this.nestedAttribute();return e?!!P[e.type()]:!!P[this.type()]}},{key:"isDecimalType",value:function(){var e=this.nestedAttribute();return e?!!F[e.type()]:!!F[this.type()]}},{key:"isEnumerated",value:function(){return!!V[this.type()]||this.isValidityEnum()||this.hasSuggestedValues()}},{key:"isMostlyNumberType",value:function(){return!!G[this.type()]}},{key:"hasInputMethod",value:function(){return"Video"!==this.type()||w.AppGlobals.AppModel.inRollout("videoUpload")}},{key:"shouldRightAlign",value:function(){var e,t,a,n=this.referencedLabelCollection().labelBasicAttribute;if(null!=n)return n.shouldRightAlign();var r=null!==(a=null===(t=null===(e=w.AppGlobals.AppModel)||void 0===e?void 0:e.AppTemplate)||void 0===t?void 0:t.Presentation)&&void 0!==a?a:{},i=r.UseAccountingFormat,o=r.RightAlignNumeric;return this.isNumericType()&&Boolean(i||o)}},{key:"shouldNotStretch",value:function(){return this.isImageType()||this.shouldRightAlign()}},{key:"valueComparer",value:function(e){var t,a=e===i.Native&&W[this.type()]||H[this.type()];if("special-enum"===a){var n=this.auxData(),r=n.EnumValues;a=r?n.AllowOtherValues&&"Color"!==this.type()&&"Progress"!==this.type()?null===(t=this.nestedAttribute())||void 0===t?void 0:t.valueComparer(e):p.default.listComparer.bind(p.default,r):this.nestedAttribute().valueComparer(e)}return a||(a=p.default.genericComparer),a}},{key:"columnStats",value:function(){if(this.model.InternalQualifier&&this.model.InternalQualifier.ColumnStats&&null!=this.model.InternalQualifier.ColumnStats.MaxLength)return this.model.InternalQualifier.ColumnStats;var e=this.basestAttribute().auxData();return(null==e?void 0:e.MaxLength)&&e.MinLength?{MaxLength:e.MaxLength,MinLength:e.MinLength,AverageLength:(e.MaxLength+e.MinLength)/2,StdDevLength:(e.MaxLength-e.MinLength)/10}:null}},{key:"getChartAxisFormat",value:function(e,t){var a=this.auxData(),n=this.isDecimalType(),r=this.isNumericType(),i=",";(n||r)&&(a.ShowThousandsSeparator||(i=""));if(n){var o=0;if(a.DecimalDigits)o=a.DecimalDigits;else if(e>=0&&t>=0){var l=t-e;o=Math.max(Math.ceil(Math.log10(Math.floor(20/l))),0)}return i+"."+o+"f"}return r?i+".0f":null}},{key:"getChartAxisValueRange",value:function(e,t){if(this.isNumericType()){var a=this.auxData().MinValue,n=this.auxData().MaxValue,r=null===a||isNaN(a)||isNaN(e)?a||e||0:Math.min(a,e),i=null===n||isNaN(n)||isNaN(t)?n||t||0:Math.max(n,t);if(!isNaN(r)&&!isNaN(i))return[r,i]}return null}},{key:"validIfConstraintInfo",value:function(){return this.internalQualifier().Valid_If_ConstraintInfo}},{key:"appFormulaColumnsReferenced",value:function(){return this.appFormulaEvalTree()&&this.appFormulaEvalTree().columnsReferenced()||[]}},{key:"defaultExpressionColumnsReferenced",value:function(){return this.defaultExpressionEvalTree()&&this.defaultExpressionEvalTree().columnsReferenced()||[]}},{key:"resetColumnsReferenced",value:function(){return this.resetIfEvalTree()&&this.resetIfEvalTree().columnsReferenced()||[]}},{key:"showContentColumnsReferenced",value:function(){return this.isShowType()&&this.evalTreeLookup("ShowContent")&&this.evalTreeLookup("ShowContent").columnsReferenced()||[]}},{key:"validIfColumnsReferenced",value:function(){return this.validIfEvalTree()&&this.validIfEvalTree().columnsReferenced()||[]}},{key:"suggestedValuesColumnsReferenced",value:function(){return this.suggestedValuesEvalTree()&&this.suggestedValuesEvalTree().columnsReferenced()||[]}},{key:"requiredIfColumnsReferenced",value:function(){return this.requiredIfEvalTree()&&this.requiredIfEvalTree().columnsReferenced()||[]}},{key:"showIfColumnsReferenced",value:function(){return this.showIfEvalTree()&&this.showIfEvalTree().columnsReferenced()||[]}},{key:"editableIfColumnsReferenced",value:function(){return this.editableIfEvalTree()&&this.editableIfEvalTree().columnsReferenced()||[]}},{key:"baseImageColumnsReferenced",value:function(){return this.baseImageEvalTree()&&this.baseImageEvalTree().columnsReferenced()||[]}},{key:"displayNameColumnsReferenced",value:function(){return this.displayNameEvalTree()&&this.displayNameEvalTree().columnsReferenced()||[]}},{key:"changeColumns",value:function(){return this.isChangeTriggered()?this.auxData().ChangeColumns:null}},{key:"changeValues",value:function(){return this.isChangeTriggered()?this.auxData().ChangeValues:null}},{key:"updateMode",value:function(){return this.isChangeTriggered()?this.auxData().UpdateMode:null}},{key:"numberDisplayMode",value:function(){return this.auxData().NumberDisplayMode}},{key:"resetsEachUpdate",value:function(){return"Reset"===this.updateMode()||!!this.model.ResetOnEdit}},{key:"checkChangeTriggered",value:function(e,t,a,n){var r=!1;if(this.isChangeTriggered()){var i=this.changeColumns();if(null==i||0===i.length)r=!0;else for(var o=0;o<i.length;o++){if(i[o].toLowerCase()===a.name().toLowerCase()){var l=this.changeValues();if(null==l||0===l.length){r=!0;break}for(var u={ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"Equals",IsAtomic:!0},s=0;s<l.length;s++){if(u.Children=[{ResultType:a.type(),ResultTypeQualifier:a.auxData(),EvalType:"CONSTANT",ConstantValue:n},{ResultType:a.type(),ResultTypeQualifier:a.auxData(),EvalType:"CONSTANT",ConstantValue:l[s]}],A.default.create(u).run()){r=!0;break}}if(r)break}}}return r}},{key:"getValues",value:function(e){return this.valueFromWireFormat(e)}},{key:"missingRequired",value:function(e){return!(!this.model.IsRequired||this.model.Formula||this.model.AppFormula||null!=e&&""!==e)}},{key:"validateValue",value:function(t){if(this.model.IsReadOnly)return!0;var a=e.validators[this.model.Type];return!a||a(t,this.auxData())}},{key:"convertibleTo",value:function(e){var t=this.type(),a=e.type();return t===a||(!(!this.isNumericType()||!e.isNumericType())||(!(!this.isTextualType()||!e.isTextualType())||(!(!this.isImageType()||!e.isImageType())||(!(!this.isListType()||!e.isListType())||(!(!this.isTemporalType()||"Duration"===t||"Duration"===a||!e.isTemporalType())||("LatLong"===t&&"XY"===a||(("Text"===t||"LongText"===t)&&"List"!==a||("Text"===a||"LongText"===a))))))))}},{key:"isMoreSpecificType",value:function(e){var t=this.type(),a=e.type();return"Text"!==t&&"LongText"!==t&&("Text"===a||"LongText"===a)||"Unknown"!==t&&(!a||"Unknown"===a)}},{key:"coerceValue",value:function(t,a,n){if(a=a||this.type(),n=n||this.auxData(),null==t)return null;if(this.isNumericType()){var r=Number(t),i=0;if("Number"!==this.type()&&"ChangeCounter"!==this.type()&&(i=this.auxData().DecimalDigits),!isNaN(r)&&"number"==typeof i){"Percent"===this.type()&&(i+=2);var o=Math.pow(10,i);return r=Math.round(r*o)/o}}if("function"==typeof t.getMonth&&"object"===(0,l.default)(n)&&n.IgnoreSeconds&&t.setSeconds(0),"Yes/No"===this.type()&&(t=e.normalizeBooleanValue(t)),this.type()!==a){var u=e.valueToWireFormat(t,a,n);return e.valueFromWireFormat(u,this.type(),this.auxData())}return t}},{key:"shouldUpdateOnChange",value:function(){if(this.isValidityEnum()||this.hasSuggestedValues())return!0;switch(this.type().toLowerCase()){case"enum":case"enumlist":case"list":case"ref":case"color":case"image":case"thumbnail":case"file":case"drawing":case"signature":case"progress":case"yes/no":return!0;default:return!1}}},{key:"shouldUseStackSelect",value:function(){return"Stack"===this.auxData().EnumInputMode||"Stack"===this.auxData().InputMode}},{key:"shouldUseButtonSelect",value:function(e,t,a,n){if("Buttons"===this.auxData().EnumInputMode||"Buttons"===this.auxData().InputMode)return!0;if("Stack"===this.auxData().EnumInputMode||"Stack"===this.auxData().InputMode)return!0;if("Dropdown"===this.auxData().EnumInputMode)return!1;if(!e||!e.length)return!!a;if(n)return!1;if(t&&!this.isValidityEnum())return!1;var r=d.default.max(d.default.map(e,(function(e){return"string"!=typeof e?0:e.length}))),i=r<=14&&e.length<=3,o=r<=2&&e.length<=6;return i||o}},{key:"inFullDependentChain",value:function(e){var t,a,n=!1;if(null!=this.validIfConstraintInfo()&&e.length>0){n=!0;for(var r=0;r<e.length;r++){if(t=e[r],a=r>0?e[r-1]:null,null==t.validIfConstraintInfo()){n=!1;break}if(a){var i=t.validIfColumnsReferenced(),o=a.validIfColumnsReferenced();if(i.length!==o.length+1||d.default.intersection(i,o).length!==o.length){n=!1;break}}else if(this.name()!==t.name()){n=!1;break}}}return n}},{key:"valueExists",value:function(t){return e.valueExists(t,this.type())}},{key:"valueFromWireFormat",value:function(t){var a=this.nestedAttribute();switch(this.type()){case"List":return t?"function"==typeof t.split?t.split(e.listDelimiter).filter((function(e){return null!=e&&""!==e})).map((function(e){return a.valueFromWireFormat(e)})):t:[];case"EnumList":return t?"function"==typeof t.split?this.splitEnumListValue(t).filter((function(e){return null!=e&&""!==e})).map((function(e){return a.valueFromWireFormat(e)})):t:[];case"Ref":case"Enum":return a.valueFromWireFormat(t);default:return e.valueFromWireFormat(t,this.type(),this.auxData())}}},{key:"valuesFromWireFormat",value:function(e){var t=this;return e.map((function(e){return t.valueFromWireFormat(e)}))}},{key:"valueToWireFormat",value:function(t){var a=this.nestedAttribute();switch(this.type()){case"List":case"EnumList":return t?Array.isArray(t)?t.filter((function(e){return!d.default.isNil(e)&&""!==e})).map((function(e){return a?a.valueToWireFormat(e):e})).join(e.listDelimiter):t:"";case"Enum":case"Ref":if(a)return a.valueToWireFormat(t)}return e.valueToWireFormat(t,this.type(),this.auxData())}},{key:"valuesToWireFormat",value:function(e){var t=this;return null==e?[]:(e=Array.isArray(e)?e:[e]).map((function(e){return t.valueToWireFormat(e)}))}},{key:"needsAsyncCallback",value:function(){return"LatLong"===this.type()||this.usesOcrAsyncFormula()}},{key:"usesOcrAsyncFormula",value:function(){var e=this.defaultExpressionEvalTree(),t=this.appFormulaEvalTree(),a=function(e){return!!e&&("OCR"===e.FunctionName||"OCRTEXT"===e.FunctionName)};return a(e)||a(t)}},{key:"normalizePercentValueToString",value:function(t){if(""===t)return"";var a=this.auxData(),n=a&&null!=a.DecimalDigits?a.DecimalDigits:0,r=null==a?void 0:a.NumericDigits,i=e.normalizePercentValueToNumber(t);return null===i?"":e.formatLocalizedNumber(i,{precision:n,numericDigits:r})+"%"}},{key:"splitEnumListValue",value:function(t,a){var n=e.listDelimiter;return e.splitEnumListValue(t,n,a)}}],[{key:"parseAuxData",value:function(e,t){if(!e)return{};try{return JSON.parse(e)}catch(a){return m.default.warnToDevConsole("Error parsing aux data",e,t),{}}}},{key:"makeDate",value:function(e){return e?new Date(e):new Date(0)}},{key:"baseTypeFromAuxData",value:function(t,a){var n=t.BaseType||t.ReferencedType||t.ElementType;if(a&&n){var r=e.baseTypeQualifierFromAuxData(t);if(r){var i=e.baseTypeFromAuxData(r,!0);i&&(n=i)}}return n}},{key:"referencedTypeFromAuxData",value:function(t){return"Ref"===t.ReferencedType?e.referencedTypeFromAuxData(e.parseAuxData(t.ReferencedTypeQualifier)):t.ReferencedType}},{key:"baseTypeQualifierFromAuxData",value:function(t){var a=t.BaseTypeQualifier;return a||(a=t.ReferencedTypeQualifier)||(a=t.ElementTypeQualifier),a?e.parseAuxData(a):null}},{key:"fromTypeData",value:function(t,a,n){return new e({Name:t,Type:a,TypeAuxData:n})}},{key:"getColor",value:function(e){return"string"!=typeof e?null:R[e.toLowerCase()]}},{key:"valueExists",value:function(t,a){return"Url"===a?!!e.urlValueFromWireFormat(t).url:null!=t&&""!==t}},{key:"valueFromWireFormat",value:function(t,a,n){var r,i="Date"===a?"MM/DD/YYYY":"MM/DD/YYYY HH:mm:ss";switch(a){case"Yes/No":return e.booleanValueFromWireFormat(t);case"List":return e.listValueFromWireFormat(t,n);case"EnumList":return e.enumlistValueFromWireFormat(t,n);case"Enum":return e.enumValueFromWireFormat(t,n);case"Ref":return e.refValueFromWireFormat(t,n);case"Date":case"DateTime":case"ChangeTimestamp":return r=null,t&&("function"==typeof t.slice&&"00"===t.slice(6,8)?(r=(0,y.default)(t,i,!0).toDate(),isNaN(r.getTime())&&(r=new Date(t))):r=new Date(t)),r;case"Time":return t&&""!==t?g.default.timeToDate(t):null;case"Url":return e.urlValueFromWireFormat(t);case"LatLong":case"ChangeLocation":return e.latLongValueFromWireFormat(t);case"XY":return e.XYValueFromWireFormat(t);case"Number":case"Decimal":case"Percent":case"ChangeCounter":return null!=t&&""!==t?e.getNumberFromString(t):null;case"Price":return e.priceValueFromWireFormat(t,n);case"File":return e.fileValueFromWireFormat(t);default:return null==t?null:t}}},{key:"valueToWireFormat",value:function(t,a,n){var r=null!=t&&"function"==typeof t.getMonth;switch(a){case"Yes/No":return e.booleanValueToWireFormat(t);case"List":return e.listValueToWireFormat(t,n);case"EnumList":return e.enumlistValueToWireFormat(t,n);case"Enum":return e.enumValueToWireFormat(t,n);case"Ref":return e.refValueToWireFormat(t,n);case"Image":case"Thumbnail":case"Drawing":case"Signature":case"File":return t||"";case"Date":if(r)return g.default.MDYformat(t,!0);break;case"Time":if(r)return g.default.dateToTime(t);break;case"DateTime":case"ChangeTimestamp":if(r)return g.default.MDYHMSformat(t,!0);break;case"Url":if(t&&"object"===(0,l.default)(t)){var i=t.url||"",o=t.linkText||"";return JSON.stringify({Url:i,LinkText:o})}if(null===t||""===t)return JSON.stringify({Url:"",LinkText:""})}return null!=t?String(t):""}},{key:"valuesToWireFormat",value:function(t,a,n){return null==t?[]:(t=Array.isArray(t)?t:[t]).map((function(t){return e.valueToWireFormat(t,a,n)}))}},{key:"normalizeBooleanValue",value:function(e){var t=e?String(e).toLowerCase():null;return["y","yes","t","true"].indexOf(t)>=0||!(!1===e||["n","no","f","false"].indexOf(t)>=0)&&null}},{key:"booleanValueFromWireFormat",value:function(t){return e.normalizeBooleanValue(t)}},{key:"booleanValueToWireFormat",value:function(e){return!0===e?"Y":!1===e?"N":""}},{key:"listValueFromWireFormat",value:function(t,a){if(!t)return[];var n=a.ElementType,r=e.parseAuxData(a.ElementTypeQualifier);return"function"==typeof t.split?t.split(e.listDelimiter).filter((function(e){return null!=e&&""!==e})).map((function(t){return e.valueFromWireFormat(t,n,r)})):t}},{key:"enumlistValueFromWireFormat",value:function(t,a){if(!t)return[];var n=a.BaseType,r=e.parseAuxData(a.BaseTypeQualifier);if("function"==typeof t.split){var i=e.fromTypeData("_temp",n,r);return i.splitEnumListValue(t).map((function(e){return i.valueFromWireFormat(e)}))}return t}},{key:"enumValueFromWireFormat",value:function(t,a){var n=a.BaseType,r=e.parseAuxData(a.BaseTypeQualifier);return e.valueFromWireFormat(t,n,r)}},{key:"refValueFromWireFormat",value:function(t,a){var n=a.ReferencedType,r=e.parseAuxData(a.ReferencedTypeQualifier);return e.valueFromWireFormat(t,n,r)}},{key:"listValueToWireFormat",value:function(t,a){var n=this,r=a.ElementType,i=e.parseAuxData(a.ElementTypeQualifier);return t?Array.isArray(t)?t.filter((function(e){return null!=e&&""!==e})).map((function(e){return n.valueToWireFormat(e,r,i)})).join(e.listDelimiter):t:""}},{key:"enumlistValueToWireFormat",value:function(t,a){var n=this,r=a.BaseType,i=e.parseAuxData(a.BaseTypeQualifier);return"string"==typeof t?t:t?t.filter((function(e){return null!=e&&""!==e})).map((function(e){return n.valueToWireFormat(e,r,i)})).join(e.listDelimiter):""}},{key:"enumValueToWireFormat",value:function(t,a){var n=a.BaseType,r=e.parseAuxData(a.BaseTypeQualifier);return e.valueToWireFormat(t,n,r)}},{key:"refValueToWireFormat",value:function(t,a){var n=a.ReferencedType,r=e.parseAuxData(a.ReferencedTypeQualifier);return e.valueToWireFormat(t,n,r)}},{key:"priceValueFromWireFormat",value:function(e,t){var a="$";return(null==t?void 0:t.CurrencySymbol)&&(a=t.CurrencySymbol),"string"==typeof e&&null!=e&&0===e.indexOf(a)&&(e=e.substr(1)),null!=e&&""!==e?this.getNumberFromString(e):null}},{key:"fileValueFromWireFormat",value:function(e){return null==e?null:e}},{key:"urlValueFromWireFormat",value:function(e){if(!e||"{"!==e[0])return new b.default(e,e);try{var t=JSON.parse(e),a=t.Url,n=t.LinkText;return new b.default(a,n)}catch(e){return m.default.ReportErrorOnce({errorMessage:"Error parsing json Url type"}),new b.default("",null)}}},{key:"normalizeUrlValue",value:function(e){return e&&!e.match(/\w+\:/)?"http://"+e:e}},{key:"toHttpsUrl",value:function(e){if(e){if(!e.match(/^\w+:\/\//))return"https://"+e;if(e.match("^http://"))return e.replace("http://","https://")}return e}},{key:"latLongValueFromWireFormat",value:function(e){if(e){var t=String(e).trim().split(/\s*,\s*/g);return 2===t.length?new T.default(t[0],t[1]):null}return null}},{key:"XYValueFromWireFormat",value:function(e){if(e){var t=String(e).trim().split(/\s*,\s*/g);if(2===t.length)return new S.default(t[0],t[1])}return e}},{key:"normalizePercentValueToNumber",value:function(e){var t=e;if(null==t||"number"==typeof t&&isNaN(t))return null;if("string"==typeof e&&e.indexOf("%")===e.length-1){t=e.substr(0,e.length-1);var a=parseFloat(t);return isNaN(a)?null:a}var n=Math.round(1e8*t)/1e6;return isNaN(n)?null:n}},{key:"getNumberFromString",value:function(e){if(null===e||""===e)return null;var t=Number(e);return isNaN(t)&&"string"==typeof e&&(t=Number(e.replace(/,/g,""))),t}},{key:"formatLocalizedNumber",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.precision,r=a.numericDigits,i=a.useGrouping,o=a.currencySymbol,l=void 0===o?"":o;if(!t&&0!==t)return"";var u="string"==typeof t?e.getNumberFromString(t):Number(t);if(isNaN(u))return m.default.warnToDevConsole("formatLocalizedNumber errored parsing number:",t),t;if(void 0!==n){var s=Math.pow(10,n);u=Math.round(u*s)/s}var c=h.default.decimal().toLocaleString(u,{useGrouping:null==i||i,minimumIntegerDigits:r});if(n){var d=u.toString().split(".")[1];if(d){var f=n-d.length;f>0&&(c+=new Array(f+1).join("0"))}else{var p=h.default.decimal().decimalSeparator||".";c+=p+new Array(n+1).join("0")}}return l+c}},{key:"validateNumeric",value:function(e){return!Array.isArray(e)&&e-parseFloat(e)+1>=0}},{key:"inferEnumListDelimiter",value:function(t,a){var n=e.enumListDelimiter;return("function"==typeof t.indexOf&&t.indexOf(e.listDelimiter)>=0||a&&d.default.includes(a,t))&&(n=e.listDelimiter),n}},{key:"splitEnumListValue",value:function(t,a,n){return t=t||"",a=a||e.inferEnumListDelimiter(t,n),"function"==typeof t.split?t.split(a).filter((function(e){return null!=e&&""!==e})):[t]}}]),e}();t.Attribute=j,j.validators={Color:function(){return!0},Enum:function(){return!0},EnumList:function(){return!0},"Yes/No":function(){return!0},Email:function(e){return null==e||""===e||!!e.match(/^[^@]+@[^@]+$/)},Text:function(e,t){return null==e||""===e||!((null==t?void 0:t.MinLength)&&e.length<t.MinLength)&&!((null==t?void 0:t.MaxLength)&&e.length>t.MaxLength)},LongText:function(e,t){return j.validators.Text(e,t)},LatLong:function(e){if(null==e||""===e)return!0;var t=e.match(/^(-?\d+(?:\.\d+)?),\s?(-?\d+(?:\.\d+)?)$/);return!!t&&v.default.isValidLatLng(t[1],t[2])},XY:function(e){if(null==e||""===e)return!0;var t=e.match(/^(-?\d+(?:\.\d+)?),\s?(-?\d+(?:\.\d+)?)$/);return!!t&&(S.default.isValidXOrY(t[1])&&S.default.isValidXOrY(t[2]))},Number:function(e,t){return j.validators.Decimal(e,d.default.extend({},t,{DecimalDigits:0}))},Decimal:function(e,t){if(t||(t={}),null==e||""===e)return!0;var a,n=(0,g.fastTrim)(e);try{a=new f.default(n)}catch(e){return!1}var r,i=t.MinValue||0;if(t.StepValue&&null!=t.MaxValue){r=new f.default(t.MaxValue).minus(i).div(t.StepValue).round(void 0,0).times(t.StepValue).plus(i).toString()}else r=t.MaxValue;if(null!=t.MaxValue&&a.gt(r))return!1;if(null!=t.MinValue&&a.lt(t.MinValue))return!1;var o,l=null==t.DecimalDigits?2:t.DecimalDigits;return o=0===l?"^-?\\d*?$":"^-?\\d*(?:\\.\\d{1,"+l+"})?$",new RegExp(o).test(n)},Percent:function(e,t){return t||(t={}),d.default.endsWith(e,"%")&&(e=e.substr(0,e.length-1)),j.validators.Decimal(e,d.default.extend({},t,{DecimalDigits:null==t.DecimalDigits?t.DecimalDigits:t.DecimalDigits+2,MinValue:null==t.MinValue||0===t.MinValue?t.MinValue:t.MinValue/100,MaxValue:null==t.MaxValue||0===t.MaxValue?t.MaxValue:t.MaxValue/100,StepValue:null==t.StepValue||0===t.StepValue?t.StepValue:t.StepValue/100}))},Price:function(e,t){return j.validators.Decimal(e,t)},ChangeCounter:function(){return!0},ChangeTimestamp:function(){return!0},DateTime:function(e,t){var a;if(null==e||""===e)return!0;var n=new Date(e);if(isNaN(n.getSeconds()))return!1;if((null===(a=w.AppGlobals.AppModel)||void 0===a?void 0:a.inRollout("DateTimeRespectsMinMax"))&&t){var r=t.MinValue,i=t.MaxValue;if(null!=i&&n>new Date(i))return!1;if(null!=r&&n<new Date(r))return!1}return!0},Date:function(e){if(null==e||""===e)return!0;var t=h.default.date().momentFromWireFormat(e).toDate();return!isNaN(t.getSeconds())},Time:function(e){if(null==e||""===e)return!0;if(!e.match(/^\d{2}:\d{2}(:\d{2})?/))return!1;var t=new Date("12/30/1970 "+e);return!isNaN(t.getSeconds())},Duration:function(e){return null==e||""===e||null!=e.match(/^-?(\d+):([0-5][0-9]):([0-5][0-9])$/)},Drawing:function(){return!0},Signature:function(){return!0}},j.enumListDelimiter=", ",j.listDelimiter=" , ",j.SHEET_FORMULA_NEEDS_RECOMPUTE="[sync to compute]";var q=j;t.default=q},107465:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(689728)),i=n(a(856690)),o=(0,r.default)((function e(t,a){(0,i.default)(this,e),this.singleDataContext=t,this.rows=a}));t.default=o},385857:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(627424)),o=n(a(600861)),l=n(a(856690)),u=n(a(689728)),s=n(a(496486)),c=C(a(150198)),d=n(a(192137)),f=n(a(962553)),p=C(a(302443)),h=n(a(190644)),v=n(a(498967)),m=n(a(365914)),g=C(a(888861)),y=a(959191),b=a(166089),T=a(714067),S=n(a(819433)),A=a(95483);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(w=function(e){return e?a:t})(e)}function C(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=w(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}function E(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var R=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},I=new WeakMap;function O(e,t,a,n,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.rowData;if(i[e.tempId])return o;i[e.tempId]=!0,s.default.keys(e.pendingRefStates).forEach((function(o){O(e.pendingRefStates[o],t,a,n,r+1,i)})),s.default.keys(e.pendingReverseRefStates).forEach((function(o){O(e.pendingReverseRefStates[o],t,a,n,r-1,i)}));var l=t[e.tableName]||{},u=a[r]||{};return l[e.tempId]=e,u[e.tempId]=e,t[e.tableName]=l,t[e.rootTableName]=l,a[r]=u,n[e.tempId]=e,o}var M=function(){function e(t,a,n,r,i,o,u,s){(0,l.default)(this,e),this.appModel=t,this.formState=r,this._parentContext=i,this.inputParameterValues=o,this.uiContext=u,this._transaction=s,this.isFakeContext=!1,this.rowData=n||{},!a||a instanceof d.default||(a=new d.default(a)),this.tableSchema=a}return(0,u.default)(e,[{key:"pendingTransaction",get:function(){var e,t,a,n;if(!f.default.usePendingChangesStore)return this.appModel.dataManager.currentTransaction;if(this._transaction&&!this._transaction.closed)return this._transaction;var r=null===(e=this.uiContext)||void 0===e?void 0:e.viewStateKey;if(r){var i=(0,S.default)().getState(),o=null===(a=null===(t=(0,A.getViewStack)(i).find((function(e){return e.viewStateKey===r})))||void 0===t?void 0:t.mutableState)||void 0===a?void 0:a.transactionId;return null===(n=b.AppGlobals.AppModel)||void 0===n?void 0:n.dataManager.getTransaction(o)}}},{key:"schemaName",value:function(){return this.tableSchema&&this.tableSchema.name()}},{key:"isSettingsSchema",value:function(){return this.schemaName()===T.userSettingsSchemaName}},{key:"setParentContext",value:function(e){this._parentContext=e}},{key:"getParentContext",value:function(){return this._parentContext?this._parentContext:this.isSettingsSchema()||this.appModel.IsTestModel?null:this.appModel.userSettingsDataContext()}},{key:"getInputParameterValue",value:function(e){if(this.inputParameterValues&&e){var t=this.inputParameterValues[e.toLowerCase()];if(void 0!==t)return t;if(this._parentContext)return this._parentContext.getInputParameterValue(e)}return null}},{key:"isEmpty",value:function(){return 0===s.default.keys(this.rowData).length}},{key:"copy",value:function(){var t=new e(this.appModel,this.tableSchema,this.rowData,s.default.clone(this.formState),this._parentContext,void 0,this.uiContext,this._transaction);return t}},{key:"replaceRowData",value:function(e){this.rowData=e||{},this.formState&&(this.formState.rowData=e)}},{key:"augmentWithRowData",value:function(t){var a={};s.default.forEach(t,(function(e,t){a[t]={value:e,enumerable:!0,configurable:!0,writable:!0}}));var n=Object.create(this.rowData,a);return new e(this.appModel,this.tableSchema,n,void 0,void 0,void 0,this.uiContext)}},{key:"augmentWithViewContext",value:function(e,t){var a;if(!e||(null===(a=this.uiContext)||void 0===a?void 0:a.viewStateKey)===e)return this;var n=t?this:this.copy();return n.uiContext={viewStateKey:e},n}},{key:"augmentWithTransaction",value:function(e,t){var a,n=this;if(f.default.usePendingChangesStore&&e!==this._transaction&&((n=t?this:this.copy())._transaction=e),null==this.uiContext&&e){var r=null===(a=e.owningViewState)||void 0===a?void 0:a.viewStateKey;if(r)return n.augmentWithViewContext(r,t||n!==this)}return n}},{key:"augmentWith",value:function(e,t,a){var n=a?this.augmentWithRowData(a):this;return n=(n=n.augmentWithViewContext(e,n!==this)).augmentWithTransaction(t,n!==this)}},{key:"getValue",value:function(e){return"string"!=typeof e&&(e=e.name()),this.rowData[e]}},{key:"setValue",value:function(e,t){var a=this.rowData[e]!==t;return this.rowData[e]=t,this.formState&&(this.formState.rowData[e]=t),a}},{key:"extendDefaultRecomputeParams",value:function(e){var t=e.theseAttributesAndInfluenced,a=R(e,["theseAttributesAndInfluenced"]);return t=s.default.clone(t),Object.assign({considered:{},computed:{},computeDefaults:!1,skipChangeTriggers:!1,skipLeafAttrs:!1,initialData:s.default.clone(this.rowData),nowDate:new Date,theseAttributesAndInfluenced:t},a)}},{key:"recomputeDynamicValues",value:function(){var e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.extendDefaultRecomputeParams(a),r=null!==(e=n.theseAttributesAndInfluenced)&&void 0!==e?e:this.tableSchema.dynamicAttributes(),i=E(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.recomputeAttribute(o,n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"recomputeAppFormulas",value:function(e){var t,a=this.extendDefaultRecomputeParams(e),n=E(this.tableSchema.dynamicAttributes());try{for(n.s();!(t=n.n()).done;){var r=t.value;(r.hasAppFormula()||r.isChangeTriggered()||r.resetsEachUpdate()||r.hasResetExpression())&&this.recomputeAttribute(r,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"recomputeVirtualColumns",value:function(e){this.recomputeAppFormulas({computeDefaults:!1,skipLeafAttrs:!1,virtualOnly:!0,recomputeKey:!!(null==e?void 0:e.recomputeKey)})}},{key:"recomputeInfluencedAttributes",value:function(e,t){var a=this;t=t||{},this.tableSchema.influencedDynamicAttributes(e).forEach((function(e){a.recomputeAttribute(e,t)}))}},{key:"recomputeAttribute",value:function(e,t){var a,n,r,i,l=this,u=(t=t||{}).considered=t.considered||{},c=t.computed=t.computed||{},d=t.skipTheseDefaults||{},f=t.initialData=t.initialData||s.default.clone(this.rowData),p=t.wasReset||{},v=t.theseAttributesAndInfluenced,g=this,y=e.name(),b=!1;if(!u[y]&&(u[y]=!0,e.isDynamic()&&(!t.virtualOnly||e.isVirtual()))){var T=y in d,S=this.tableSchema.dynamicDependencies(e);if((S.length||!t.skipLeafAttrs)&&(S.forEach((function(e){var a=e.name();u[a]||a===y||l.recomputeAttribute(e,t)})),!v||v.includes(e))){g._tempInitialData=f;var A=function(a){if(null!=a){var n;t.noAsync||"function"!=typeof t.getAsyncCallback||(n=t.getAsyncCallback(e));var r=a.run(g,{asyncCallback:n,attrName:y});r=e.coerceValue(r),r=e.valueToWireFormat(r),b=g.setValue(y,r),c[y]=!0}},w=e.resetsEachUpdate(),C=e.resetIfEvalTree();if(C&&(w=C.run(g)),T||(e.hasDefaultExpression()&&(t.computeDefaults||w)?A(e.defaultExpressionEvalTree()):w&&(b=g.setValue(y,""),c[y]=!0,p[y]=!0)),!t.skipChangeTriggers&&e.isChangeTriggered()){var E,k=0,R=g.getValue(y);w&&(f[y]=R);for(var I=w?R:f[y],O=0;O<S.length;O++){var M=S[O],N=M.name(),_=null!==(a=g.getValue(N))&&void 0!==a?a:"";if((null!==(n=f[N])&&void 0!==n?n:"")!==_&&(t.noAsync||"function"!=typeof t.getAsyncCallback||(E=t.getAsyncCallback(e)),e.checkChangeTriggered(I,R,M,_)&&(k++,!w)))break}if(k>0){var D;switch(e.type().toLowerCase()){case"changecounter":var L=1,P=Number(I);w&&(L=k),D=isNaN(P)?L:P+L;break;case"changetimestamp":D=R===I?m.default.MDYHMSformat(null!==(r=t.nowDate)&&void 0!==r?r:new Date,!0):R;break;case"changelocation":if(h.default.fetchLatLong((function(e,t){return E?E(h.default.stringifyLatLng(e,t)):null})),D="",h.default.lastPosition){var x=h.default.lastPosition.coords,F=x.latitude,G=x.longitude;D=h.default.stringifyLatLng(F,G)}}b=g.setValue(y,e.valueToWireFormat(D)),c[y]=!0}else b=g.setValue(y,f[y]),c[y]=!0}else if(e.hasAppFormula()){var V=this.tableSchema.isKeyComponent(e);(t.computeDefaults||!V||V&&t.recomputeKey)&&A(e.appFormulaEvalTree())}e.isKey()&&this.resolveParentRefs(),delete g._tempInitialData,b&&(null===(i=t.onDynamicValueChanged)||void 0===i||i.call(t,e,this.getValue(y)),v&&v.push.apply(v,(0,o.default)(this.tableSchema.influencedDynamicAttributes(e))))}}}},{key:"tableRow",get:function(){var e,t,a=this,n=this.pendingTransaction,r=null===(e=this.tableSchema)||void 0===e?void 0:e.sourceTableName(),i=null===(t=this.tableSchema)||void 0===t?void 0:t.keyAttribute().name(),o=this.appModel.findTableCollection(r).rootTable;return null==o?void 0:o.lookupTableRows(i,this.keyValue,n).filter((function(e){return e.values===a.rowData}))[0]}},{key:"stableId",get:function(){var e,t;return null!==(t=null===(e=this.tableRow)||void 0===e?void 0:e.stableId)&&void 0!==t?t:this.keyValue}},{key:"getColumnValue",value:function(e,t,a){var n,r;if(a||(a=0),-2===a){var i,o=this.pendingTransaction;if(this.formState&&this.formState.initialData)i=this.formState.initialData;else if(this._tempInitialData)i=this._tempInitialData;else if(o&&this.rowData){var l=this.tableSchema.sourceTableName();i=o.getInitialRowValues(l,this.stableId)}if(i)return i[e]}return a<1?(null===t||e&&"_this"!==e.toLowerCase()?"_thisrow"===e.toLowerCase()?e=null==(r=this.tableSchema.keyAttribute())?void 0:r.name():null!=t&&this.rowData&&!this.rowData.hasOwnProperty(e)&&(e=(null==(r=null===(n=this.tableSchema)||void 0===n?void 0:n.model.Attributes[t])?void 0:r.Name.toLowerCase())===e.toLowerCase()?null==r?void 0:r.Name:e):e=null==(r=this.tableSchema.model.Attributes[t])?void 0:r.Name,null!=e&&null!=this.rowData?this.rowData[e]:null):this.getParentContext()?this.getParentContext().getColumnValue(e,t,a-1):null}},{key:"getTableColumnValue",value:function(e,t,a,n){var r=f.default.findByName(e,this.appModel),i=r.table,o=r.tableSchema;if(null!=i&&null!=o){var l=o.keyAttribute().name(),u=i.table,s=this.appModel.FindTableDefinition(e);if(null!=u&&null!=s&&null!=s.SchemaName){var c=this.getTableRow(u,t,{keyAttrName:l});if(null!=c){if(null==a){var d=this.appModel.FindSchema(s.SchemaName);null!=d&&(a=d.Attributes[n].Name)}if(null!=a)return c[a]}}}return null}},{key:"makeColumnSetKey",value:function(e){var t=e.tableName,a=e.rowListAttrName,n=e.columnIndex,r=e.makeDistinct,i=e.maxEntries,o=e.elementAttribute;return[t,a,n,r,i,o.type(),o.auxDataString()].join("|")}},{key:"sortData",value:function(e,t,a,n){var r=this,i=f.default.findByName(t,this.appModel),o=i.table,l=i.tableSchema;if(!o||!l)return e.slice(0,n);var u=l.keyAttribute(),s=this.makeNestedContext(l),d=e.map((function(e){var t,n=u.valueToWireFormat(e);return s.replaceRowData(null===(t=o.lookupTableRow(n,r.pendingTransaction))||void 0===t?void 0:t.values),{refVal:e,sortExpr:a.map((function(e){return e.sortExpression.run(s)}))}})),p=a.map((function(e){return new c.default({Type:e.sortExpression.resultType(),TypeAuxData:JSON.stringify(e.sortExpression.resultTypeQualifier())})}));return v.default.sort(d,(function(e,t){for(var n=0;n<a.length;n++){var r=p[n].valueComparer(c.ValueFormat.Native)(e.sortExpr[n],t.sortExpr[n]);if(0!==r)return a[n].descending?-1*r:r}return 0})),n&&(d=d.slice(0,n)),d.map((function(e){return e.refVal}))}},{key:"makeNestedContext",value:function(t){var a=new e(this.appModel,t,void 0,void 0,this,void 0,this.uiContext);return this.isFakeContext&&(a.isFakeContext=!0),a}},{key:"getTableColumnSet",value:function(e,t,a,n,r,o,l){var u,d,f=this,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=this.appModel.findTableCollection(e),v=h.table,m=h.tableSchema,T=h.rootTableSchema,S=T&&T.allAttributes()[t];if(null!=v&&null!=m&&null!=S){var A=v.table,w=null,C=null,E=null,k=null,R=!1;if(null!=a&&(k=this.makeNestedContext(m),E=a.curry(k)),null!=o){var I=this.getColumnValue(l,o,p),O=null===(u=b.AppGlobals.AppState)||void 0===u?void 0:u.pendingFormState;if(null==O)C=(null==I?void 0:I.split(c.default.listDelimiter).filter((function(e){return null!=e&&""!==e})))||[],w=s.default.compact(C.map((function(e){var t;return null===(t=v.lookupTableRow(e,f.pendingTransaction))||void 0===t?void 0:t.values})));else{var M="List",N={ElementType:"Ref",ElementTypeQualifier:null};C=c.default.valueFromWireFormat(I,M,N);var _=A.keyAttrName;w=[];for(var D=0;D<C.length;D++){var L=C[D],P={};P[_]=L,w=w.concat(this.getTableRows(A,P))}}}else if(null!=E)if("CONSTANT"===E.evalType()&&"Yes/No"===E.resultType()&&"N"===E.constantValue())w=null;else{var x=null;if(null===(d=this.appModel)||void 0===d?void 0:d.inRollout("curryNativeValue")){var F,G=(0,g.getFilterDefaultsAndFullyMapped)(E),V=(0,i.default)(G,2);F=V[0],R=V[1],x=(0,y.filterDefaultsToLookupValues)(F)}else"BOOLEAN"===E.evalType()&&(x=E.getLookupValues());w=this.getTableRows(A,x)}else w=this.getTableRows(A);if(null!=w){if(null!=E&&!R){var B=0,U={noCache:!0};w=w.filter((function(e){if(k.replaceRowData(e),r&&B>=r)return!1;var t=E.run(k,U);return t&&B++,t}))}var H=w.map((function(e){return e[S.name()]}));return n&&(H=s.default.uniq(H)),H}}return[]}},{key:"keyValue",get:function(){var e,t;return null===(e=this.rowData)||void 0===e?void 0:e[null===(t=this.tableSchema)||void 0===t?void 0:t.keyAttribute().name()]}},{key:"getTableRows",value:function(e,t){var a,n=(null===(a=b.AppGlobals.AppState)||void 0===a?void 0:a.pendingFormState)||this.formState,r=this.appModel.findTableCollection(e.Name).table;if(null==r)return[];var i=this.pendingTransaction;if(n&&!f.default.usePendingChangesStore){var o=(0,y.lookupValuesToFilterDefaults)(t);return r.filteredRowValues({filterDefaults:o,transaction:i},this.appModel,this)}var l=t&&r.lookupTableRowsByLookupValues(t,i,this);return(null!=l?l:r.rows({transaction:i,dataContext:this})).map((function(e){return e.values}))}},{key:"getTableRow",value:function(e,t){var a,n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.keyAttrName;if(e instanceof f.default?e=(r=e).table:r=f.default.findByName(e.Name,this.appModel).table,o){var l=(null===(a=b.AppGlobals.AppState)||void 0===a?void 0:a.pendingFormState)||this.formState,u=this.pendingRowsForTable(e.Name).filter((function(e){return e.tempId!==l.tempId&&e.rowData[o]===t}));if(u.length)return u[0].rowData}return r?null===(n=r.lookupTableRow(t,this.pendingTransaction))||void 0===n?void 0:n.values:null}},{key:"getFilteredTableRows",value:function(e,t){var a,n=(null===(a=b.AppGlobals.AppState)||void 0===a?void 0:a.pendingFormState)||this.formState,r=this.appModel.findTableCollection(e.Name).table;if(null==r)return[];if(n&&!f.default.usePendingChangesStore)return r.filteredRowValues({filterExpr:t});var i=this.pendingTransaction;return r.queryRowValues({filterExpr:t,transaction:i},this.appModel,this)}},{key:"findTableKeyValues",value:function(e){var t=f.default.findByName(e,this.appModel).tableSchema;if(null==t)return{data:[],key:null};var a=t.findAttributeIndex(t.keyAttribute().name());return{data:this.getTableColumnSet(e,a),key:t.keyAttribute()}}},{key:"getFilterDefaultValues",value:function(e){var t=null,a=e.refListFilter(this);if(a){var n=g.default.getFilterDefaults(a);if(n){t={};for(var r=0;r<n.length;r++)t[n[r].ColumnName]=n[r].ColumnValue}}return t}},{key:"resolveParentRefs",value:function(){for(var e,t=(null===(e=b.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.formState,a={};t;){var n=t,r=n.tempId,i=n.parentState,o=n.rowData,l=n.keyAttrName,u=n.launchedBy;if(a[r])break;if(a[r]=!0,i&&r in i.pendingRefStates){var c=o[l],d=i.rowData[u];if(d!==c){var f=this.appModel.findTableCollection(i.tableName).tableSchema,p=f&&f.findAttributeByName(u),h=null!=c?c:"";if(p&&"EnumList"===p.type()){d=p.valueFromWireFormat(d)||[];var v=I.get(t),m=null!=v?d.indexOf(v):-1;m>=0?d[m]=h:s.default.includes(d,h)||d.unshift(h),I.set(t,h),h=p.valueToWireFormat(d)}i.rowData[u]=h}}t=t.parentState}}},{key:"pendingSaves",value:function(){var e,t={},a={},n={},r=(null===(e=b.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.formState;return r&&O(r,t,a,n,0),{byTable:t,byDepth:a,byId:n}}},{key:"pendingRowsForTable",value:function(e){return s.default.values(this.pendingSaves().byTable[e]||{})}},{key:"pendingKeysForTable",value:function(e){return this.pendingRowsForTable(e).map((function(e){return e.rowData[e.keyAttrName]}))}},{key:"getLatLong",value:function(e){if(null==e?void 0:e.supportsAsync)return new Promise((function(t){h.default.fetchLatLong((function(e,a){return t(new p.default(e,a))}),(function(){return t(p.defaultLatLong)}),e)}));if(h.default.lastPositionAge()>1e4){var t=null==e?void 0:e.asyncCallback;h.default.fetchLatLong((function(e,a){return t?t(h.default.stringifyLatLng(e,a)):null}))}if(h.default.lastPosition){var a=h.default.lastPosition.coords,n=a.latitude,r=a.longitude;return new p.default(n,r)}return p.defaultLatLong}}],[{key:"getDefaultValues",value:function(e,t){var a;if(!t||e&&e.length||(e=g.default.getFilterDefaults(t)),e){if(!(e.length&&e[0].hasOwnProperty("ColumnName")&&e[0].hasOwnProperty("ColumnValue")))return e;a={};for(var n=0;n<e.length;n++){var r=e[n],i=r.ColumnName,o=r.ColumnValue;a[i]=o}}return a}}]),e}();t.default=M},743537:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=a(166089),l=function(){function e(t,a){(0,r.default)(this,e),this.model=t,this.view=a}return(0,i.default)(e,[{key:"type",value:function(){return this.model.EventType}},{key:"actionName",value:function(){return"**auto**"!==this.model.EventAction?this.model.EventAction:null}},{key:"action",value:function(e,t){e=e||o.AppGlobals.AppModel;var a=null;if(null!==this.actionName()&&e&&this.view){var n=e.appTemplate.actions();if(!t){var r=this.view.table(),i=r&&e.findTableCollection(r).rootTable;t=i&&i.name()}var l=this.actionName();l&&(a=n.findByName(t,l))}return a}}]),e}();t.default=l},513979:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(888861)),u=n(a(266522)),s=n(a(593186)),c=a(166089),d=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},f=function(e){var t;return e&&u.default.isDynamicFormattingColor(e)?u.default.getFormattingColorForTheme(null===(t=c.AppGlobals.AppModel)||void 0===t?void 0:t.AppTemplate.Presentation.DisplayTheme,e):e},p=function(){function e(t){(0,r.default)(this,e),this.data=t}return(0,i.default)(e,[{key:"settings",get:function(){if(!this._settings){var e={};try{var t=JSON.parse(this.data.Settings),a=t.icon,n=t.textSize,r=t.highlightColor,i=t.textColor,l=d(t,["icon","textSize","highlightColor","textColor"]),u=void 0,c=Number(n);c?u=Math.max(.2,Math.min(3,c)):0!==n&&"0"!==n||(u=0),e=o.default.omitBy(Object.assign(Object.assign({},l),{icon:"_blank_"===a?null:a,textColor:f(i),highlightColor:f(r),textSize:u}),o.default.isNil)}catch(e){s.default.warnToDevConsole("Formatting Rule Settings was not valid json",this.data)}this._settings=e}return this._settings}},{key:"tableOrSlice",value:function(){return this.data.TableOrSlice}},{key:"columns",value:function(){return this.data.ColumnsToFormat}},{key:"condition",value:function(){return!this._conditionEvalTree&&this.data.IsValid&&null!=this.data.Condition&&null!=this.data.ConditionEvaluatable&&(this._conditionEvalTree=l.default.create(this.data.ConditionEvaluatable)),this._conditionEvalTree||null}},{key:"equivalentKeyRollout",value:function(){var e=this.condition();if(null!=e&&"Equals"===e.operatorName()){var t=e.children.find((function(e){return"COLUMN"===e.evalType()})),a=e.children.find((function(e){return"CONSTANT"===e.evalType()}));if(null!=t&&null!=(null==a?void 0:a.constantValue()))return"SourceColumn:".concat(t.ColumnName," - RuleTable:").concat(this.tableOrSlice())}return null}},{key:"equivalentKey",value:function(){var e;if(null===(e=c.AppGlobals.AppModel)||void 0===e?void 0:e.inRollout("curryNativeValue"))return this.equivalentKeyRollout();var t=this.condition();if(t){var a=t.model;if(a&&"Equals"===a.OperatorName){var n=a.Children.find((function(e){return"COLUMN"===e.EvalType})),r=a.Children.find((function(e){return"CONSTANT"===e.EvalType}));if(!n||!r)return null;if(null!=r.ConstantValue)return"SourceColumn:"+n.ColName+" - RuleTable:"+this.tableOrSlice()}}return null}}]),e}();t.default=p},173861:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(513979)),u=n(a(962553)),s=n(a(385857)),c=n(a(365914)),d=a(166089),f={icon:[]},p=function(){function e(t,a){(0,r.default)(this,e);var n=t.filter((function(e){return!0===e.IsValid&&!e.Disabled}));this.rules=o.default.map(n,(function(e){return new l.default(e)})),this.appModel=a||d.AppGlobals.AppModel,this._cacheStore={timestamp:this.appModel.DataStamp,rulesForColumnOrAction:{},rulesForTable:{},formattingById:{}}}return(0,i.default)(e,[{key:"_makeCacheKey",value:function(e,t,a,n,r){return c.default.hashCode([e,t,a,n,r].join("|"))}},{key:"_validateCache",value:function(){this._cacheStore.timestamp!==this.appModel.DataStamp&&(this._cacheStore.timestamp=this.appModel.DataStamp,this._cacheStore.formattingById={})}},{key:"getFormatting",value:function(t){var a=t.tableOrSlice,n=t.rootTable,r=t.column,i=t.actionName,l=t.rowKey,c=t.dataContext,p=this.appModel||d.AppGlobals.AppModel;if(!n&&a){var h=u.default.findByName(a,p).table;h&&(n=h.rootTable())}if(n&&!c){var v={};l&&(v=n.findRow(l)||{}),c=new s.default(p,n.tableSchema,v)}this._validateCache();var m=n?n.name():"",g=this._makeCacheKey(m,r,i,l,c?JSON.stringify(c.rowData):null),y=this._cacheStore.formattingById[g];if(!y){var b=this.activeRules({rootTableName:m,column:r,actionName:i,dataContext:c}),T=b.activeRules,S=b.isPure;y=o.default.omitBy(e.mergeRulesByImportance(T),o.default.isNil),S&&(o.default.isEqual(y,f)&&(y=f),this._cacheStore.formattingById[g]=y)}return y}},{key:"rulesForTable",value:function(e){var t=this._cacheStore.rulesForTable[e];return t||(t=o.default.filter(this.rules,(function(t){return!(!e||t.data.TableOrSlice!==e)})),this._cacheStore.rulesForTable[e]=t),t}},{key:"rulesForColumnOrAction",value:function(e,t,a){var n=this._makeCacheKey(e,t,a),r=this._cacheStore.rulesForColumnOrAction[n];return r||(r=o.default.filter(this.rulesForTable(e),(function(e){return t?o.default.includes(e.data.ColumnsToFormat,t):a?o.default.includes(e.data.ColumnsToFormat,"__action__"+a):null==e.data.ColumnsToFormat||0===e.data.ColumnsToFormat.length})),this._cacheStore.rulesForColumnOrAction[n]=r),r}},{key:"activeRules",value:function(e){var t=e.rootTableName,a=e.column,n=e.actionName,r=e.dataContext,i=this.rulesForColumnOrAction(t,a,n),l=o.default.every(i,(function(e){return o.default.isNil(e.condition())||e.condition().isPure()})),u=o.default.filter(i,(function(e){return!!o.default.isNil(e.condition())||!!r&&!!e.condition().run(r)}));return{activeRules:u,isPure:l}}},{key:"computeWorstCaseFormatting",value:function(t,a){var n=a.tableOrSlice,r=a.column;return e.combineRulesToWorst(t,this.worstCaseRules({tableOrSlice:n,column:r}))}},{key:"worstCaseRules",value:function(e){var t=e.tableOrSlice,a=e.column,n=o.default.find(this.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.Name===t})),r=n?n.SourceTable:t,i=o.default.filter(this.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.SourceTable===r})),l=o.default.map(i,(function(e){return e.Name})),u=o.default.filter(this.rules,(function(e){return e.data.TableOrSlice===r||o.default.includes(l,e.data.TableOrSlice)}));return o.default.filter(u,(function(e){return a?o.default.includes(e.data.ColumnsToFormat,a):null==e.data.ColumnsToFormat||0===e.data.ColumnsToFormat.length}))}}],[{key:"mergeRulesByImportance",value:function(e){return o.default.reduce(e,(function(e,t){return o.default.extendWith(e,t.settings,(function(e,t,a){return"textSize"===a&&1===t?e:"icon"===a?(t&&e.unshift(t),e):t||e}))}),o.default.cloneDeep(f))}},{key:"combineRulesToWorst",value:function(e,t){var a={};return o.default.reduce(t,(function(e,t){var n=!1,r=t.equivalentKey();return r&&(a[r]&&(n=!0),a[r]=t),o.default.extendWith(e,t.settings,(function(e,t,a){return"icon"===a?(n||t&&e.unshift(t),e):"textSize"===a&&null!=e?Math.max(parseFloat(e),parseFloat(t)):t||e}))}),o.default.cloneDeep(f))}},{key:"cssStylesForText",value:function(e){var t={};return e.textColor&&(t.color=e.textColor),e.textSize&&(t.fontSize=e.textSize+"em"),t}},{key:"styleClassesForText",value:function(e){var t=[];return e.bold&&t.push("FormatRule--bold"),e.italic&&t.push("FormatRule--italic"),e.underline&&t.push("FormatRule--underline"),e.strikethrough&&t.push("FormatRule--strikethrough"),e.uppercase&&t.push("FormatRule--uppercase"),t.join(" ")}}]),e}();t.default=p},895466:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MISSING_AUTH_TOKEN=t.ImageHandle=void 0,t.isImageHandle=function(e){return null!=e&&"object"===(0,o.default)(e)&&null!=e.type&&null!=e.value};var r=n(a(856690)),i=n(a(689728)),o=n(a(918698)),l=n(a(496486)),u=n(a(365914)),s=n(a(571524)),c=n(a(593186)),d=n(a(112368)),f=a(263198),p=n(a(440587)),h=a(629503),v=a(646317),m=a(635672),g=a(166089),y=a(557310),b="missing_auth_token";t.MISSING_AUTH_TOKEN=b;var T=function(e,t){return"".concat(e,"|").concat(t)};var S={},A=function(){function e(t,a){if((0,r.default)(this,e),this._flattenCallbacks=new Map,this._flattened={},this._processCallbacks=[],this._processed=null,this._processPending=!1,"string"==typeof t&&0===t.indexOf("{")){var n=t;try{t=JSON.parse(n),t=p.default.from(t).url||t}catch(e){c.default.ReportError({errorMessage:"Tried to create ImageHandle from non-url string",serializedString:n})}}t&&"object"===(0,o.default)(t)?y.ReactRootUIConfig.isReactRoot()?this.model=Object.assign({},t):this.model=t.model||t:"string"==typeof t?(this.model={value:t},t&&0!==t.indexOf("data:")?this.model.type="Url":this.model.type="Data"):this.model={},a&&(this.model.tableName=a);var i=this.id()||(0,v.makeGuid)();this.model.id=i;var l=this.timestamp()||(new Date).toISOString();this.model.timestamp=l,S[i]=this,this.model.cachedById&&(this.model.value=g.AppGlobals.AppModel.GetFromImageCache(this.model.id)||"",delete this.model.cachedById)}return(0,i.default)(e,[{key:"equals",value:function(t){return t=e.from(t),this.id()===t.id()||this.value()&&this.value()===t.value()}},{key:"isValid",value:function(){return!(!this.type()||null==this.value())}},{key:"isAndroidHandle",value:function(){return this.isValid()&&"Android"===this.type()}},{key:"isIosHandle",value:function(){return this.isValid()&&"IOS"===this.type()}},{key:"isWebFileHandle",value:function(){return this.isValid()&&"WebFileReader"===this.type()}},{key:"isWebImageHandle",value:function(){return this.isValid()&&"WebImageReader"===this.type()}},{key:"isUrlHandle",value:function(){return this.isValid()&&"Url"===this.type()}},{key:"isDataHandle",value:function(){return this.isValid()&&"Data"===this.type()}},{key:"isBlank",value:function(){return null==this.value()||""===this.value()}},{key:"id",value:function(){return this.model.id}},{key:"timestamp",value:function(){return this.model.timestamp}},{key:"tableName",value:function(){return this.model.tableName}},{key:"type",value:function(){return this.model.type}},{key:"value",value:function(){return this.model.value}},{key:"mediaType",value:function(){return this.model.mediaType}},{key:"filePath",value:function(){var e,t;if(void 0===this.model.filePath){var a=null===(t=null===(e=g.AppGlobals.AppModel)||void 0===e?void 0:e.localState)||void 0===t?void 0:t.GetFilePaths(),n=this.id();a&&n&&(this.model.filePath=a[n]||void 0)}return this.model.filePath}},{key:"setFilePath",value:function(e){this.model.filePath=e,g.AppGlobals.AppModel.localState.AddImageFilePath(this.id(),e)}},{key:"setFileInput",value:function(e){this.file=e}},{key:"fileName",value:function(){return this.model.filename}},{key:"setFileName",value:function(e){this.model.filename=e}},{key:"preferredWidth",get:function(){return this.model.preferredWidth}},{key:"nestedHandle",value:function(){if(void 0!==this.model.nestedHandle){var t=e.from(this.model.nestedHandle,this.tableName());return t.isValid()?t:null}return null}},{key:"setNestedHandle",value:function(t){var a=e.from(t,this.tableName());return this.model.nestedHandle=a.isValid()?a:null,this}},{key:"resolve",value:function(){return this.isValid()?this.isDataHandle()?this.value():this.isUrlHandle()?g.AppGlobals.AppModel.ResolveFile(this.value(),this.tableName()):g.AppGlobals.AppModel.ResolveFile(this.model,this.tableName()):""}},{key:"_flushProcessCallbacks",value:function(e,t){var a=this,n=l.default.uniq(this._processCallbacks);this._processCallbacks=[],n.forEach((function(n){return n(e,t,a)}))}},{key:"canUseFirebaseUpload",value:function(){return this.isAndroidHandle()&&d.default.SupportsFirebaseFileUpload()}},{key:"getFirebaseToken",value:function(e){var t=this;(0,m.ajaxGet)("/api/firebaseToken").then((function(a){(null==a?void 0:a.firebaseToken)?(f.JeeneeBrowserAPI.setStorageAuth(a.firebaseToken),t.getUrlForSync(e,!1)):e(null,"")})).catch((function(){e(null,"")}))}},{key:"getUrlForSync",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.nestedHandle()?this.flatten(e):this.isBlank()?e(null,""):this.canUseFirebaseUpload()?f.JeeneeBrowserAPI.getFileStorageUrl(this.value(),(function(n){n&&n!==b?e(null,n):n===b&&a?t.getFirebaseToken(e):(c.default.ReportErrorOnce({errorMessage:"getUrlForSync firebase path falling back to base64"}),t.getBase64UrlForSync(e))})):this.getBase64UrlForSync(e)}},{key:"getBase64UrlForSync",value:function(e){var t=this;h.Common.processImage(this,(function(a){t.fileName()&&a.indexOf("#")<0&&(a+="#filename=".concat(encodeURIComponent(t.fileName()))),t.value()&&!a&&c.default.ReportErrorOnce({errorMessage:"Failed to get base64 data for sync",imageUrl:a}),e(null,a)}),(function(t){c.default.ReportErrorOnce({errorMessage:"Failed to get base64 data for sync",nestedErrorMessage:t}),e(t)}))}},{key:"getUrlForImgSrc",value:function(){var e=h.Common.getCachedImage(this);if(null!=e)return e;var t=this.value();switch(this.type()){case"Data":case"Url":return t;case"IOS":return void 0!==window.webkit?"appsheetios://?path="+encodeURIComponent(t)+"&method=getImageOrFile&id=5":"/jeenee_url?path="+encodeURIComponent(t)+"&id=5";case"Android":return d.default.IsAndroidAppWithMinVersion(6.8)&&t&&t.length<50?"/jeenee_url?path="+encodeURIComponent(t):t;case"WebFileReader":case"WebImageReader":return null}return null}},{key:"getBase64OrWebUrl",value:function(e){var t=this;if(this._processCallbacks.push(e),!this.isValid())return setTimeout((function(){return t._flushProcessCallbacks(null,"")}),1),"";if(this._processed)return setTimeout((function(){return t._flushProcessCallbacks(null,t._processed)}),1),this._processed;if(this.isUrlHandle()){var a=this.resolve();return setTimeout((function(){return t._flushProcessCallbacks(null,a)}),1),a}return this._processPending?"":(this._processPending=!0,h.Common.processImage(this,(function(e){t._processPending=!1,t._processed=e,t._flushProcessCallbacks(null,e)}),(function(e){t._processPending=!1,c.default.warnToDevConsole("unable to process image: ",e),t._flushProcessCallbacks(null,"")})))}},{key:"flushFlattenCallbacks",value:function(e,t,a){var n=this,r=l.default.uniq(this._flattenCallbacks.get(e));this._flattenCallbacks.delete(e),r.forEach((function(e){return e(t,a,n)}))}},{key:"cachedFlattened",value:function(e,t){return this._flattened[T(e,t)]}},{key:"flatten",value:function(e,t,a){var n=this,r=T(t,a),i=this._flattenCallbacks.get(r)||[];this._flattenCallbacks.set(r,i);var o=i.length>0;if(i.push(e),this.isValid()){var l=this.cachedFlattened(t,a);if(l)setTimeout((function(){return n.flushFlattenCallbacks(r,null,l)}),1);else if(!o){var d=document.createElement("canvas");d.width=0,d.height=0;var f=function(){c.default.warnToDevConsole("unable to load image data in ImageHandle.flatten"),n.flushFlattenCallbacks(r,null,n.resolve())},p=function(e,n){if(d){var r=e.width,i=e.height;if(s.default.IsMobileBrowser()){var o=Math.max(window.innerWidth,window.innerHeight);r=Math.min(e.width,o),i=Math.min(e.height,o)}t=d.width||t||r,a=d.height||a||i;var l=u.default.computeImageSizing({mode:d.width?"cover":"contain",containerWidth:t||0,containerHeight:a||0,imageWidth:e.width,imageHeight:e.height,centerHorizontal:!0}),c=l.scaledWidth,f=l.scaledHeight,p=l.left,h=l.top,v=d.getContext("2d");if(!d.width||!d.height){if(d.width=c,d.height=f,p=0,h=0,v.setTransform(1,0,0,1,0,0),y.ReactRootUIConfig.isReactRoot())v.fillStyle="rgba(0,0,0,0)";else{var m="#F8F8F8";g.AppGlobals.ViewManager.theme&&(m=g.AppGlobals.ViewManager.theme.getThemeColor("signatureBackground")||m),v.fillStyle=m}v.fillRect(0,0,d.width,d.height)}v.setTransform(1,0,0,1,0,0),v.drawImage(e,p,h,c,f)}delete e.onload,delete e.onerror,delete e.src,n(e)};!function e(r,i){var o=function(e){var t=new Image;e.match(/^data:/)?delete t.crossOrigin:t.crossOrigin="Anonymous",t.onerror=f,e?(t.onload=p.bind(null,t,i),t.src=e):setTimeout((function(){i(t)}),1)},l=r.cachedFlattened(t,a);l&&y.ReactRootUIConfig.isReactRoot()?o(l):r.getBase64OrWebUrl((function(t,a){if(t)f();else{a=a||"";var l=r.nestedHandle();l?function(t,a){e(a,(function(e){t?(e=new Image,t.match(/^data:/)?delete e.crossOrigin:e.crossOrigin="Anonymous",e.onerror=f,e.onload=p.bind(n,e,i),e.src=t):i(e)}))}(a,l):o(a)}}))}(this,(function(){try{y.ReactRootUIConfig.isReactRoot()?n._flattened[r]=d.toDataURL("image/png",1):n._flattened[r]=d.toDataURL("image/jpeg"),n.flushFlattenCallbacks(r,null,n._flattened[r])}catch(e){c.default.warnToDevConsole("unable to flatten composite image: ",e),n.flushFlattenCallbacks(r,null,n.resolve())}}))}}else setTimeout((function(){return n.flushFlattenCallbacks(r,null,"")}),1)}},{key:"toJSON",value:function(){var e=this.value(),t=l.default.clone(this.model);if(this.isDataHandle()&&e){var a=g.AppGlobals.AppModel.GetFromImageCache(this.id());a&&a===e||g.AppGlobals.AppModel.AddToImageCache(this.id(),e),t.cachedById=!0,t.value=u.default.hashCode(e)}return t}},{key:"toString",value:function(){return"Url"===this.type()&&this.value()||""}},{key:"toDebugString",value:function(){return JSON.stringify(this.model)}}],[{key:"from",value:function(t,a){return t instanceof e?(!t.tableName()&&a&&(t.model.tableName=a),t):t&&"object"===(0,o.default)(t)&&null!=t.id&&t.id in S?S[t.id]:new e(t,a)}},{key:"clearCache",value:function(){S={}}}]),e}();t.ImageHandle=A;var w=A;t.default=w},87786:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(654158)),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;(0,r.default)(this,e),this.tableRows=t,this._indexStore=a}return(0,i.default)(e,[{key:"indexStore",get:function(){var e;return null!==(e=this._indexStore)&&void 0!==e?e:this._indexStore=new Map}},{key:"push",value:function(e){this.tableRows.push(e)}},{key:"allRows",value:function(){return this.tableRows}},{key:"count",get:function(){return this.tableRows.length}},{key:"lookupAtomic",value:function(e,t){return e?this.getIndex(e).lookup(t).allRows():[]}},{key:"lookup",value:function(e){var t=this;if(!this.tableRows||!e.length)return null;if(e.map((function(e){return e.attribute})).filter((function(e){return!e||"List"===e.type()||"EnumList"===e.type()})).length)return null;var a=new WeakMap;if(e.forEach((function(e){a.set(e,t.getIndex(e.attribute).lookup(e.value))})),1===e.length)return a.get(e[0]).allRows();var n=o.default.sortBy(e,(function(e){return a.get(e).count}));return a.get(n[0]).lookup(n.slice(1))}},{key:"getIndex",value:function(e){var t=e.lowercaseName(),a=this.indexStore.get(t);return a||(a=new l.default(this.tableRows,e),this.indexStore.set(t,a)),a}}]),e}();t.default=u},306593:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Paging=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=function(){function e(t){(0,r.default)(this,e);for(var a=1,n=[],i={1:n},o={},l=0;l<t.length;l++){var u=t[l],s=t[l-1],c=t[l+1];if(u.isPageHeader()){var d=n.filter((function(e){return!e.isHidden()&&!e.isPageHeader()})),f=u.showContent(),p=u.description(),h=!(null!=f&&""!==f||null!=p&&""!==p||u.hasDisplayName()),v=s&&s.isPageHeader()||c&&c.isPageHeader();if(h&&v)continue;if(h&&!c)continue;if(!d.length){if(h)continue;if(1===a){n.unshift(u),o[u.name()]=a;continue}var m=n[0];if(!(null!=m.showContent()&&""!==m.showContent()||null!=m.description()&&""!==m.description())){n[0]=u,o[m.name()]=null,o[u.name()]=a;continue}}n=[u],i[++a]=n,o[u.name()]=a}else n.push(u),o[u.name()]=a}this.attributes=t,this.attributesByPage=i,this.pagesByAttribute=o}return(0,i.default)(e,[{key:"formPageCount",get:function(){return o.default.keys(this.attributesByPage).length}},{key:"rowStateColumnNames",get:function(){return this.attributes.map((function(e){return e.name()}))}},{key:"pageHeader",value:function(e){return this.attributesOnPage(e).filter((function(e){return e.isPageHeader()}))[0]}},{key:"attributesOnPage",value:function(e){return this.attributesByPage[e]||[]}},{key:"onPage",value:function(e){return this.pagesByAttribute[e]}}]),e}();t.Paging=l},455127:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=a(166089),l=function(){function e(t){(0,r.default)(this,e),this.uiController=t,this.totalBigSteps=4,this.totalQueued=0,this.remainingQueued=0,this.completedSteps={},this.errorCount=0,this.intervalTimerCount=0,this.completeCount=1,this.errors=[]}return(0,i.default)(e,[{key:"disable",value:function(){this.clearIntervalTimer(),this.disabled=!0}},{key:"start",value:function(e){this.uiController.onStart(e)}},{key:"updateProgress",value:function(e){this.disabled||this.uiController.onProgress(e)}},{key:"finish",value:function(){this.disabled||(this.disable(),this.uiController.onFinish())}},{key:"raiseWarning",value:function(e){this.uiController.onWarning(e)}},{key:"getPlanInfo",value:function(){var e=o.AppGlobals.AppModel.AppTemplate,t=!1===e.HasValidPlan&&!e.IsPersonal&&!e.IsDeployable,a=e.PlanViolationLevel,n=e.OwnerId===o.AppGlobals.AppState.UserInformation.Id;return{violationLevel:a,upgradeNeeded:t,inTestMode:!e.IsDeployable&&!n}}},{key:"setSyncQueueStatus",value:function(e){var t,a;this.totalQueued=null!==(t=e.totalSteps)&&void 0!==t?t:0,this.remainingQueued=null!==(a=e.remainingSteps)&&void 0!==a?a:0,this.updateProgress(e)}},{key:"clearIntervalTimer",value:function(){null!=this.intervalHandle&&(clearInterval(this.intervalHandle),delete this.intervalHandle,this.intervalTimerCount=0)}},{key:"completeSection",value:function(e){var t=this;if(!this.disabled&&!this.completedSteps[e])if(this.completedSteps[e]=!0,this.completeCount++,this.updateProgress({step:e,percentDone:this.getCompletePercentage()}),this.checkFinished()){this.clearIntervalTimer();var a=this.getPlanInfo();(a.violationLevel||a.upgradeNeeded||a.inTestMode)&&this.raiseWarning(a),this.finish()}else this.clearIntervalTimer(),this.intervalHandle=setInterval((function(){t.intervalTimerCount++,t.updateProgress({percentDone:t.getCompletePercentage()}),t.intervalTimerCount>9&&t.clearIntervalTimer()}),3e3)}},{key:"raiseError",value:function(e){if(!this.disabled){var t=e instanceof Error?e.message:e;this.clearIntervalTimer(),this.errorCount++,this.errors.push(t),this.uiController.onError(t)}}},{key:"getErrors",value:function(){return this.errors[0]}},{key:"getCompletePercentage",value:function(){var e=this.totalQueued+this.totalBigSteps,t=1-(this.remainingQueued+this.totalBigSteps-this.completeCount)/e,a=this.intervalTimerCount;return a>=9&&(a=9),100*(t+=a/(10*e))}},{key:"checkFinished",value:function(){return this.totalBigSteps===this.completeCount}},{key:"setSyncingStatus",value:function(e){var t,a;this.disabled||null===(a=(t=this.uiController).onSyncingStatus)||void 0===a||a.call(t,e)}},{key:"closeDialog",value:function(){this.uiController.close()}}]),e}();t.default=l},494012:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.RowState=t.DynamicStateStore=void 0;var r=n(a(238416)),i=n(a(856690)),o=n(a(689728)),l=n(a(496486)),u=n(a(150198)),s=a(365914),c=a(166089),d=n(a(962553)),f=a(557310);function p(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var v=function(){function e(t,a,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];(0,i.default)(this,e),this.name=t,this.evalName=a,this.store=new Map,this.checkFn=n,this.dependencies=r}return(0,o.default)(e,[{key:"evalTree",value:function(e){return e.evalTreeLookup(this.evalName)}},{key:"tablesReferenced",value:function(e){return l.default.compact(l.default.flatMap(l.default.concat(this.dependencies,this),(function(t){return t.evalTree(e)&&t.evalTree(e).tablesReferenced()})))}},{key:"invalidate",value:function(t){var a,n=e.makeCacheKeyPrefix(t),r=e.makeCacheKey(t),i=p(this.store.keys());try{for(i.s();!(a=i.n()).done;){var o=a.value;(o===r||null!=n&&o.startsWith(n))&&this.store.delete(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"check",value:function(t,a){var n=e.makeCacheKey(t,a);if(this.store.has(n))return this.store.get(n);var r=this.checkFn(t,a);return this.store.set(n,r),r}}],[{key:"makeCacheKey",value:function(e,t){return f.ReactRootUIConfig.isReactRoot()?e.name()+(t?"/".concat(t):""):e.name()}},{key:"makeCacheKeyPrefix",value:function(e){return f.ReactRootUIConfig.isReactRoot()?e.name()+"/":null}}]),e}();t.DynamicStateStore=v;var m=function(){function e(t,a,n,r){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};(0,i.default)(this,e),this._checkValidOptions=function(e,t){if(e.isValidityEnum()){var a=e.validIfEvalTree().getInConditionListInformation(o.dataContext.augmentWithViewContext(t)),n=a.values;return a.elementAttribute.valuesToWireFormat(n)}return null},this._checkSuggestedValues=function(e,t){return e.hasSuggestedValues()?e.valuesToWireFormat(e.suggestedValuesEvalTree().run(o.dataContext.augmentWithViewContext(t))):null},this._checkShowContent=function(e,t){if(e.isShowType()){var a=e.evalTreeLookup("ShowContent");if(a){var n=a.run(o.dataContext.augmentWithViewContext(t));return n=e.coerceValue(n,a.resultType(),a.resultTypeQualifier()),n=e.valueToWireFormat(n),e.localizeWireValue(n)}return e.auxData().Content||null}return null},this._checkDisplayName=function(e,t){return e.displayName(o.dataContext.augmentWithViewContext(t))},this._checkHidden=function(e,t){var a,n,r,i=o.value(e),s=e.isReverseDependentRef(),c=o.pendingFormState(),f=null===(r=null===(n=null===(a=null===window||void 0===window?void 0:window.AppState)||void 0===a?void 0:a.CurrentUIState)||void 0===n?void 0:n.FormUIState)||void 0===r?void 0:r.DefaultValues,p=Array.isArray(f)&&f.length>1;if(c||p){if(e.isVirtual()&&e.isKey())return!0;if(e.isSys()&&!s)return!0;if(p){if(e.isKey())return!0;if(l.default.includes(l.default.keys(f[0]),e.name()))return!0}}if(!e.isShowType()&&!u.default.valueExists(i,e.type())&&(!o.isEditable(e,t)||!o.appModel.allowScanOverride()&&(e.isScannable()||e.isNfcScannable())&&!e.shouldShowScannerButtons())){if(!s)return!0;if(p)return!0;var h=o.appModel.findTableCollection(e.nestedAttribute().referencedTableName()).table;if(!h||!h.allowsAdd(o.appModel))return!0}if(o.isEditable(e,t)&&e.isValidityEnum()){var v=o.validOptions(e,t);if(null==v||0===v.length){var m=e.referencedTableName();if(null==m)return!0;var g=d.default.findByName(m,o.appModel).table;if(null==g||!g.allowsAdd(o.appModel))return!0}}if(c||p||o.appModel.appTemplate.respectShowIf){var y=e.showIfEvalTree();if(y){var b=o.dataContext;return e.isPageHeader()&&o.getVisitedDataContext&&(b=o.getVisitedDataContext()||o.dataContext),!y.run(b.augmentWithViewContext(t))}}return!!e.isHidden()},this._checkValid=function(e,t){var a=e.validIfEvalTree(),n=o.value(e);if(e.isShowType())return!0;if(!u.default.valueExists(n,e.type())||n===u.default.SHEET_FORMULA_NEEDS_RECOMPUTE)return!0;if(o.isHidden(e,t))return!0;var r=o.paging.onPage(e.name()),i=o.paging.pageHeader(r);return!(!o.includes(i)||!o.isHiddenPage(i,t))||!(a&&!a.run(o.dataContext.augmentWithViewContext(t)))&&e.validateValue(n)},this._checkRequired=function(e,t){if(e.isKey())return!0;if(o.isHidden(e,t))return!1;if(e.isShowType())return!1;var a=o.paging.onPage(e.name()),n=o.paging.pageHeader(a);if(o.includes(n)&&o.isHiddenPage(n,t))return!1;var r=e.requiredIfEvalTree();return r?!!r.run(o.dataContext.augmentWithViewContext(t)):!!e.isRequired()},this._checkEditable=function(e,t){if(!1===o.table.allowsUpdate(o.appModel)&&!o.isNewRow)return!1;if(!1===o.table.allowsAdd(o.appModel)&&o.isNewRow)return!1;if(o.editableColumnAllowlist&&!l.default.includes(o.editableColumnAllowlist,e.name()))return!1;if(o.editableColumnDenylist&&l.default.includes(o.editableColumnDenylist,e.name()))return!1;if(null!=e.firstNestedRef()&&o.stableId&&o.appModel.dataManager.currentTransaction.hasStableReverseRef({tableName:o.table.rootName(),stableId:o.stableId,refColumnName:e.name()}))return!1;if(e.isReadOnly()||e.hasAppFormula()||e.hasFormula()||e.isShowType()||e.isChangeTriggered())return!1;if(!o.isNewRow&&(e.isKey()||o.tableSchema.isKeyComponent(e)))return!1;var a=e.editableIfEvalTree();return!a||!!a.run(o.dataContext.augmentWithViewContext(t))},this.appModel=t,this.table=a,this.tableSchema=a.tableSchema,this.view=c.view,this.dataContext=n,this.getVisitedDataContext=c.getVisitedDataContext,this.rowKey=r,this.stableId=c.stableId,this.stateAttributes=s,this.editableColumnAllowlist=c.editableColumnAllowlist,this.editableColumnDenylist=c.editableColumnDenylist,this.rowStatePaging=c.paging;var f=new v("displayName","DisplayName",this._checkDisplayName),p=new v("showContent","ShowContent",this._checkShowContent),h=new v("validOptions","Valid_If_AppEval",this._checkValidOptions),m=new v("suggestedValues","Suggested_Values",this._checkSuggestedValues),g=new v("isEditable","Editable_If_AppEval",this._checkEditable),y=new v("isHidden","Show_If_AppEval",this._checkHidden,[g,h]),b=new v("isValid","Valid_If_AppEval",this._checkValid,[y]),T=new v("isRequired","Required_If_AppEval",this._checkRequired,[y]),S={displayName:f,showContent:p,validOptions:h,suggestedValues:m,isEditable:g,isHidden:y,isValid:b,isRequired:T};this.stateStores=S}return(0,o.default)(e,[{key:"displayName",value:function(e,t){return this.stateStores.displayName.check(e,t)}},{key:"showContent",value:function(e,t){return this.stateStores.showContent.check(e,t)}},{key:"validOptions",value:function(e,t){return this.stateStores.validOptions.check(e,t)}},{key:"suggestedValues",value:function(e,t){return this.stateStores.suggestedValues.check(e,t)}},{key:"isEditable",value:function(e,t){return this.stateStores.isEditable.check(e,t)}},{key:"isHidden",value:function(e,t){return this.stateStores.isHidden.check(e,t)}},{key:"isValid",value:function(e,t){return this.stateStores.isValid.check(e,t)}},{key:"isRequired",value:function(e,t){return this.stateStores.isRequired.check(e,t)}},{key:"isNewRow",get:function(){return null==this.rowKey}},{key:"paging",get:function(){var e;return this.rowStatePaging||(null===(e=this.view)||void 0===e?void 0:e.paging)||this.tableSchema.paging}},{key:"values",value:function(){return this.dataContext.rowData}},{key:"value",value:function(e){return"string"!=typeof e&&(e=e.name()),this.dataContext.getValue(e)}},{key:"onDataChange",value:function(e){var t=this;this.stateStores&&l.default.values(this.stateStores).forEach((function(a){t.stateAttributes.forEach((function(t){var n=a.tablesReferenced(t);l.default.includes(n,e.tableName)&&a.invalidate(t)}))}))}},{key:"updateAndValidate",value:function(t,a,n){if("string"==typeof t&&(t=this.tableSchema.findAttributeByName(t)),t){var i=l.default.clone(this.values()),o=this.validateSave({viewStateKey:n}).errorState;this.dataContext.setValue(t.name(),a);var u={initialData:i,noAsync:!0};(t.resetsEachUpdate()||t.hasResetExpression())&&(u.skipTheseDefaults=(0,r.default)({},t.name(),!0)),this.dataContext.recomputeAppFormulas(u),this.refreshState();var s=this.validateSave({viewStateKey:n}).errorState;return e.changeInvalidatesRow(t,o,s)}return null}},{key:"includes",value:function(e){return l.default.includes(this.stateAttributes,e)}},{key:"id",get:function(){var e;return null!==(e=this.stableId)&&void 0!==e?e:this.value(this.tableSchema.keyAttribute())}},{key:"refreshState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stateAttributes;l.default.values(this.stateStores).forEach((function(t){e.forEach((function(e){t.invalidate(e)}))}))}},{key:"getErrorState",value:function(){var e,t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stateAttributes,n=arguments.length>1?arguments[1]:void 0,r=l.default.clone(this.values()),i=function(e){return e.map((function(e){return e.name()}))},o=function(e){return null==r[e.name()]||""===r[e.name()]},u=function(e){return e.isKey()||t.tableSchema.isKeyComponent(e)},s=i(a.filter((function(e){return!t.isValid(e,n)}))),c=i(a.filter((function(e){return o(e)&&t.isRequired(e,n)}))),d=l.default.uniq(l.default.concat(s,c).map((function(e){return t.paging.onPage(e)}))),f=d.length>0,p=a.filter((function(e){return o(e)&&u(e)&&t.isHidden(e,n)}));return p.length&&(e="Key field '".concat(p[0].name(),"' cannot be blank")),{error:f,message:e,invalid:s,missingRequired:c,pages:d,rowValues:r}}},{key:"validateSave",value:function(e){var t,a,n,r=void 0===e?{}:e,i=r.enforceStableKey,o=void 0!==i&&i,s=r.usedTransactions,c=void 0!==s&&s,d=r.transaction,f=r.viewStateKey,p=void 0===f?null===(t=null==d?void 0:d.owningViewState)||void 0===t?void 0:t.viewStateKey:f,h=this.values(),v=this.tableSchema.keyAttribute(),m=v.name(),g=this.rowKey;n=(a=this.getErrorState(void 0,p)).pages,a.error||(a=null,n=null);var y=h[m];if(u.default.valueExists(y,v.type())||(a={error:!0,message:"Key field '".concat(m,"' is required"),pages:n}),this.isNewRow){var b=c?1:0;this.table.rootTable().lookupTableRows(m,y,d).length>b&&(a={error:!0,message:"There is already a row with the key: '".concat(y,"'"),pages:n})}else y!==g&&(this.tableSchema.keyAttribute().isVirtual()&&l.default.trim(y)===l.default.trim(g)||(o?a={error:!0,message:"The key of an existing row cannot be changed",pages:n}:y=g));return{errorState:a,newRowKey:y}}},{key:"pendingFormState",value:function(){var e;return this.dataContext.formState||(null===(e=c.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)}},{key:"isHiddenPage",value:function(e,t){return!(!e.isPageHeader()||!this.isHidden(e,t)||null==e.showIfEvalTree())}}],[{key:"diffErrorState",value:function(e,t){var a,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.checkValueChange,o=void 0===i||i,u=r.wasReset,c=void 0===u?{}:u;if(!t||!t.error)return null;e=e||{};var d=new s.NestedStore;if(t.message&&t.message!==e.message&&d.store("message",t.message),null!=t.invalid)for(var f=0;f<t.invalid.length;f++){var p=t.invalid[f],h=null===(a=e.rowValues)||void 0===a?void 0:a[p],v=null===(n=t.rowValues)||void 0===n?void 0:n[p];(null==e||!l.default.includes(e.invalid,p)||o&&h!==v)&&d.push("invalid",p)}if(t.missingRequired)for(var m=0;m<t.missingRequired.length;m++){var g=t.missingRequired[m];null!=e&&l.default.includes(e.missingRequired,g)?o&&c[g]&&d.push("missingRequired",g):d.push("missingRequired",g)}return d.isEmpty()?null:d.toSimpleObject()}},{key:"changesInvalidateRow",value:function(e,t){var a;if(!t||!t.error)return null;if(e=e||{},t.message&&t.message!==e.message)return{message:t.message};if(null!=t.invalid)for(var n=0;n<t.invalid.length;n++){var r=t.invalid[n],i=null===(a=e.rowValues)||void 0===a?void 0:a[r],o=t.rowValues[r];if(!l.default.includes(e.invalid,r)||i!==o)return{attribute:r,reason:"invalid"}}if(t.missingRequired)for(var u=0;u<t.missingRequired.length;u++){var s=t.missingRequired[u];if(!l.default.includes(e.missingRequired,s))return{attribute:s,reason:"blank and required"}}return null}},{key:"changeInvalidatesRow",value:function(t,a,n){return n&&n.error?l.default.includes(n.invalid,t.name())?{attribute:t.name(),reason:"invalid"}:l.default.includes(n.missingRequired,t.name())?{attribute:t.name(),reason:"blank and required"}:e.changesInvalidateRow(a,n):null}}]),e}();t.RowState=m;var g=m;t.default=g},69411:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(856690)),o=n(a(689728)),l=a(166089),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(21870));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}var c=function(){function e(){var t=this;(0,i.default)(this,e),this.close=function(){l.AppGlobals.ViewManager.ShowingInfoPage()&&"none"!==$("#InfoPage #LaunchScreen").css("display")&&l.AppGlobals.ViewManager.HideInfoPage((function(){$("#InfoPage").hasClass("ActivePage")||t.launchScreen.hide()}))}}return(0,o.default)(e,[{key:"launchScreen",get:function(){return $("#LaunchScreen")}},{key:"onStart",value:function(){u.default.syncState.ui===u.SyncUI.Blocking&&l.AppGlobals.ViewManager.ShowLaunchScreen()}},{key:"onProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.totalSteps,a=e.remainingSteps,n=e.step,r=e.percentDone;if(void 0!==t){var i=l.AppGlobals.AppModel.MapActionName("Saving changes"),o=l.AppGlobals.AppModel.MapActionName("Syncing...");null!=a&&null!=t&&(i="".concat(i," (").concat(t-a+1,"/").concat(t,")"));var u=a&&a>0?i:o;this.launchScreen.find(".SyncingStatusLabel .LoadingStatusLabelMain").text(u)}r&&this.launchScreen.find(".LoadingStatus .bar").css("width",r+"%"),n&&this.launchScreen.find(".LoadStatusDiv .Loaded"+n).removeClass("LoadingState").addClass("LoadedState")}},{key:"onFinish",value:function(){$("#LaunchScreen .AppBlockedMode").hide(),this.closeDataLoadModalTimeout=setTimeout(this.close,0)}},{key:"onWarning",value:function(e){var t=e.violationLevel,a=e.upgradeNeeded,n=e.inTestMode,r=e.message;t||a||n||r&&this.launchScreen.find(".ErrorMessage").show().append($("<p />").text(r))}},{key:"onError",value:function(e){if(e&&"function"==typeof e.indexOf&&0===e.indexOf("__:")&&(e=e.slice(3,e.length)),this.launchScreen.find(" .LoadStatusDiv .LoadingState").removeClass("LoadingState").addClass("ErrorState"),this.launchScreen.find(".LoadingStatus").hide(),this.launchScreen.find(".btn").prop("disabled",!1),"abort"!==e){var t=this.launchScreen.find(".ErrorMessage");e.split("\n").forEach((function(e){return t.append($("<p />").text(e))})),t.show(),this.launchScreen.find(".SyncingStatusLabel").hide(),this.launchScreen.find(".aspinner").hide()}}},{key:"onSyncingStatus",value:function(e){this.launchScreen.find(".LoadingFromCacheStatusLabel").toggle(!e),this.launchScreen.find(".SyncingStatusLabel").toggle(e),e&&(this.launchScreen.find(".LoadingStatus").show(),this.launchScreen.find(".CancelButton").toggle(!0))}}]),e}();t.default=c},962553:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(627424)),o=n(a(600861)),l=n(a(856690)),u=n(a(689728)),s=n(a(496486)),c=n(a(65706)),d=R(a(365914)),f=n(a(674823)),p=n(a(385857)),h=R(a(888861)),v=n(a(389549)),m=n(a(87786)),g=n(a(450513)),y=a(417751),b=a(959191),T=a(166089),S=a(149313),A=a(354632),w=a(44617),C=a(557310),E=a(714067);function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(k=function(e){return e?a:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=k(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}function I(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var M=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},N=function(){function e(t,a,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Set,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Set,f=arguments.length>7?arguments[7]:void 0;(0,l.default)(this,e),this.tableName=t,this.transactionId=a,this.keyAttribute=n,this.createdRows=i,this.updatedRows=u,this.deletedRows=s,this.pendingRows=c,this._indexedRows=f,this.getMergedRows=function(e,t,a,n){var i=(0,o.default)(e);return r.mergeIntoRows(i,t,a,n),i},this.mergeIntoRows=function(e,t,a,n){var i,o=I(r.pendingRows.values());try{for(o.s();!(i=o.n()).done;){var l=i.value;t&&l.values===t.rowData||(null!=a&&!a.includes(l)||null!=n&&!n.run(l.dataContext)?(0,d.remove)(e,l.shadowing):(0,d.addOrReplace)(e,l,l.shadowing))}}catch(e){o.e(e)}finally{o.f()}var u,s=I(r.deletedRows);try{for(s.s();!(u=s.n()).done;){var c=u.value;(0,d.remove)(e,c)}}catch(e){s.e(e)}finally{s.f()}}}return(0,u.default)(e,[{key:"hasChanges",get:function(){return this.pendingRows.size>0||this.deletedRows.size>0}},{key:"indexedRows",get:function(){var e;return null!==(e=this._indexedRows)&&void 0!==e?e:this._indexedRows=new m.default(Array.from(this.pendingRows))}},{key:"onDataChange",value:function(e){delete this._indexedRows}},{key:"addCreatedRow",value:function(e){this.createdRows.set(e.stableId,e),this.pendingRows.add(e),this.onDataChange()}},{key:"getShadowCopy",value:function(e){if(this.pendingRows.has(e))return e;var t=this.updatedRows.get(e.stableId);if(t)return t;var a=e.copy();return a.shadowing=e,this.updatedRows.set(e.stableId,a),this.pendingRows.add(a),this.onDataChange(),a}},{key:"markForDeletion",value:function(e){var t,a=null!==(t=e.shadowing)&&void 0!==t?t:e;this.deletedRows.add(a),this.createdRows.delete(e.stableId),this.updatedRows.delete(e.stableId),this.pendingRows.delete(e),this.onDataChange()}}]),e}(),_=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new WeakMap;(0,l.default)(this,e),this.tableName=t,this.keyAttribute=a,this.store=n}return(0,u.default)(e,[{key:"forTransaction",value:function(e){var t=this.store.get(e);return null==t&&(t=new N(this.tableName,e.id,this.keyAttribute),this.store.set(e,t)),t}}]),e}(),D=function(){function e(t,a,n,r,i){var o,u,f=this;(0,l.default)(this,e),this._updateModeUnmemoized=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.AppGlobals.AppModel,a=f.updateModeEvalTree();if(a){var n=String(a.run(t.dataContext()));return n in y.UpdateModeEnum?y.UpdateModeEnum[n]:y.UpdateModeEnum.READ_ONLY}var r=null!==(e=f.sliceDefinition)&&void 0!==e?e:f.tableDefinition,i=r.UpdateMode;return i},this.appModel=i||T.AppGlobals.AppModel,this.table=this.model=t,this.tableSchema=a,this.tableDefinition=n,this._rootTable=r,t.IsSlice||(this._pendingChanges=new _(this.name(),a.keyAttribute()),this._tableRows=s.default.map(t.Rows,(function(e){return new v.default(e,f)})),this._formatting=new g.default(t.Name,this.appModel),this._indexedTableRowsByName=new Map);this.queryMemoized=(0,c.default)({limit:15,makeKey:function(e){return e.filterExpr&&!e.filterExpr.isPure()?null:(e=(0,d.stripEmptyItems)(e),String(d.default.hashCode(JSON.stringify(e))))},getTimestamp:function(e){var t,a=e.transaction,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.appModel;if(a){var r=null!==(t=a.lastModifiedTimestamp)&&void 0!==t?t:0;return Math.max(f.timestamp(n),r)}return f.timestamp(n)},fn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.appModel,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.default(f.appModel,f.tableSchema),n=e.transaction;return f._queryCompatibility(e,t,a.augmentWithTransaction(n))}});var h=null===(u=null===(o=n.ExprLookup)||void 0===o?void 0:o.UpdateMode)||void 0===u?void 0:u.IsPure;this.updateMode=h?(0,c.default)({limit:2,makeKey:function(e){return(0,S.$TSFixMeMaybeNull)(e),e.DataStamp},getTimestamp:function(e){return f.timestamp(e)},fn:this._updateModeUnmemoized}):this._updateModeUnmemoized,this.indexedTableRows=function(){var e=f.rootTable()._indexedTableRowsByName,t=e.get(f.name());return null==t&&(t=new m.default(f.rows()),e.set(f.name(),t)),t}}return(0,u.default)(e,[{key:"pendingChanges",get:function(){return this.rootTable()._pendingChanges}},{key:"isUserSettingsTable",get:function(){return this.name()===E.userSettingsTableName}},{key:"queryRowValues",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!0,groupBy:void 0}),t,a)}},{key:"queryRows",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!1,groupBy:void 0}),t,a)}},{key:"queryRowValuesAsync",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!0,groupBy:void 0}),t,a)}},{key:"queryRowsAsync",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!1,groupBy:void 0}),t,a)}},{key:"queryRowValuesGroupBy",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!0}),t,a)}},{key:"queryRowsGroupBy",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!1}),t,a)}},{key:"queryRowValuesGroupByAsync",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!0}),t,a)}},{key:"queryRowsGroupByAsync",value:function(e,t,a){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!1}),t,a)}},{key:"formatting",get:function(){return this.isSlice()?this.rootTable().formatting:this._formatting}},{key:"sliceDefinition",get:function(){return this.tableSchema.sliceDefinition}},{key:"labelTextForId",value:function(e,t){var a=this.lookupTableRow(e,t);if(a){var n=this.tableSchema.labelBasicAttribute();if(n)return a.get(n.name())}return e}},{key:"timestamp",value:function(e){return(e=e||this.appModel)?s.default.max([this.rootTable().ownTimestamp,e.dataStampTime()]):0}},{key:"rootName",value:function(){return this.rootTable().name()}},{key:"rootTable",value:function(){return this.model.IsSlice?this._rootTable:this}},{key:"rowLabelValue",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.dataContext){var n=this.keyAttribute().name();t=a.dataContext.getTableRow(this,e,{keyAttrName:n})}else t=this.findRow(e);if(t){var r=this.tableSchema.labelAttributes(),i=r.map((function(e){return t[e.name()]})).join(" ");return i}return e}},{key:"isSlice",value:function(){return this.model.IsSlice}},{key:"sliceFilterEvalTree",value:function(){var e,t;if(void 0===this._sliceFilterEvalTree){var a=null===(t=null===(e=null==this?void 0:this.tableSchema)||void 0===e?void 0:e.sliceDefinition)||void 0===t?void 0:t.FilterEvaluatable;this._sliceFilterEvalTree=a?h.default.create(a):null}return this._sliceFilterEvalTree}},{key:"keyLabelMap",value:function(e,t){var a=this;e=e||this.appModel,t=t||new p.default(e,this.tableSchema);var n=this.tableSchema.findAttributeIndex(this.keyAttribute().name()),r=t.getTableColumnSet(this.rootName(),n),i=this.tableSchema.labelBasicAttribute()||this.tableSchema.keyAttribute(),o=this.tableSchema.findAttributeIndex(i.name()),l=t.getTableColumnSet(this.rootName(),o);return t.pendingRowsForTable(this.name()).forEach((function(e){var t=e.rowData[a.keyAttribute().name()],n=e.rowData[i.name()];t&&(r.push(t),l.push(n||""))})),s.default.zipObject(r,l)}},{key:"deleteRow",value:function(e){if(this.isSlice())return this.rootTable().deleteRow(e);var t=this.keyAttribute().name(),a=this.rows().find((function(a){return a.get(t)===e}));if(a){var n=a.snapshot(),r=a.keyAttribute.name(),i=a.keyValue,o=function(e){return e[r]===i};return s.default.remove(this.model.Rows,o),s.default.remove(this._tableRows,(function(e){return o(e.values)})),this.onDataChange(),n}return null}},{key:"deleteRowByStableId",value:function(t,a){if(this.isSlice())this.rootTable().deleteRowByStableId(t,a);else if(a&&e.usePendingChangesStore){var n=this.lookupTableRow(t,a);n&&this.pendingChanges.forTransaction(a).markForDeletion(n)}else{var r=this.rows().findIndex((function(e){return e.stableId===t}));r>-1&&(this.model.Rows.splice(r,1),this._tableRows.splice(r,1),this.onDataChange())}}},{key:"createRow",value:function(t,a){if(this.isSlice())return this.rootTable().createRow(t,a);var n=new v.default(t,this);return a&&e.usePendingChangesStore?this.pendingChanges.forTransaction(a).addCreatedRow(n):(this.model.Rows.push(t),this._tableRows.push(n),this.onDataChange()),t}},{key:"replaceRow",value:function(e){var t=this.lookupTableRow(e[this.keyAttribute().name()]);if(t){var a=this._tableRows.indexOf(t),n=this.table.Rows.indexOf(t.values),r=new v.default(e,this);this._tableRows[a]=r,this.table.Rows[n]=e,this.onDataChange()}}},{key:"resetRowValues",value:function(e,t,a){if(this.isSlice())return this.rootTable().resetRowValues(e,t,a);var n=this.keyAttribute().name(),r=this.rows().find((function(t){return t.get(n)===e}));return r?(r.resetValues(t),this.onDataChange(),r):null}},{key:"createNewRow",value:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isSlice())return this.rootTable().createNewRow(a);var n=this.tableSchema.getDefaultValues(a.initialValues),r=a.transaction,i=s.default.clone(n)||{},o=new p.default(this.appModel,this.tableSchema,i).augmentWithTransaction(r),l={considered:{},computed:{},computeDefaults:!0,skipTheseDefaults:n,skipChangeTriggers:!0,getAsyncCallback:this.getAsyncCallback,nowDate:new Date,onDynamicValueChanged:a.onDynamicValueChanged};this.tableSchema.allBaseTableAttributes().forEach((function(e){var a=e.name(),n=i[a];if("_RowNumber"===a){var u=(s.default.max(t.rootTable().rows({transaction:r}).map((function(e){return Number(e.get("_RowNumber"))})))||1)+1;i[a]=e.valueToWireFormat(u)}else e.isDynamic()?o.recomputeAttribute(e,l):null==n&&(i[a]="")}));var u=new v.default(i,this,{stableId:d.default.makeGuid()});return r&&e.usePendingChangesStore?this.pendingChanges.forTransaction(r).addCreatedRow(u):(this._tableRows.push(u),this.model.Rows.push(i),this.onDataChange()),u}},{key:"getPendingRow",value:function(t,a){return this.isSlice()?this.rootTable().getPendingRow(t,a):e.usePendingChangesStore?this.pendingChanges.forTransaction(a).getShadowCopy(t):t}},{key:"commitPendingChanges",value:function(e){if(this.isSlice())this.rootTable().commitPendingChanges(e);else if(!e.closed){var t=this.pendingChanges.forTransaction(e);t.hasChanges&&(this._tableRows=t.getMergedRows(this._tableRows),this.model.Rows=this._tableRows.map((function(e){return e.values})),this.onDataChange())}}},{key:"rowValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appModel,a=void 0===t?this.appModel:t;return this.rows({appModel:a}).map((function(e){return e.values}))}},{key:"rows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appModel,a=void 0===t?this.appModel:t,n=e.transaction,r=e.dataContext;if(!a)return[];if(this.isSlice()){var i=this.sliceFilterEvalTree();return this.rootTable().queryRows({filterExpr:i||void 0,transaction:n})}return n?this.pendingChanges.forTransaction(n).getMergedRows(this._tableRows,r):s.default.clone(this._tableRows)}},{key:"filteredRowValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.appModel,a=arguments.length>2?arguments[2]:void 0;return this.filteredRows(e,t,a).map((function(e){return e.values}))}},{key:"filteredRows",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.filterExpr,n=t.filterDefaults,r=void 0===n?[]:n,l=t.transaction,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.appModel,c=arguments.length>2?arguments[2]:void 0;if(!u)return[];var d=performance.now(),f=w.dynamicRollouts.includeByOwnerId("ClientExpressionPerformance")?"true":"false",m=new p.default(u,this.tableSchema).augmentWithTransaction(l),g=null==a?void 0:a.curry(m);if(g&&"CONSTANT"===g.evalType()&&"Yes/No"===g.resultType()&&"N"===g.constantValue())return A.filterTimeMetric.record(performance.now()-d,{InRollout:f}),[];var y,S=this.rootTable(),C=S.tableSchema,E=(0,h.getFilterDefaultsAndFullyMapped)(g),k=(0,i.default)(E,2),R=k[0],I=k[1],O=(0,b.filterDefaultsToIndexLookup)(r,C),M=(0,b.filterDefaultsToIndexLookup)(R,C),N=O.concat(M),_=this.indexedTableRows().lookup(N);if(_){if(y=_,l){var D=this.pendingChanges.forTransaction(l),L=D.hasChanges,P=D.getMergedRows,x=D.indexedRows;if(L){var F=x.lookup(N);y=P(_,c,F,this.sliceFilterEvalTree())}}}else y=this.rows({appModel:u,transaction:l});if(r.length&&null==_){var G=s.default.compact(O.map((function(e){var t=e.attribute,a=e.value;return h.default.createColFilter(a,C,t)})).concat(g));g=1===G.length?G[0]:h.default.createAnd.apply(h.default,(0,o.default)(G))}if(g&&(!_||!I)){var V={noCache:!0};y=y.filter((function(e){return m.replaceRowData(e.values),g.run(m,V)}))}if(c){var B=c.pendingRowsForTable(this.name());if(null==B?void 0:B.length){var U=T.AppGlobals.AppState.pendingFormState||c.formState;U&&(B=B.filter((function(t){var n,r=t.tempId!==U.tempId,i=s.default.compact([a]);if(N){var l=N.map((function(t){var a=t.attribute,n=t.value;return h.default.createColFilter(n,e.tableSchema,a)}));i=s.default.concat(i,l)}return i.length>1?n=h.default.createAnd.apply(h.default,(0,o.default)(i)):1===i.length&&(n=i[0]),n&&(m.replaceRowData(t.rowData),r=r&&n.run(m)),r}))),B=B.map((function(t){return new v.default(t.rowData,e)})),y=s.default.uniqBy(B.concat(y),(function(t){return t.get(e.keyAttribute().name())}))}}return A.filterTimeMetric.record(performance.now()-d,{InRollout:f}),y}},{key:"findRow",value:function(e){var t;return null===(t=this.lookupTableRow(e))||void 0===t?void 0:t.values}},{key:"isPendingDeletion",value:function(e,t){return this.pendingChanges.forTransaction(t).deletedRows.has(e)}},{key:"lookupTableRow",value:function(t,a){var n;if(null!=t)return e.usePendingChangesStore?this.lookupTableRows(this.keyAttribute().name(),t,a)[0]:null!==(n=this.appModel.dataManager.findPendingRow(t))&&void 0!==n?n:this.indexedTableRows().lookupAtomic(this.keyAttribute(),t)[0]}},{key:"lookupTableRowsByIndexLookup",value:function(t,a,n){var r=this.indexedTableRows().lookup(t);if(r&&a&&e.usePendingChangesStore){var i=this.pendingChanges.forTransaction(a),o=i.hasChanges,l=i.indexedRows,u=i.getMergedRows;if(o)return u(r,n,l.lookup(t),this.sliceFilterEvalTree())}return r}},{key:"lookupTableRowsByLookupValues",value:function(e,t,a){var n=(0,b.lookupValuesToIndexLookup)(e,this.tableSchema);return this.lookupTableRowsByIndexLookup(n,t,a)}},{key:"lookupTableRows",value:function(t,a,n,r){var i=this.rootTable().tableSchema.findAttributeByName(t),o=this.indexedTableRows().lookupAtomic(i,a);if(n&&e.usePendingChangesStore){var l=this.pendingChanges.forTransaction(n),u=l.hasChanges,s=l.createdRows,c=l.indexedRows,d=l.getMergedRows;if(u){var f=s.get(a);return d(o,r,f?[f]:c.lookupAtomic(i,a),this.sliceFilterEvalTree())}}return o}},{key:"keyAttribute",value:function(){return this.tableSchema.keyAttribute()}},{key:"hasUniqueComputedKey",value:function(){return function e(t){return null!=t&&("UNIQUEID"===t.functionName()||"CONCATENATE"===t.functionName()&&s.default.some(t.children,e))}(this.keyAttribute().defaultExpressionEvalTree())}},{key:"name",value:function(){return this.model.Name}},{key:"imageAttrName",value:function(){var e;return this.isSlice()?this.rootTable().imageAttrName():null===(e=this.tableSchema.imageAttributesByImportance()[0])||void 0===e?void 0:e.name()}},{key:"updateModeEvalTree",value:function(){var e;if(void 0===this._updateModeEvalTree){var t=(null!==(e=this.sliceDefinition)&&void 0!==e?e:this.tableDefinition).ExprLookup;(null==t?void 0:t.UpdateMode)?this._updateModeEvalTree=h.default.create(t.UpdateMode):this._updateModeEvalTree=null}return this._updateModeEvalTree}},{key:"allowsUpdate",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.UPDATES_ONLY)>0;if(t&&this.isSlice()){var a=this.rootTable();a&&(t=a.allowsUpdate(e))}return t}},{key:"allowsAdd",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.ADDS_ONLY)>0;if(t&&this.isSlice()){var a=this.rootTable();a&&(t=a.allowsAdd(e))}return t}},{key:"allowsDelete",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.DELETES_ONLY)>0;if(t&&this.isSlice()){var a=this.rootTable();a&&(t=a.allowsDelete(e))}return t}},{key:"_queryCompatibility",value:function(e,t,a){var n=e.valuesOnly,r=void 0===n||n,i=e.doAsync,o=void 0!==i&&i,l=M(e,["valuesOnly","doAsync"]),u=(0,d.stripEmptyItems)(l),c=this._query(u,t,a),f=l.groupBy;if(r||void 0===r){var p=c.map((function(e){return e.values}));if(null!=f){var h=d.default.getGroupByMap(p,f);return o?Promise.resolve(h):h}return o?Promise.resolve(p):p}if(null!=f){var v=s.default.groupBy(c,(function(e){return e.get(f)}));return o?Promise.resolve(v):v}return o?Promise.resolve(c):c}},{key:"_query",value:function(e,t,a){var n,r=e.filterExpr,i=e.filterDefaults,o=e.sortRules,l=e.searchQuery,u=e.transaction,c=M(e,["filterExpr","filterDefaults","sortRules","searchQuery","transaction"]);if(s.default.isEmpty(c))return null==l?(n=this.filteredRows({filterExpr:r,filterDefaults:i,transaction:u},t,a),this.tableSchema.sortTableRows(n,o)):(n=this.queryRows({filterExpr:r,filterDefaults:i,sortRules:o,transaction:u},t,a),this.evaluateSearch(n,l,t));n=this.queryRows({filterExpr:r,filterDefaults:i,sortRules:o,searchQuery:l,transaction:u},t,a);var d=c.limit,f=c.uniqueBy;return f&&(n=s.default.uniqBy(n,(function(e){var t=e.get(f);return(null==t?void 0:t.toString)?t.toString().toLowerCase():t}))),d&&(n=n.slice(0,d)),n}},{key:"evaluateSearch",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.appModel,r=(0,f.default)(t).toLowerCase().trim(),i=this.tableSchema.searchableAttributes().filter((function(e){return"Ref"===e.type()})),o={};i.forEach((function(e){if(!o[e.referencedTableName()]){var t=n.findTableCollection(e.referencedTableName()),a=t.table,r=t.tableSchema;a&&r&&(o[a.name()]=a.keyLabelMap(n))}}));var l=new p.default(n,this.tableSchema),u=performance.now();e=e.filter((function(e){return l.replaceRowData(e.values),a.tableSchema.searchMatchesRow(e.values,r,o,l)}));var s=performance.now()-u;return A.searchTimeMetric.record(s),e}},{key:"onDataChange",value:function(t,a){var n,r=this;this.isSlice()&&this.rootTable().onDataChange(t,a),null!=t&&C.ReactRootUIConfig.isReactRoot()&&!t.find((function(e){return e.rootTableName===r.rootName()}))||(null===(n=this._indexedTableRowsByName)||void 0===n||n.clear(),this.ownTimestamp=(new Date).getTime(),!this.isSlice()&&a&&e.usePendingChangesStore&&this.pendingChanges.forTransaction(a).onDataChange(t)),this.queryMemoized.invalidate()}},{key:"dispose",value:function(){var e;this.isUserSettingsTable||(this.isSlice()||(this._tableRows.length=0,this.model.Rows.length=0),null===(e=this._indexedTableRowsByName)||void 0===e||e.clear(),this.model.Disposed=!0)}}],[{key:"findByName",value:function(e,t,a){return(t=t||T.AppGlobals.AppModel).findTableCollection(e,a)}},{key:"usePendingChangesStore",get:function(){return w.dynamicRollouts.includeByOwnerId("TransactionPendingChanges")&&C.ReactRootUIConfig.isReactRoot()}}]),e}();t.default=D},450513:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(513979)),u=n(a(593186)),s=a(166089);var c=function(){function e(t){var a,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.AppGlobals.AppModel;(0,r.default)(this,e);try{var c=(null===(n=null===(a=null==i?void 0:i.AppTemplate)||void 0===a?void 0:a.Presentation)||void 0===n?void 0:n.FormatRules)||[],d=c.filter((function(e){return e.IsValid&&!e.Disabled&&e.TableOrSlice===t})),f=o.default.sortBy(d,(function(e){return e.RuleOrder}));this.rules=f.map((function(e){return new l.default(e)})),this.appModel=i}catch(e){this.rules=[],u.default.warnToDevConsole("error instantiating TableFormatting",e)}}return(0,i.default)(e,[{key:"forColumn",value:function(e,t){var a=this.rules.filter((function(t){return o.default.includes(t.columns(),e)})),n=o.default.every(a,(function(e){return o.default.isNil(e.condition())||e.condition().isPure()}));t&&(a=a.filter((function(e){return o.default.isNil(e.condition())||e.condition().run(t,{noCache:!0})})));var r=function(e){return o.default.reduce(e,(function(e,t){return o.default.extendWith(e,t.settings,(function(e,t,a){return"textSize"===a&&1===t?e:"icon"===a?(t&&e.unshift(t),e):t||e}))}),{icon:[]})}(a);return r.timestamp=this.appModel.dataStampTime(),{rules:r,isPure:n}}},{key:"computeWorstCaseFormatting",value:function(e){var t,a,n,r,i,l,u,s=this,c=e.tableOrSlice,d=e.column;return n=o.default.find(s.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.Name===c})),r=n?n.SourceTable:c,i=o.default.filter(s.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.SourceTable===r})),l=o.default.map(i,(function(e){return e.Name})),u=o.default.filter(s.rules,(function(e){return e.data.TableOrSlice===r||o.default.includes(l,e.data.TableOrSlice)})),t=o.default.filter(u,(function(e){return d?o.default.includes(e.data.ColumnsToFormat,d):0===e.data.ColumnsToFormat.length})),a={},o.default.reduce(t,(function(e,t){var n=!1,r=t.equivalentKey();return r&&(a[r]&&(n=!0),a[r]=t),o.default.extendWith(e,t.settings,(function(e,t,a){return"icon"===a?(n||t&&e.unshift(t),e):"textSize"===a&&null!=e?Math.max(parseFloat(e),parseFloat(t)):t||e}))}),{icon:[]})}}]),e}();t.default=c},389549:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TableRow=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(494012)),u=n(a(385857)),s=n(a(593186)),c=a(557310),d=a(44617),f=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},p=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.stableId;(0,r.default)(this,e);var o=a.tableSchema,l=a.appModel;this.appModel=l,this.table=a,this.tableSchema=o,this.formatting={},this._stableId=i,this._rowStateMap=new Map,this.values=t,this.keyAttribute=o.keyAttribute(),null===i&&(this._keyValue=t[this.keyAttribute.name()])}return(0,i.default)(e,[{key:"refresh",value:function(){this._rowStateMap.forEach((function(e){return e.refreshState()})),this.rowState.refreshState(),this.rowTimestamp=(new Date).getTime(),this.formatting={}}},{key:"snapshot",value:function(){return o.default.cloneDeep(this.values)}},{key:"copy",value:function(){return new e(this.snapshot(),this.table,{stableId:this._stableId})}},{key:"tableName",get:function(){return this.table.rootName()}},{key:"rowId",get:function(){return this.keyValue}},{key:"keyValue",get:function(){return null!=this._keyValue?this._keyValue:this.values[this.keyAttribute.name()]}},{key:"labelValue",get:function(){return this.table.labelTextForId(this.rowId)}},{key:"stableId",get:function(){return this._stableId||this.keyValue}},{key:"timestamp",get:function(){return o.default.max([this.rowTimestamp||this.table.timestamp(this.appModel)||this.appModel.dataStampTime()])}},{key:"dataContext",get:function(){return null==this._dataContext&&(this._dataContext=new u.default(this.appModel,this.tableSchema,this.values)),this._dataContext}},{key:"rowState",get:function(){if(null==this._rowState){var e=this._stableId?null:this.keyValue;this._rowState=new l.default(this.appModel,this.table,this.dataContext,e,this.tableSchema.allBaseTableAttributes(),{stableId:this._stableId})}return this._rowState}},{key:"getReferencedRows",value:function(e){var t=this;return o.default.compact(this.tableSchema.findBaseTableAttributesByType("Ref").map((function(a){var n=t.get(a.name());if(null!=n&&""!==n){var r=t.appModel.findTableCollection(a.referencedTableName()).rootTable;if(r)return r.lookupTableRow(n,e)}return null})))}},{key:"get",value:function(e){return this.values[e]}},{key:"getRowState",value:function(e){var t=e.paging,a=t.rowStateColumnNames.toString(),n=this._rowStateMap.get(a);if(null==n){var r=this._stableId?null:this.keyValue;n=new l.default(this.appModel,this.table,this.dataContext,r,t.attributes,{paging:t,stableId:this._stableId}),this._rowStateMap.set(a,n)}return n}},{key:"getColumnFormatting",value:function(e){var t,a=this.formatting,n=this.table,r=a[e];if(!(null==r?void 0:r.timestamp)||r.timestamp<(null===(t=this.appModel)||void 0===t?void 0:t.dataStampTime())){var i=this.dataContext,o=n.formatting.forColumn(e,i),l=o.rules;return o.isPure&&(a[e]=l),l}return a[e]}},{key:"isNewRow",value:function(){return null!=this._stableId}},{key:"commitRowId",value:function(){delete this._stableId,delete this._rowState,this._rowStateMap.clear(),this._keyValue=this.values[this.keyAttribute.name()]}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enforceStableKey,a=e.usedTransactions,n=e.transaction,r=e.paging,i=arguments.length>1?arguments[1]:void 0,o=c.ReactRootUIConfig.isReactRoot()&&r?this.getRowState({paging:r}):this.rowState;return o.validateSave({enforceStableKey:t,usedTransactions:a,transaction:n,viewStateKey:i}).errorState}},{key:"recompute",value:function(e){var t=e.userEdited,a=e.transaction,n=e.wasReset,r=void 0===n?{}:n,i=e.noAsync,o=void 0===i||i,l=f(e,["userEdited","transaction","wasReset","noAsync"]);if(d.dynamicRollouts.includeByOwnerId("TransactionRecomputeInfluenced"))return this.dataContext.augmentWithTransaction(a).recomputeDynamicValues(Object.assign(Object.assign({},l),{wasReset:r,noAsync:o,computeDefaults:this.isNewRow(),skipTheseDefaults:t})),this.refresh(),r;var u=l.initialData,s=l.virtualOnly;return this.dataContext.augmentWithTransaction(a).recomputeAppFormulas({initialData:u,virtualOnly:s,wasReset:r,noAsync:!0,skipTheseDefaults:t}),this.refresh(),r}},{key:"update",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.userEdited,r=a.initialData,i=a.noAsync,l=a.getAsyncCallback,u=a.wasReset,c=void 0===u?{}:u,d=a.updateInfluenced,f=void 0===d||d,p=a.transaction,h=arguments.length>3?arguments[3]:void 0,v=!this.isNewRow(),g=this.snapshot(),y=this.keyValue,b=this.tableSchema;if(this.values[e.name()]=t,this.table.onDataChange(),f){var T=this.isNewRow(),S=b.changeTriggeredAttributes().map((function(e){return e.name()})),A=o.default.extend(o.default.keyBy(S),n);m(e,b,this.dataContext.augmentWithTransaction(p),this.rowState,{initialData:r,noAsync:i,getAsyncCallback:l,computeDefaults:T,skipTheseDefaults:A,wasReset:c},void 0,h),this.table.onDataChange()}return v&&this.keyValue!==y?(s.default.errorToDevConsole("an update attempted to change the key of an existing row"),o.default.extend(this.values,g),c):(this.refresh(),c)}},{key:"resetValues",value:function(e){o.default.extend(this.values,e),this.refresh(),this.table.onDataChange()}},{key:"invalidate",value:function(){this.refresh()}},{key:"onDataChange",value:function(e,t,a){this!==e&&(this.rowState.onDataChange(e),t&&a&&this.tableSchema.virtualAttributes().filter((function(t){return o.default.includes(t.appFormulaEvalTree().tablesReferenced(),e.tableName)})).length&&t.recompute(this.tableName,this.stableId,{virtualOnly:!0,triggeredBy:a.id}))}}]),e}();t.TableRow=p;var h=p;t.default=h;var v=!1;function m(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6?arguments[6]:void 0;if(v){if(i>0)return;v=!1}var u=new Date,s={},c={},d={},f=o.default.extend({skipLeafAttrs:!0,considered:s,computed:c,wasReset:d,nowDate:u},r);e.isKey()&&a.resolveParentRefs(),a.recomputeInfluencedAttributes(e,f),g(e,t,a,n,r,i,l)}function g(e,t,a,n,r){for(var i,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6?arguments[6]:void 0,c=t.influencedValidityEnums(e).filter((function(t){return t!==e})),d={},f=[],p=e.inFullDependentChain(c),h=0;h<c.length;h++){var g=c[h],y=a.getValue(g),b=n.validOptions(g,u)||[],T=p&&0===h&&(0===l&&b.length||l>0&&""===y);if(T)i=y;else{if(p&&h>0&&(null==i||""===i))b=[];else{var S=g.validIfEvalTree(),A=S.getInConditionListInformation(a),w=A.values,C=A.elementAttribute;b=C.valuesToWireFormat(w)}d[g.name()]=b;var E=Array.isArray(y)?y:[y];"EnumList"===g.type()&&(E=g.splitEnumListValue(y,b));for(var k=!0,R=0;R<E.length;R++){var I=E[R];if(""!==I&&null!=I&&!o.default.includes(b,I)){k=!1;break}}null==b||k||""===a.getValue(g)||(y="",a.setValue(g.name(),y),f.push({attr:g})),i=y}}return f.forEach((function(i){var o=i.attr;if(e.name()!==o.name())if(l<20)m(o,t,a,n,r,l+1,u);else if(!v){v=!0;var c="Possible infinite loop in handleEntryValueChanged";s.default.ReportErrorOnce({errorMessage:c}),s.default.warnToDevConsole(c)}})),d}},654158:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TableRowIndex=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(87786)),l=function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;(0,r.default)(this,e),this.tableRows=a,this.indexAttribute=n,this.store=i,this.tableRows=a,this.indexAttribute=n,a.forEach((function(e){var a=e.get(n.name());t.lookup(a).push(e)}))}return(0,i.default)(e,[{key:"distinctValues",value:function(){return Array.from(this.store.keys())}},{key:"lookup",value:function(e){var t=this.indexAttribute.getNormalizedLookupValue(e),a=this.store.get(t);return null==a&&(a=new o.default,this.store.set(t,a)),a}}]),e}();t.TableRowIndex=l;var u=l;t.default=u},192137:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(856690)),o=n(a(689728)),l=n(a(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=S(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(150198)),s=n(a(888861)),c=n(a(385857)),d=a(976661),f=a(365914),p=n(a(498967)),h=a(306593),v=n(a(593186)),m=n(a(674823)),g=a(351101),y=a(166089),b=a(251347),T=a(557310);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(S=function(e){return e?a:t})(e)}function A(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var C="**all other columns**",E=function(){function e(t,a){var n,r,o=this;(0,i.default)(this,e),t instanceof e&&v.default.warnToDevConsole("TableSchema was double-instantiated"),this.model=t,this.sliceDefinition=a,this._cacheStore={};var s=null!==(r=null===(n=this.model)||void 0===n?void 0:n.Attributes.map((function(e){return new u.default(e)})))&&void 0!==r?r:[];this._allBaseTableAttributeIndexesByName={},this._allBaseTableAttributeIndexesByLowercasedName={},s.forEach((function(e,t){o._allBaseTableAttributeIndexesByName[e.name()]=t,e.name()&&(o._allBaseTableAttributeIndexesByLowercasedName[e.name().toLowerCase()]=t)})),this._allBaseTableAttributes=s,this._allAttributes=this.sliceDefinition?a.Columns.map((function(e){return s[o._allBaseTableAttributeIndexesByName[e]]||s[o._allBaseTableAttributeIndexesByLowercasedName[e?e.toLowerCase():e]]})):s,this._allAttributes=this._allAttributes.filter((function(e){return e})),this._nonCosmeticAttributes=this._allAttributes.filter((function(e){return!e.isShowType()})),this.paging=new h.Paging(this._allAttributes),this._allAttributesByName=l.default.keyBy(this._allAttributes,(function(e){return e.name()})),this._allAttributesLowercased=l.default.keyBy(this._allAttributes,(function(e){var t;return null===(t=e.name())||void 0===t?void 0:t.toLowerCase()}));var c=this._allAttributes.filter((function(e){return e.isValid()})).filter((function(e){return!!e.isVirtual()||!e.isSys()}));this._attributes=c}return(0,o.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"name",value:function(){return this.sliceDefinition?this.sliceDefinition.Name:this.model.Name}},{key:"isSlice",value:function(){return!!this.sliceDefinition}},{key:"tableOrSliceName",value:function(){return this.isSlice()?this.sliceDefinition.Name:this.model.AutoSchemaFrom}},{key:"sourceTableName",value:function(){return this.isSlice()?this.sliceDefinition.SourceTable:this.model.AutoSchemaFrom}},{key:"allAttributes",value:function(){return this._allAttributes}},{key:"virtualAttributes",value:function(){return this._allBaseTableAttributes.filter((function(e){return e.isVirtual()}))}},{key:"nonCosmeticAttributes",value:function(){return this._nonCosmeticAttributes}},{key:"allBaseTableAttributes",value:function(){return this._allBaseTableAttributes}},{key:"allAttributesExcept",value:function(e){return this.allAttributes().filter((function(t){return-1===e.indexOf(t.name())}))}},{key:"formItemNumber",value:function(e){return l.default.indexOf(this._nonCosmeticAttributes.map((function(e){return e.name()})),e)}},{key:"visibleAttributes",value:function(){var e=this;return this._cache("visibleAttributes",(function(){return e._attributes.filter((function(e){return!e.isHidden()}))}))}},{key:"visibleAttributesWithoutShowTypes",value:function(){var e=this;return this._cache("visibleAttributesWithoutShowTypes",(function(){return e._attributes.filter((function(e){return!e.isHidden()&&!e.isShowType()}))}))}},{key:"visibleAttributesWithoutPageHeaders",value:function(){var e=this;return this._cache("visibleAttributesWithoutPageHeaders",(function(){return e._attributes.filter((function(e){return!e.isHidden()&&!e.isPageHeader()}))}))}},{key:"visibleAttributesExcept",value:function(e){return this.visibleAttributesWithoutShowTypes().filter((function(t){return-1===e.indexOf(t.name())}))}},{key:"refAttributesToTable",value:function(e){var t=function(t){return t.referencedTableName()===e};return T.ReactRootUIConfig.isReactRoot()?this.allAttributes().filter(t):this.findAttributesByType("Ref",{includeHidden:!0}).filter(t)}},{key:"recurseReferencedRowToTable",value:function(e,t,a,n,r){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};a=a||y.AppGlobals.AppModel;var l=this.findAttributesByType("Ref",{includeHidden:!0});return(null==l?void 0:l.length)&&null!==(i=l.map((function(i){var l,u=i.referencedTableName(),s=null===(l=e.lookupTableRow(n,r))||void 0===l?void 0:l.values;if(s){var c=s[i.name()];if(null!=c){if(u===t)return c;var d=a.findTableCollection(u),f=d.table,p=d.tableSchema;if(f&&p&&!o[f.name()])return o[f.name()]=!0,p.recurseReferencedRowToTable(f,t,a,c,r,o)}}return null})).find((function(e){return null!=e})))&&void 0!==i?i:null}},{key:"sheetFormulaAttributes",value:function(){return this._allBaseTableAttributes.filter((function(e){return e.hasFormula()}))}},{key:"changeTriggeredAttributes",value:function(){var e=this;return this._cache("changeTriggeredAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.isChangeTriggered()}))}))}},{key:"dynamicAttributes",value:function(){var e=this;return this._cache("dynamicAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.isDynamic()}))}))}},{key:"virtualAttributesThatDependOn",value:function(e){return this.virtualAttributes().filter((function(t){return t.appFormulaEvalTree().tablesReferenced().includes(e)}))}},{key:"dynamicAttributesThatDependOn",value:function(e,t){return this.dynamicAttributes().filter((function(a){return a.valueDependsOn(e,t)}))}},{key:"columnDependencies",value:function(e){var t=this;return this._cache(e.name()+"ColumnDependencies",(function(){var a=t.dynamicDependencies(e),n=t.findAttributesByIndices(l.default.union(e.showIfColumnsReferenced(),e.validIfColumnsReferenced(),e.requiredIfColumnsReferenced(),e.editableIfColumnsReferenced(),e.showContentColumnsReferenced(),e.suggestedValuesColumnsReferenced(),e.displayNameColumnsReferenced())),r=t.paging,i=r.pageHeader(r.onPage(e.name()));i&&i!==e&&i.showIfEvalTree()&&(n=l.default.union(n,t.columnDependencies(i)));var o=[];return n.forEach((function(e){o=l.default.union(o,t.dynamicDependencies(e))})),l.default.union(o,a,n)}))}},{key:"dynamicDependencies",value:function(e){return this._cache(e.name()+"DynamicDependencies",this._dynamicDependencyRecursor.bind(this,e))}},{key:"_dynamicDependencyRecursor",value:function(t,a){a=a||{};var n=this.findAttributesByIndices(t.appFormulaColumnsReferenced()),r=this.findAttributesByIndices(t.defaultExpressionColumnsReferenced()),i=this.findAttributesByIndices(t.resetColumnsReferenced()),o=t.changeColumns();o=null!=o?0===o.length?this._allBaseTableAttributes.filter((function(e){return!e.isChangeTriggered()})):this._allBaseTableAttributes.filter((function(e){return l.default.includes(o,e.name())})):[];var u=l.default.union(n,r,i,o);a[t.name()]=!0;var s=[];return u=u.filter(function(n){if(!(n.name()in a)){var r=this._dynamicDependencyRecursor(n,a);if(t.isChangeTriggered()&&l.default.indexOf(e.attributeNames(r),t.name())>=0)return!1;s=l.default.union(s,r)}return!0}.bind(this)),l.default.union(s,u)}},{key:"influencedAttributes",value:function(t){var a=this;return this._cache(t.name()+"InfluencedAttributes",(function(){return a._allBaseTableAttributes.filter(function(a){var n=this.columnDependencies(a);return e.attributeNames(n).indexOf(t.name())>=0}.bind(a))}))}},{key:"influencedDynamicAttributes",value:function(t){var a=this;return this._cache(t.name()+"InfluencedDynamicAttributes",(function(){return a.dynamicAttributes().filter(function(a){var n=this.dynamicDependencies(a);return e.attributeNames(n).indexOf(t.name())>=0}.bind(a))}))}},{key:"influencedValidityEnums",value:function(t){var a=this;return this._cache(t.name()+"InfluencedValidityEnums",(function(){return a._allBaseTableAttributes.filter(function(a){if(!a.isValidityEnum())return!1;var n=this.columnDependencies(a);return e.attributeNames(n).indexOf(t.name())>=0}.bind(a)).sort((function(e,t){return e.validIfColumnsReferenced().length<t.validIfColumnsReferenced().length?-1:e.validIfColumnsReferenced().length>t.validIfColumnsReferenced().length?1:0}))}))}},{key:"findAttributesByNames",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.includeHidden,r=void 0!==n&&n,i=[];return e.forEach((function(a){if(a===C){var n=r?t.allAttributesExcept(e):t.visibleAttributesExcept(e);i=i.concat(n)}else{var o=t.findAttributeByName(a);o?i.push(o):v.default.warnToDevConsole("Could not find attribute",a,"requested in columnOrder",e,t)}})),i}},{key:"findAttributesByIndices",value:function(e){var t=this,a=[];return e.length&&(a=e.map((function(e){return t._allBaseTableAttributes[e]}))),a}},{key:"keyAttribute",value:function(){var e=this;return this._cache("keyAttribute",(function(){return e._allAttributes.find((function(e){return e.isKey()}))||e._allAttributes[0]}))}},{key:"keyAttributes",value:function(){var e=this;return this._cache("keyAttributes",(function(){var t=e.keyAttribute();return e.hasCompoundKey()?t.appFormulaColumnsReferenced().map((function(t){return e._allBaseTableAttributes[t]})).filter((function(e,t,a){return a.indexOf(e)===t})):[t]}))}},{key:"isKeyComponent",value:function(e){var t=this.keyAttributes().map((function(e){return e.name()}));return this.hasCompoundKey()&&l.default.includes(t,e.name())}},{key:"hasCompoundKey",value:function(){return this.keyAttribute().isVirtual()}},{key:"labelAttributes",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._cache("labelAttributes",(function(){var a=e._attributes.filter((function(e){return e.isLabel()}));if(t&&!a.length){var n=e.basicAttributesByImportance()[0],r=e.presentableImageAttributesByImportance()[0];a=[],n&&a.push(n),r&&a.push(r)}return l.default.sortBy(a,(function(e){return e.isImageType()?1:2}))}))}},{key:"labelImageAttribute",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._cache("labelImageAttribute",(function(){var a=e._attributes.filter((function(e){return e.isLabel()&&e.isImageType()}));return a.length?a[0]:t?e.presentableImageAttributesByImportance()[0]:null}))}},{key:"labelBasicAttribute",value:function(){var e=this;return this._cache("labelBasicAttributes",(function(){var t=e._allBaseTableAttributes.filter((function(e){return e.isLabel()&&!e.isImageType()}));return t.length?t[0]:e.basicAttributesByImportance().length?e.basicAttributesByImportance()[0]:null}))}},{key:"searchableAttributes",value:function(){var e=this;return this._cache("searchableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.Searchable}))}))}},{key:"scannableAttributes",value:function(){var e=this;return this._cache("scannableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.IsScannable}))}))}},{key:"nfcScannableAttributes",value:function(){var e=this;return this._cache("nfcScannableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.IsNfcScannable}))}))}},{key:"summaryFormulaAttributesByImportance",value:function(){var e=this;return this._cache("summaryFormulaAttributesByImportance",(function(){return e.visibleAttributesWithoutShowTypes().filter((function(e){return e.hasFormula()&&e.isNumericType()})).reverse()}))}},{key:"imageAttributesByImportance",value:function(){var e=this;return this._cache("imageAttributesByImportance",(function(){var t=e.visibleAttributesWithoutShowTypes().filter((function(e){return e.isImageType()})),a=l.default.sortBy(t,(function(e){return e.isRequired()?1:2}));return l.default.sortBy(a,(function(e){return e.isLabel()?1:2}))}))}},{key:"presentableImageAttributesByImportance",value:function(){var e=this;return this._cache("presentableImageAttributesByImportance",(function(){return e.imageAttributesByImportance().filter((function(e){return e.isPresentableImageType()}))}))}},{key:"basicAttributesByImportance",value:function(){var e=this;return this._cache("basicAttributesByImportance",(function(){var t=e.basicTypeAttributes(),a=l.default.sortBy(t,(function(e){return e.isRequired()?1:2})),n=l.default.sortBy(a,(function(e){return e.isKey()?1:2})),r=l.default.sortBy(n,(function(e){return"Name"===e.type()?1:2})),i=l.default.sortBy(r,(function(e){return"Name"===e.type()&&e.isVirtual()?1:2}));return l.default.sortBy(i,(function(e){return e.isLabel()?1:2}))}))}},{key:"basicTypeAttributes",value:function(){var e=this;return this._cache("basicTypeAttributes",(function(){return e.visibleAttributesWithoutShowTypes().filter((function(e){return e.isBasicType()}))}))}},{key:"actionTypeAttributes",value:function(){var t=this;return this._cache("actionTypeAttributes",(function(){var a=t.visibleAttributesWithoutShowTypes().filter((function(e){return e.isActionType()}));return e.reduceAttributesToUniqueTypes(a)}))}},{key:"rowNumberAttribute",value:function(){return this.findAttributeByName("_RowNumber")}},{key:"findBaseTableAttributeByName",value:function(e){return this._allBaseTableAttributes[this.findAttributeIndex(e)]}},{key:"findAttributeByName",value:function(e){return this._allAttributesByName[e]||this._allAttributesLowercased[e?e.toLowerCase():e]}},{key:"findAttributeIndex",value:function(e){return this._allBaseTableAttributeIndexesByName[e]||this._allBaseTableAttributeIndexesByLowercasedName[e?e.toLowerCase():e]}},{key:"findBaseTableAttributesByType",value:function(e){return this._allBaseTableAttributes.filter((function(t){return t.type()===e}))}},{key:"findAttributesByType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.includeHidden,n=void 0!==a&&a,r=n?this.allAttributes():this.visibleAttributesWithoutShowTypes();return r.filter((function(t){return t.type()===e}))}},{key:"isInSlice",value:function(e){return null!=this.findAttributeByName(e)}},{key:"getDefaultValues",value:function(e){var t=this,a={};return l.default.isObject(e)?(l.default.keys(e).forEach((function(n){var r=t.findAttributeByName(n);a[r?r.name():n]=e[n]})),a):{}}},{key:"uniqueColumnValues",value:function(e,t){var a=this.findAttributeByName(e);if(!a)return v.default.warnToDevConsole("Could not find column named",e),[];if(!t)return[];var n=[];return t.forEach((function(t){var r=t[e];if("EnumList"===a.type()){var i=a.getValues(r);n=n.concat(i)}else n.push(r)})),l.default.uniq(n.filter((function(e){return!!e})))}},{key:"isAppLauncherSchema",value:function(){var e,t=this.visibleAttributesWithoutShowTypes().length<=3,a=this.findAttributesByType("App").length>0,n=this.presentableImageAttributesByImportance().length>0,r=!!((null===(e=y.AppGlobals.AppModel)||void 0===e?void 0:e.AppTemplate)&&["AppGallery-245842-3-176618-10305","AppGallery-10305","AppGalleryDev-10305"].indexOf(y.AppGlobals.AppModel.AppTemplate.Name)>=0);return t&&a&&n||r}},{key:"isUrlLauncherSchema",value:function(){var e=this.visibleAttributesWithoutShowTypes().length<=3,t=this.findAttributesByType("Url").length>0,a=this.presentableImageAttributesByImportance().length>0;return e&&t&&a}},{key:"isPhotogenic",value:function(){var e=this.presentableImageAttributesByImportance().length>0,t=this.basicTypeAttributes().length>0;return e&&t}},{key:"rowComparer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.valuesOnly,n=void 0===a||a,r=this.augmentSortRules(e),i=r.augmentedSortRules,o=r.additionalComparerArguments;return(0,d.makeObjectComparer)(i,o,{valuesOnly:n})}},{key:"augmentSortRules",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.inRollout,r=void 0!==n&&n,i=[],o={};t.forEach((function(t){var a=e.findAttributeByName(t.Column);if(a){for(var n,s,c=a,d={},f=(0,g.getAppModel)();null!=c.firstNestedRef()&&f;){var h=f.findTableCollection(c.referencedTableName()),m=h.table,y=h.rootTableSchema;if(!m||!y)break;var b=y.labelBasicAttribute();if(!b)break;var T="".concat(m.rootName(),"|").concat(b.name());if(d[T]){s=p.default.genericComparer,o[c.name()]={labelComparer:s};break}n?function(){var e=m.keyLabelMap();n=l.default.mapValues(n,(function(t){return e[t]}))}():n=m.keyLabelMap(),s=b.valueComparer(u.ValueFormat.Wire),o[a.name()]={keyLabelMap:n,labelComparer:s},c=b,d[T]=!0}var S=l.default.extend({},t,{Comparer:r&&s||a.valueComparer(u.ValueFormat.Wire)});i.push(S)}else v.default.warnToDevConsole("Sort attribute",t.Column,"was not found in table schema",e)}));var s=this.rowNumberAttribute();return s&&i.push({Column:s.name(),Order:"Ascending",Comparer:s.valueComparer(u.ValueFormat.Wire)}),{augmentedSortRules:i,additionalComparerArguments:o}}},{key:"sortTableRows",value:function(e,t){var a=this.augmentSortRules(t,{inRollout:!0}),n=a.augmentedSortRules,r=a.additionalComparerArguments,i=e.map((function(e){var t,a,i=[e],o=A(n);try{for(o.s();!(a=o.n()).done;){var l=a.value,u=l.Column,s=l.Comparer,c=e.get(u),d=null===(t=r[u])||void 0===t?void 0:t.keyLabelMap;if(null!=d){var h=d[c];null!=h&&(c=h)}s!==p.default.textComparer&&"string"==typeof c||(c=(0,f.toNormalizedString)(c)),i.push(c)}}catch(e){o.e(e)}finally{o.f()}return i})),o=(0,d.makeSortRulesComparer)(n,{sortBy:function(e,t){return e[t+1]}});return p.default.sort(i,o),i.map((function(e){return e[0]}))}},{key:"searchMatchesRow",value:function(e,t,a,n){if(!t)return!0;if(null==e)return!1;var r=b.dynamicRollouts.includeByOwnerId("UseDateLocaleInAppSearch");a=a||{};for(var i=this.searchableAttributes(),o=0;o<i.length;o++){var l=i[o],u=e[l.name()];if(null!=u&&"function"==typeof u.toLowerCase){var s=l.type();if(r){var c=u;if(u=l.localizeWireValue(c,{dataContext:n}),null!=l.firstNestedRef())u="".concat(c,"|").concat(u);else if("Decimal"===s||"Number"===s||"Price"===s){var d=l.localizeWireValue(c,{dataContext:n,suppressGrouping:!0});u="".concat(d,"|").concat(u)}}else if("Ref"===s){var f=l.referencedTableName(),p=f&&a[f];p&&(u="".concat(u,"|").concat(p[u]))}else if("Yes/No"===s){var h=l.booleanTypeLabels(n),v=h.yesLabel,g=h.noLabel;u="Y"===u?v:g}if((0,m.default)(u).toLowerCase().indexOf(t)>=0)return!0}}return!1}},{key:"computeAggregate",value:function(e){var t=e.aggregationFunction,a=e.targetColumnName,n=e.rows,r=e.tableName,i=e.appModel;if("COUNT"===t)return n.length;var o=this.findAttributeByName(a);if(!o)return null;var d=this.findAttributeIndex(a),f=new c.default(i,this);f.getTableRows=function(){return n},f.getTableRow=function(e,t){var a=this.keyAttribute().name();return l.default.find(n,(function(e){return e[a]===t}))};var p,h={ResultType:"List",ResultTypeQualifier:{ElementType:o.type(),ElementTypeQualifier:o.auxDataString()},EvalType:"COLUMNSET",ColIndex:d,ColName:o.name(),TableName:r},m={ResultType:o.type(),ResultTypeQualifier:o.auxData(),EvalType:"FUNCTION",FunctionName:t,Children:[h]},g=s.default.create(m).run(f);switch(t){case"MIN":case"MAX":case"SUM":p=o;break;default:p=o.decimalDigits()?o:u.default.fromTypeData(t,"Decimal",'{ "DecimalDigits": 2 }')}try{g=p.coerceValue(g)}catch(e){v.default.warnToDevConsole("error coercing value in computeAggregate",g,p)}return g}}],[{key:"reduceAttributesToUniqueTypes",value:function(e){return l.default.uniqBy(e,(function(e){return"LatLong"===e.type()||"Address"===e.type()?"GenericAddressType":e.type()}))}},{key:"attributeNames",value:function(e){return e.map((function(e){return e.name()}))}}]),e}();t.default=E},282615:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.viewNameIconMap=t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(888861)),l=n(a(385857)),u=n(a(593186)),s=n(a(743537)),c=a(306593),d=a(166089),f=a(557310);t.viewNameIconMap={calendar:"date_range",dashboard:"view_quilt",deck:"ballot",table:"view_list",gallery:"border_all",detail:"category",map:"location_on",chart:"insert_chart_outlined",form:"view_stream",onboarding:"view_carousel",card:"insert_photo",iframe:"web_asset"};var p=function(){function e(t){(0,r.default)(this,e),this._appControl=t,this._evalTreeLookup={},this._cacheStore={}}return(0,i.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"name",value:function(){return this._appControl.Name}},{key:"control",value:function(){return this._appControl}},{key:"table",value:function(){return"dashboard"===this.viewType()?null:this._appControl.TableOrFolderName}},{key:"viewType",value:function(){return this._appControl.Action}},{key:"columnOrder",get:function(){return this.definition().ColumnOrder}},{key:"paging",get:function(){var e=this.columnOrder,t=d.AppGlobals.AppModel.findTableCollection(this.table()).tableSchema;return null!=t&&null!=e&&e.length>0&&("form"===this.viewType()||f.ReactRootUIConfig.isReactRoot())?this._cache("paging",(function(){return new c.Paging(t.findAttributesByNames(e,{includeHidden:!0}))})):null==t?void 0:t.paging}},{key:"createdBy",value:function(){return this._appControl.CreatedBy}},{key:"isSystemView",value:function(){return"System"===this.createdBy()}},{key:"isFullScreen",value:function(){return"onboarding"===this.viewType()}},{key:"position",value:function(){return this._appControl.Position}},{key:"rowKey",value:function(e){if(this._rowKey&&this._rowKey.timestamp===e.DataStamp)return this._rowKey.value;var t=this.definition().RowKey,a=this.evalTreeLookup("ROW_KEY");return a&&(t=a.run(e.dataContext()),a.isPure()&&(this._rowKey={timestamp:e.DataStamp,value:t})),t}},{key:"definition",value:function(){var e=this;return this._cache("definition",(function(){var t=e.control();if(!t)return{};if(t.ViewDefinition)return t.ViewDefinition;try{return JSON.parse(t.Settings)}catch(e){return{}}}))}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this._appControl.ExprLookup||{};try{t[e]&&(this._evalTreeLookup[e]=o.default.create(t[e]))}catch(t){u.default.warnToDevConsole("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"hasDisplayName",value:function(){return!!this.evalTreeLookup("DisplayName")}},{key:"displayName",value:function(e,t,a,n){var r=this.evalTreeLookup("DisplayName");if(r){var i=r.run(new l.default(e,t,a,void 0,void 0,void 0,n));return i?String(i):this.name()}return this.name()}},{key:"events",value:function(){var e=this;return this._cache("events",(function(){return(e.definition().Events||[]).map((function(t){return new s.default(t,e)})).filter((function(e){return!!e.actionName()}))}))}},{key:"getEventByType",value:function(e){return this.events().filter((function(t){return t.type()===e.name}))[0]}},{key:"shouldBeShown",value:function(e){var t=this.evalTreeLookup("ShowIf");return!t||!!t.run(e?e.dataContext():new l.default(d.AppGlobals.AppModel))}}],[{key:"createFromControl",value:function(t){return new e(t)}}]),e}();t.default=p},351101:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayMode=void 0,t.checkTemplateMatchesAppState=Me,t.default=void 0,t.getAppModel=Re,t.mapActionName=Ie,t.setTestAppModel=void 0;var i=n(a(364687)),o=n(a(600861)),l=n(a(918698)),u=n(a(627424)),s=n(a(856690)),c=n(a(689728)),d=n(a(496486)),f=n(a(297636)),p=n(a(734155)),h=n(a(294184)),v=n(a(730381)),m=n(a(571524)),g=n(a(143249)),y=n(a(112368)),b=me(a(593186)),T=n(a(315847)),S=a(852468),A=n(a(314247)),w=a(685650),C=n(a(190644)),E=a(46239),k=me(a(21870)),R=a(365914),I=a(75212),O=a(318926),M=a(218546),N=a(431335),_=a(881219),D=a(646317),L=a(422339),P=a(249633),x=a(629503),F=a(354632),G=a(249825),V=me(a(895466)),B=n(a(429815)),U=n(a(962553)),H=n(a(192137)),W=n(a(150198)),j=n(a(385857)),q=n(a(888861)),Y=n(a(513954)),z=n(a(700482)),K=n(a(688291)),J=n(a(27401)),Q=n(a(710229)),X=a(714067),Z=a(263198),ee=a(796326),te=a(946094),ae=a(804758),ne=a(161171),re=a(557310),ie=a(515128),oe=a(764685),le=a(892148),ue=a(166089),se=a(149313),ce=a(737351),de=a(235049),fe=a(44617),pe=a(609464),he=a(50295);function ve(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(ve=function(e){return e?a:t})(e)}function me(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=ve(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}function ge(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return ye(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ye(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var be,Te=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))};t.DisplayMode=be,function(e){e.Automatic="Automatic",e.Centered="Centered",e.NoHeadings="No Headings",e.Normal="Normal",e.SideBySide="Side-by-side"}(be||(t.DisplayMode=be={}));var Se,Ae,we=function(e){return"errorMessage"in e&&!!e.errorMessage},Ce=function(e){if((0,ee.isSuccessResponse)(e)){var t=e.response,a=null==t?void 0:t.Template,n=null==a?void 0:a.Behavior.UsageScopes,r=(null==a?void 0:a.Behavior.RequireUserConsent)&&n&&n!==t.UserConsentedScopes;return(null==t?void 0:t.GeolocationRequired)&&(!a||!r)}return!1},Ee=function(){function e(t,a){(0,s.default)(this,e),this.data=t,this.columns=a}return(0,c.default)(e,[{key:"toRowValues",value:function(){var e=this;return this.data.map((function(t){return d.default.zipObject(e.columns,t)}))}}],[{key:"fromJSON",value:function(t){try{var a=JSON.parse(t);return new e(a.data,a.columns)}catch(t){return b.default.ReportErrorOnce({errorMessage:"Error parsing json",error:t}),new e([],[])}}}]),e}(),ke=function(e){Ae!==ue.AppGlobals.AppModel&&b.default.ReportError({errorMessage:"setCurrentAppModel _currentAppModel !== AppGlobals.AppModel",currentDefined:null!=Ae,windowDefined:null!=ue.AppGlobals.AppModel});var t=Ae;Ae=e,window.AppModel=Ae,e&&e===t?b.default.ReportError({errorMessage:"setCurrentAppModel newAppModel === oldAppModel"}):(e&&(null==t?void 0:t.pendingAppModel)===e&&(null==t||delete t.pendingAppModel),null==t||t.Dispose((null==e?void 0:e.AppTemplate.Id)!==(null==t?void 0:t.AppTemplate.Id)))};function Re(){var e;return ue.AppGlobals.AppModel||b.default.ReportErrorOnce({errorMessage:"getAppModel called but there is no AppGlobals.AppModel"}),Ae!==ue.AppGlobals.AppModel&&null!=(null===(e=ue.AppGlobals.AppModel)||void 0===e?void 0:e.appTemplate)?(b.default.ReportErrorOnce({errorMessage:"getAppModel window mismatch"}),ue.AppGlobals.AppModel):Ae}function Ie(e,t){var a,n;return null!==(n=null===(a=Re())||void 0===a?void 0:a.MapActionName(e,t))&&void 0!==n?n:t||e}var Oe=window.APPSHEET_TEST_CONTEXT?ke:d.default.noop;function Me(e,t){var a,n,r=function(e){try{var t=e.match(/^\/?([^#]+)#?/)[1];return decodeURIComponent(t).toLowerCase()}catch(t){return e}};return(null===(a=e.Name)||void 0===a?void 0:a.toLowerCase())===r(t.Name)||(null===(n=e.Id)||void 0===n?void 0:n.toLowerCase())===r(t.Id)}t.setTestAppModel=Oe;var Ne=function(){function e(t){var a=this;(0,s.default)(this,e),this.deferredUntilSwap=[],this.inBackgroundSync=!1,this.startedGeocoding=!1,this.dynamicRollouts=new G.DynamicRolloutContainer,this.readyToSwap=!1,this.useConsistentComparisonOperators=!1,this.Disposed=!1,this.IsTestModel=!1,this.USERSTORE_PROVIDER="user-local",this.NATIVE_PROVIDER="native",this.API_LEVEL=2,this.SYSTEM_OWNER_IDS=[10305,71626],this.DESC_SORT_PREFIX="▼",this.ANY_IMAGE_TYPE="anyImage",this.ROW_NUMBER_ATTRNAME="_RowNumber",this.ROW_ID_ATTRNAME="Row ID",this.SHOW_LIST="list",this.DisplayActions={card:!0,table:!0,dashboard:!0,deck:!0,gallery:!0,slideshow:!0,detail:!0,map:!0,chart:!0,form:!0,search:!0,calendar:!0,onboarding:!0,iframe:!0},this.SHOW_WORKFLOW="flow",this.LIST_OPTION_TABLE="Tabular",this.LIST_OPTION_GROUPED="Grouped",this.LIST_OPTION_CARD="Deck",this.DECK_OPTION_SQUARE="Square Image",this.DECK_OPTION_CIRCLE="Round Image",this.DECK_OPTION_FULL="Full Image",this.CHART_OPTION_ROW="Row Series",this.CHART_OPTION_ROW_STACKED="Row Series [Stack]",this.CHART_OPTION_ROW_LINE="Row Series [Line]",this.CHART_OPTION_COL="Col Series",this.CHART_OPTION_COL_STACKED="Col Series [Stack]",this.CHART_OPTION_COL_LINE="Col Series [Line]",this.CHART_OPTION_SCATTER="Scatter Plot",this.CHART_OPTION_PIECHART="PieChart",this.CHART_OPTION_DONUTCHART="DonutChart",this.CHART_OPTION_HISTOGRAM="Histogram",this.CHART_OPTION_HORIZ_HISTOGRAM="Horizontal Histogram",this.CHART_OPTION_AGGREGATE_PIECHART="Aggregate PieChart",this.CHART_OPTION_AGGREGATE_DONUTCHART="Aggregate DonutChart",this.CHART_OPTION_AGGREGATE_NUMBER="Aggregate Number",this.ACTION_SEARCH="search",this.ACTION_LOOKUP="lookup",this.ACTION_NEW="new",this.ACTION_SCAN="scan",this.POSITION_FAR_LEFT="left most",this.POSITION_FAR_RIGHT="right most",this.POSITION_LEFT="left",this.POSITION_RIGHT="right",this.POSITION_CENTER="center",this.POSITION_MENU="menu",this.POSITION_REF="ref",this.POSITIONS_ORDERED=["left most","left","center","right","right most"],this.FORM_CACHE_INTERVAL_MS=1e4,this.FORM_RESTORE_STATE_TIMEOUT_MS=6e5,this.DataStamp=(new Date).toISOString(),this.ForceDelayedSync=!1,this.InASyncCall=!1,this.ReadFromLocalCache=!0,this.Tables=[],this.backgroundSyncInProgress=!1,this.numOutstandingRequests=0,this.nativeProviderFor=function(e){return(null==e?void 0:e.ProviderName)===a.NATIVE_PROVIDER?a.nativeDataProvider:void 0},t&&(this.ReadFromLocalCache=!1,this.dynamicRollouts=t.dynamicRollouts),this.Types=z.default.init(this),this.dataManager=new Q.default(this),this.AppTemplate={IsValid:!1,IsRunnable:!0,IsDeployable:!0,AppData:{Folders:[],DataSets:[],DataSchemas:[],TableSlices:[]},Behavior:{},Presentation:{Controls:[],FormatRules:[]}},this.appTemplate=new B.default(this.AppTemplate,this),this.defaultDataProvider=new L.DefaultProvider,this.nativeDataProvider=new P.NativeProvider(this)}return(0,c.default)(e,[{key:"isCurrent",get:function(){return Re()===this}},{key:"signature",get:function(){return this.appTemplateModel.Id}},{key:"rowCount",get:function(){return d.default.sum(this.Tables.filter((function(e){return e.Rows})).map((function(e){return e.Rows&&e.Rows.length})))}},{key:"appTemplateModel",get:function(){return this.AppTemplate}},{key:"dataContext",value:function(){return this.cachedDataContext||(this.cachedDataContext=new j.default(this)),this.cachedDataContext}},{key:"isReady",value:function(){return this.appTemplateModel.IsValid}},{key:"inDynamicRolloutByOwnerId",value:function(e){return this.dynamicRollouts.byOwner(e)}},{key:"inRollout",value:function(e){return this.rollouts?Boolean(this.rollouts.get(e)):(b.default.errorToDevConsole("Checked rollout ".concat(e," before template was available - using out-of-rollout path.")),!1)}},{key:"setRollout",value:function(e,t){this.rollouts||(this.rollouts=new Map),this.rollouts.set(e,t)}},{key:"setRollouts",value:function(e){for(var t=0,a=Object.entries(e);t<a.length;t++){var n=(0,u.default)(a[t],2),r=n[0],i=n[1];this.setRollout(r,i)}}},{key:"setAppTemplate",value:function(e){this.rollouts=g.default.allByOwner(e),this.AppTemplate=e,this.appTemplate=new B.default(e,this),this.rolloutClassNames=(0,h.default)("CSSRolloutContainer",{DesktopNavigationRollout:re.ReactRootUIConfig.isInDesktopExperience(),OutsideDesktopNavigationRollout:!re.ReactRootUIConfig.isInDesktopExperience()}),this.storageManager&&this.storageManager.setCurrentTemplate(e),this.dataManager&&this.dataManager.onTemplateChange(),this.useConsistentComparisonOperators=this.appTemplate.expressionSettings().ComparisonOperatorBlankValuesMode===ne.ExpressionSettingsOption.Consistent}},{key:"Dispose",value:function(e){var t,a;b.default.AddTraceContext("AppModel.Dispose"),this.stopSyncQueue(),this.discardPendingAppModel(),null===(t=this.dataManager)||void 0===t||t.dispose(),null===(a=this.storageManager)||void 0===a||a.dispose(e),this.Tables=[],this.Disposed=!0}},{key:"dataStampTime",value:function(){return this.cachedDataStampTime&&this.cachedDataStampTime.dataStamp===this.DataStamp||(this.cachedDataStampTime={dataStamp:this.DataStamp,time:new Date(this.DataStamp).getTime()||0}),this.cachedDataStampTime.time}},{key:"rebuildTableIndex",value:function(){b.default.AddTraceContext("appModel.rebuildTableIndex"),this.TableNameIndex={};for(var e=0;e<this.Tables.length;e++){var t=this.Tables[e];this.TableNameIndex[t.Name]=e,null!=t.Name&&(this.TableNameIndex[t.Name.toLowerCase()]=e)}}},{key:"initialize",value:function(e,t,a){var n=this;b.default.AddTraceContext("appModel.initialize");var r=!1,i=!1,o=function(a){switch(null==e||e.completeSection(a),a){case"Data":i=!0;break;case"Template":r=!0}i&&r&&"function"==typeof t&&(b.default.AddTraceContext("appTemplateSuccess"),t(n.AppTemplate))},l=ue.AppGlobals.AppState.AppTemplate.Id?ue.AppGlobals.AppState.AppTemplate.Id:ue.AppGlobals.AppState.AppTemplate.Name;(0,se.$TSFixMeMaybeNull)(l),(0,se.$TSFixMeMaybeNull)(ue.AppGlobals.AppState.AppTemplate.Version),this.GetAppTemplateAsync(l,ue.AppGlobals.AppState.AppTemplate.Version,(function(e){if(null!=e){var t=(e.Behavior.AuthRequired||void 0!==window.OTURLParams.requireLogin)&&!m.default.IsIFramePreview();if(!ue.AppGlobals.AppState.IsAuthenticatedUser(t))return ue.AppGlobals.AppState.SwitchToLoginPage(e.IsPublic?null:e.Behavior.AuthProvider," Offline app fetch indicates login is required",e.Id),b.default.AddTraceContext("Switching to login page"),!1}return o("Template"),!0}),(function(){o("Data")}),(function(t){var n,r;n="Template",r=t,null==e||e.raiseError(r),"Template"===n&&"function"==typeof a&&a(r)}))}},{key:"GetTableRowHeight",value:function(){var e;return 2.111*(null===(e=this.appTemplate)||void 0===e?void 0:e.normalizedFontSize())}},{key:"FindTableDefinition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==e)return null;if(t>5)return null;for(var a=e.toLowerCase(),n=0;n<this.appTemplateModel.AppData.DataSets.length;n++)if(this.appTemplateModel.AppData.DataSets[n].IsValid){if(a===this.appTemplateModel.AppData.DataSets[n].Name.toLowerCase())return this.appTemplateModel.AppData.DataSets[n]}else b.default.AddTraceContext("Found INVALID TABLE DEFINITION for "+e);if(null!=this.appTemplateModel.AppData.TableSlices)for(var r=0;r<this.appTemplateModel.AppData.TableSlices.length;r++)if(this.appTemplateModel.AppData.TableSlices[r].IsValid&&a===this.appTemplateModel.AppData.TableSlices[r].Name.toLowerCase())return this.FindTableDefinition(this.appTemplateModel.AppData.TableSlices[r].SourceTable,t+1);return null}},{key:"FindSliceDefinition",value:function(e){if(null==e)return null;for(var t=e.toLowerCase(),a=0;a<this.appTemplateModel.AppData.TableSlices.length;a++)if(this.appTemplateModel.AppData.TableSlices[a].IsValid&&t===this.appTemplateModel.AppData.TableSlices[a].Name.toLowerCase())return this.appTemplateModel.AppData.TableSlices[a];return null}},{key:"FindControl",value:function(e,t){if(null==e)return null;for(var a=e.toLowerCase(),n=0;n<this.appTemplateModel.Presentation.Controls.length;n++){var r=this.appTemplateModel.Presentation.Controls[n];if(r.IsValid&&(a===r.Name.toLowerCase()&&(!t||t===r.Action)))return r}return null}},{key:"FindControlsForTable",value:function(e,t,a){"string"==typeof t&&(t=[t]);var n=null;t||(n=["form","dashboard","search","detail"]);var r=d.default.includes(t,"form");if(null==this.appTemplateModel.Presentation.Controls)return[];var i=this.appTemplateModel.Presentation.Controls.filter((function(i){var o,l=i.Action;"table"===l&&(l="fastTable");var u=(null===(o=i.TableOrFolderName)||void 0===o?void 0:o.toLowerCase())===e.toLowerCase(),s=!t||d.default.includes(t,l);n&&s&&(s=!d.default.includes(n,l));var c="ref"===i.Position;return a?!(!r&&"form"===i.Action)&&(u&&(s||c)):u&&s}));return d.default.sortBy(i,(function(e){return"ref"===e.Position?"App owner"===e.CreatedBy?1:2:3}))}},{key:"NavStateForView",value:function(e,t){if(!e)return null;var a=this.appTemplate.getView(e.Name),n=a?a.definition():{},r=(0,R.getGroupAggregateFromString)(n.GroupAggregate),i=a?a.rowKey(this):null,o=null==a?void 0:a.table(),l={TableName:t||o,RowKey:i,GroupBy:n.GroupBy,SortBy:n.SortBy,FilterExpr:n.FilterExpr,ColumnOrder:n.ColumnOrder,ColumnWidth:n.ColumnWidth,ChartType:n.ChartType,ChartColumns:n.ChartColumns,TrendLine:n.TrendLine,ShowLegend:n.ShowLegend,LabelType:n.LabelType,ColorCodes:n.ChartColors,ImageDisplayType:n.ImageShape,defaultCalendarView:n.DefaultCalendarView,viewEntries:n.ViewEntries,MaxNestedRows:n.MaxNestedRows,groupAggregate:r,mainSlideshowImageColumn:n.MainSlideshowImageColumn,detailContentColumn:n.DetailContentColumn,headerColumns:n.HeaderColumns,SlideshowDisplayMode:n.DisplayMode,MapCol:n.MapColumn,SecondaryTable:n.SecondaryTable,SecondaryColumn:n.SecondaryColumn,LocationMode:n.LocationMode,GalleryImageSize:n.ImageSize,Layout:"**auto**"===n.Layout?null:n.Layout,UseCardLayout:n.UseCardLayout,mainDeckImageColumn:"**auto**"===n.MainDeckImageColumn?null:n.MainDeckImageColumn,primaryDeckHeaderColumn:"**auto**"===n.PrimaryDeckHeaderColumn?null:n.PrimaryDeckHeaderColumn,secondaryDeckHeaderColumn:"**auto**"===n.SecondaryDeckHeaderColumn?null:n.SecondaryDeckHeaderColumn,deckSummaryColumn:"**auto**"===n.DeckSummaryColumn?null:n.DeckSummaryColumn,deckNestedTableColumn:"**auto**"===n.DeckNestedTableColumn?null:n.DeckNestedTableColumn,startDateColumn:"**auto**"===n.StartDateColumn?null:n.StartDateColumn,endDateColumn:"**auto**"===n.EndDateColumn?null:n.EndDateColumn,startTimeColumn:"**auto**"===n.StartTimeColumn?null:n.StartTimeColumn,endTimeColumn:"**auto**"===n.EndTimeColumn?null:n.EndTimeColumn,labelColumn:"**auto**"===n.LabelColumn?null:n.LabelColumn,categoryColumn:"**auto**"===n.CategoryColumn?null:n.CategoryColumn,showActionBar:!1!==n.ShowActionBar,actionColumns:n.ActionColumns,actionBarEntries:n.ActionBarEntries,interactiveMode:n.InteractiveMode,showTabs:n.ShowTabs,image:"**none**"===n.Image?null:n.Image,title:"**none**"===n.Title?null:n.Title,firstBlurb:"**none**"===n.FirstBlurb?null:n.FirstBlurb,secondBlurb:"**none**"===n.SecondBlurb?null:n.SecondBlurb,finishView:"**none**"===n.FinishView?null:n.FinishView};return e.Action===ue.AppGlobals.AppState.SHOW_MAP?l.MapType=n.MapType||e.ActionType:e.Action===ue.AppGlobals.AppState.SHOW_GALLERY?l.SortAttr=e.Parameters.length>0?e.Parameters[0]:null:e.Action!==ue.AppGlobals.AppState.SHOW_DETAIL&&e.Action!==ue.AppGlobals.AppState.SHOW_SLIDESHOW||(l.ImageDisplayType=n.ImageStyle),l}},{key:"FindSchema",value:function(e){if(!this.appTemplateModel.SchemaLookup||!this.appTemplateModel.SchemaLookup[e]){for(var t={},a=0;a<this.appTemplateModel.AppData.DataSchemas.length;a++){var n=this.appTemplateModel.AppData.DataSchemas[a];n.IsValid&&(t[n.Name]=n)}this.appTemplateModel.SchemaLookup=t}return this.appTemplateModel.SchemaLookup[e]}},{key:"FindTable",value:function(e){if(null==e||null==this.Tables||0===this.Tables.length)return null;null==this.TableNameIndex&&this.rebuildTableIndex();var t=this.TableNameIndex[e.toLowerCase()];return null!=t?this.Tables[t]:null}},{key:"FindRootTable",value:function(e){var t=this.FindTable(e);return null!=t&&t.IsSlice&&null!=t.SliceSource&&t.SliceSource!==t.Name?this.FindRootTable(t.SliceSource):t}},{key:"ResolveFile",value:function(e,t){var a,n,r=!!(null===(a=this.AppTemplate)||void 0===a?void 0:a.Behavior.FullOfflineCaching);if(null==e||""===e)return e;if(!(0,V.isImageHandle)(e)&&"string"==typeof e&&"http"!==e.substr(0,4)&&"data:"!==e.substr(0,5)){var i=e.split("::");2===i.length&&(t=i[0],e=i[1]);var o=le.WindowWrapper.location.protocol,l=encodeURIComponent(e),u="";r||(u="&appVersion="+this.appTemplateModel.Version);var s,c=U.default.findByName(t,this).rootTable,f=c?c.name():t,p="appName="+encodeURIComponent(this.appTemplateModel.Name)+"&tableName="+encodeURIComponent(f)+u+"&fileName="+l,h=this.FindTableDefinition(t);if(null==h?void 0:h.EnablePartitioning)if(((null===(n=h.SourcePartitionDefinition)||void 0===n?void 0:n.Expression)||"").toLowerCase().indexOf("usersettings(")>=0){var v=this.GetUserSettings(this.appTemplateModel.Name);v&&(p+="&settings="+encodeURIComponent(JSON.stringify(v)))}return s=o+"//"+le.WindowWrapper.location.host+"/template/gettablefileurl?"+(this.appTemplate.secureImageAccess?"secure=1&":"")+p,d.default.endsWith(e&&e.toLowerCase(),".pdf")&&(s+="&n="+encodeURIComponent(e)),s}if((0,V.isImageHandle)(e)){var g=V.default.from(e),b=g.getUrlForImgSrc();e=b||null==g.filePath()?b:this.ResolveFile(g.filePath(),t)}else if("string"==typeof e)if(m.default.InAndroidWebView()){var T=(0,R.getTableFileQueryParsed)(e).fileName;"string"==typeof T&&T.toLowerCase().endsWith(".pdf")&&(e+="&n="+encodeURIComponent(T))}else if(m.default.InIOSWebView()&&!y.default.IsIOSAppWithMinVersion(12.7)&&r){var S=(0,R.getTableFileQueryString)(e)||"";S&&(e=X.GETTABLEFILEURL_BASE+S)}return e}},{key:"sortRowByNumber",value:function(e,t){var a=Number(e[this.ROW_NUMBER_ATTRNAME]),n=Number(t[this.ROW_NUMBER_ATTRNAME]);return null==a||""===a?1:null==n||""===n?-1:a>n?1:a<n?-1:0}},{key:"AddDeleteOrUpdateTableRows",value:function(e,t,a){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.skipWriteTables,o=void 0===i||i,l=r.usedTransactions,u=void 0!==l&&l,s=r.bypassSubmitToServer,c=void 0!==s&&s;t=t||d.default.noop,a=a||d.default.noop,(0,f.default)(e,(function(e,t){var a=function(e){return we(e)?e:void 0};switch(e.type){case"AddTableRow":return t(a(n.CheckAddRequest(e,u)));case"UpdateTableRow":return t(a(n.CheckUpdateRequest(e)));case"DeleteTableRow":return t(a(n.CheckDeleteRequest(e)));default:return t({errorMessage:"AddDeleteOrUpdateTableRows was passed a request of unknown type: ".concat(e.type),request:e})}}),(function(r){if(r){var i=r.request,l=r.errorMessage;a({request:i,errorMessage:l})}else{var s=!1,d=new R.NestedStore;(0,f.default)(e,(function(e,t){var a=function(e,a){s=s||!!e,d.merge(a),t()},r=function(a){return t({request:e,errorMessage:a})},i={skipWriteTables:o,usedTransactions:u,bypassSubmitToServer:c};switch(e.type){case"AddTableRow":n.AddTableRow(e,a,r,i);break;case"UpdateTableRow":n.UpdateTableRow(e,a,r,i);break;case"DeleteTableRow":n.DeleteTableRow(e,a,r,i)}}),(function(e){if(e){var r=e.request,i=e.errorMessage;return b.default.warnToDevConsole("unexpected error in AddDeleteOrUpdateTableRows:\n",i,r),void a({request:r,errorMessage:i})}u||n.Snapshot(d),t(s)}))}}))}},{key:"CheckAddRequest",value:function(e,t){var a=function(t){return b.default.AddTraceContext("ERROR in AddTableRow: ".concat(t)),{request:e,errorMessage:t}},n=U.default.findByName(e.tableName,this),r=n.table,i=n.tableSchema,o=n.tableDefinition;if(null==r)return a("Table ".concat(e.tableName," not found"));if(null==i)return a("TableSchema ".concat(e.tableName," not found"));if(null==o)return a("TableDefinition ".concat(e.tableName," not found"));if(!r.allowsAdd(this))return a("Table ".concat(e.tableName," does not allow new entries"));var l=r.rootTable();if(null==l)return a("Base table of slice ".concat(e.tableName," not found"));var u=d.default.clone(e.row),s=u[l.keyAttribute().name()];if(!t&&null!=l.findRow(s))return a("".concat(Ie("There is already a row with the key:")," ").concat(s));return{table:r,rootTable:l,tableSchema:i,tableDefinition:o,newRow:u,keyValue:s}}},{key:"AddTableRow",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.usedTransactions,i=n.skipWriteTables,o=n.bypassSubmitToServer;t=t||d.default.noop,a=a||d.default.noop,b.default.AddTraceContext("AddTableRow");var l=this.CheckAddRequest(e,r);if(we(l))a(l.errorMessage);else{var u=l.table,s=l.rootTable,c=l.tableSchema,f=l.keyValue,p=l.newRow;if(!r){if(u.isSlice()){var h=new j.default(this,c);c.allBaseTableAttributes().forEach((function(e){if(e.isValid()&&!c.isInSlice(e.name())&&!(e.name()in p)){(0,b.doWeEverHitThis)("Missing attribute in AddTableRow");var t=e.hasDefaultExpression()?e.defaultExpressionEvalTree().run(h):null;"function"==typeof t?t((function(e,t){p[t.name()]=W.default.valueToWireFormat(e,t.type(),t.auxData())}),e):p[e.name()]=W.default.valueToWireFormat(t,e.type(),e.auxData())}})),e.tableName=s.name()}s.createRow(p)}var v=new R.NestedStore;if(v.for(s.name()).store(f,p),!r){this.onDataChange();var m=this.updateVirtualColumns(p,s,c);v.merge(m)}var g=new Y.default.AddTableRowAction(e);i||this.Snapshot(v),o||this.Submit(g),this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(!1,v)}}},{key:"CheckDeleteRequest",value:function(e){var t=function(t){return b.default.AddTraceContext("ERROR in DeleteTableRow: ".concat(t)),{request:e,errorMessage:t}},a=U.default.findByName(e.tableName,this),n=a.table,r=a.tableSchema,i=a.tableDefinition;if(null==n)return t("Table ".concat(e.tableName," not found"));if(null==r)return t("TableSchema ".concat(e.tableName," not found"));if(null==i)return t("TableDefinition ".concat(e.tableName," not found"));if(!n.allowsDelete(this))return t("Table ".concat(e.tableName," does not allow deletes"));var o=n.rootTable();if(null==o)return t("Base table of slice ".concat(e.tableName," not found"));var l=e.row||o.findRow(e.rowKey);if(null==l)return t("Row ".concat(e.rowKey," not found"));var u=l[o.keyAttribute().name()];return null==u?t("Row ".concat(e.rowKey," has an empty key")):{table:n,rootTable:o,tableDefinition:i,tableSchema:r,thisRow:l,keyValue:u}}},{key:"DeleteTableRow",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.usedTransactions,i=n.skipWriteTables,o=n.bypassSubmitToServer;t=t||d.default.noop,a=a||d.default.noop,b.default.AddTraceContext("DeleteTableRow");var l=this.CheckDeleteRequest(e);if(we(l))a(l.errorMessage);else{var u=l.table,s=l.rootTable,c=l.tableSchema,f=l.thisRow,p=l.keyValue;u.isSlice()&&(e.tableName=s.name()),r||s.deleteRow(p);var h=new R.NestedStore;if(h.for(s.name()).store(p,null),!r){this.onDataChange();var v=this.updateVirtualColumns(f,s,c);h.merge(v)}r||(f[c.keyAttribute().name()]=e.rowKey,e.row=f);var m=new Y.default.DeleteTableRowAction(e);i||this.Snapshot(h),o||this.Submit(m),this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(!1,h)}}},{key:"CheckUpdateRequest",value:function(e){var t=function(t){return b.default.AddTraceContext("ERROR in UpdateTableRow: ".concat(t)),{request:e,errorMessage:t}},a=U.default.findByName(e.tableName,this),n=a.table,r=a.tableSchema,i=a.tableDefinition;if(null==n)return t("Table ".concat(e.tableName," not found"));if(null==r)return t("TableSchema ".concat(e.tableName," not found"));if(null==i)return t("TableDefinition ".concat(e.tableName," not found"));if(!n.allowsUpdate(this))return t("Table ".concat(e.tableName," does not allow updates"));var o=n.rootTable();if(null==o)return t("Base table of slice ".concat(e.tableName," not found"));var l=d.default.clone(e.row),u=o.keyAttribute().name(),s=l[u],c=o.findRow(s);return null==c?t("Updated row with key ".concat(s," cannot be found")):{table:n,rootTable:o,tableSchema:r,tableDefinition:i,newRow:l,keyAttrName:u,keyValue:s,oldRow:c}}},{key:"UpdateTableRow",value:function(e,t,a){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.usedTransactions,o=r.skipWriteTables,l=r.bypassSubmitToServer;t=t||d.default.noop,a=a||d.default.noop,b.default.AddTraceContext("UpdateTableRow");var u=this.CheckUpdateRequest(e);if(we(u))a(u.errorMessage);else{var s=u.rootTable,c=u.tableSchema,f=u.tableDefinition,p=u.newRow,h=u.keyAttrName,v=u.keyValue,m=u.oldRow,g=d.default.clone(m);i||s.replaceRow(p);var y=new R.NestedStore;if(y.for(s.name()).store(v,p),!i){this.onDataChange();var T=R.NestedStore.merge(this.updateVirtualColumns(g,s,c),this.updateVirtualColumns(p,s,c));y.merge(T)}m[h]=v;var S=e.tableName===X.userSettingsTableName,A={immediateSync:S,enqueueChanges:!S};if(null===(n=this.nativeProviderFor(f))||void 0===n||n.OnLocalUpdateRow({tableName:e.tableName,row:e.row,oldRow:g,nextSteps:A}),A.enqueueChanges){var w=new Y.default.UpdateTableRowAction(e);o||this.Snapshot(y),l||this.Submit(w)}this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(A.immediateSync,y)}}},{key:"onDataChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timestampString,a=void 0===t?(new Date).toISOString():t,n=e.logDelta,r=e.transaction;this.DataStamp=a,delete this.cachedUserSettingsDataContext,this.dataManager&&this.dataManager.onDataChange(n,r),k.default.dataStamp=a}},{key:"shouldEncryptLocalData",value:function(){return this.appTemplateModel.Behavior.EncryptLocalData}},{key:"allowScanOverride",value:function(){var e,t,a=null===(t=null===(e=null==this?void 0:this.AppTemplate)||void 0===e?void 0:e.Presentation)||void 0===t?void 0:t.AllowScanOverride;return!1!==a}},{key:"allowLatLongOverride",value:function(){var e,t,a=null===(t=null===(e=null==this?void 0:this.AppTemplate)||void 0===e?void 0:e.Presentation)||void 0===t?void 0:t.AllowScanOverride;return!1!==a}},{key:"getSortHandleWidth",value:function(){return X.SORTHANDLE_WIDTH}},{key:"startBackgroundSync",value:function(){var t,a=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{initiatedBy:"Polling"},r=this.NumDelayedActions()+this.NumProcessingActions(),i=this.dataManager.currentTransaction;if(!(this.NeedsUsageScopesConsent()||x.Common.InitializingApp||this.backgroundSyncInProgress||this.InASyncCall||(null==i?void 0:i.started)||0!==r)){var o=new Date,l=null!==(t=n.progressHandle)&&void 0!==t?t:k.default.syncProgressHandle;this.backgroundSyncProgressHandle=l;var u=new e(this);this.pendingAppModel=u;var s=this.DataStamp,c=JSON.stringify(ue.AppGlobals.AppState.AppTemplate),d=function(e){var t;a.backgroundSyncInProgress=!1,ue.AppGlobals.StateChangeHandler.ShowFinishBackendCall(),b.default.logToDevConsole("Background sync succeeded"),(null==e?void 0:e.IsRunnable)&&a.DataStamp===s&&a.pendingAppModel===u&&JSON.stringify(ue.AppGlobals.AppState.AppTemplate)===c?(u.deferIfBackgroundSync((function(){u.SyncSuccess()})),O.logger.logAppEvent(M.AppEventName.BackgroundSyncSucceeded),u.ReadFromLocalCache=!0,u.readyToSwap=!0,u.inBackgroundSync=!1,(null===(t=null===window||void 0===window?void 0:window.AppModel)||void 0===t?void 0:t.pendingAppModel)===u&&ue.AppGlobals.AppModel.swapInPendingAppModel(),(0,F.recordSyncMetrics)(o,a.lastSuccessfulSyncTimeMs(),{InitiatedBy:n.initiatedBy,Visibility:k.default.syncState.visibility,Result:"success",Background:"true"})):(b.default.logToDevConsole("but the new app template could not be used"),u.Dispose(),a.discardPendingAppModel(),(0,F.recordSyncMetrics)(o,a.lastSuccessfulSyncTimeMs(),{InitiatedBy:n.initiatedBy,Visibility:k.default.syncState.visibility,Result:"not_usable",Background:"true"})),l.finish()},f=function(e){b.default.logToDevConsole("Background sync failed"),O.logger.logAppEvent(M.AppEventName.BackgroundSyncFailed),ue.AppGlobals.StateChangeHandler.ShowFinishBackendCall(),a.backgroundSyncInProgress=!1,a.SyncFailure(),a.discardPendingAppModel(),(0,F.recordSyncMetrics)(o,a.lastSuccessfulSyncTimeMs(),{InitiatedBy:n.initiatedBy,Visibility:k.default.syncState.visibility,Result:"failure",Background:"true"}),l.raiseError(e)};this.backgroundSyncInProgress=!0,b.default.logToDevConsole("Starting a background sync"),b.default.AddTraceContext("Starting background sync"),u.inBackgroundSync=!0,u.readyToSwap=!1,ue.AppGlobals.StateChangeHandler.ShowStartBackendCall(),l.start(n),u.Initialize(l,d,f)}}},{key:"deferIfBackgroundSync",value:function(e){this.inBackgroundSync?this.deferredUntilSwap.push(e):e()}},{key:"swapInPendingAppModel",value:function(){var e,t,a,n,r,i=this;if(this.NumDelayedActions()+this.NumProcessingActions()>0)this.discardPendingAppModel();else if(this.pendingAppModel&&this.pendingAppModel.readyToSwap&&!this.InASyncCall){if(null===(t=null===(e=null===window||void 0===window?void 0:window.AppState)||void 0===e?void 0:e.CurrentUIState)||void 0===t?void 0:t.FormUIState){if(this.appTemplateModel.Version!==this.pendingAppModel.AppTemplate.Version)return;if(null===(r=null===(n=null===(a=null===window||void 0===window?void 0:window.AppState)||void 0===a?void 0:a.CurrentUIState)||void 0===n?void 0:n.FormUIState)||void 0===r?void 0:r.RestoreState)return;var o=this.dataContext().pendingSaves().byTable,l=!1;if(d.default.keys(o).forEach((function(e){var t=i.pendingAppModel.findTableCollection(e).table;d.default.values(o[e]).forEach((function(e){if(e.rowKey)if(null==t)l=!0;else{var a=t.findRow(e.rowKey);null!=a&&d.default.isEqual(a,e.initialData)||(l=!0)}}))})),l)return}else{var u=document.activeElement;if(u&&("INPUT"===u.tagName||"TEXTAREA"===u.tagName))return}if(this.pendingAppModel.Disposed)return void b.default.ReportError({errorMessage:"Tried to swap in disposed pendingAppModel"});if(this.pendingAppModel.Tables.some((function(e){return e.Disposed})))return void b.default.ReportError({errorMessage:"Tried to swap in pendingAppModel with disposed Tables"});try{b.default.AddTraceContext("Swapping in pending AppModel");for(var s=this.pendingAppModel;s.deferredUntilSwap.length;){s.deferredUntilSwap.shift()()}ke(s);var c=s.AppTemplate;ue.AppGlobals.AppModel.OnAppTemplateLoad(c),Z.JeeneeBrowserAPI.OnAppTemplateLoad(c),ue.AppGlobals.ViewManager.OnAppTemplateLoad(c,!0),ue.AppGlobals.AppState.OnAppTemplateLoad(c),(0,ce.installOrUpdateServiceWorker)(),O.logger.logAppEvent(M.AppEventName.BackgroundSyncAppModelSwap)}catch(e){b.default.ReportError({errorMessage:"error switching to pending AppModel",error:e}),b.default.warnToDevConsole("error occurred when swapping in pending AppModel"),b.default.logToDevConsole(e),ue.AppGlobals.AppModel.discardPendingAppModel()}}}},{key:"discardPendingAppModel",value:function(){this.pendingAppModel&&(b.default.AddTraceContext("Discarding pending app model"),this.pendingAppModel.deferredUntilSwap=[],this.pendingAppModel.Dispose(),delete this.pendingAppModel,this.backgroundSyncProgressHandle&&(this.backgroundSyncProgressHandle.finish(),delete this.backgroundSyncProgressHandle))}},{key:"SyncData",value:function(e,t,a,n){var r=this;b.default.AddTraceContext("appModel.SyncData"),null==e||e.start(t);var i=new Date;this.ReadFromLocalCache=!1;try{this.Initialize(e,(function(e){r.ReadFromLocalCache=!0,null!=e&&(e.IsRunnable?(ue.AppGlobals.AppModel.OnAppTemplateLoad(e),Z.JeeneeBrowserAPI.OnAppTemplateLoad(e),ue.AppGlobals.ViewManager.OnAppTemplateLoad(e),ue.AppGlobals.AppState.OnAppTemplateLoad(e)):ue.AppGlobals.ViewManager.ShowErrorScreen("This app '"+e.ShortName+"' is in an invalid state. Please contact the app creator.")),(0,F.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:k.default.syncState.visibility,Result:"success",Background:"false"}),a(),(0,ce.installOrUpdateServiceWorker)()}),(function(e){r.ReadFromLocalCache=!0,r.RecordSyncEnd(),(0,F.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:k.default.syncState.visibility,Result:"failure",Background:"false"}),n(e),(0,ce.installOrUpdateServiceWorker)()}),(function(e){r.ReadFromLocalCache=!0,r.RecordSyncEnd(),(0,F.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:k.default.syncState.visibility,Result:"flush_load_failure",Background:"false"}),n(e),(0,ce.installOrUpdateServiceWorker)()}))}catch(e){ue.AppGlobals.AppModel.ReadFromLocalCache=!0,n((0,ie.asError)(e).message)}}},{key:"backendSync",value:function(t,a,n,r){var i=this;if(this.RecordSyncStart(),this.appTemplateModel.IsValid&&this.appTemplateModel.Name===ue.AppGlobals.AppState.AppTemplate.Name){this.ResetSyncFailures(),(0,de.autoConnect)();var o=this.NumProcessingActions()+this.NumDelayedActions(),l=setInterval((function(){var u,s,c=(0,oe.getSyncErrorHandler)(i.appTemplateModel.Id,(function(){clearInterval(l)}),!1);if(null===(u=i.syncQueue)||void 0===u||u.Check(t,c),t){var d={remainingSteps:i.NumProcessingActions()+i.NumDelayedActions(),totalSteps:o};t.setSyncQueueStatus(d)}if(0===i.NumProcessingActions())if(clearInterval(l),0===i.NumDelayedActions()&&0===i.NumProcessingActions())if(null==t||t.completeSection("Queue"),i===ue.AppGlobals.AppModel&&i.InASyncCall){var f=new e(i);f.Initialize(t,(function(e){if(ue.AppGlobals.AppModel.InASyncCall){var t=i.RecordSyncEnd();f.SyncSuccess(t),f.ReadFromLocalCache=!0,ke(f),a(e)}else f.Dispose()}),(function(e){i.SyncFailure(),i.RecordSyncEnd(),n(e)}))}else i.initialize(t,(function(e){i.RecordSyncEnd(),i.SyncSuccess(),a(e)}),(function(e){i.RecordSyncEnd(),n(e)}));else"function"==typeof r&&r(null!==(s=null==t?void 0:t.getErrors())&&void 0!==s?s:"")}),200)}else null==t||t.completeSection("Queue"),this.initialize(t,(function(e){var t=i.RecordSyncEnd();i.SyncSuccess(t),a(e)}),(function(e){i.RecordSyncEnd(),n(e)}))}},{key:"initializeStorageManager",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.AppGlobals.AppState.AppTemplate,t=e.Name,a=e.Id,n=e.Version,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue.AppGlobals.AppState.UserInformation.Id;this.storageManager=new J.default({tentativeTemplateName:t,tentativeTemplateId:a,appTemplateVersion:n,userId:r})}},{key:"Initialize",value:function(e,t,a,n){var r=this;b.default.AddTraceContext("appModel.Initialize",{inNestedSync:this!==ue.AppGlobals.AppModel}),this.storageManager||this.initializeStorageManager();var i=function(){var i,o=r!==ue.AppGlobals.AppModel;if(r.ReadFromLocalCache){r.localState=null!==(i=r.storageManager.validStorageInterface)&&void 0!==i?i:r.storageManager.defaultStorageInterface;var l=J.default.readUserRollouts(),u=r.localState.GetOwnerRollouts();(l||u)&&r.dynamicRollouts.restoreFromStorage({ownerDynamicRollouts:u,userDynamicRollouts:l});var s=r.lastSuccessfulSyncTime();s&&r.onDataChange({timestampString:s})}else o&&(r.localState=r.storageManager.defaultStorageInterface);r.actionNames=null,r.ReadFromLocalCache&&r.LocalStateIsValid()?(null==e||e.completeSection("Queue"),r.initialize(e,t,a)):(o||r.LocalStateIsValid()||r.ClearLocalState(),r.ReadFromLocalCache&&(null==e||e.setSyncingStatus(!0)),r.backendSync(e,t,a,n))};this.ReadFromLocalCache?(ue.AppGlobals.AppState.ForceWipeUserData&&(this.ClearPrivateData(),ue.AppGlobals.AppState.ForceWipeUserData=!1),ue.AppGlobals.AppState.ForceRefreshAppDefinition&&(this.ClearTemplateData(),ue.AppGlobals.AppState.ForceRefreshAppDefinition=!1),this.ReadLocalState((function(e){return e&&b.default.warnToDevConsole(e),p.default.nextTick(i)}))):i()}},{key:"RecordSyncStart",value:function(){this.InASyncCall=!0,this.syncStartTime=Date.now()}},{key:"RecordSyncEnd",value:function(){var e;if(this.InASyncCall=!1,this.syncStartTime){var t=Date.now()-this.syncStartTime;try{(null===(e=window.parent)||void 0===e?void 0:e.recordSyncTime)&&window.parent.recordSyncTime(t/1e3)}catch(e){}return delete this.syncStartTime,t}}},{key:"CancelSync",value:function(){b.default.AddTraceContext("appModel.CancelSync"),this.RecordSyncEnd(),(0,_.abortOutstandingCalls)()}},{key:"OnAppTemplateLoad",value:function(e){var t;b.default.AddTraceContext("appModel.OnAppTemplateLoad"),null==(null===(t=null==e?void 0:e.Behavior)||void 0===t?void 0:t.Description)&&d.default.set(e,"Behavior.Description",{}),m.default.detect();var a=m.default.Locale();if("en-us"===a.toLowerCase()){var n={weekdaysMin:"S_M_T_W_T_F_S".split("_")};v.default.updateLocale(a,n)}else v.default.locale(a);(0,se.$TSFixMeMaybeNull)(ue.AppGlobals.AppState.AppTemplate.Name),(this.appTemplateModel.Name&&d.default.toLower(this.appTemplateModel.Name)===d.default.toLower(ue.AppGlobals.AppState.AppTemplate.Name)||this.appTemplateModel.Id&&ue.AppGlobals.AppState.AppTemplate.Id===this.appTemplateModel.Id)&&ue.AppGlobals.AppState.SetCurrentTemplate(this.AppTemplate),k.default.setAppTemplate(this.appTemplate),this.RequiresSamplesUser(e)?ue.AppGlobals.AppState.SetSamplesUser():ue.AppGlobals.AppState.ReadUserInfoFromUStore(),this.startSyncQueue(this.appTemplate),this.NeedsUsageScopesConsent()||this.SetupGeolocationListener(),this.StartGeocodingTableData(),this.appTemplate.loadPredictors(),this.appTemplate.loadOcrExtractors()}},{key:"SetupGeolocationListener",value:function(){var e=this.appTemplate.usesLocation;if(e&&!Se){Se=C.default.addListener({interval:6e4,enableHighAccuracy:!1})}!e&&Se&&(C.default.removeListener(Se),Se=null)}},{key:"ProcessAppTemplate",value:function(e){var t,a=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;b.default.AddTraceContext("appModel.ProcessAppTemplate"),this.Tables=null!==(t=this.Tables)&&void 0!==t?t:[];var o=this.appTemplateModel.AppData.DataSets.filter((function(e){return e.IsValid}));this.appTemplateModel.IsRunnable&&this.GetTables(o,r,i,(function(t){b.default.AddTraceContext("GetTables callback - tablesArray count: "+t.length),a.Tables=t,a.appTemplateModel.AppData.TableSlices.filter((function(e){return e.IsValid})).forEach((function(e){var t=a.MakeTable(e.Name);t.IsSlice=!0,t.SliceSource=e.SourceTable,a.Tables.push(t)})),a.ProcessTables(),"function"==typeof e&&e()}),n)}},{key:"ProcessTables",value:function(){var e=this,t=[this.appTemplateModel.Presentation.LogoUrl,"https://www.appsheet.com/content/img/favicon64.ico","https://www.appsheet.com/content/img/pageart/draggable-pin-white-2x.png","https://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png","https://mts.googleapis.com/maps/vt/icon/name=icons/spotlight/directions_drag_cross_67_16.png&scale=4"],a=function(t,a,n,r){if("function"==typeof r&&(y.default.IsIOSAppWithMinVersion(4.4)||y.default.IsAndroidAppWithMinVersion(6.4))){var i=[],o=[],u=[],s=[],c=[],p=[/https?:\/\/drive\.google\.com\/open\?/];(0,f.default)(a.Attributes,(function(a,n){var r,l,d,p,h,v;if(a.IsValid)switch(a.Type){case e.IMAGE_TYPE:case e.THUMBNAIL_TYPE:case e.DRAWING_TYPE:case e.SIGNATURE_TYPE:i.push(a);break;case e.FILE_TYPE:u.push(a);break;case e.SHOW_TYPE:(r=new W.default(a)).isShowImage()&&(l=r.showContent(e.dataContext()))&&o.push(l);break;case e.XY_TYPE:r=new W.default(a),p=new j.default(e),v=new Set,(h=r.auxData().KMLFileUrl)&&s.push(h),(d=r.baseImage(p))&&v.add(d);var m,g=ge(t.length?t:[{}]);try{for(g.s();!(m=g.n()).done;){var y=m.value;p.replaceRowData(y),(d=r.baseImage(p))&&v.add(d)}}catch(e){g.e(e)}finally{g.f()}return void(0,f.default)(Array.from(v),(function(e,t){var a=E.ImageMapType.getForUrl(e);a.whenReady((function(e){if(null==e)for(var n=1;n<=E.ImageMapType.CACHE_MAX_ZOOM;n++)c=c.concat(a.getAllTileUrls(n));t()}))}),(function(){return n()}))}n()}),(function(a){a&&b.default.warnToDevConsole(a),r(function(){var a=[];if(i.length>0)for(var r=0;r<t.length;r++)for(var f=t[r],h=0;h<i.length;h++){var v=f[i[h].Name];if(null!=v&&"object"!==(0,l.default)(v)&&""!==v&&!v.startsWith("data:")){var m=x.Common.FlexImageUrl(e.ResolveFile(v,n));a.push(m)}}if(u.length>0)for(var g=0;g<t.length;g++)for(var y=t[g],b=0;b<u.length;b++){var T=y[u[b].Name];if(null!=T&&"object"!==(0,l.default)(T)&&""!==T)for(var S=e.ResolveFile(T,n),A=0;A<p.length;A++)S&&!p[A].test(S)&&a.push(S)}if(o.length>0)for(var C=0;C<o.length;C++){var E=o[C];null!=E&&"object"!==(0,l.default)(E)&&""!==E&&a.push(x.Common.FlexImageUrl(E))}return c.forEach((function(e){return a.push(e)})),s.forEach((function(e){return a.push(e)})),c.length&&(0,w.preloadForOffline)(),a=d.default.uniq(a)}())}))}},n=[],r=[],i=[];b.default.AddTraceContext("ProcessTables - this.Tables count: "+this.Tables.length);var o=this.appTemplateModel.Id;o&&"c37bc8a4-6b53-4e71-812c-2348072cbf2e"!==o&&(r=r.concat(o)),this.Tables.forEach((function(t){if(!t.IsSlice){var o=e.FindTableDefinition(t.Name);if(null!=o){var l=e.FindSchema(o.SchemaName);if(null!=l){i.push(t.Name);var u=new H.default(l).keyAttribute();if(t.keyAttrName=u.name(),b.default.Debug()){var s=d.default.uniqBy(t.Rows,(function(e){return e[t.keyAttrName]}));if(t.Rows.length!==s.length){var c=d.default.keys(d.default.pickBy(d.default.groupBy(t.Rows,(function(e){return e[t.keyAttrName]})),(function(e){return e.length>1})));b.default.warnToDevConsole("removed ".concat(t.Rows.length-s.length," rows with duplicate keys ")+"from table ".concat(t.Name," with keyAttr ").concat(t.keyAttrName,":\n"),c),t.Rows=s}}try{e.appTemplateModel.Behavior.FullOfflineCaching&&n.push(a.bind(null,t.Rows,l,t.Name))}catch(e){b.default.ReportError({errorMessage:"ProcessTables: Error in getCachedFilesArray for table",tableName:t.Name,error:e})}var f=function(t,a){var n,r=[],i=[],o=ge(a.Attributes);try{for(o.s();!(n=o.n()).done;){var l=n.value;l.IsValid&&l.Type===e.APP_TYPE&&i.push(l)}}catch(e){o.e(e)}finally{o.f()}for(var u=0;u<t.length;u++)for(var s=t[u],c=0;c<i.length;c++){var d=s[i[c].Name];d&&36===d.length&&r.push(d)}return r}(t.Rows,l,t.Name);f.length>0&&(r=r.concat(f))}else{var p=e.appTemplateModel.AppData.DataSchemas||[];b.default.AddTraceContext("TableSchema NOT FOUND for non-slice table "+t.Name,{schemasFrom:p.map((function(e){return e.AutoSchemaFrom}))})}}else{var h=e.appTemplateModel.AppData.DataSets||[];b.default.AddTraceContext("TableDefinition NOT FOUND for non-slice table "+t.Name,{dataSetNames:h.map((function(e){return e.Name}))})}}})),this.rebuildTableIndex(),i=[],this.Tables.forEach((function(t){if(t.IsSlice){var a=e.FindTableDefinition(t.Name),n=e.FindTable(t.SliceSource);i.push(t.Name),null==a||null==n||n===t?(t.IsValid=!1,b.default.ReportErrorOnce({errorMessage:"Seems like an invalid table slice",tableName:t.Name,sliceSource:t.SliceSource,tableDefinitionMissing:null==a,sourceTableMissing:null==n,sourceTableEqualsSlice:n===t})):t.keyAttrName=n.keyAttrName}}));var u=function(e){var t;(null===(t=ue.AppGlobals.ViewManager)||void 0===t?void 0:t.sideMenu)&&!d.default.isEqual(e,d.default.pick(ue.AppGlobals.ViewManager.sideMenu.state,d.default.keys(e)))&&ue.AppGlobals.ViewManager.sideMenu.setState(e),k.default.setCachingProgress(e)};u({totalFilesRequested:null,totalFilesToCache:null,filesCached:null,filesWithError:null}),this.appTemplateModel.Behavior.FullOfflineCaching&&(0,f.default)(n,(function(e,a){e((function(e){t=t.concat(e),a()}))}),(function(a){a&&b.default.warnToDevConsole(a),(t=d.default.uniq(t)).length>1&&u({totalFilesRequested:t.length,totalFilesToCache:t.length,filesCached:null,filesWithError:null}),Z.JeeneeBrowserAPI.cacheFiles(e.appTemplateModel,t)})),Z.JeeneeBrowserAPI.setAuthCookie(),Z.JeeneeBrowserAPI.subscribeToApps(this.appTemplateModel.Name,r)}},{key:"MatchesAppNameOrId",value:function(e){return this.AppTemplate&&(this.appTemplateModel.Name===e||this.appTemplateModel.Id===e)}},{key:"fetchAppTemplate",value:function(e,t,a){var n;return Te(this,void 0,void 0,i.default.mark((function r(){var o,l,u,s;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o="/api/template/"+e+"/",l=function(t){var a=ue.AppGlobals.AppModel.appTemplate&&ue.AppGlobals.AppModel.appTemplate.lastModified();ue.AppGlobals.AppModel.MatchesAppNameOrId(e)&&a&&t.setRequestHeader("If-Modified-Since",a)},r.next=4,ue.AppGlobals.AppModel.makeGetAppTemplateParamsAsync(e,a);case 4:return u=r.sent,null!=t&&(u.version=t),this.inBackgroundSync&&(u.isBackgroundSync=!0),(s=null===(n=this.localState)||void 0===n?void 0:n.GetSyncToken())&&(u.syncToken=s),r.abrupt("return",$.postJSONAsync(o,u,l));case 10:case"end":return r.stop()}}),r,this)})))}},{key:"redirectIfNeeded",value:function(e,t){var a=this;return new Promise((function(n){var r=le.WindowWrapper.location.href,i=!1;"sync"===t&&re.ReactRootUIConfig.needsReload(e)&&(i=!0,r=re.ReactRootUIConfig.getRedirectUrl(e,r)),A.default.shouldBeUnloaded(e)&&(i=!0,r=(0,D.replaceGuid)(r,e.Id)),r!==le.WindowWrapper.location.href?le.WindowWrapper.location.href=r:i?(a.ClearTemplateData(),le.WindowWrapper.location.reload()):n()}))}},{key:"GetAppTemplateAsync",value:function(e,t){var a,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!0},o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return Te(this,void 0,void 0,i.default.mark((function u(){var s,c,f,p,h,v,g,y,T,S,A,w,C,E,R,I,N,_,D,L,P,F,G,V,B,U,H,W,j,q,Y=this;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.ReadFromLocalCache||!this.LocalStateIsValid()){i.next=10;break}if(s=this.GetTemplateResult(),this.setAppTemplate(s),r(s)){i.next=5;break}return i.abrupt("return");case 5:return i.next=7,this.redirectIfNeeded(s,"local cache");case 7:this.ProcessAppTemplate(o,l),i.next=64;break;case 10:return c=!(!ue.AppGlobals.AppModel.MatchesAppNameOrId(e)||!(null===(a=ue.AppGlobals.AppModel.AppTemplate.Behavior)||void 0===a?void 0:a.UsesGeolocation)),(f=O.logger.startTelemetryLogger()).log(M.AppTelemetryEventName.FetchAppTemplateStart),i.next=15,this.fetchAppTemplate(e,t,c);case 15:if(p=i.sent,!Ce(p)){i.next=21;break}return c=!0,i.next=20,this.fetchAppTemplate(e,t,c);case 20:p=i.sent;case 21:if(!(0,ee.isFailureResponse)(p)){i.next=29;break}return v=(h=p).responseText,g=h.httpStatus,v===b.SYNC_CANCELED_ERROR_MESSAGE?f.log(M.AppTelemetryEventName.FetchAppTemplateCancel):f.log(M.AppTelemetryEventName.FetchAppTemplateError),(0,oe.getSyncErrorHandler)(e,l,this.inBackgroundSync)(v,g),i.abrupt("return");case 29:if(y=null!==(n=p.response)&&void 0!==n?n:{},T=y.AppSheetJSVersion,S=y.Success,A=y.ErrorDescription,w=y.NotModified,C=y.Template,E=y.UserRole,R=y.NestedDataSets,I=y.DataSetFormat,N=y.Timestamp,_=y.FirebaseCustomToken,D=y.ExternalAccounts,L=y.OwnerEmail,P=y.UserConsentedScopes,F=y.UserRollouts,G=y.OwnerRollouts,V=y.SyncToken,B=y.DeltaNotificationSyncToken,U=y.DeprecationStatus,!m.default.InMobileWebView()||"Block"!==U){i.next=36;break}return H=p.httpStatus,W=A||"",(0,oe.getSyncErrorHandler)(W,l,this.inBackgroundSync)(W,H,!0),i.abrupt("return");case 36:if(S){i.next=40;break}return f.log(M.AppTelemetryEventName.FetchAppTemplateError),l("Unable to fetch app definition.\n ".concat(null!=A?A:"Empty app template")),i.abrupt("return");case 40:if(m.default.InMobileWebView()&&"Warning"===U&&0===k.default.toasts.length&&(864e5,k.default.showToastThrottled(he.DeprecationWarningToast,864e5)),this.dynamicRollouts.update({upstreamAppSheetJSVersion:T,ownerDynamicRollouts:G,userDynamicRollouts:F}),Me(j=w?ue.AppGlobals.AppModel.AppTemplate:C,ue.AppGlobals.AppState.AppTemplate)){i.next=48;break}return b.default.ReportError({errorMessage:"Current app changed without canceling sync",thisAppName:this.appTemplateModel.Name,thisAppId:this.appTemplateModel.Id,scopeAppName:j.Name,scopeAppId:j.Id,windowAppName:ue.AppGlobals.AppModel.AppTemplate.Name,windowAppId:ue.AppGlobals.AppModel.AppTemplate.Id,stateAppName:ue.AppGlobals.AppState.AppTemplate.Name,stateAppId:ue.AppGlobals.AppState.AppTemplate.Id,NotModified:w,inAppStartup:ue.AppGlobals.AppState.inAppStartup,inBackgroundSync:this.inBackgroundSync,initializingApp:x.Common.InitializingApp}),l(b.SYNC_CANCELED_ERROR_MESSAGE),f.log(M.AppTelemetryEventName.FetchAppTemplateCancel),i.abrupt("return");case 48:if(f.log(M.AppTelemetryEventName.FetchAppTemplateEnd,{ownerSubscription:j.OwnerSubscription,syncInitiatedBy:k.default.syncState.initiatedBy,syncVisibility:k.default.syncState.visibility}),ue.AppGlobals.AppState.SaveUserRole(E),fe.dynamicRollouts.includeByOwnerId("SendDataNotificationsOnChangeRollout")&&(0,pe.deltaNotificationInstance)().setLatestWatermark(j,B),this.setAppTemplate(j),this.onDataChange({timestampString:N}),_&&Z.JeeneeBrowserAPI.setStorageAuth(_),L&&(j.OwnerEmail=L),D&&(j.ExternalAccounts=D),P&&(j.Behavior.UserConsentedScopes=P),r(this.AppTemplate)){i.next=59;break}return i.abrupt("return");case 59:return i.next=61,this.redirectIfNeeded(j,"sync");case 61:this.deferIfBackgroundSync((function(){Y.WriteSyncResultToLocalStorage(w,V).catch((function(e){var t;b.default.AddTraceContext("getAppTemplateCallback WriteSyncResultToLocalStorage error"),(null===(t=Y.appTemplateModel.Behavior)||void 0===t?void 0:t.LaunchOffline)&&!m.default.IsIFrame()&&l((0,ie.asError)(e).message)}))})),q=R?d.default.keyBy(R,(function(e){return e.Name})):{},this.ProcessAppTemplate(o,l,q,I);case 64:case"end":return i.stop()}}),u,this)})))}},{key:"makeGetAppTemplateParamsAsync",value:function(e,t){var a=this;return new Promise((function(n){return a.MakeGetAppTemplateParams(e,t,n)}))}},{key:"MakeGetAppTemplateParams",value:function(e,t,a){var n,r,i,o,l=!this.MatchesAppNameOrId(e),u=this.GetUserSettings(e);null!=this.SyncInfo.LastSyncTableParams?i=this.getPerTableSyncParams(e):o=this.GetTableTimestamps(e),b.default.logToDevConsole("Syncing with ".concat(i?"perTableParams":"timestamps"),null!=i?i:o);var s={settings:u?JSON.stringify(u):null,getAllTables:!0,syncsOnConsent:!0,syncUI:k.SyncUI[k.default.syncState.ui],initiatedBy:k.default.syncState.initiatedBy,dataNotificationSyncPayload:k.default.syncState.notification,isPreview:m.default.IsIFramePreview(),apiLevel:this.API_LEVEL,supportsJsonDataSets:!0,tzOffset:(new Date).getTimezoneOffset(),locale:navigator.languages?navigator.languages[0]:navigator.language,tableTimestamps:o,perTableParams:i,lastSyncTime:this.lastSuccessfulSyncTime()||"",appStartTime:window.APP_START_TIME||"",dataStamp:this.DataStamp||"",clientId:this.GetClientId(),build:window.AppSheetJSBuild,hasValidPlan:this.AppTemplate&&this.appTemplateModel.HasValidPlan,userConsentedScopes:this.AppTemplate?this.appTemplateModel.Behavior.UserConsentedScopes:null};m.default.InAndroidWebView()?s.androidAppVersion=y.default.AppVersion():m.default.InIOSWebView()&&(s.iosAppVersion=y.default.AppVersion()),!l&&(null===(n=this.AppTemplate)||void 0===n?void 0:n.Version)&&(s.localVersion=this.appTemplateModel.Version);try{(null===(r=window.parent)||void 0===r?void 0:r.getDegreeOfParallelism)&&(this.CustomDegreeOfParallelism=window.parent.getDegreeOfParallelism())}catch(e){}this.CustomDegreeOfParallelism&&(s.customDegreeOfParallelism=this.CustomDegreeOfParallelism);var c=(0,te.getPreviewAsEmail)();if(c&&(s.previewAsEmail=c),t&&!C.default.lastPosition)this.SafeGetLocation((function(e){s.location=e,a(s)}));else if(t&&C.default.lastPosition){var d=C.default.lastPosition.coords,f=d.latitude,p=void 0===f?0:f,h=d.longitude,v=void 0===h?0:h;s.location=C.default.stringifyLatLng(p,v),a(s)}else a(s)}},{key:"GetTableTimestamps",value:function(e){var t={};if(this.GetTablesResult()&&this.MatchesAppNameOrId(e))for(var a=0;a<this.Tables.length;a++){var n=this.Tables[a];if(!n.IsSlice){var r=this.lastTableTimestamp(n.Name);t[n.Name]=n.Timestamp!==r||n.Disposed?null:r}}return t}},{key:"getPerTableSyncParams",value:function(e){var t=new R.NestedStore;if(this.GetTablesResult()&&this.MatchesAppNameOrId(e))for(var a=0;a<this.Tables.length;a++){var n=this.Tables[a];if(!n.IsSlice){var r=this.lastSyncTableParams(n.Name);r&&n.Timestamp===r.time&&!n.Disposed&&t.for(n.Name).store(r)}}return t.toSimpleObject()}},{key:"GetUserSettings",value:function(e){var t,a,n,r,i;if(fe.dynamicRollouts.includeByOwnerId("ClientRetainUserSettings"))return(!e||(null===(t=this.localState)||void 0===t?void 0:t.matches(e)))&&null!==(i=null===(r=null===(n=null===(a=this.localState)||void 0===a?void 0:a.GetTable(X.userSettingsTableName))||void 0===n?void 0:n.Rows)||void 0===r?void 0:r[0])&&void 0!==i?i:null;if(!e||this.MatchesAppNameOrId(e)){var o=this.FindSchema(X.userSettingsSchemaName);if(o)if(new H.default(o)){var l=d.default.find(this.Tables,(function(e){return e.Name===X.userSettingsTableName}));if(null==l?void 0:l.Rows)return l.Rows[0]}}return null}},{key:"userSettingsDataContext",value:function(){if(this.cachedUserSettingsDataContext)return this.cachedUserSettingsDataContext;var e=this.FindSchema(X.userSettingsSchemaName);if(e){var t=new H.default(e),a=this.GetUserSettings(),n=new j.default(this,t,a,null);return null!=a&&(this.cachedUserSettingsDataContext=n),n}return null}},{key:"SafeGetLocation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,a=!1;if(C.default.lastPosition){var n=C.default.lastPosition.coords,r=n.latitude,i=void 0===r?0:r,o=n.longitude,l=void 0===o?0:o;e(C.default.stringifyLatLng(i,l))}else{var u={timeout:t,enableHighAccuracy:!1},s=function(t){b.default.warnToDevConsole(t);var n=C.default.stringifyLatLng(0,0);a||(a=!0,e(n))},c=function(t,n){var r=C.default.stringifyLatLng(t,n);a||(a=!0,e(r))};C.default.fetchLatLong(c,s,u)}}},{key:"GetTable",value:function(e,t,a,n,r,i){this.defaultDataProvider.ReadTable(e,t,a,null,null,null,r,i)}},{key:"GetTables",value:function(e,t,a,n,r){var i,o=this;if(this.ReadFromLocalCache&&this.LocalStateIsValid()){if((i=this.GetTablesResult())&&Array.isArray(i)&&i.length)return b.default.AddTraceContext("appModel.GetTables - used local"),void n(i);var l="";i?Array.isArray(i)?i.length||(l="tablesResult array was empty"):l="tablesResult was not an array":l+="tablesResult was null ";var u="appModel.GetTables - tried to use local but ".concat(l);(0,b.doWeEverHitThis)(u)}var s=0,c=0,f={},p=[];if(null==e||0===e.length)return b.default.warnToDevConsole("no tableDefinitions found in AppTemplate, proceeding with empty tables and clearing local state"),b.default.AddTraceContext("appModel.GetTables - empty result"),this.ClearLocalState(),void n(p);b.default.AddTraceContext("appModel.GetTables - getUserTable loop");var h,v=ge(e);try{var m=function(){var e=h.value;if(e.IsValid){s++;var i=function(e,t,a,r,i){if(i){var l=d.default.clone(i);l.Rows=d.default.clone(i.Rows),a&&(l.Timestamp=a),p.push(l),f[e]=!0}else p.push(o.MakeTable(e,t,a,r));++c===s&&(o.deferIfBackgroundSync((function(){p.some((function(e){return e.Disposed}))?b.default.ReportError({errorMessage:"Tried to write disposed tablesResult"}):o.WriteTablesResult(p.filter((function(e){return!e.IsSlice})),{tablesToSkip:f})})),b.default.AddTraceContext("getTableSuccessFn: "+s+" tables"),n(p))};!function(t,n,l,u,s){var c,d,f,p,h=null!=s?s:{},v=h.DataSet,m=h.NotModified,g=h.LastModified,y=h.ETag;if(m){var T=ue.AppGlobals.AppModel.FindTable(l);if(null==T||T.Disposed){null===(c=ue.AppGlobals.AppModel.localState)||void 0===c||c.clearSyncState(),ue.AppGlobals.AppModel===o||null===(d=o.localState)||void 0===d||d.clearSyncState();var S="There was a problem fetching table",A="".concat(S," ").concat(l,". Please try again."),w=ue.AppGlobals.AppModel.findTableCollection(l).table;b.default.ReportErrorOnce({errorMessage:S,tableName:l,thisAppName:o.appTemplateModel.Name,thisAppId:o.appTemplateModel.Id,windowAppName:ue.AppGlobals.AppModel.AppTemplate.Name,windowAppId:ue.AppGlobals.AppModel.AppTemplate.Id,stateAppName:ue.AppGlobals.AppState.AppTemplate.Name,stateAppId:ue.AppGlobals.AppState.AppTemplate.Id,windowTableCount:null===(f=ue.AppGlobals.AppModel.Tables)||void 0===f?void 0:f.length,inAppStartup:ue.AppGlobals.AppState.inAppStartup,inBackgroundSync:o.inBackgroundSync,initializingApp:x.Common.InitializingApp,foundTable:null!=w,foundTableRowCount:null===(p=null==w?void 0:w.rows())||void 0===p?void 0:p.length,isDisposed:!!(null==T?void 0:T.Disposed)}),r(A)}else(0,se.$TSFixMeMaybeNull)(T.Rows),T.Rows.length&&b.default.logToDevConsole("not modified:",T.Name,"(".concat(T.Rows.length,")")),setTimeout((function(){(0,se.$TSFixMeMaybeNull)(T.Rows),i(l,T.Rows,g||T.Timestamp,T.ETag,T)}),1)}else if(v)setTimeout((function(){var e="json"===a?Ee.fromJSON(v).toRowValues():N.CSV.parse(v);e.length&&b.default.logToDevConsole("SENT DATA:",l,"(".concat(e.length,")")),i(l,e,g,y)}),1);else{if(o.NeedsUsageScopesConsent())return void setTimeout((function(){i(l,[])}),1);b.default.ReportErrorOnce({errorMessage:"getUserTable fell into unexpected `GetTable` path",tableName:l,IsAutoCreated:e.IsAutoCreated}),o.GetTable(t,n,l,o.USERSTORE_PROVIDER===u,i,r)}}(o.appTemplateModel.Name,o.appTemplateModel.Version,e.Name,e.ProviderName,t[e.Name])}};for(v.s();!(h=v.n()).done;)m()}catch(e){v.e(e)}finally{v.f()}0===s&&n(p)}},{key:"MakeTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return{Name:e,Rows:t,IsSlice:!1,SliceSource:null,Timestamp:a,ETag:n}}},{key:"tablesByRowCount",value:function(){return d.default.sortBy(ue.AppGlobals.AppModel.Tables.filter((function(e){return e.Rows&&e.Rows.length>0})),(function(e){return(0,se.$TSFixMeMaybeNull)(e.Rows),-e.Rows.length})).map((function(e){return(0,se.$TSFixMeMaybeNull)(e.Rows),[e.Rows.length,e.Name,e]}))}},{key:"ExtractShareInfo",value:function(e,t){var a=this,n="",r="",i=U.default.findByName(e,this).table;if(i){var o=i.rootTable();if(null==o?void 0:o.tableSchema){var l=o.tableSchema,u=o.findRow(t);u&&l.visibleAttributesWithoutShowTypes().forEach((function(t){var r;switch(t.type()){case a.IMAGE_TYPE:case a.THUMBNAIL_TYPE:case a.DRAWING_TYPE:case a.SIGNATURE_TYPE:n+=t.name()+" - "+((0,V.isImageHandle)(u[t.name()])?"(photo being processed)":x.Common.FlexImageUrl(a.ResolveFile(u[t.name()],e)))+"\r\n";break;case a.SHOW_TYPE:break;case a.URL_TYPE:(null==(r=W.default.urlValueFromWireFormat(u[t.name()]))?void 0:r.linkText)&&r.linkText!==r.url?n+=t.name()+" - "+r.linkText+":"+r.url+"\r\n":n+=r?t.name()+" - "+r.url+"\r\n":t.name()+" - \r\n";break;default:n+=t.name()+" - "+t.localizeWireValue(u[t.name()])+"\r\n"}}));var s=l.imageAttributesByImportance().filter((function(e){return e.type()!==a.SIGNATURE_TYPE}))[0];s&&(r=x.Common.FlexImageUrl(this.ResolveFile(u[s.name()],e)))}}return{body:n,image:r}}},{key:"RequiresSamplesUser",value:function(e){return e.IsPublic&&this.SYSTEM_OWNER_IDS.indexOf(e.OwnerId)>=0&&e.Behavior.AuthRequired&&"AppGallery-10305"!==e.Name}},{key:"MakeSliceMappingContext",value:function(e){var t=this.FindSliceDefinition(e);if(null!=t){var a={TableToSliceMapping:{}};return a.TableToSliceMapping[t.SourceTable]=t,a}return null}},{key:"updateVirtualColumns",value:function(e,t,a){var n=this,r=new R.NestedStore;return a.findBaseTableAttributesByType(this.TABLEREF_TYPE).forEach((function(t){var a=e[t.name()],i=U.default.findByName(t.referencedTableName(),n).table;if(i){var o=i.rootTable();if(o){var l=o.tableSchema;if(l){var u=o.lookupTableRow(a),s=null==u?void 0:u.values;if(s&&l.virtualAttributes().length){var c=new j.default(n,l,s),f=d.default.clone(s);if(c.recomputeVirtualColumns(),!d.default.isEqual(f,s)){var p=o.name();r.for(p).store(a,s),null==u||u.invalidate()}}}}}})),r}},{key:"SendQueuedChangesToRecoveryEndpoint",value:function(){return Te(this,void 0,void 0,i.default.mark((function e(){var t,a,n,r,o,l;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.GetQueuedActions()||[],a=[],n=ge(t),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=18;break}if(null==(o=r.value)){e.next=16;break}return e.prev=8,e.next=11,this.defaultDataProvider.RecordRecoveryData(this.appTemplateModel.Name,o.params);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),a.push(e.t0);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(3),n.e(e.t1);case 23:return e.prev=23,n.f(),e.finish(23);case 26:if(!a.length){e.next=30;break}throw(l=new Error(a.map((function(e){return e.message})).join("\n"))).stack=a[0].stack,l;case 30:case"end":return e.stop()}}),e,this,[[3,20,23,26],[8,13]])})))}},{key:"SendCreatorFeedback",value:function(e){var t="/api/template/"+this.appTemplateModel.Id+"/feedback";$.postJSON(t,e,(function(){}),(function(){}))}},{key:"StartGeocodingTableData",value:function(){var e=this;if(!T.default.disabled&&!this.startedGeocoding){this.startedGeocoding=!0;var t={},a=m.default.IsEditorIFramePreview()?5:25,n=function(e,t){e.length>0&&ue.AppGlobals.AppModel.WriteGeocodeResults(e,null,null,t)};this.Tables.forEach((function(r){if(!r.IsSlice){var i=e.findTableCollection(r.Name),o=i.table,l=i.tableSchema,u=i.tableDefinition;if(o&&l&&u){var s=l.findBaseTableAttributesByType("Address").filter((function(e){return e.geocodingEnabled()}));s.length&&function(){for(var r=0,i=0,c=[],f=T.default.region(u.LocaleName),p=T.default.BAD_GEO_VALUE,h=d.default.shuffle(o.rowValues()),v=0;v<h.length;v++){var m=h[v];if(!m._isGeoCoded){if(!e.appTemplateModel.IsDeployable&&r>=25)break;for(var g=0;g<s.length;g++){var y=s[g],A=m["_geo_"+y.name()];if(A){var w=A.split(",");if(2===w.length){if(Number(w[0])===p)continue;if(!(Number(w[0])>p)){m["_latitude"+y.name()]=w[0],m["_longitude"+y.name()]=w[1];continue}}}var C=m[y.name()];if(C&&C.trim())if("continue"===function(){if(C=C.trim(),T.default.addressHasBeenQueued(C))return"continue";var e=l.keyAttribute().name(),u={tableName:o.name(),rowKey:m[e],keyAttrName:e,address:C,addressAttrName:y.name()},s=function(e){var t,o;e.length?(t=e[0].latitude,o=e[0].longitude):(t=p,o=p);var l=U.default.findByName(u.tableName,ue.AppGlobals.AppModel),s=l.table,d=l.tableSchema;if(s&&d){var f=d.keyAttribute();if(d.findAttributeByName(u.addressAttrName)&&f.name()===u.keyAttrName){var h=s.findRow(u.rowKey);if(h)h[u.addressAttrName]===u.address&&(h["_latitude"+u.addressAttrName]=t,h["_longitude"+u.addressAttrName]=o,h._isGeoCoded=!0)}}if(c.push({Address:u.address,LatLong:t+","+o}),++i===r)n(c,u.tableName);else if(i>0&&i%a==0){var v=c;c=[],n(v,u.tableName)}};r++,T.default.geocodeAddress(C,{region:f}).then((function(e){var a=e.status,n=e.results;n?s(n):function(e){if(e===S.ZERO_RESULTS||e===S.INVALID_REQUEST)s([]);else{i++;var a=[S.REQUEST_DENIED];d.default.includes(a,e)&&!t[e]&&(b.default.ReportErrorOnce({errorMessage:"Geocoding of address failed",address:u.address,status:e},e),t[e]=!0,s([]))}}(a)})).catch(b.default.warnToDevConsole)}())continue}m._isGeoCoded=!0}}}()}}}))}}},{key:"WriteGeocodeResults",value:function(e,t,a,n){var r=this.appTemplateModel.Name,i=!this.appTemplateModel.IsDeployable,o=this.appTemplateModel.OwnerId,l="/api/template/geocodeResults?tableName="+encodeURIComponent(n)+"&appName="+encodeURIComponent(r)+"&ownerId="+encodeURIComponent(o)+"&isPrototype="+encodeURIComponent(i);if($.postJSON(l,e,(function(e){null!=t&&t(e)}),(function(){null!=a&&a()})),n&&this.ReadFromLocalCache&&!this.InASyncCall){var u=this.FindRootTable(n);this.WriteTableResult(u)}}},{key:"IsWhitelabelApp",value:function(){var e,t;return!!(null===(t=null===(e=this.appTemplateModel.Behavior)||void 0===e?void 0:e.Description)||void 0===t?void 0:t.IsWhitelabel)}},{key:"findTableCollection",value:function(e,t){return this.dataManager.findTableCollection(e,t)}},{key:"findReferencedRow",value:function(e,t,a){var n=e.referencedTableName();if(!n)return null;var r=this.findTableCollection(n),i=r.table,o=r.tableSchema;if(!i||!o)return null;var l=i.timestamp(),u=o.keyAttribute().name(),s={table:i,tableSchema:o,timestamp:l,appModel:this,keyAttrName:u};return t?null!=(a=null!=a?a:t.getValue(e))?t.getTableRow(i,a,s):null:null!=a?i.findRow(a):null}},{key:"RunExpression",value:function(e){return q.default.create(e).run(new j.default(this))}},{key:"runDisplayName",value:function(e){var t=this.dataContext(),a=e.run(t),n=e.resultAttribute(),r=n.valueToWireFormat(a);return n.localizeWireValue(r)}},{key:"MapActionName",value:function(e,t){var a=this;if(!this.actionNames){var n=this.appTemplateModel.Presentation.ActionNameMappings;if(!n)return e;this.actionNames={},d.default.forEach(n,(function(e){var t=e.ActionName;if(e.NameEval){var n=q.default.create(e.NameEval);e.NameEval.IsPure?a.actionNames[t]=a.runDisplayName(n):a.actionNames[t]=n}else a.actionNames[t]=e.DisplayName}))}var r=this.actionNames[e];return r?"function"==typeof r.run?this.runDisplayName(r):r:t||e}},{key:"Snapshot",value:function(e){b.default.Test()&&b.default.logToDevConsole("Snapshot",e.toSimpleObject()),this.ReadFromLocalCache&&this.WriteTableRows(e.toSimpleObject())}},{key:"Submit",value:function(e){var t,a,n;if(b.default.Test())b.default.logToDevConsole("Submit",e.params);else if(null!=e&&(null!==(t=ue.AppGlobals.AppModel)&&void 0!==t?t:this).EnqueueDelayedAction(e),fe.dynamicRollouts.includeByOwnerId("ClientNoPushDelay"))(this.backgroundSyncInProgress||this.InASyncCall)&&0===this.NumProcessingActions()&&(b.default.logToDevConsole("Canceling sync due to local data change"),this.CancelSync()),(null===(a=this.syncQueue)||void 0===a?void 0:a.AutomaticUpdateSync)&&(this.stopSyncQueue(),this.startSyncQueue(this.appTemplate));else if(!this.ReadFromLocalCache){var r=ue.AppGlobals.AppState.AppTemplate.Id?ue.AppGlobals.AppState.AppTemplate.Id:ue.AppGlobals.AppState.AppTemplate.Name;(0,se.$TSFixMeMaybeNull)(r);var i=(0,oe.getSyncErrorHandler)(r,null,!0);null===(n=this.syncQueue)||void 0===n||n.Check(void 0,i)}}},{key:"ResetSyncFailures",value:function(){this.syncQueue&&this.syncQueue.ResetFailures()}},{key:"NumDelayedActions",value:function(){return this.syncQueue?this.syncQueue.DelayedCount():0}},{key:"NumProcessingActions",value:function(){return this.syncQueue?this.syncQueue.ActiveCount():0}},{key:"totalRows",value:function(){return d.default.sum(this.Tables.filter((function(e){return e.Rows})).map((function(e){return e.Rows.length})))}},{key:"startSyncQueue",value:function(e){this.syncQueue||(this.syncQueue=new K.default(this)),this.syncQueue.Start(e.name());var t=null==this.storageManager.validStorageInterface,a="_restore"in(0,I.parseHash)(this.GetControlState()),n=t||a;this.syncQueue.applySyncSettings(e,n)}},{key:"stopSyncQueue",value:function(){var e;null===(e=this.syncQueue)||void 0===e||e.Stop()}},{key:"GetQueuedActions",value:function(){return null!=this.syncQueue?this.syncQueue.getQueuedActions():null}},{key:"EnqueueDelayedAction",value:function(e){null!=this.syncQueue&&this.syncQueue.Enqueue(e)}},{key:"ShouldDelaySync",value:function(){var e;return this.appTemplateModel.Behavior&&this.appTemplateModel.Behavior.DelayedSync||(null===(e=ue.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.ForceDelayedSync}},{key:"RevokeUserAccess",value:function(t){b.default.AddTraceContext("RevokeUserAccess"),b.default.logToDevConsole("revoking user access"),C.default.removeAllListeners(),ue.AppGlobals.AppModel.ClearPrivateData(),ue.AppGlobals.AppModel.Dispose(),this.syncQueue&&(this.syncQueue.AutomaticUpdateSync=!1),e.reset(),ue.AppGlobals.ViewManager.ShowErrorScreen(t||(0,X.accessDeniedErrorMessage)())}},{key:"ReadLocalState",value:function(e){this.storageManager.readLocalAppData().then((function(){return e()})).catch(e)}},{key:"WriteTableResult",value:function(e){if(e&&this.localState){ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.ShowStorageInProgress();var t=this.shouldEncryptLocalData();this.localState.WriteTableResult(e,{shouldEncrypt:t},(function(e){e&&b.default.warnToDevConsole(e),ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.HideStorageInProgress()}))}}},{key:"WriteTablesResult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.tablesToSkip;ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.ShowStorageInProgress();var n=this.shouldEncryptLocalData();this.localState.WriteTablesResult(e,{tablesToSkip:a,shouldEncrypt:n},(function(e){e&&b.default.warnToDevConsole(e),ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.HideStorageInProgress()}))}},{key:"WriteTableRows",value:function(e){var t=this;d.default.keys(e).forEach((function(a){var n=t.FindRootTable(a),r=t.shouldEncryptLocalData();t.localState.writeTableRows(n,e[a],{shouldEncrypt:r})}))}},{key:"SetControlState",value:function(e){var t;"string"==typeof e&&e.length&&e.indexOf("appName=")<0&&(e="appName=".concat(this.appTemplateModel.Name,"&")+e),null===(t=this.localState)||void 0===t||t.WriteControlState(e)}},{key:"SetViewState",value:function(e){var t;null===(t=this.localState)||void 0===t||t.WriteViewState(e)}},{key:"WriteSyncResultToLocalStorage",value:function(e,t){var a,n=this.dynamicRollouts.getStorageFormat(),r=n.userDynamicRollouts,i=n.ownerDynamicRollouts;return Promise.all([e||null===(a=this.localState)||void 0===a?void 0:a.writeTemplateResult(this.AppTemplate),this.localState.writeOwnerRollouts(i),this.localState.writeSyncToken(t),J.default.writeUserRollouts(r)])}},{key:"NeedsUsageScopesConsent",value:function(){return this.inRollout("userConsent")&&!this.appTemplate.hasValidUsageScopesConsent()}},{key:"RecordUsageScopesConsent",value:function(){var e,t;this.InASyncCall||(this.appTemplate.recordUsageScopesConsent(),null===(t=null===(e=this.localState)||void 0===e?void 0:e.writeTemplateResult(this.AppTemplate))||void 0===t||t.catch((function(e){b.default.ReportError({errorMessage:"Error saving consents to local storage",nestedErrorMessage:(0,ie.asError)(e).message})})),$.postJSON("/api/template/"+this.appTemplateModel.Id+"/userconsent?consentedScopes="+encodeURIComponent(this.appTemplateModel.Behavior.UserConsentedScopes)+"&clientId="+encodeURIComponent(this.GetClientId())),this.SetupGeolocationListener(),ue.AppGlobals.StateChangeHandler.RefreshAppData({initiatedBy:"AppStart"}))}},{key:"AddToImageCache",value:function(e,t){this.localState.AddToImageCache(e,t)}},{key:"SyncSuccess",value:function(e){var t,a=new R.NestedStore,n={},r=ge(this.Tables);try{for(r.s();!(t=r.n()).done;){var i=t.value;!i.IsSlice&&i.Timestamp&&(n[i.Name]=i.Timestamp,a&&a.for(i.Name).store({time:i.Timestamp,etag:i.ETag}))}}catch(e){r.e(e)}finally{r.f()}this.localState.WriteSyncSuccess(this.DataStamp,n,null==a?void 0:a.toSimpleObject(),e),this.MaybeClearImageCache()}},{key:"findPendingImages",value:function(){var e,t,a,n,r=d.default.values(this.dataContext().pendingSaves().byId).map((function(e){return e.rowData})),i=null!==(e=this.GetQueuedActions())&&void 0!==e?e:[],l=null!==(a=null===(t=Re())||void 0===t?void 0:t.GetQueuedActions())&&void 0!==a?a:[],u=null!==(n=[].concat((0,o.default)(i),(0,o.default)(l)).map((function(e){return e.params.row})))&&void 0!==n?n:[];return[].concat((0,o.default)(r),(0,o.default)(u)).reduce((function(e,t){return[].concat((0,o.default)(e),(0,o.default)(d.default.values(t).filter(V.isImageHandle).map((function(e){return V.default.from(e)}))))}),[])}},{key:"hasPendingImages",value:function(){return this.findPendingImages().length>0}},{key:"MaybeClearImageCache",value:function(){this.LocalStateIsValid()&&!this.hasPendingImages()?this.ClearImageCache():O.logger.logEvent(new ae.AppEvent(M.AppEventName.SkippedClearImageCache))}},{key:"SyncFailure",value:function(){this.localState&&this.localState.WriteSyncFailure()}},{key:"ClearPersistedActions",value:function(){var e;this.syncQueue?this.syncQueue.Clear(!0):(null===(e=ue.AppGlobals.AppState)||void 0===e?void 0:e.AppTemplate)&&K.default.RemovePersistedActions(ue.AppGlobals.AppState.AppTemplate.Name)}},{key:"ClearTemplateData",value:function(){var e=this;this.storageManager&&this.storageManager.clearTables().then((function(){return e.storageManager.clearTemplate()})).catch(b.default.warnToDevConsole)}},{key:"ClearControlState",value:function(){this.storageManager&&this.storageManager.clearControlState().catch(b.default.warnToDevConsole)}},{key:"ClearPrivateData",value:function(){this.ClearPersistedActions(),this.ClearLocalState()}},{key:"ClearLocalState",value:function(){this.storageManager&&this.storageManager.clearAll().catch(b.default.warnToDevConsole)}},{key:"ClearImageCache",value:function(){V.default.clearCache(),this.storageManager&&(this.storageManager.clearImageCache().catch(b.default.warnToDevConsole),this.storageManager.clearFilePaths().catch(b.default.warnToDevConsole))}},{key:"LocalStateIsValid",value:function(){return!!this.localState&&this.localState.IsValid()}},{key:"GetClientId",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetClientId()}},{key:"GetViewState",value:function(){return this.localState.readViewState()}},{key:"GetControlState",value:function(){var e=this.localState&&this.localState.GetControlState();if(null!=e&&""!==e&&"null"!==e)try{var t=(0,I.parseHash)(e);if("_restore"in t){var a=JSON.parse(t._restore);(null==a.timestamp||new Date-new Date(a.timestamp)>=this.FORM_RESTORE_STATE_TIMEOUT_MS)&&(delete t._restore,e=(0,D.sortedParams)(t))}}catch(e){b.default.warnToDevConsole(e)}return e}},{key:"GetTablesResult",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetTablesResult()}},{key:"GetTemplateResult",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetTemplateResult()}},{key:"GetFromImageCache",value:function(e){var t;return null===(t=this.localState)||void 0===t?void 0:t.GetFromImageCache(e)}},{key:"SyncInfo",get:function(){return this.localState&&this.localState.SyncInfo||{}}},{key:"lastSyncTimeMs",value:function(e){var t=this.SyncInfo.LastSyncAt,a=e&&this.pendingAppModel&&this.pendingAppModel.DataStamp,n=t?new Date(t).getTime():null,r=a?new Date(a).getTime():null;return Math.max(n,r)||null}},{key:"lastSuccessfulSyncTime",value:function(){return this.SyncInfo.LastSuccessfulSyncAt}},{key:"lastSuccessfulSyncTimeMs",value:function(){var e=this.SyncInfo.LastSuccessfulSyncAt;return e?new Date(e).getTime():null}},{key:"lastSyncedWithin",value:function(e){var t=this.lastSuccessfulSyncTimeMs();return null!=t&&Date.now()-t<e}},{key:"lastTableTimestamp",value:function(e){var t=this.SyncInfo.LastSyncTableTimestamps;return null==t?void 0:t[e]}},{key:"lastSyncTableParams",value:function(e){var t;return(null!==(t=this.SyncInfo.LastSyncTableParams)&&void 0!==t?t:{})[e]}}],[{key:"reset",value:function(){ke(new e)}}]),e}();t.default=Ne},513954:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.convertImages=void 0;var r=n(a(238416)),i=n(a(593186)),o=n(a(895466)),l=a(318926),u=a(218546),s=n(a(962553)),c=n(a(496486)),d=n(a(948415)),f=a(263198),p=a(351101),h=a(166089),v=a(700482),m=a(149313),g=function(e){return Date.now()-new Date(e).getTime()},y=function(e){return e?Math.floor(g(e)/1e3):void 0},b=function(e,t){var a;return t?(a={},(0,r.default)(a,"was".concat(e,"ThisSession"),function(e){return new Date(e).getTime()>window.AppSheetPageLoadTime}(t)),(0,r.default)(a,"secondsSince".concat(e),y(t)),(0,r.default)(a,"hasSyncedSince".concat(e),function(e){return(0,p.getAppModel)().lastSyncedWithin(g(e))}(t)),a):{}},T=function(e,t){try{return Object.assign(Object.assign(Object.assign({mediaType:t.mediaType(),imageHandleType:t.type(),imageHandleValue:t.value(),imageResolution:(0,p.getAppModel)().appTemplate.imageResolution},b("Captured",t.timestamp())),b("Enqueued",e.timestamp)),{secondsSincePhotoStorageCleared:y(f.JeeneeBrowserAPI.lastClearPhotoStorageTime)})}catch(e){return{getErrorReportParamsFailed:e.message}}},S=function(e,t){for(var a=[],n=[],r=0;r<t.model.Attributes.length;r++){var i=t.model.Attributes[r];null!=i&&i.IsValid&&(e.hasOwnProperty(i.Name)?a.push(e[i.Name]):a.push(null),n.push(!!i.IsSensitive))}return{row:a,pii:n}},A=function(e,t,a,n,r){i.default.AddTraceContext("convertImages");var l=function(n,r){setTimeout((function(){var l=o.default.from(a[n],t.sourceTableName());if(l.isValid()){var u=l.filePath();u?(a[n]=u,i.default.AddTraceContext("filePath",{attrName:n,filePath:u}),r()):(i.default.AddTraceContext("getUrlForSync",{attrName:n}),l.getUrlForSync((function(o,u){if(o)return i.default.AddTraceContext("getUrlForSync errored",{attrName:n}),i.default.ReportErrorOnce(Object.assign({errorMessage:"getUrlForSync errored",nestedErrorMessage:o},T(e,l))),void r(o);var s;(null==u||u.startsWith(f.UNABLE_TO_LOAD_IMAGE_PREFIX))&&i.default.ReportErrorOnce(Object.assign({errorMessage:"getUrlForSync returned bad imageUrl",imageUrl:u},T(e,l))),a[n]=u,i.default.AddTraceContext("getUrlForSync succeeded",{attrName:n}),r(null,{attrName:n,imageHandle:l,tableName:t.sourceTableName(),fileName:(s=a,s[t.keyAttribute().name()]+"."+n)})})))}else i.default.ReportErrorOnce(Object.assign({errorMessage:"Tried to upload invalid ImageHandle",imageHandle:l.toDebugString()},T(e,l))),r()}),0)},u=t.allBaseTableAttributes().filter((function(e){return e.isValid()&&function(e){return c.default.includes(v.imageHandleColumnTypes,e.type())}(e)})).map((function(e){return l.bind(undefined,e.name())}));(0,d.default)(u,(function(e,t){e?r(e):n(c.default.compact(t))}))};t.convertImages=A;var w=function(e,t){var a={};e.forEach((function(e){var n=e.attrName;if(n in t){var r=o.default.from(e.imageHandle);r.setFilePath(t[n]),(0,m.$TSFixMeMaybeNull)(h.AppGlobals.AppModel.syncQueue),h.AppGlobals.AppModel.syncQueue.queuedActions.forEach((function(e){r.equals(e.params.row[n])&&((0,m.$TSFixMeMaybeNull)(h.AppGlobals.AppModel.syncQueue),h.AppGlobals.AppModel.syncQueue.PersistAction(e))})),a[e.tableName]=!0}})),h.AppGlobals.AppModel.ReadFromLocalCache&&c.default.keys(a).forEach((function(e){var t=h.AppGlobals.AppModel.FindRootTable(e);t&&h.AppGlobals.AppModel.WriteTableResult(t)}))},C={SerializeAction:function(e){return JSON.stringify(e.params)},DeSerializeAction:function(e){var t=JSON.parse(e);if(null==t)return null;switch(t.actionType){case"AddTableRow":return new C.AddTableRowAction(t);case"DeleteTableRow":return new C.DeleteTableRowAction(t);case"UpdateTableRow":return new C.UpdateTableRowAction(t)}return null}};C.AddTableRowAction=function(e){var t,a,n=this;this.params=e,e.actionType="AddTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(a=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===a?void 0:a.GetSyncToken()),this.ActionType=function(){return n.params.actionType},this.RequestId=function(){return n.params.requestId},this.Execute=function(e,t){n.params.deleteThisAction?"function"==typeof e&&e():function(e,t,a){i.default.AddTraceContext("DBAddTableRow");var n=h.AppGlobals.AppModel.findTableCollection(e.tableName),r=n.rootTable,o=n.rootTableSchema,s=n.tableDefinition;if(!r||!o||!s)return void a("Table ".concat(e.tableName," not found"));e.tableName=r.name();var c={};for(var d in e.row)e.row.hasOwnProperty(d)&&(c[d]=e.row[d]);var f=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof a&&a(e,t)};A(e,o,c,(function(a){var n=function(e){e.Success?(e.RowValues&&w(a,e.RowValues),e.ReturnedFromCache&&l.logger.logAppEvent(u.AppEventName.UsedCachedAddResponse),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):f(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var r=S(c,o),i=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.AddTableRow(i,e,r,n,f)}),f)}(n.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,a){"function"==typeof t&&null!=t&&t(e,a)}))}},C.DeleteTableRowAction=function(e){var t,a,n=this;this.params=e,e.actionType="DeleteTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(a=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===a?void 0:a.GetSyncToken()),this.ActionType=function(){return n.params.actionType},this.RequestId=function(){return n.params.requestId},this.Execute=function(e,t){n.params.deleteThisAction?"function"==typeof e&&e():function(e,t,a){i.default.AddTraceContext("DBDeleteTableRow");var n=h.AppGlobals.AppModel.findTableCollection(e.tableName),r=n.rootTable,o=n.rootTableSchema,s=n.tableDefinition;if(!r||!o||!s)return void a("Table ".concat(e.tableName," not found"));e.tableName=r.name();var c=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof a&&a(e,t)},d=function(e){e.Success?(e.ReturnedFromCache&&l.logger.logAppEvent(u.AppEventName.UsedCachedDeleteResponse),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):c(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var f=S(e.row,o),p=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.DeleteTableRow(p,e,f,d,c)}(n.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,a){"function"==typeof t&&null!=t&&t(e,a)}))}},C.UpdateTableRowAction=function(e){var t,a,n=this;this.params=e,e.actionType="UpdateTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(a=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===a?void 0:a.GetSyncToken()),this.ActionType=function(){return n.params.actionType},this.RequestId=function(){return n.params.requestId},this.Execute=function(e,t){n.params.deleteThisAction?"function"==typeof e&&e():function(e,t,a){i.default.AddTraceContext("DBUpdateTableRow");var n=s.default.findByName(e.tableName),r=n.table,o=n.tableSchema,c=n.tableDefinition;if(!r||!o||!c)return void a("Table ".concat(e.tableName," not found"));var d={};for(var f in e.row)e.row.hasOwnProperty(f)&&(d[f]=e.row[f]);var p=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof a&&a(e,t)};A(e,o,d,(function(a){var n=function(e){e.Success?(e.RowValues&&w(a,e.RowValues),e.ReturnedFromCache&&l.logger.logAppEvent(u.AppEventName.UsedCachedUpdateResponse),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):p(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var r=null!=o.sliceDefinition?function(e,t){for(var a=t.sliceDefinition,n=[],r=[],i=0;i<a.Columns.length;i++){var o=a.Columns[i];if(null!=o){e.hasOwnProperty(o)?n.push(e[o]):n.push(null);var l=t.findAttributeByName(o).model;r.push(!!(null==l?void 0:l.IsSensitive))}}return{row:n,pii:r}}(d,o):S(d,o),i=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.UpdateTableRow(i,e,r,n,p)}),p)}(n.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,a){"function"==typeof t&&null!=t&&t(e,a)}))}};var E=C;t.default=E},959191:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.filterDefaultsToIndexLookup=function(e,t){return e.map((function(e){var a=e.ColumnName,n=e.ColumnValue;return{attribute:t.findAttributeByName(a),value:n}}))},t.filterDefaultsToLookupValues=function(e){if(!(null==e?void 0:e.length))return null;var t,a={},n=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,u=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){u=!0,o=e},f:function(){try{l||null==a.return||a.return()}finally{if(u)throw o}}}}(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=r.ColumnName,l=r.ColumnValue;if(a.hasOwnProperty(o)&&a[o]!==l)return null;a[o]=l}}catch(e){n.e(e)}finally{n.f()}return a},t.lookupValuesToFilterDefaults=function(e){return r.default.keys(e).map((function(t){return{ColumnName:t,ColumnValue:e[t]}}))},t.lookupValuesToIndexLookup=function(e,t){return r.default.keys(e).map((function(a){return{attribute:t.findAttributeByName(a),value:e[a]}}))};var r=n(a(496486));function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}},710229:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TransactionErrorState=void 0;var i=n(a(600861)),o=n(a(856690)),l=n(a(689728)),u=n(a(861655)),s=n(a(994993)),c=n(a(73808)),d=n(a(496486)),f=a(365914),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=S(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(593186)),h=n(a(962553)),v=n(a(195508)),m=n(a(385857)),g=n(a(494012)),y=a(557310),b=a(306593),T=a(44617);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(S=function(e){return e?a:t})(e)}function A(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,c.default)(e);if(t){var r=(0,c.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,s.default)(this,a)}}var E=p.default.logToDevConsole,k=function(e){(0,u.default)(a,e);var t=C(a);function a(e,n){var r;return(0,o.default)(this,a),(r=t.call(this)).appModel=e,r.transaction=n,r}return(0,l.default)(a,[{key:"isValid",value:function(){return!this.error&&!this.message}},{key:"message",get:function(){var e,t=this;return this.error?this.error:(this.forEach((function(a,n){if(!e){var r=t.appModel.findTableCollection(a),i=r.table,o=r.tableSchema;n.forEach((function(a,n){if(!e){var r=n.message,l=n.invalid,u=n.missingRequired;if(r)e=r;else if(null==l?void 0:l.length){var s,c=l[0],d="This entry is invalid",f=t.appModel.MapActionName(d);if(i&&o){var p=i.lookupTableRow(a,t.transaction);if(p){var h=new m.default(t.appModel,o,p.values),v=o.findAttributeByName(c);if(v){c=v.displayName(h);var g=v.invalidMessageEvalTree();g&&(s=g.run(h))}}}s=s||f!==d?"".concat(c,": ").concat(s||f):"".concat(c," is invalid"),e=s}else if(null==u?void 0:u.length){var y,b=u[0],T="This entry is required",S=t.appModel.MapActionName(T);if(i&&o){var A=i.lookupTableRow(a,t.transaction);if(A){var w=new m.default(t.appModel,o,A.values),C=o.findAttributeByName(b);C&&(b=C.displayName(w))}}y=S!==T?"".concat(b,": ").concat(S):"".concat(b," is required"),e=y}}}))}})),e)}}]),a}(f.NestedStore);t.TransactionErrorState=k;var R=function(){function e(t){var a=this;(0,o.default)(this,e),this.appModel=t,this.updateLog=[],this.transactions=new Map,this.tableCache=new Map,this.tablesToDispose=new Set,this.newRowLookup=new Map;var n=this.transactions,r=function(e){var t=a.getTransaction(e.transactionId);t.started||"START"===e.type||t.start();var n=Object.assign({id:a.updateLog.length},e);return a.updateLog.push(n),n},l=function(e,t,n,r,i){var o=a.findTableCollection(t),l=o.rootTable,u=o.rootTableSchema,s=null==l?void 0:l.lookupTableRow(n,e);if(s&&l&&u){var c=s.stableId,d=l.name(),f=r?u.findAttributeByName(r):void 0,p=f&&s.get(f.name());i({rootTableName:d,rootTable:l,rootTableSchema:u,tableRow:s,attribute:f,stableId:c,currentValue:p})}},u=function(e,t,a,n){var r=a.snapshot(),i=e.getInitialRowValues(t,n)||r,o=e.getRecordsForRow(t,n),l=o.length?void 0:a.validate({usedTransactions:!0,transaction:e}),u=d.default.keyBy(o.map((function(e){return e.columnName})));return{before:r,initialData:i,recordsForRow:o,initialErrorState:l,userEdited:u}},s=function(e,t){if(y.ReactRootUIConfig.isReactRoot())return function(e,t){var n=e.type,r=e.tableName,i=!1;if(["CREATE","UPDATE","DELETE","RECOMPUTE"].includes(n)){E("undoing",e);var o=a.findTableCollection(r).rootTable;if(o&&(i=!0,"CREATE"===n&&o.deleteRowByStableId(e.stableId,t),"DELETE"===n&&o.createRow(e.before,t),"UPDATE"===n||"RECOMPUTE"===n)){var l=e.rowId,u=e.before,s=e.after,c=e.stableId,d=o.lookupTableRow(c,t);if(d)d.resetValues(u);else{(0,p.doWeEverHitThis)("undoDataChanges unable to find row by stableId");var f=s[o.keyAttribute().name()];o.resetRowValues(null!=f?f:l,u,t)}}}return i}(e,t);var n=e.type,r=e.tableName,i=!1;if(["CREATE","UPDATE","DELETE","RECOMPUTE"].includes(n)){E("undoing",e);var o=a.findTableCollection(r),l=o.rootTable,u=o.rootTableSchema;if(l&&u&&(i=!0,"CREATE"===n&&l.deleteRow(e.rowId),"DELETE"===n&&l.createRow(e.before),"UPDATE"===n||"RECOMPUTE"===n)){var s=u.keyAttribute().name(),c=e.rowId,d=e.before,f=e.after[s];l.resetRowValues(null!=f?f:c,d)}}return i},c=function(e,t,n,r){var i=t.refColumnName,o=t.tableName,l=t.stableId;if(t.multiselect){var u=a.findTableCollection(o),s=u.rootTable,c=u.rootTableSchema,f=null==s?void 0:s.lookupTableRow(l,e),p=null==c?void 0:c.findAttributeByName(i);if(f&&"EnumList"===(null==p?void 0:p.type())){var h=f.get(i),v=p.valueFromWireFormat(h);if(Array.isArray(v)){var m=d.default.lastIndexOf(v,r);m>-1?v[m]=n:v.push(n);var g=p.valueToWireFormat(v);e.update(o,l,i,g)}}}else e.update(o,l,i,n)},v=function(e,t,n,r){!function(e,t,n){var r;if(T.dynamicRollouts.includeByOwnerId("TransactionRecomputeInfluenced")){var o,l=function(a){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a!==t){a.onDataChange(t);var i=a.tableSchema,o=a.tableName,l=a.stableId,u=r?i.virtualAttributesThatDependOn(t.tableName):i.dynamicAttributesThatDependOn(t.tableName,a.isNewRow());u.length&&e.recompute(o,l,{virtualOnly:r,triggeredBy:n.id,theseAttributesAndInfluenced:u})}},u=e.affectedRows,s=t.getReferencedRows(e),c=e.getRecordsOfTypeForRow(t.tableName,t.stableId,"CREATE")[0];if(c&&c.stableReference){var f=c.stableReference,p=f.tableName,h=f.stableId,v=f.referencedTableName,m=f.referencedStableId;o=null!==(r=s.find((function(e){return e.stableId===m&&e.tableName===v})))&&void 0!==r?r:u.find((function(e){return e.stableId===h&&e.tableName===p}))}var g=new Set([].concat((0,i.default)(u),(0,i.default)(s)));o&&g.add(o);var y,b=A(g);try{for(b.s();!(y=b.n()).done;){var S=y.value;l(S,S!==o)}}catch(e){b.e(e)}finally{b.f()}}else for(var w=new Set,C=d.default.concat(e.affectedRows,t.getReferencedRows(e));C.length;){var E=C.pop();if(!w.has(E)){w.add(E);var k=e.logRecords.length;E.onDataChange(t,e,n);var R=e.logRecords.slice(k);a.appModel.onDataChange({logDelta:R,transaction:e})}}}(e,t,n),r||function(e,t,a){var n=a.before,r=a.after,i=t.keyAttribute.name();if(r&&i in r){var o,l=n&&n[i],u=r[i],s=A(e.getStableReferencesTo(t));try{for(s.s();!(o=s.n()).done;){var d=o.value;c(e,d,u,l)}}catch(e){s.e(e)}finally{s.f()}}}(e,t,n),"stableReference"in n&&t.invalidate()},m=function(e){var t=[],n=[],r=a.getStartRecord(e.id);r&&a.getActiveRecordsPartitionedByStableId(e.id).forEach((function(e,i){var o=a.findTableCollection(e).rootTable,l=o&&o.keyAttribute().name();i.forEach((function(a,i){if(d.default.some(i,(function(e){return!("RECOMPUTE"===e.type&&e.virtualOnly)}))){var o,u,s,c,f=r.appId,p=r.appName,h=r.appVersion,v=r.userSettings,m=d.default.first(i),g=d.default.last(i),y=d.default.uniq(i.map((function(e){return e.tableName}))),b=1===y.length?y[0]:e;if("CREATE"!==m.type||"DELETE"!==g.type)"DELETE"===g.type?(o="DeleteTableRow",u=m.before,s=m.rowId):"CREATE"===m.type?(o="AddTableRow",u=d.default.extend({},g.before,g.after),s=null!=l&&null!=u[l]?u[l]:g.rowId):(o="UpdateTableRow",u=d.default.extend({},g.before,g.after),s=g.rowId),t.push((c={appId:f,appName:p,appVersion:h,userSettings:v,type:o,tableName:b,row:u,rowKey:s},d.default.omitBy(c,d.default.isNil))),n.push(a)}}))}));return{requests:t,stableIds:n}};this.handlers={onStart:function(e){var t;if(!e.started){var n=a.appContext,i=n.appId,o=n.appName,l=n.appVersion,u=n.userSettings;t=r({type:"START",transactionId:e.id,appId:i,appName:o,appVersion:l,userSettings:u})}return t},onStartGroup:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.startedBy,n=t.recoverable,i=r({type:"START_GROUP",transactionId:e.id,startedBy:a,recoverable:n});return E("group ".concat(i.id," was started in ").concat(e.id)+(a?" by ".concat(a):"")),i},onEndGroup:function(e){for(var t,n,i=e.lastRecord,o=i,l=1;o&&(i===o||l>0);){if("END_GROUP"===o.type&&l++,"START_GROUP"===o.type&&0===--l){t=o.id;break}o=a.getPreviousRecord(o)}return null!=t&&(n=r({type:"END_GROUP",transactionId:e.id,ends:t}),E("group ".concat(t," was ended in ").concat(e.id))),n},onCreate:function(e,n,i){var o,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=l.referencedBy,s=l.hasReferenceTo,d=l.rowStateColumnNames,f=a.findTableCollection(n),p=f.rootTable;if(p){var h=e.logRecords.length,m=!1,g=p.createNewRow({initialValues:i,transaction:e,onDynamicValueChanged:function(t,a){u&&t.isKey()&&(c(e,u,a),m=!0)}}),y=g.snapshot(),b=g.validate({usedTransactions:!0,transaction:e}),T=p.name(),S=u?Object.assign(Object.assign({},u),{referencedTableName:T,referencedStableId:g.stableId}):s?Object.assign(Object.assign({},s),{tableName:T,stableId:g.stableId}):void 0;o=r({type:"CREATE",timestamp:Date.now(),transactionId:e.id,rowId:g.keyValue,stableId:g.stableId,initialErrorState:b,tableName:T,rootTableName:T,after:y,stableReference:S,rowStateColumnNames:d}),a.newRowLookup.set(g.stableId,g);var A=e.logRecords.slice(h);t.onDataChange({transaction:e,logDelta:A}),v(e,g,o,m),E("add came through",e.id,y)}return o},onRecompute:function(e,a,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=o.virtualOnly,c=void 0!==s&&s,f=o.theseAttributesAndInfluenced,p=o.triggeredBy;return l(e,a,n,void 0,(function(o){var l=o.rootTableName,s=o.rootTable,h=o.tableRow,v=o.stableId,m=u(e,a,h,v),g=m.before,b=m.initialData,T=m.initialErrorState,S=m.userEdited;y.ReactRootUIConfig.isReactRoot()&&(h=s.getPendingRow(h,e));var A=h.recompute({initialData:b,virtualOnly:c,userEdited:S,transaction:e,theseAttributesAndInfluenced:f}),w=d.default.pickBy(h.snapshot(),(function(e,t){return g[t]!==e}));if(!d.default.isEmpty(w)){var C=s.tableSchema.findAttributesByNames(Object.keys(w)),k=e.logRecords.length;i=r({type:"RECOMPUTE",timestamp:Date.now(),transactionId:e.id,initialErrorState:T,tableName:a,rootTableName:l,rowId:n,stableId:v,before:g,after:w,virtualOnly:c||d.default.every(C,(function(e){return e.isVirtual()})),triggeredBy:p,wasReset:A});var R=e.logRecords.slice(k);t.onDataChange({transaction:e,logDelta:R}),E("recompute came through",e.id,w)}})),i},onUpdate:function(e,a,n,i,o,s,c){var f;return l(e,a,n,i,(function(l){var p=l.rootTableName,h=l.rootTable,m=l.tableRow,g=l.stableId,b=l.attribute,T=l.currentValue;if(b&&T!==o){var S=u(e,a,m,g),A=S.before,w=S.initialData,C=S.recordsForRow,k=S.initialErrorState,R=S.userEdited;R[i]=i,y.ReactRootUIConfig.isReactRoot()&&(m=h.getPendingRow(m,e));var I=0===C.length,O=m.update(b,o,{initialData:w,userEdited:R,updateInfluenced:!I,transaction:e});I&&m.recompute({initialData:w,wasReset:O,userEdited:R,transaction:e});var M=d.default.pickBy(m.snapshot(),(function(e,t){return A[t]!==e}));if(!d.default.isEmpty(M)){var N=e.logRecords.length;f=r({type:"UPDATE",timestamp:Date.now(),transactionId:e.id,initialErrorState:k,tableName:a,rootTableName:p,rowId:n,stableId:g,columnName:i,value:o,before:A,after:M,mechanism:s,wasReset:O,rowStateColumnNames:c});var _=e.logRecords.slice(N);t.onDataChange({transaction:e,logDelta:_}),v(e,m,f),E("update came through",e.id,M)}}})),f},onDelete:function(e,n,i){var o,l=a.findTableCollection(n).rootTable;if(l){var u=l.lookupTableRow(i,e),s=u&&u.snapshot();if(s&&u){var c=u.stableId,d=l.name(),f=e.logRecords.length;o=r({type:"DELETE",timestamp:Date.now(),transactionId:e.id,tableName:d,rootTableName:d,rowId:i,stableId:c,before:s}),y.ReactRootUIConfig.isReactRoot()?l.deleteRowByStableId(c):l.deleteRow(i);var p=e.logRecords.slice(f);t.onDataChange({transaction:e,logDelta:p}),v(e,u,o),E("deleted via transaction",o)}}return o},onUndo:function(e){var n,i;if(e.started){var o=e.lastActiveRecord;if(o&&o!==e.startRecord){var l=null!==(n=o.ends)&&void 0!==n?n:o.triggeredBy;i=r({type:"UNDO",timestamp:Date.now(),transactionId:e.id,undoes:null!=l?l:o.id});var u=s(o,e);if(null!=l)for(;o&&o.id!==l;)u=s(o,e)||u,o=a.getPreviousActiveRecord(o);u&&t.onDataChange({transaction:e}),E("undo finished",i,e.logRecords)}}return i},onAbort:function(e){var i,o=a.getStartRecord(e.id);if(o&&(i=r({type:"ABORT",transactionId:e.id}),!h.default.usePendingChangesStore)){var l=!1,u=e.lastActiveRecord;for(E("ABORT running undoDataChanges");u&&u!==o;)l=s(u,e)||l,u=a.getPreviousActiveRecord(u);l&&t.onDataChange()}return E("aborted transaction",e.id),h.default.usePendingChangesStore||n.delete(e.id),i},onValidate:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.affectedRows,r=new k(t,e);return e.closed?(r.error="Transaction is already closed",r):(d.default.compact(n).forEach((function(t){var n,i,o=t.tableName,l=t.stableId,u=e.wasModified(o,l);if(y.ReactRootUIConfig.isReactRoot()){var s=e.getRecordsForRow(o,l).filter((function(e){return"RECOMPUTE"!==e.type})),c=s[s.length-1],f=(null==c?void 0:c.rowStateColumnNames)||[],p=a.appModel.findTableCollection(o).tableSchema,h=(null==p?void 0:p.findAttributesByNames(f))||[];h.length>0&&(i=new b.Paging(h))}var v=t.validate({usedTransactions:!0,transaction:e,enforceStableKey:!t.isNewRow(),paging:i}),m=v;y.ReactRootUIConfig.isReactRoot()&&e.wasCreated(l)?m=null:u&&(m=null!==(n=e.getInitialErrorState(o,l))&&void 0!==n?n:null);var T=g.default.diffErrorState(m,v);if(T){var S=t.keyValue,A=r.for(o).get(S)||{},w=d.default.clone(A);if(T.invalid){var C=A.invalid||[];w.invalid=d.default.uniq(d.default.concat(C,T.invalid))}if(T.missingRequired){var E=A.missingRequired||[];w.missingRequired=d.default.uniq(d.default.concat(E,T.missingRequired))}T.message&&(w.message=T.message),r.for(o).store(S,w)}})),r)},onCommitAsync:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.localOnly,l=void 0!==o&&o;return new Promise((function(i,o){var u=e.validate();if(u.isValid()){if(e.closed)return u.error="Transaction is already closed",void o(new Error(u.message));var s=m(e),c=s.requests,d=s.stableIds;if(!c.length)return E("committed (NOOP)",e.id,e.logRecords),h.default.usePendingChangesStore||n.delete(e.id),void i(void 0);var p=function(o){d.forEach((function(e){var t=a.newRowLookup.get(e);t&&t.commitRowId()}));var l,u=A(e.affectedRootTables);try{for(u.s();!(l=u.n()).done;){l.value.commitPendingChanges(e)}}catch(e){u.e(e)}finally{u.f()}var s,c=new f.NestedStore,p=A(e.affectedRows);try{for(p.s();!(s=p.n()).done;){var v=s.value;c.for(v.tableName).store(v.rowId,v.values)}}catch(e){p.e(e)}finally{p.f()}t.Snapshot(c);var m=r({type:"COMMIT",transactionId:e.id,immediateSync:o});h.default.usePendingChangesStore||n.delete(e.id),E("committed",e.id,e.logRecords),h.default.usePendingChangesStore&&t.onDataChange({logDelta:[m]}),i(m)};l?p():t.AddDeleteOrUpdateTableRows(c,p,(function(e){var t=e.errorMessage;u.error=t,o(new Error(u.message))}),{usedTransactions:!0})}else o(new Error(u.message))}))},onCommit:function(e,i){var o=e.validate();if(o.isValid()){if(e.closed)return o.error="Transaction is already closed",void i(o);var l=m(e),u=l.requests,s=l.stableIds;if(!u.length)return E("committed (NOOP)",e.id,e.logRecords),h.default.usePendingChangesStore||n.delete(e.id),void i(null);t.AddDeleteOrUpdateTableRows(u,(function(o){s.forEach((function(e){var t=a.newRowLookup.get(e);t&&t.commitRowId()}));var l,u=A(e.affectedRootTables);try{for(u.s();!(l=u.n()).done;){l.value.commitPendingChanges(e)}}catch(e){u.e(e)}finally{u.f()}var c,d=new f.NestedStore,p=A(e.affectedRows);try{for(p.s();!(c=p.n()).done;){var v=c.value;d.for(v.tableName).store(v.rowId,v.values)}}catch(e){p.e(e)}finally{p.f()}t.Snapshot(d);var m=r({type:"COMMIT",transactionId:e.id,immediateSync:o});h.default.usePendingChangesStore||n.delete(e.id),E("committed",e.id,e.logRecords),h.default.usePendingChangesStore&&t.onDataChange({logDelta:[m]}),i(null,m)}),(function(e){var t=e.errorMessage;o.error=t,i(o)}),{usedTransactions:!0})}else i(o)}}}return(0,l.default)(e,[{key:"isCurrent",get:function(){return this.appModel.isCurrent}},{key:"newTransaction",value:function(){var e=new v.default(this,this.handlers);return this.transactions.set(e.id,e),e}},{key:"findTableCollection",value:function(e,t){if(null==e){if(t)throw new Error("Could not find table ".concat(e));return{}}var a=this.tableCache,n=this.tablesToDispose,r=this.appModel,i=e.toLowerCase(),o=r.appTemplate.findSchemaForTable(i),l=r.appTemplate.findRootSchemaForTable(i),u=r.appTemplate.findRootTableDefinition(i);if(!o||!l||!u){if(t)throw new Error("Could not find table ".concat(e));return{}}if(!a.has(i)){var s,c=r.FindTable(i);if(!c){if(t)throw new Error("Could not find table ".concat(e));return{}}c.IsSlice&&(s=this.findTableCollection(c.SliceSource).table);var d=new h.default(c,o,u,s,r);a.set(i,d),n.add(d)}var f=a.get(i),p=f&&f.rootTable();return{table:f,tableSchema:o,rootTable:p,rootTableSchema:l,tableDefinition:u}}},{key:"onDataChange",value:function(e,t){this.tableCache.forEach((function(a){a.onDataChange(e,t)}))}},{key:"onTemplateChange",value:function(){this.tableCache.clear()}},{key:"dispose",value:function(){var e=this.tableCache,t=this.tablesToDispose;t.forEach((function(e){e.dispose()})),e.clear(),t.clear()}},{key:"findPendingRow",value:function(e){return this.newRowLookup.get(e)}},{key:"appContext",get:function(){var e=this.appModel;return{appId:e.AppTemplate.Id,appName:e.AppTemplate.Name,appVersion:e.AppTemplate.Version,userSettings:e.GetUserSettings()}}},{key:"getTransaction",value:function(e){return e?this.transactions.get(e):void 0}},{key:"currentTransaction",get:function(){var e=(0,i.default)(this.transactions.values()).filter((function(e){return!e.closed}));if(e.length>1)p.default.ReportErrorOnce({errorMessage:"Transaction Error: get currentTransaction found more than one open transaction"});else if(0===e.length)return this.newTransaction();return e[0]}},{key:"abortCurrentTransaction",value:function(){(0,i.default)(this.transactions.values()).forEach((function(e){e.closed||e.abort()}))}},{key:"getPreviousRecord",value:function(e){if(null!=e){var t=this.updateLog[e.id-1];if(t&&t.transactionId===e.transactionId)return t}}},{key:"getPreviousActiveRecord",value:function(e){for("UNDO"!==(null==e?void 0:e.type)&&(e=this.getPreviousRecord(e));"UNDO"===(null==e?void 0:e.type);){var t=this.getLogRecord(e.undoes);e=this.getPreviousRecord(t)}return e}},{key:"getStartRecord",value:function(e){return this.getLogRecords(e)[0]}},{key:"getLogRecord",value:function(e){return this.updateLog[e]}},{key:"getLogRecords",value:function(e){return this.updateLog.filter((function(t){return t.transactionId===e}))}},{key:"getLastRecord",value:function(e){return d.default.last(this.getLogRecords(e))}},{key:"getOpenGroupRecords",value:function(e){for(var t=[],a=this.getActiveRecords(e).reverse(),n=0,r=0;r<a.length;r++){var i=a[r];"END_GROUP"===i.type?n++:"START_GROUP"===i.type&&(0===n?t.push(i):n--)}return t}},{key:"getActiveRecords",value:function(e){for(var t=this.getLastActiveRecord(e),a=[];t;)a.unshift(t),t=this.getPreviousActiveRecord(t);return a}},{key:"getLastActiveRecord",value:function(e){var t=this.getLastRecord(e);return t&&"UNDO"===t.type?this.getPreviousActiveRecord(t):t}},{key:"getActiveRecordsPartitionedByStableId",value:function(e){var t=this.getActiveRecords(e),a=new f.NestedStore;return t.forEach((function(e){var t=e.rootTableName,n=e.stableId;null!=t&&null!=n&&a.for(t).push(n,e)})),a}}]),e}();t.default=R},700482:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.imageHandleColumnTypes=t.default=t.XY_TYPE=t.VIDEO_TYPE=t.URL_TYPE=t.UNKNOWN_TYPE=t.TIME_TYPE=t.THUMBNAIL_TYPE=t.TEXT_TYPE=t.TABLEREF_TYPE=t.SIGNATURE_TYPE=t.SHOW_TYPE=t.PROGRESSENUM_TYPE=t.PRICE_TYPE=t.PHONE_TYPE=t.PERCENT_TYPE=t.NUMBER_TYPE=t.NAME_TYPE=t.MULTICOLUMNKEY_TYPE=t.LONGTEXT_TYPE=t.LIST_TYPE=t.LATLONG_TYPE=t.IMAGE_TYPE=t.FILE_TYPE=t.ENUM_TYPE=t.ENUMLIST_TYPE=t.EMAIL_TYPE=t.DURATION_TYPE=t.DRAWING_TYPE=t.DECIMAL_TYPE=t.DATE_TYPE=t.DATETIME_TYPE=t.COLORENUM_TYPE=t.CHANGETIMESTAMP_TYPE=t.CHANGELOCATION_TYPE=t.CHANGECOUNTER_TYPE=t.BOOLEAN_TYPE=t.APP_TYPE=t.ADDRESS_TYPE=void 0;var r=n(a(496486)),i={TextType:{Name:"Text"},LongTextType:{Name:"LongText"},BooleanType:{Name:"Yes/No"},NumberType:{Name:"Number",ChartAxisFormat:",.0f"},ChangeCounterType:{Name:"ChangeCounter",ChartAxisFormat:",.0f"},DecimalType:{Name:"Decimal",ChartAxisFormat:",.2f"},PercentType:{Name:"Percent",ChartAxisFormat:",.2f"},PriceType:{Name:"Price",ChartAxisFormat:",.2f"},UrlType:{Name:"Url",IsExternal:!0},FileType:{Name:"File",IsExternal:!0},ImageType:{Name:"Image",IsImage:!0},VideoType:{Name:"Video"},ThumbnailType:{Name:"Thumbnail",IsImage:!0},SignatureType:{Name:"Signature",FullWidth:!0},DrawingType:{Name:"Drawing",IsImage:!0,FullWidth:!0},DateType:{Name:"Date"},DateTimeType:{Name:"DateTime"},ChangeTimestampType:{Name:"ChangeTimestamp"},TimeType:{Name:"Time"},DurationType:{Name:"Duration"},NameType:{Name:"Name"},EmailType:{Name:"Email"},AddressType:{Name:"Address"},LatLongType:{Name:"LatLong"},XYType:{Name:"XY"},ChangeLocationType:{Name:"ChangeLocation"},PhoneType:{Name:"Phone"},AppType:{Name:"App",IsExternal:!0},EnumType:{Name:"Enum"},EnumListType:{Name:"EnumList"},ColorEnumType:{Name:"Color"},ProgressEnumType:{Name:"Progress"},TableRefType:{Name:"Ref"},ListType:{Name:"List"},MultiColumnType:{Name:"MultiColumnKey"}},o=i.TextType.Name;t.TEXT_TYPE=o;var l=i.LongTextType.Name;t.LONGTEXT_TYPE=l;var u=i.BooleanType.Name;t.BOOLEAN_TYPE=u;var s=i.NumberType.Name;t.NUMBER_TYPE=s;var c=i.ChangeCounterType.Name;t.CHANGECOUNTER_TYPE=c;var d=i.DecimalType.Name;t.DECIMAL_TYPE=d;var f=i.PercentType.Name;t.PERCENT_TYPE=f;var p=i.PriceType.Name;t.PRICE_TYPE=p;var h=i.UrlType.Name;t.URL_TYPE=h;var v=i.FileType.Name;t.FILE_TYPE=v;var m=i.ImageType.Name;t.IMAGE_TYPE=m;var g=i.VideoType.Name;t.VIDEO_TYPE=g;var y=i.ThumbnailType.Name;t.THUMBNAIL_TYPE=y;var b=i.SignatureType.Name;t.SIGNATURE_TYPE=b;var T=i.DrawingType.Name;t.DRAWING_TYPE=T;var S=i.DateType.Name;t.DATE_TYPE=S;var A=i.DateTimeType.Name;t.DATETIME_TYPE=A;var w=i.ChangeTimestampType.Name;t.CHANGETIMESTAMP_TYPE=w;var C=i.TimeType.Name;t.TIME_TYPE=C;var E=i.DurationType.Name;t.DURATION_TYPE=E;var k=i.NameType.Name;t.NAME_TYPE=k;var R=i.EmailType.Name;t.EMAIL_TYPE=R;var I=i.LatLongType.Name;t.LATLONG_TYPE=I;var O=i.XYType.Name;t.XY_TYPE=O;var M=i.ChangeLocationType.Name;t.CHANGELOCATION_TYPE=M;var N=i.AddressType.Name;t.ADDRESS_TYPE=N;var _=i.PhoneType.Name;t.PHONE_TYPE=_;var D=i.AppType.Name;t.APP_TYPE=D;var L=i.EnumType.Name;t.ENUM_TYPE=L;var P=i.EnumListType.Name;t.ENUMLIST_TYPE=P;var x=i.ProgressEnumType.Name;t.PROGRESSENUM_TYPE=x;var F=i.ColorEnumType.Name;t.COLORENUM_TYPE=F;var G=i.TableRefType.Name;t.TABLEREF_TYPE=G;var V=i.MultiColumnType.Name;t.MULTICOLUMNKEY_TYPE=V;var B=i.ListType.Name;t.LIST_TYPE=B;var U="Unknown";t.UNKNOWN_TYPE=U;var H="Show";t.SHOW_TYPE=H;var W={init:function(e){return e.TEXT_TYPE=o,e.LONGTEXT_TYPE=l,e.BOOLEAN_TYPE=u,e.NUMBER_TYPE=s,e.CHANGECOUNTER_TYPE=c,e.DECIMAL_TYPE=d,e.PERCENT_TYPE=f,e.PRICE_TYPE=p,e.URL_TYPE=h,e.FILE_TYPE=v,e.IMAGE_TYPE=m,e.VIDEO_TYPE=g,e.THUMBNAIL_TYPE=y,e.SIGNATURE_TYPE=b,e.DRAWING_TYPE=T,e.DATE_TYPE=S,e.DATETIME_TYPE=A,e.CHANGETIMESTAMP_TYPE=w,e.TIME_TYPE=C,e.DURATION_TYPE=E,e.NAME_TYPE=k,e.EMAIL_TYPE=R,e.LATLONG_TYPE=I,e.XY_TYPE=O,e.CHANGELOCATION_TYPE=M,e.ADDRESS_TYPE=N,e.PHONE_TYPE=_,e.APP_TYPE=D,e.ENUM_TYPE=L,e.ENUMLIST_TYPE=P,e.PROGRESSENUM_TYPE=x,e.COLORENUM_TYPE=F,e.TABLEREF_TYPE=G,e.MULTICOLUMNKEY_TYPE=V,e.LIST_TYPE=B,e.UNKNOWN_TYPE=U,e.SHOW_TYPE=H,r.default.keyBy(r.default.values(i),(function(e){return e.Name}))}},j=[m,y,v,T,b,g];t.imageHandleColumnTypes=j;var q=W;t.default=q},237136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modifiesDataTypes=t.modifiedData=void 0;var a=["CREATE","UPDATE","RECOMPUTE","DELETE","UNDO"];t.modifiesDataTypes=a;t.modifiedData=function(e){return a.includes(e.type)}},764685:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.getSyncErrorHandler=function(e,t,a){return function(n,s,c){var d;if(401===s)if(o.default.AddTraceContext("getAppTemplate: 401 Unauthorized"),a){var f="401 Unauthorized: Background sync failed. Please log out and back in.";l.default.syncState.error=f,o.default.warnToDevConsole("aborting background sync due to unauthorized"),r.AppGlobals.AppModel.discardPendingAppModel(),"function"==typeof t&&t(f)}else{var p=null===(d=function(e){try{return JSON.parse(e)}catch(t){return o.default.ReportErrorOnce({errorMessage:"error parsing 401/403 responseText",responseText:e}),null}}(n))||void 0===d?void 0:d.LoginProvider;if(i.default.IsIFrame())return void(null==t||t("Login is required but not supported in iframes."));r.AppGlobals.AppState.SwitchToLoginPage(p,"Fetching app template indicates login is required",e)}else if(403===s){o.default.AddTraceContext("getAppTemplate: 403 FORBIDDEN (access blocked)");var h=n||(0,u.accessDeniedErrorMessage)();r.AppGlobals.AppModel.MatchesAppNameOrId(e)?r.AppGlobals.AppModel.RevokeUserAccess(h):(o.default.AddTraceContext("Clearing actions only"),r.AppGlobals.AppModel.ClearPersistedActions(),r.AppGlobals.ViewManager.ShowErrorScreen(h)),"function"==typeof t&&t(h)}else if(i.default.InMobileWebView()&&200===s&&c)o.default.AddTraceContext("Upgrade required."),r.AppGlobals.ViewManager.ShowUpgradeRequiredScreen(n),$("#FullScreenOverlay").show();else if("function"==typeof t){if(o.default.AddTraceContext("getAppTemplate.errorHandler failureFn, statusCode "+s),n&&n.length>1e3){var v="unknown";if(n.startsWith("<"))v="html";else if(n.startsWith("{"))try{JSON.parse(n),v="json"}catch(e){v="malformed-json"}n=n.slice(0,1e3),o.default.AddTraceContext("RESPONSE TEXT (truncated):"+n),o.default.ReportErrorOnce({errorMessage:"GetAppTemplate ajax errorHandler called",responseType:v,statusCode:s})}t(n)}}};var r=a(166089),i=n(a(571524)),o=n(a(593186)),l=n(a(21870)),u=a(714067)},688291:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.autoSyncInterval=void 0;var i=n(a(856690)),o=n(a(689728)),l=w(a(593186)),u=n(a(513954)),s=n(a(343625)),c=n(a(571524)),d=a(263198),f=a(629503),p=w(a(21870)),h=a(764685),v=a(166089),m=a(235049),g=a(44617),y=a(557310),b=n(a(819433)),T=a(398171),S=a(892148);function A(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(A=function(e){return e?a:t})(e)}function w(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=A(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}var C=function(){y.ReactRootUIConfig.isReactRoot()?setTimeout((function(){var e,t,a=null!==(e=v.AppGlobals.AppModel.NumDelayedActions())&&void 0!==e?e:0,n=null!==(t=v.AppGlobals.AppModel.NumProcessingActions())&&void 0!==t?t:0;(0,b.default)().dispatch((0,T.setTotalActions)(a+n))})):$("#header").trigger("queueChange")},E=18e5,k=!0===window.APPSHEET_TEST_CONTEXT?1:10;t.autoSyncInterval=k;var R=function(){function e(t){(0,i.default)(this,e),this.queuedActions=[],this._appModel=t,this._repeatFailureLimit=1,this._checkSkipLimit=30,this._autoSyncInterval=k,this._parallelismLimit=1,this._minBackgroundSyncIntervalMs=E,this.initialize()}return(0,o.default)(e,[{key:"appModel",value:function(){return v.AppGlobals.AppModel&&v.AppGlobals.AppModel!==this._appModel&&l.default.ReportErrorOnce({errorMessage:"SyncQueue AppModel mismatch",appSwitched:v.AppGlobals.AppModel.AppTemplate.Id!==this._appModel.AppTemplate.Id}),v.AppGlobals.AppModel||this._appModel}},{key:"initialize",value:function(){try{this.isLocalStorageEnabled=void 0!==window.localStorage}catch(e){this.isLocalStorageEnabled=!1}this.executingActions={},this.queuedActions=[],this.checksSkipped=0,this.lastTryFailCount=0,this.queueStartedApp=null,this.AutomaticUpdateSync=!1}},{key:"Clear",value:function(t){this.queuedActions=[],t&&(e.RemovePersistedActions(v.AppGlobals.AppState.AppTemplate.Name),C())}},{key:"PersistAction",value:function(e){var t;if(this.isLocalStorageEnabled){var a=e.RequestId(),n=g.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")?this._appModel:v.AppGlobals.AppState,r=(null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.appName)||n.AppTemplate.Name,i=u.default.SerializeAction(e),o=r+"_Action"+a;s.default.setItem(o,i)}}},{key:"Enqueue",value:function(e){null==e.params.timeStamp&&(e.params.timeStamp=new Date),this.queuedActions.push(e),this.PersistAction(e),C()}},{key:"Delay",value:function(e){var t,a=e.RequestId();(null!=this.executingActions[a]&&delete this.executingActions[a],this.PersistAction(e),g.dynamicRollouts.includeByOwnerId("ClientNoPushDelay"))?this.Disposed||this.queuedActions.unshift(e):((null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.appName)||v.AppGlobals.AppState.AppTemplate.Name)===this.appModel().AppTemplate.Name&&this.queuedActions.unshift(e)}},{key:"Activate",value:function(e){for(var t=e.RequestId(),a=0;a<this.queuedActions.length;a++)if(this.queuedActions[a].RequestId()===t){var n=this.queuedActions[a];this.queuedActions.splice(a,1),this.executingActions[t]=n;break}}},{key:"Remove",value:function(e){for(var t=e.RequestId(),a=0;a<this.queuedActions.length;a++)if(this.queuedActions[a].RequestId()===t){this.queuedActions.splice(a,1);break}if(this.isLocalStorageEnabled){var n=g.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")?this._appModel:v.AppGlobals.AppState,r=e.params.appName||n.AppTemplate.Name;s.default.removeItem("".concat(r,"_Action").concat(t))}null!=this.executingActions[t]&&delete this.executingActions[t],C()}},{key:"Poll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3*k,a=arguments.length>1?arguments[1]:void 0;if(this.AutomaticUpdateSync){if(this.PollTimeoutId)return;var n=setTimeout((function(){e.ResetFailures(!0);var t=e.appModel().NumProcessingActions()+e.appModel().NumDelayedActions();e.Check(p.default.syncProgressHandle,e.onError,a);var n=k;!e.appModel().InASyncCall&&t>0&&(0,m.isConnected)()&&(n=1);var r=1e3*n*Math.pow(2,Math.min(e.lastTryFailCount,9));r=Math.min(36e5,r),e.lastTryFailCount>0&&(r=Math.max(6e4,r));var i=t>0;e.PollTimeoutId=null,e.Poll(r,i)}),t);this.PollTimeoutId=n}}},{key:"CheckConnectivity",value:function(){if(!(0,m.isConnected)()){if(this.lastTryFailCount=0,this.checksSkipped<30)return this.checksSkipped++,!1;this.checksSkipped=0,(0,m.autoConnect)(),this.ResetFailures()}return!0}},{key:"Check",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.default.syncProgressHandle,t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(this.CheckConnectivity()){var n=this.getQueuedActions();if(n.length)for(var r=0;r<n.length;r++){if(this.ActiveCount()>=1)return;var i=n[r];if(null==i){var o="empty serialized action in SyncQueue.Check";l.default.ReportErrorOnce({errorMessage:o}),t&&t(o)}else{var u=this.CheckAction(i,e,t);if(!u)break}}else 0===this.ActiveCount()&&this.CheckBackgroundSync(a,e)}}},{key:"checkForAppSwitch",value:function(e,t){return e.params.appId!==this.appModel().AppTemplate.Id&&(l.default.ReportError({errorMessage:"SyncQueue detected app switch",where:t}),!0)}},{key:"CheckAction",value:function(e,t,a,n){var r=this,i=this.checkForAppSwitch(e,"CheckAction start");return e.params.failureCount<1&&(this.Activate(e),f.Common.StartBackendCall(),e.params.checkCache=!0,l.default.logToDevConsole("syncQueue.Check - Executing action",e.params),e.Execute((function(a){i||(i=r.checkForAppSwitch(e,"CheckAction success")),l.default.AddTraceContext("syncQueue.Check - execute action success",{warningMessage:a}),f.Common.FinishBackendCall(),r.Remove(e),r.checksSkipped=0,r.lastTryFailCount=0,a&&(null==t||t.raiseWarning({message:a})),0!==r.queuedActions.length||i||d.JeeneeBrowserAPI.clearPhotoStorageForApp(e.params.appId,e.params.timestamp),null==n||n()}),(function(n,i){n!==l.SYNC_CANCELED_ERROR_MESSAGE&&r.checkForAppSwitch(e,"CheckAction failure"),l.default.AddTraceContext("syncQueue.Check - execute action failure",{errorMessage:n}),f.Common.FinishBackendCall(),e.params.failureCount++,r.lastTryFailCount++,e.params.checkCache=0===i,r.Delay(e),n&&(null==t||t.raiseError(n)),"function"==typeof a&&a(n,i)})),!0)}},{key:"CheckBackgroundSync",value:function(e,t){var a=(new Date).getTime(),n=window.AppSheetPageLoadTime,r=this.appModel();r&&(n=r.lastSyncTimeMs(!0)||n),e?r.startBackgroundSync({progressHandle:t,initiatedBy:"PushedChanges"}):!c.default.IsIFramePreview()&&a-n>E&&r.startBackgroundSync({progressHandle:t,initiatedBy:"Polling"})}},{key:"ResetFailures",value:function(e){var t=this.queuedActions;e||(this.queuedActions=[]);for(var a=t.length-1;a>=0;a--){var n=t[a];null!=n&&(n.params.failureCount=0,e||this.Delay(n))}}},{key:"DelayedCount",value:function(){return this.queuedActions.length}},{key:"ActiveCount",value:function(){return Object.keys(this.executingActions).length}},{key:"Start",value:function(e){if((!e||this.queueStartedApp!==e)&&(this.initialize(),e))if(this.isLocalStorageEnabled){try{window.localStorage.setItem("__test","trial")}catch(e){return void("QUOTA_EXCEEDED_ERR"===e.name.toUpperCase()&&(this.isLocalStorageEnabled=!1))}this.loadPersistedActions(e),this.queueStartedApp=e,C()}else c.default.IsIFrame()||alert("Warning! HTML5 local storage is disabled. Your app will not work correctly.")}},{key:"Stop",value:function(){null!=this.PollTimeoutId&&clearTimeout(this.PollTimeoutId),this.PollTimeoutId=null}},{key:"applySyncSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.automaticUpdates,n=e.syncOnStart,r=!t&&f.Common.InitializingApp&&(a||n);if(r&&n&&setTimeout((function(){v.AppGlobals.StateChangeHandler.RefreshAppData({preferredUI:p.SyncUI.Blocking,initiatedBy:"AppStart"})})),this.AutomaticUpdateSync=a,this.AutomaticUpdateSync){var i=r&&!n;this.Poll(0,i)}else this.Stop()}},{key:"onError",get:function(){var e=this.appModel().AppTemplate.Id;return(0,h.getSyncErrorHandler)(e,(function(e){e!==l.SYNC_CANCELED_ERROR_MESSAGE&&l.default.ReportErrorOnce({errorMessage:e})}),!0)}},{key:"Disposed",get:function(){return this._appModel.Disposed}},{key:"getQueuedActions",value:function(){return this.queuedActions.sort((function(e,t){var a=e.params.timeStamp,n=t.params.timeStamp;return a<n?-1:a>n?1:0}))}},{key:"loadPersistedActions",value:function(e){try{for(var t=S.WindowWrapper.unsafeLocalStorage,a={},n={},r=0;r<t.length;r++){var i=t.key(r);if(0===i.indexOf(e+"_Action")){var o=t.getItem(i),s=null;if(null==o)l.default.ReportErrorOnce({errorMessage:"empty serialized action in SyncQueue.loadPersistedActions"});else try{s=u.default.DeSerializeAction(o)}catch(e){l.default.ReportErrorOnce({errorMessage:"error deserializing action in SyncQueue.loadPersistedActions",error:e})}null!=s?(s.params.failureCount=0,this.Enqueue(s),a[i]=o):n[i]=!0}}for(var d in n)t.removeItem(d)}catch(e){c.default.IsIFrame()||l.default.ReportErrorOnce({errorMessage:"Caught error in SyncQueue.loadPersistedActions",error:e})}}}],[{key:"RemovePersistedActions",value:function(e){try{for(var t=S.WindowWrapper.unsafeLocalStorage,a={},n=0;n<t.length;n++){var r=t.key(n);(0===r.indexOf(e+"_Action")||0===r.indexOf(e+"_Lookup"))&&(a[r]=!0)}for(var i in a)t.removeItem(i)}catch(e){c.default.IsIFrame()||l.default.ReportErrorOnce({errorMessage:"Caught error in SyncQueue.RemovePersistedActions",error:e})}}}]),e}();t.default=R},195508:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.status=t.default=t.Transaction=void 0;var r=n(a(600861)),i=n(a(856690)),o=n(a(689728)),l=n(a(496486)),u=a(29827),s=n(a(819433)),c=a(646317),d=n(a(962553)),f=a(237136);function p(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}t.status={PENDING:"PENDING",COMMITTED:"COMMITTED",ABORTED:"ABORTED"};var v=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:(0,c.makeGuid)()};(0,i.default)(this,e),this.dataManager=t,this.handlers=a,this._model=n,this._closed=!1}return(0,o.default)(e,[{key:"id",get:function(){return this._model.id}},{key:"closed",get:function(){return this._closed||!this.dataManager.isCurrent}},{key:"isValid",get:function(){return this.validate().isEmpty()}},{key:"started",get:function(){return this.logRecords.length>0}},{key:"modifiedData",get:function(){return l.default.some(this.activeRecords,f.modifiedData)}},{key:"hasUserEdits",get:function(){return l.default.some(this.activeRecords,(function(e){return"UPDATE"===e.type||"END_GROUP"===e.type}))}},{key:"currentGroupHasUserEdits",get:function(){return l.default.some(this.currentGroupActiveRecords,(function(e){return"UPDATE"===e.type||"END_GROUP"===e.type}))}},{key:"lastModifiedTimestamp",get:function(){var e;return null===(e=l.default.findLast(this.logRecords,(function(e){return null!=e.timestamp})))||void 0===e?void 0:e.timestamp}},{key:"toJSON",value:function(){return l.default.cloneDeep(this._model)}},{key:"model",get:function(){return this.toJSON()}},{key:"start",value:function(){return this.closed?null:this.handlers.onStart(this)}},{key:"startGroup",value:function(e){return this.closed?null:this.handlers.onStartGroup(this,e)}},{key:"endGroup",value:function(){return this.closed?null:this.handlers.onEndGroup(this)}},{key:"create",value:function(e,t,a){return this.closed?null:this.handlers.onCreate(this,e,t,a)}},{key:"recompute",value:function(e,t,a){return this.closed?null:this.handlers.onRecompute(this,e,t,a)}},{key:"update",value:function(e,t,a,n,r,i){return this.closed?null:this.handlers.onUpdate(this,e,t,a,n,r,i)}},{key:"delete",value:function(e,t){return this.closed?null:this.handlers.onDelete(this,e,t)}},{key:"undo",value:function(){return this.closed?null:this.handlers.onUndo(this)}},{key:"abort",value:function(){return this.closed?null:(this._closed=!0,this.handlers.onAbort(this))}},{key:"validate",value:function(e){return this.handlers.onValidate(this,e)}},{key:"commit",value:function(e){var t=this;this.handlers.onCommit(this,(function(a,n,r){a||(t._closed=!0),null==e||e(a,n,r)}))}},{key:"commitAsync",value:function(e){var t=this;return this.handlers.onCommitAsync(this,e).then((function(e){return t._closed=!0,e}))}},{key:"getInitialRowValues",value:function(e,t){if(this.dataManager.findTableCollection(e).rootTable){var a=l.default.first(this.getRecordsForRow(e,t));if(a)return"CREATE"===a.type?a.after:a.before}return null}},{key:"getInitialErrorState",value:function(e,t){var a=l.default.find(this.getRecordsForRow(e,t),(function(e){return null!=e.initialErrorState}));return null==a?void 0:a.initialErrorState}},{key:"getResetColumns",value:function(e,t){return l.default.extend.apply(l.default,[{}].concat((0,r.default)(this.getRecordsForRow(e,t).map((function(e){return e.wasReset})))))}},{key:"wasCreated",value:function(e){return null!=this.dataManager.findPendingRow(e)}},{key:"wasModified",value:function(e,t,a){var n=this.getInitialRowValues(e,t);if(!n)return!1;var r=this.dataManager.findTableCollection(e),i=r.rootTable,o=r.rootTableSchema;if(!i||!o)return!1;var u=i.lookupTableRow(t,this),s=(null==u?void 0:u.values)||{},c=this.getResetColumns(e,t);return a?s[a]!==n[a]||!!c[a]:!l.default.isEqual(n,s)||l.default.keys(c).length>0}},{key:"getRecordsOfTypeForRow",value:function(e,t,a){var n=this.dataManager.findTableCollection(e).rootTable;return this.activeRecords.filter((function(e){return e.rootTableName===(null==n?void 0:n.name())&&e.stableId===t&&e.type===a}))}},{key:"getRecordsForRow",value:function(e,t){var a=this.dataManager.findTableCollection(e).rootTable;return this.activeRecords.filter((function(e){return e.rootTableName===(null==a?void 0:a.name())&&e.stableId===t}))}},{key:"logRecords",get:function(){return this.dataManager.getLogRecords(this.id)}},{key:"activeRecords",get:function(){return this.dataManager.getActiveRecords(this.id)}},{key:"startRecord",get:function(){return this.dataManager.getStartRecord(this.id)}},{key:"lastRecord",get:function(){return this.dataManager.getLastRecord(this.id)}},{key:"lastActiveRecord",get:function(){return this.dataManager.getLastActiveRecord(this.id)}},{key:"currentGroupStartedBy",get:function(){var e;return null===(e=this.dataManager.getOpenGroupRecords(this.id)[0])||void 0===e?void 0:e.startedBy}},{key:"findGroupStartedBy",value:function(e){return this.dataManager.getOpenGroupRecords(this.id).find((function(t){return t.startedBy===e}))}},{key:"owningViewState",get:function(){if(d.default.usePendingChangesStore){var e=(0,s.default)().getState();return(0,u.getViewInPendingTransactionById)(this.id,e)}}},{key:"currentGroupActiveRecords",get:function(){var e=this.activeRecords,t=this.dataManager.getOpenGroupRecords(this.id)[0],a=e.indexOf(t);return a>0?e.slice(a):e}},{key:"affectedRootTableNames",get:function(){return l.default.compact(l.default.uniq(this.activeRecords.map((function(e){return e.rootTableName}))))}},{key:"affectedRootTables",get:function(){var e=this;return l.default.compact(this.affectedRootTableNames.map((function(t){return e.dataManager.findTableCollection(t).rootTable})))}},{key:"stableReferenceRecords",get:function(){return this.activeRecords.filter((function(e){return"CREATE"===e.type&&null!=e.stableReference}))}},{key:"hasStableReverseRef",value:function(e){return this.stableReferenceRecords.filter((function(t){var a=t.stableReference,n=t.stableId;return l.default.isMatch(a,e)&&l.default.isMatch(a,{stableId:n})})).length>0}},{key:"getStableReferencesTo",value:function(e){return this.stableReferenceRecords.filter((function(t){var a=t.stableReference;return a.referencedTableName===e.tableName&&a.referencedStableId===e.stableId})).map((function(e){return e.stableReference}))}},{key:"affectedRows",get:function(){var e,t=this,a=new Map,n=p(this.affectedRootTables);try{for(n.s();!(e=n.n()).done;){var r=e.value;a.set(r.name(),r)}}catch(e){n.e(e)}finally{n.f()}return l.default.uniq(l.default.compact(this.activeRecords.map((function(e){var n=e.rootTableName,r=e.rowId,i=e.stableId,o=a.get(null!=n?n:"");return null==o?void 0:o.lookupTableRow(null!=i?i:r,t)}))))}},{key:"inNestedTransactionGroup",get:function(){return this.dataManager.getOpenGroupRecords(this.id).length>1}}]),e}();t.Transaction=v;var m=v;t.default=m},397013:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808)),s=n(a(593302)),c=n(a(496486)),d=n(a(365914)),f=n(a(150198)),p=n(a(189491)),h=a(213082),v=a(515128),m=n(a(593186));function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var y=function(e){return null==e?0:Number(e)||0},b=function(e){(0,o.default)(a,e);var t=g(a);function a(e,n){var i;return(0,r.default)(this,a),(i=t.call(this,e,n)).Operator=e.Op,i}return(0,i.default)(a,[{key:"runEval",value:function(e){if(null===e||2!==e.length)return null!==e&&1===e.length&&"UNARY_MINUS"===this.Operator?"number"===this.resultType().toLowerCase()?this.runNumber(e):this.runDecimal(e):null;switch(this.resultType().toLowerCase()){case"date":case"changetimestamp":case"datetime":return this.runDate(e);case"time":return this.runTime(e);case"duration":return this.runDuration(e);case"list":return this.runList(e);case"number":case"changecounter":return this.runNumber(e);default:return this.runDecimal(e)}}},{key:"runDate",value:function(e){switch(this.Operator){case"DATE_PLUS":return e[1].attribute.yields("Duration")?d.default.addSeconds(f.default.makeDate(e[0].value),d.default.getDurationSecs(d.default.parseDuration(e[1].value))):d.default.addDays(f.default.makeDate(e[0].value),y(e[1].value));case"DATE_MINUS":return e[1].attribute.yields("Duration")?d.default.addSeconds(f.default.makeDate(e[0].value),-1*d.default.getDurationSecs(d.default.parseDuration(e[1].value))):d.default.addDays(f.default.makeDate(e[0].value),-1*y(e[1].value))}return null}},{key:"runTime",value:function(e){switch(this.Operator){case"TIME_PLUS":return e[1].attribute.yields("Duration")?d.default.timeToDate(d.default.dateToTime(d.default.addSeconds(e[0].value,d.default.getDurationSecs(d.default.parseDuration(e[1].value))))):d.default.timeToDate(d.default.dateToTime(d.default.addHours(e[0].value,y(e[1].value))));case"TIME_MINUS":return e[1].attribute.yields("Duration")?d.default.timeToDate(d.default.dateToTime(d.default.addSeconds(e[0].value,-1*d.default.getDurationSecs(d.default.parseDuration(e[1].value))))):d.default.timeToDate(d.default.dateToTime(d.default.addHours(e[0].value,-1*y(e[1].value))))}return null}},{key:"runDuration",value:function(e){switch(this.Operator){case"DURATION_PLUS":return e[0].attribute.yields("Duration")&&e[1].attribute.yields("Duration")?d.default.addDurations(e[0].value,e[1].value):e[0].attribute.yields("Duration")&&e[1].attribute.yields("Number")?d.default.addDurationHours(e[0].value,y(e[1].value)):null;case"DURATION_MINUS":return e[0].attribute.yields("Duration")&&e[1].attribute.yields("Duration")?d.default.diffDurations(e[0].value,e[1].value):e[0].attribute.yields("Duration")&&e[1].attribute.yields("Number")?d.default.subtractDurationHours(e[0].value,y(e[1].value)):e[0].attribute.yields("Time")&&e[1].attribute.yields("Time")?d.default.diffTimes(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value)):e[0].attribute.yields("Date")&&e[1].attribute.yields("Date")?d.default.diffDates(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value)):d.default.diffTimes(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value))}return null}},{key:"runList",value:function(e){switch(this.Operator){case"LIST_PLUS":return null==e[0].value?e[1].value:null==e[1].value?e[0].value:e[0].value.concat(e[1].value);case"LIST_MINUS":if(null==e[0])return null;if(null==e[1])return e[0].values;var t=e[0].value,a=this.children[0].resultAttribute().nestedAttribute(),n=a.basestType(),r=e[1].value,i=this.children[1].resultAttribute().nestedAttribute(),o=i.basestType(),l=c.default.uniq(r).map((function(e){return(0,h.getTypedChildValue)(e,i,n,!1)})),u=c.default.zipObject(t,t.map((function(e){return(0,h.getTypedChildValue)(e,a,o,!1)})));return c.default.uniq(c.default.differenceWith(t,l,(function(e,t){return u[e]===t})))}return null}},{key:"runNumber",value:function(e){var t;switch(this.Operator){case"PLUS":return y(e[0].value)+y(e[1].value);case"MINUS":return y(e[0].value)-y(e[1].value);case"TIMES":return y(e[0].value)*y(e[1].value);case"DIV":return 0===(t=y(e[1].value))?0:1*y(e[0].value)/t;case"MOD":return y(e[0].value)%y(e[1].value);case"UNARY_MINUS":return-1*y(e[0].value)}return null}},{key:"normalizeDecimalValue",value:function(e){var t=this.resultTypeQualifier(),a=t&&null!=t.DecimalDigits?t.DecimalDigits:2;if("number"==typeof a){"Percent"===this.resultType()&&(a+=2);var n=Math.pow(10,a);return Math.round(e*n)/n}return e}},{key:"runDecimal",value:function(e){try{var t=0,a=new s.default(1*y(e[0].value)),n=e.length>1?new s.default(y(e[1].value)):null;switch(this.Operator){case"PLUS":t=Number(a.plus(n).toFixed());break;case"MINUS":t=Number(a.minus(n).toFixed());break;case"TIMES":t=Number(a.times(n).toFixed());break;case"DIV":t=n.eq(0)?0:Number(a.div(n).toFixed());break;case"MOD":t=n.eq(0)?0:Number(a.mod(n).toFixed());break;case"UNARY_MINUS":t=Number(a.times(-1).toFixed())}return t}catch(t){var r=(0,v.asError)(t);return"BigError"===r.name&&"NaN"===r.message||m.default.ReportErrorOnce({errorMessage:"Unexpected error in runDecimal",error:r}),this.runNumber(e)}}}]),a}(p.default);t.default=b},213082:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.getTypedChildValue=b;var i=n(a(856690)),o=n(a(689728)),l=n(a(861655)),u=n(a(994993)),s=n(a(73808)),c=n(a(496486)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(365914)),f=n(a(150198)),p=n(a(189491));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.default)(this,a)}}var m=new Date("01/01/1970 00:00:00").getTime(),g=new Date("12/30/1899 00:00:00").getTime(),y=function(e){(0,l.default)(a,e);var t=v(a);function a(e,n){var r;return(0,i.default)(this,a),(r=t.call(this,e,n)).IsAtomic="true"===String(e.IsAtomic),r.BoolType=e.BoolType,r.OperatorName=e.OperatorName,r}return(0,o.default)(a,[{key:"canBeShortCircuited",value:function(e){return this.children.length>1&&!this.IsAtomic&&!(null==e?void 0:e.isFakeContext)}},{key:"meetsShortCircuitCondition",value:function(e){switch(this.BoolType){case"AND":return!1===e;case"OR":return!0===e}return!1}},{key:"runEval",value:function(e,t){switch(this.IsAtomic){case!0:return this.runAtomicBoolean(e,t);case!1:return this.runCompositeBoolean(e)}return null}},{key:"runCompositeBoolean",value:function(e){switch(this.BoolType){case"AND":return e.every((function(e){return Boolean(e.value)}));case"OR":return e.some((function(e){return Boolean(e.value)}));case"NOT":return!e[0].value}return null}},{key:"runEqualsNew",value:function(e,t,a,n){return null===e||""===e||null===a||""===a?e===a:t===n}},{key:"runAtomicBoolean",value:function(e,t){var a,n=null===(a=null==t?void 0:t.appModel)||void 0===a?void 0:a.useConsistentComparisonOperators,r=e[0],i=e[1],o=r.attribute,l=i.attribute,u=b(r.value,o,l.basestType(),n),s=b(i.value,l,o.basestType(),n);if(n){switch(this.OperatorName){case"GreaterThan":return u>s;case"GreaterThanOrEquals":return u>s||this.runEqualsNew(r.value,u,i.value,s);case"LessThan":return u<s;case"LessThanOrEquals":return u<s||this.runEqualsNew(r.value,u,i.value,s);case"Equals":return this.runEqualsNew(r.value,u,i.value,s);case"NotEquals":return!this.runEqualsNew(r.value,u,i.value,s)}return null}switch(this.OperatorName){case"GreaterThan":return u>s;case"GreaterThanOrEquals":return u>=s;case"LessThan":return u<s;case"LessThanOrEquals":return u<=s;case"Equals":return u===s;case"NotEquals":return u!==s}return null}},{key:"getLookupValues",value:function(){return this.IsAtomic?this.getAtomicLookupValues():this.getCompositeLookupValues()}},{key:"getAtomicLookupValues",value:function(){if("Equals"===this.OperatorName&&null!=this.children&&2===this.children.length){var e,t,a={};if("COLUMN"===this.children[0].model.EvalType&&"CONSTANT"===this.children[1].model.EvalType)return e=this.children[0].ColumnName,t=this.children[1].Value,a[e]=d.default.stripRefImageValue(t,this.children[0].model.ResultType),a;if("COLUMN"===this.children[1].model.EvalType&&"CONSTANT"===this.children[0].model.EvalType)return e=this.children[1].ColumnName,t=this.children[0].Value,a[e]=d.default.stripRefImageValue(t,this.children[0].model.ResultType),a}return null}},{key:"getCompositeLookupValues",value:function(){var e;switch(this.BoolType){case"AND":return e=null,this.children.map((function(t){var a=t.getLookupValues();e?a&&(e=c.default.assign(e,a)):e=a})),e;case"OR":case"NOT":return null}return null}}]),a}(p.default);function b(e,t,a,n){var r;if(Array.isArray(e))r=(r=e.map((function(e){return b(e,t.nestedAttribute(),a,n)}))).sort().toString();else{var i=t.basestType();r=function(e,t,a,n){var r;switch(t){case"Date":return!n||null!==e&&""!==e?((r=f.default.makeDate(e)).setHours(0,0,0,0),r.getTime()):m;case"Time":return n?null===e||""===e?g:((r=f.default.makeDate(e)).setFullYear(1899,11,30),r.getTime()):((r=f.default.makeDate(e)).setFullYear(0,0,0),r.getTime());case"DateTime":case"ChangeTimestamp":return!n||null!==e&&""!==e?f.default.makeDate(e).getTime():m;case"Duration":return d.default.getDurationSecs(d.default.parseDuration(e));case"Yes/No":return e;case"Text":if("Yes/No"===a)switch(String(e).toLowerCase()){case"y":case"yes":case"t":case"true":return!0;case"n":case"no":case"f":case"false":return!1}if("Progress"===a)switch(String(e).toLowerCase()){case"empty":return"empty";case"quarter":case"one quarter":return"quarter";case"half":return"half";case"three quarter":case"three quarters":return"three quarter";case"full":return"full"}return null==e?"":String(e).toLowerCase();case"Number":case"Decimal":case"Price":case"Percent":case"ChangeCounter":return Number(e);case"List":case"EnumList":return null==e?"":e.sort().toString().toLowerCase();case"File":case"Image":case"Signature":case"Thumbnail":case"Drawing":return d.default.stripRefImageValue(e,t);case"Url":return e&&"function"==typeof e.indexOf&&0!==e.indexOf("{")?JSON.stringify(f.default.urlValueFromWireFormat(e)).toLowerCase():null==e?"":String(e).toLowerCase();default:return null==e?"":String(e).toLowerCase()}}(e,i,a,n),"Text"!==i&&"Text"!==a||(r=(0,d.toNormalizedString)(r))}return r}t.default=y},17601:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808)),s=a(888861);function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var d=function(e){(0,o.default)(a,e);var t=c(a);function a(e,n){return(0,r.default)(this,a),t.call(this,e,n)}return(0,i.default)(a,[{key:"ColumnIndex",get:function(){var e;return null!==(e=this.model.ColIndex)&&void 0!==e?e:0}},{key:"ColumnName",get:function(){var e;return null!==(e=this.model.ColName)&&void 0!==e?e:""}},{key:"ContextLevel",get:function(){var e;return null!==(e=this.model.ContextLevel)&&void 0!==e?e:0}},{key:"runEval",value:function(e,t){if(null==t||"function"!=typeof t.getColumnValue)return null;var a=t.getColumnValue(this.ColumnName,this.ColumnIndex,this.ContextLevel);return this.resultAttribute().valueFromWireFormat(a)}},{key:"curryThis",value:function(e){if(!e||"function"!=typeof e.getColumnValue)return this;var t=e.getColumnValue(this.ColumnName,this.ColumnIndex,this.ContextLevel);return null==t?this:(0,s.createConstantValue)(t,this.resultType(),this.resultTypeQualifier())}}],[{key:"is",value:function(e){return"COLUMN"===e.evalType()}}]),a}(n(a(189491)).default);t.default=d},50757:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(441588)),l=n(a(861655)),u=n(a(994993)),s=n(a(73808));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.default)(this,a)}}var d=function(e){(0,l.default)(a,e);var t=c(a);function a(e,n){var i;return(0,r.default)(this,a),(i=t.call(this,e,n)).ColumnIndex=e.ColIndex,i.ContextLevel=e.ContextLevel,i.TableName=e.TableName,i.RowListAttrName=e.RowListAttrName,i.RowListAttrIndex=e.RowListAttrIndex,i.MakeDistinct=e.MakeDistinct,i}return(0,i.default)(a,[{key:"runEval",value:function(e,t){var a=this;if(null==t||"function"!=typeof t.getTableColumnSet)return[];var n=this.resultAttribute(),r=n.nestedAttribute()||n,i=this.TableName,o=this.ColumnIndex,l=this.MakeDistinct,u=this.RowListAttrName,s=this.RowListAttrIndex,c=this.ContextLevel,d=r.valuesFromWireFormat(t.getTableColumnSet(i,o,null,l,null,s,u,c)),f=r.basestAttribute().type();return d.map((function(e){return a.handleRefImageValue(e,f,i)}))}},{key:"curryThis",value:function(e){var t;return(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))?null!=this.RowListAttrIndex?null==e.getColumnValue(this.RowListAttrName,this.RowListAttrIndex,this.ContextLevel)?this:this.convertToConstant(e):(0,o.default)((0,s.default)(a.prototype),"curryThis",this).call(this,e):e?this.children&&0!==this.children.filter((function(e){return"CONSTANT"!==e.model.EvalType})).length?this:this.convertToConstant(e):this}}]),a}(n(a(189491)).default);t.default=d},85945:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808)),s=n(a(189491));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var d=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},f=function(e){(0,o.default)(a,e);var t=c(a);function a(e,n){return(0,r.default)(this,a),t.call(this,e,n)}return(0,i.default)(a,[{key:"Value",get:function(){return null!=this.model.ConstantValue?this.model.ConstantValue:(void 0===this._wireValue&&(this._wireValue=this.resultAttribute().valueToWireFormat(this.NativeValue)),this._wireValue)}},{key:"NativeValue",get:function(){return void 0!==this.model.NativeValue?this.model.NativeValue:(void 0===this._nativeValue&&(this._nativeValue=null,this._nativeValue=this.resultAttribute().valueFromWireFormat(this.Value)),this._nativeValue)}},{key:"runEval",value:function(){return this.NativeValue}},{key:"curryRollout",value:function(){return this}},{key:"toJSON",value:function(){var e;if(void 0===this.model.ConstantValue||void 0!==this.model.NativeValue){var t=this.model,a=(t.NativeValue,d(t,["NativeValue"])),n=null!==(e=a.ConstantValue)&&void 0!==e?e:this.Value;return Object.assign(Object.assign({},a),{ConstantValue:n})}return this.model}}],[{key:"is",value:function(e){return"CONSTANT"===e.evalType()}}]),a}(s.default);t.default=f},98705:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(441588)),l=n(a(861655)),u=n(a(994993)),s=n(a(73808)),c=a(888861),d=n(a(189491)),f=n(a(150198));function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.default)(this,a)}}var h=function(e){(0,l.default)(a,e);var t=p(a);function a(e,n){var i;return(0,r.default)(this,a),(i=t.call(this,e,n)).RefColumnIndex=e.RefColumnIndex,i.RefColumnName=e.RefColumnName,i.RemoteColumnIndex=e.RemoteColumnIndex,i.RemoteColumnName=e.RemoteColumnName,i.RemoteTableName=e.RemoteTableName,i}return(0,i.default)(a,[{key:"runEval",value:function(e,t){if(null==t||"function"!=typeof t.getColumnValue||"function"!=typeof t.getTableColumnValue)return null;var a,n,r;if(null!=e&&1===e.length){var i=e[0],o=i.attribute,l=i.value;a=o.valueToWireFormat(l)}else a=t.getColumnValue(this.RefColumnName,this.RefColumnIndex,0);return null==this.RemoteTableName?null:(n=t.getTableColumnValue(this.RemoteTableName,a,this.RemoteColumnName,this.RemoteColumnIndex),r=this.resultAttribute().valueFromWireFormat(n),r=this.handleRefImageValue(r,this.resultAttribute().basestAttribute().type(),this.RemoteTableName))}},{key:"curryThis",value:function(e){var t;if(null!=this.children&&1===this.children.length)return(0,o.default)((0,s.default)(a.prototype),"curryThis",this).call(this,e);if(e&&"function"==typeof e.getColumnValue&&null!=e.getColumnValue(this.RefColumnName,this.RefColumnIndex,0)){if(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))return(0,o.default)((0,s.default)(a.prototype),"curryThis",this).call(this,e);var n=this.run(e),r=f.default.valueToWireFormat(n,this.resultType(),this.resultTypeQualifier());return(0,c.createConstantValue)(r,this.resultType(),this.resultTypeQualifier())}return this}}]),a}(d.default);t.default=h},189491:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.sortByExpensiveRollout=t.default=t.DEFAULT_ASYNC_TIMEOUT=void 0;var r=n(a(918698)),i=n(a(600861)),o=n(a(856690)),l=n(a(689728)),u=n(a(496486)),s=n(a(65706)),c=n(a(593186)),d=n(a(365914)),f=n(a(150198)),p=a(888861),h=a(895466),v=a(166089);function m(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var y=5e3;function b(e,t){return"value"===e&&"number"==typeof t&&isNaN(t)?"__NaN__":t}t.DEFAULT_ASYNC_TIMEOUT=y;var T=function(e,t){return t.mayBeExpensive-e.mayBeExpensive},S=function(e,t){return Number(e.mayBeExpensive)-Number(t.mayBeExpensive)};t.sortByExpensiveRollout=S;var A=function(e){return e.model},w=function(e){return e.isPure()},C=function(e){return e.columnsReferenced()},E=function(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n;n.trace&&(a={},r=Object.assign(Object.assign({},n),{trace:a}));var i=e.resultType(),o=e.resultAttribute(),l=e.run(t,r);return l instanceof Promise?l.then((function(e){return{type:i,attribute:o,value:e,trace:a}})):{type:i,attribute:o,value:l,trace:a}},k=function(){function e(t,a){var n=this;(0,o.default)(this,e),this.model=t;var r=a(t);r&&(this.children=r),void 0===t.IsPure&&(t.IsPure=!r||r.every(w)),t.ColumnsReferenced||(t.ColumnsReferenced=r?u.default.flatten(r.map(C)):[]),null!=v.AppGlobals.AppModel&&v.AppGlobals.AppModel.inRollout("fromCacheOrRunEval")||(this.fromCacheOrRunEval=this.isPure()?(0,s.default)({limit:100,makeKey:function(e,t){var a=e.map((function(e){return e.value}));return t&&"PARAM"===n.evalType()&&a.push(t.getInputParameterValue(n.model.Name)),JSON.stringify(a,b)},getTimestamp:function(){var e;return(null===(e=v.AppGlobals.AppModel)||void 0===e?void 0:e.DataStamp)||""},fn:function(e,t,a){return n.runEval(e,t,a)}}):this.runEval.bind(this))}return(0,l.default)(e,[{key:"withCurriedChildren",value:function(e){var t=(0,p.create)(Object.assign(Object.assign({},this.model),{Children:e.map(A)}),(function(){return e})),a=this._resultAttribute;return a&&(t._resultAttribute=a),t}},{key:"isConstant",get:function(){return"CONSTANT"===this.evalType()}},{key:"convertToConstant",value:function(e){var t,a=this.run(e);if(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))return(0,p.createConstantValueNative)(a,this.resultType(),this.resultTypeQualifier());var n=a,r=f.default.valueToWireFormat(n,this.resultType(),this.resultTypeQualifier());if(c.default.Debug()){var i=f.default.valueFromWireFormat(r,this.resultType(),this.resultTypeQualifier());!i&&!n||u.default.isEqual(i,n)||c.default.ReportErrorOnce({errorMessage:"convertToConstant doesn't roundtrip",thisValue:n,thisWireValue:r,sanityCheck:i})}return(0,p.createConstantValue)(r,this.resultType(),this.resultTypeQualifier())}},{key:"runAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.resolve(this.run(e,Object.assign({supportsAsync:!0,timeout:y},t)))}},{key:"run",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return null!=this.children&&this.children.length>0?this.runInternalNode(e,t,a):this.runLeafNode(e,t,a)}},{key:"runChildEvals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[],n=!1,r=this.children,i=this.canBeShortCircuited(e);i&&this.mayBeExpensive&&(r=r.sort(T));for(var o=0;o<r.length;o++){var l=E(r[o],e,t);if(a.push(l),l instanceof Promise)n=!0;else if(i&&this.meetsShortCircuitCondition(l.value))break}return n?Promise.all(a):a}},{key:"runSelf",value:function(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return a=n.noCache?this.runEval(e,t,n,r):this.fromCacheOrRunEval(e,t,n,r),n.trace&&(n.trace.Result=a,n.trace.Source=this.model.SourceExpr,n.trace.ChildTraces=u.default.compact(e.map((function(e){return e.trace})))),a}},{key:"runInternalNode",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.runChildEvals(e,a);return r instanceof Promise?r.then((function(r){return t.runSelf(r,e,a,n)})):this.runSelf(r,e,a,n)}},{key:"runLeafNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.runEval(void 0,e,t,a);return t.trace&&(t.trace.Source=this.model.SourceExpr,t.trace.Result=n),n}},{key:"fromCacheOrRunEval",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.runEval(e,t,a,n)}},{key:"runEval",value:function(e,t,a,n){return null}},{key:"canBeShortCircuited",value:function(e){return!1}},{key:"meetsShortCircuitCondition",value:function(e){return!1}},{key:"source",get:function(){return this.model.SourceExpr}},{key:"hash",get:function(){var e=this._hash;return null==e&&(e=this._hash=d.default.hashCode(this.source||JSON.stringify(this.model))),e}},{key:"mayBeExpensive",get:function(){return Boolean(this.model.MayBeExpensive)}},{key:"isRowList",value:function(){return null!=this.model.RowListAttrIndex||this.model.RowListAttrName}},{key:"isEqualTo",value:function(e){return null!=e&&this.hash===e.hash}},{key:"curry",value:function(e){var t;if(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("curry"))return this.curryRollout(e);var a=(0,p.create)(Object.assign({},this.model));if(null!=this.children)if(a.model.Children=[],this.canBeShortCircuited(e)){var n=this.children;this.mayBeExpensive&&(n=this.children.sort(T));for(var r=[],i=0;i<n.length;i++){var o=n[i].curry(e);if("CONSTANT"===o.evalType()&&this.meetsShortCircuitCondition(o.nativeValue())){r.length=0,r.push(o);break}r.push(o)}a.children=r,a.model.Children=r.map((function(e){return e.model}))}else a.children=this.children.map((function(t,n){var r=t.curry(e);return a.model.Children[n]=r.model,r}));return a.curryThis(e)}},{key:"curryRollout",value:function(e){var t,a=null===(t=this.children)||void 0===t?void 0:t.length;if(null!=this.children&&a){var n,r=this.children,o=this.canBeShortCircuited(e);o&&this.mayBeExpensive&&(n=r=(0,i.default)(this.children).sort(S));for(var l=0;l<a;l++){var u=r[l],s=u.curry(e);if(o&&"CONSTANT"===s.evalType()&&this.meetsShortCircuitCondition(s.nativeValue())){(n=null!=n?n:[]).length=0,n.push(s);break}s!==u&&((n=null!=n?n:(0,i.default)(this.children))[l]=s)}if(n)return this.withCurriedChildren(n).curryThis(e)}return this.curryThis(e)}},{key:"curryThis",value:function(e){return e&&u.default.every(this.children,(function(e){return"CONSTANT"===e.evalType()}))?this.convertToConstant(e):this}},{key:"getLookupValues",value:function(){return null}},{key:"operatorName",value:function(){return this.model.OperatorName}},{key:"evalType",value:function(){return this.model.EvalType}},{key:"colName",value:function(){return this.model.ColName}},{key:"constantValue",value:function(){return this.Value}},{key:"nativeValue",value:function(){return this.NativeValue}},{key:"resultType",value:function(){return this.model.ResultType}},{key:"resultTypeQualifier",value:function(){var e=this.model.ResultTypeQualifier;if("string"==typeof e)try{return JSON.parse(e)}catch(e){return null}return"object"===(0,r.default)(e)?e:null}},{key:"resultAttribute",value:function(){return this._resultAttribute||(this._resultAttribute=new f.default({Name:this.source,Type:this.model.ResultType,TypeAuxData:this.model.ResultTypeQualifier})),this._resultAttribute}},{key:"isThisInCondition",value:function(){return"IN"===this.FunctionName}},{key:"isPure",value:function(){return this.model.IsPure}},{key:"isAtomic",value:function(){return this.model.IsAtomic}},{key:"functionName",value:function(){return this.model.FunctionName}},{key:"boolType",value:function(){return this.model.BoolType}},{key:"toJSON",value:function(){var e;return Object.assign(Object.assign({},this.model),{Children:null===(e=this.children)||void 0===e?void 0:e.map((function(e){return e.toJSON()}))})}},{key:"columnsReferenced",value:function(){return this.model.ColumnsReferenced||[]}},{key:"ancColumnsReferenced",value:function(){return this.model.AncColumnsReferenced}},{key:"tablesReferenced",value:function(){var e;if(!this._tablesReferenced){var t,a=new Set,n=m(null!==(e=this.model.TablesReferenced)&&void 0!==e?e:[]);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=v.AppGlobals.AppModel.findTableCollection(r).rootTable;a.add(i?i.name():r)}}catch(e){n.e(e)}finally{n.f()}this.populateTablesDereferenced(a),this._tablesReferenced=Array.from(a)}return this._tablesReferenced}},{key:"populateTablesDereferenced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;if(this.RemoteTableName&&e.add(this.RemoteTableName),this.children){var t,a=m(this.children);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.populateTablesDereferenced(e)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"referencedTableTimestamps",value:function(){return this.tablesReferenced().map((function(e){var t,a;return null===(a=null===(t=v.AppGlobals.AppModel)||void 0===t?void 0:t.findTableCollection(e).rootTable)||void 0===a?void 0:a.ownTimestamp}))}},{key:"handleRefImageValue",value:function(e,t,a){switch(t){case"Image":case"Drawing":case"Signature":case"Thumbnail":case"File":e&&!(0,h.isImageHandle)(e)&&"string"==typeof e&&e.length>0&&"http"!==e.substr(0,4)&&"data"!==e.substr(0,4)&&e.indexOf("::")<0&&(e=a+"::"+e)}return e}}],[{key:"makeCompactEvaluatable",value:function(e){var t=function e(t,a){for(var n in t)n!==a||t.FunctionName?"object"===(0,r.default)(t[n])&&e(t[n],a):delete t[n]},a=u.default.cloneDeep(e);return["ColumnsReferenced","TablesReferenced","SourceExpr"].forEach((function(e){return t(a,e)})),function e(t){for(var a in t)t[a]?"object"===(0,r.default)(t[a])&&e(t[a]):delete t[a]}(a),a}}]),e}();t.default=k},565722:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(627424)),o=n(a(600861)),l=n(a(856690)),u=n(a(689728)),s=n(a(441588)),c=n(a(861655)),d=n(a(994993)),f=n(a(73808)),p=n(a(496486)),h=n(a(730381)),v=n(a(888861)),m=n(a(189491)),g=P(a(365914)),y=n(a(783918)),b=n(a(593186)),T=n(a(571524)),S=n(a(190644)),A=n(a(385857)),w=P(a(150198)),C=n(a(440587)),E=P(a(302443)),k=n(a(304878)),R=n(a(498967)),I=n(a(107465)),O=n(a(895466)),M=a(213082),N=a(351101),_=a(946094),D=a(166089);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(L=function(e){return e?a:t})(e)}function P(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=L(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}function x(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return F(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,f.default)(e);if(t){var r=(0,f.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,d.default)(this,a)}}var V=["Date","DateTime","ChangeTimestamp"],B=p.default.keyBy(["SELECT","ORDERBY","IF","IFS","ANY","TOP","SWITCH","LINKTOFILTEREDVIEW"]);function U(e){return e?"Url"===e.type?String(e.value):String(e.attribute.valueToWireFormat(e.value)):""}function H(e){var t;return null==e||""===e||0===e.length||e instanceof C.default&&!e.url||!0===(null===(t=(0,N.getAppModel)())||void 0===t?void 0:t.inRollout("curryNativeValue"))&&Array.isArray(e)&&1===e.length&&H(e[0])}var W=function(e){(0,c.default)(n,e);var t=G(n);function n(e,a){var r;return(0,l.default)(this,n),(r=t.call(this,e,a)).FunctionName=e.FunctionName,r}return(0,u.default)(n,[{key:"run",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return B[this.FunctionName]?this.runLazy(e,t,a):(0,s.default)((0,f.default)(n.prototype),"run",this).call(this,e,t,a)}},{key:"runLazy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(this.FunctionName){case"SELECT":return this.runSelect(e,t,a);case"ORDERBY":return this.runOrderBy(e,t,a);case"IF":return this.runIf(e,t);case"IFS":return this.runIfS(e,t);case"SWITCH":return this.runSwitch(e,t);case"ANY":return this.runAny(e,t);case"TOP":return this.runTop(e,t);case"LINKTOFILTEREDVIEW":return this.runLinkToFilteredView(e,t);default:return null}}},{key:"curry",value:function(e){return B[this.FunctionName]?this.curryLazy(e):(0,s.default)((0,f.default)(n.prototype),"curry",this).call(this,e)}},{key:"runEval",value:function(e,t){var a,n,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(this.FunctionName){case"_TODAY":case"TODAY":return(r=new Date).setHours(0,0,0,0),r;case"_TIMENOW":case"TIMENOW":return g.default.timeToDate(g.default.dateToTime(new Date));case"NOW":case"_NOW":return(i=new Date).setMilliseconds(0),i;case"UTCNOW":return this.runUtcNow();case"HOUR":return this.runHour(e);case"MINUTE":return this.runMinute(e);case"SECOND":return this.runSecond(e);case"TOTALHOURS":return this.runTotalHours(e);case"TOTALMINUTES":return this.runTotalMinutes(e);case"TOTALSECONDS":return this.runTotalSeconds(e);case"DAY":return this.runDay(e);case"MONTH":return this.runMonth(e);case"YEAR":return this.runYear(e);case"WEEKDAY":return this.runWeekday(e);case"WEEKNUM":return this.runWeeknum(e);case"ISOWEEKNUM":return this.runIsoWeeknum(e);case"DATE":return this.runDate(e);case"TIME":return this.runTime(e);case"DATETIME":return this.runDateTime(e);case"USERNAME":case"_USERNAME":return D.AppGlobals.AppState.UserInformation.Name;case"USEREMAIL":case"_USEREMAIL":return this.runUserEmail(D.AppGlobals.AppState.UserInformation.AuthUserEmail);case"USERROLE":case"_USERROLE":return this.runUserRole(D.AppGlobals.AppState.UserInformation.UserRole);case"USERLOCALE":return navigator.languages?navigator.languages[0]:navigator.language;case"USERTZOFFSET":return(new Date).getTimezoneOffset();case"HERE":case"_HERE":return null!==(a=null==t?void 0:t.getLatLong(o))&&void 0!==a?a:null;case"UNIQUEID":case"_UNIQUE":return this.runUniqueId(e);case"ISBLANK":return this.runIsBlank(e);case"CONCATENATE":return this.runConcatenate(e);case"CONTAINS":return this.runContains(e);case"STARTSWITH":return this.runStartsWith(e);case"ENDSWITH":return this.runEndsWith(e);case"LEN":return this.runLen(e);case"LEFT":return this.runLeft(e);case"RIGHT":return this.runRight(e);case"MID":return this.runMid(e);case"FIND":return this.runFind(e);case"INITIALS":return this.runInitials(e);case"TEXT":return this.runText(e);case"UPPER":return this.runUpper(e);case"LOWER":return this.runLower(e);case"DOMAINOF":return this.runDomainOf(e);case"SUBSTITUTE":return this.runSubstitute(e);case"SPLIT":return this.runSplit(e);case"TRIM":return this.runTrim(e);case"LIST":return this.runList(e);case"SORT":return this.runSort(e);case"INDEX":return this.runIndex(e);case"IN":return(null===(n=null==t?void 0:t.appModel)||void 0===n?void 0:n.inRollout("curryNativeValue"))?this.runInRollout(e,t):this.runIn(e,t);case"COUNT":case"SUM":case"ANY":case"MIN":case"MAX":case"AVERAGE":case"STDEVP":return this.runAggregate(this.FunctionName,e,t);case"ROUND":case"FLOOR":case"CEILING":return this.runMathRounding(this.FunctionName,e);case"LOG":return this.runMathLog(e);case"MOD":return this.runMathMod(e);case"POWER":return this.runMathPower(e);case"ABS":return this.runMathAbs(e);case"SQRT":return this.runMathSqrt(e);case"RANDBETWEEN":return this.runMathRandBetween(e);case"NUMBER":return this.runNumber(e);case"DECIMAL":return this.runDecimal(e);case"HYPERLINK":return this.runHyperlink(e);case"LINKTEXT":return this.runLinkText(e);case"LINKURL":return this.runLinkUrl(e);case"LAT":return this.runLat(e);case"LONG":return this.runLong(e);case"LATLONG":return this.runLatLong(e);case"XY":return this.runXY(e);case"DISTANCE":return this.runDistance(e,t);case"ENCODEURL":return this.runEncodeUrl(e);case"LINKTOFORM":return this.runLinkToForm(e);case"APP":return this.runApp(e);case"CONTEXT":return this.runContext(e,t);case"WORKDAY":return this.runWorkday(e);case"EOMONTH":return this.runEndOfMonth(e);case"EWOMONTH":return this.runEndWeekdayOfMonth(e);case"EOWEEK":return this.runEndOfWeek(e);case"PREDICT":return this.runPredict(e,t);case"OCR":return this.runOcr(e,t,o);case"OCRTEXT":return this.runOcrText(e,t,o);case"UNIQUE":return this.runUnique(e);case"INTERSECT":return this.runIntersect(e);case"EXTRACT":return this.runExtract(e)}return null}},{key:"runExtract",value:function(e){var t=this,a=e[0].value;if(!a)return[];var n=e[1].value;if(!n)return[];var r,i=[];switch(a.toUpperCase()){case"PRICE":case"PRICES":i=(i=y.default.recognizeCurrency(n,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return t._convertRecognizerPrice(e)}));break;case"NUMBER":case"NUMBERS":i=(i=y.default.recognizeNumber(n,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return parseFloat(e.resolution.value)}));break;case"PHONENUMBER":case"PHONENUMBERS":i=(i=y.default.recognizePhoneNumber(n,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return e.resolution.value}));break;case"CHOICE":case"CHOICES":i=(i=y.default.recognizeBoolean(n,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return e.resolution.value}));break;case"DATETIME":case"DATETIMES":i=(i=this._runExtractDateTimes(n,["datetime","date","time","datetimerange","daterange","timerange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DATE":case"DATES":i=(i=this._runExtractDateTimes(n,["datetime","date","datetimerange","daterange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DOMAIN":case"DOMAINS":i=(i=(0,o.default)(n.matchAll(/(\w+(?:[-+.]\w+)*@\w+(?:[-.]\w+)*\.\w+(?:[-.]\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]})).map((function(e){var t=e.indexOf("@");return e.substr(t+1)}));break;case"TIME":case"TIMES":i=(i=this._runExtractDateTimes(n,["datetime","time","datetimerange","timerange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DURATION":case"DURATIONS":for(var l in r=this._runExtractDateTimes(n,["datetimerange","daterange","timerange","duration"])){var u=r[l];if(u.hasOwnProperty("start")&&u.hasOwnProperty("end")){var s=this._convertRecognizerDateTime(u,"start"),c=this._convertRecognizerDateTime(u,"end"),d=g.default.stringifyDuration(g.default.makeDuration((c-s)/1e3));i.push(d)}else if(u.hasOwnProperty("timex")&&u.hasOwnProperty("value")){var f=parseFloat(u.value),p=g.default.stringifyDuration(g.default.makeDuration(f/1e3));i.push(p)}}break;case"EMAIL":case"EMAILS":i=(i=(0,o.default)(n.matchAll(/(\w+(?:[-+.]\w+)*@\w+(?:[-.]\w+)*\.\w+(?:[-.]\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}));break;case"HASHTAG":case"HASHTAGS":i=(i=(0,o.default)(n.matchAll(/(\#\w+(?:-\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}));break;case"MENTION":case"MENTIONS":i=(i=(0,o.default)(n.matchAll(/(\@\w+(?:-\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}))}return i}},{key:"_runExtractDateTimes",value:function(e,t){var a=y.default.recognizeDateTime(e,y.default.Culture.English);return a=(a=a.filter((function(e){return null!=e&&null!=e.resolution})).filter((function(e){return t.includes(e.resolution.values[0].type.toLowerCase())})).filter((function(e){return 0===(0,o.default)(e.text.matchAll(/^(\d+)$/g)).map((function(e){return parseInt(e)})).filter((function(e){return e<1900||e>2050})).length}))).map((function(e){return e.resolution.values[0]}))}},{key:"_convertRecognizerPrice",value:function(e){var t=parseFloat(e.resolution.value,10);return"Cent"===e.resolution.unit?t/100:t}},{key:"_convertRecognizerDateTime",value:function(e,t){return t?this._convertSingleRecognizerDateTime(e[t]):e.hasOwnProperty("start")?[this._convertSingleRecognizerDateTime(e.start),this._convertSingleRecognizerDateTime(e.end)]:this._convertSingleRecognizerDateTime(e.value)}},{key:"_convertSingleRecognizerDateTime",value:function(e){var t;if(/\bGMT[-\+]\d{4}$/.test(e))t=new Date(e);else{var a=(0,o.default)(new Date(e).toString().matchAll(/\b(GMT[-\+]\d{4})\b/g));t=a.length>0?new Date(e+" "+a[0]):new Date(e)}if(isNaN(t)&&e.indexOf(":")>-1){var n=new Date,r=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();return new Date(r+" "+e)}return t}},{key:"runUnique",value:function(e){var t=e[0].value;if(!t)return null;var a=this.children[0].resultAttribute().nestedAttribute(),n=a.basestType();return p.default.uniqBy(t,(function(e){return(0,M.getTypedChildValue)(e,a,n,!1)}))}},{key:"runIntersect",value:function(e){if(!e||2!==e.length)return null;var t=e[0].value,a=e[1].value;if(!t||!a)return null;var n=this.children[0].resultAttribute().nestedAttribute(),r=n.basestType();return p.default.intersectionBy(t,a,(function(e){return(0,M.getTypedChildValue)(e,n,r,!1)}))}},{key:"getInConditionListInformation",value:function(e){if(this.isThisInCondition()){var t=this.children[1],a=t.resultTypeQualifier(),n=t.resultAttribute();return{elementType:a.ElementType,elementTypeQualifier:w.default.parseAuxData(a.ElementTypeQualifier),elementAttribute:n.nestedAttribute(),values:p.default.uniq(this.children[1].run(e)).filter((function(e){return null!=e&&""!==e}))}}return null}},{key:"runUtcNow",value:function(){var e=new Date,t=e.getTimezoneOffset();return(0,h.default)(e).add(t,"m").toDate()}},{key:"runHour",value:function(e){var t=e[0].value;return g.default.parseDuration(t).hours}},{key:"runMinute",value:function(e){var t=e[0].value,a=g.default.parseDuration(t);return a.mins*(a.isNegative?-1:1)}},{key:"runSecond",value:function(e){var t=e[0].value,a=g.default.parseDuration(t);return a.secs*(a.isNegative?-1:1)}},{key:"runTotalHours",value:function(e){var t=g.default.parseDuration(e[0].value),a=t.hours,n=t.mins,r=t.secs;return(t.isNegative?-1:1)*(Math.abs(a)+n/60+r/3600)}},{key:"runTotalMinutes",value:function(e){var t=g.default.parseDuration(e[0].value),a=t.hours,n=t.mins,r=t.secs;return(t.isNegative?-1:1)*(60*Math.abs(a)+n+r/60)}},{key:"runTotalSeconds",value:function(e){var t=g.default.parseDuration(e[0].value),a=t.hours,n=t.mins,r=t.secs;return(t.isNegative?-1:1)*(3600*Math.abs(a)+60*n+r)}},{key:"runDay",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getDate():0}},{key:"runMonth",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getMonth()+1:0}},{key:"runYear",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getFullYear():0}},{key:"runWeekday",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getDay()+1:null}},{key:"runWeeknum",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?g.default.getWeek(new Date(t)):null}},{key:"runIsoWeeknum",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?(0,h.default)(new Date(t)).isoWeek():null}},{key:"runDate",value:function(e){var t=e[0].value;if(t){var a=new Date(t);if(a&&!isNaN(a))return a.setHours(0,0,0,0),a}return null}},{key:"runDateTime",value:function(e){var t=e[0].value;if(t){var a=new Date(t);if(a&&!isNaN(a))return a}return null}},{key:"runTime",value:function(e){var t=e[0].value;if(t){var a=new Date(t);return a&&!isNaN(a)?g.default.timeToDate(g.default.dateToTime(a)):g.default.timeToDate(t)}return null}},{key:"runUserEmail",value:function(e){var t=(0,_.getPreviewAsEmail)();return t||e}},{key:"runUserRole",value:function(e){var t;try{if(null===(t=window.parent)||void 0===t?void 0:t.getPreviewAsRole){var a=window.parent.getPreviewAsRole();if(a)return a}}catch(e){}return e}},{key:"runValueInList",value:function(e,t,a){var n=t.value,r=t.attribute,i=e.value,o=e.attribute;if(null!=i&&null!=n){var l,u=Array.isArray(n)?n:[n],s=o.basestType(),c=r.basestType(),d=r.nestedAttribute(),f=d.allNestedTypes(),h=(0,M.getTypedChildValue)(i,o,c,!1),v=[s,d.type(),f,n,a],m=this._typedListValueCacheKey,g=null!=m;if(g)for(var y=0;y<v.length;y++)p.default.isEqual(v[y],m[y])||(g=!1);if(!g){if(a){l=new Set;var b,T=x(u);try{for(T.s();!(b=T.n()).done;){var S=b.value;l.add((0,M.getTypedChildValue)(S,d,s,!1))}}catch(e){T.e(e)}finally{T.f()}}else l=u.map((function(e){return(0,M.getTypedChildValue)(e,d,s,!1)}));this._cachedTypedListValue=l,this._typedListValueCacheKey=v}return(l=this._cachedTypedListValue)instanceof Set?l.has(h):l.includes(h)}return!1}},{key:"runListInList",value:function(e,t,a){var n=this,r=e.value;if(null!=r&&null!=t.value){var i=Array.isArray(r)?r:[r],o=e.attribute.nestedAttribute(),l={type:o.type(),attribute:o};return p.default.every(i.map((function(e){return l.value=e,n.runValueInList(l,t,a)})))}return!1}},{key:"runIn",value:function(e,t){var a,n=e[0],r=e[1],i=null===(a=null==t?void 0:t.appModel)||void 0===a?void 0:a.inRollout("valueInListSet");return n.attribute.isListType()&&!r.attribute.nestedAttribute().isListType()?this.runListInList(n,r,i):this.runValueInList(n,r,i)}},{key:"runInRollout",value:function(e,t){var a,n=e[0],r=n.attribute,i=e[1],o=i.attribute.nestedAttribute(),l=r.isListType(),u=!l,s=o.isListType(),c=!s,d=null===(a=null==t?void 0:t.appModel)||void 0===a?void 0:a.inRollout("valueInListSet");if(u&&s){for(var f=o;f.nestedAttribute().isListType();)f=f.nestedAttribute();var h=p.default.extend({},i,{attribute:f,value:p.default.flattenDeep(i.value)});return this.runValueInList(n,h,d)}return l&&c?this.runListInList(n,i,d):this.runValueInList(n,i,d)}},{key:"runAggregate",value:function(e,t,a){var n,r=t[0].value,i=this.children[0].resultAttribute().nestedAttribute(),o=null==i?void 0:i.type().toLowerCase();if(r&&Array.isArray(r)&&r.length>0)switch(e){case"COUNT":return r.length;case"SUM":return"duration"===o?(0,g.sumDurations)(r):(null==i?void 0:i.isDecimalType())&&(null===(n=null==a?void 0:a.appModel)||void 0===n?void 0:n.inDynamicRolloutByOwnerId("ClientDecimalSum"))?(0,g.sumDecimals)(r):(0,g.sumNumbers)(r);case"MIN":return p.default.min(r);case"MAX":return p.default.max(r);case"AVERAGE":return r.reduce((function(e,t){return e+t}),0)/(r.length||1);case"STDEVP":var l=r.reduce((function(e,t){return e+t}),0)/(r.length||1),u=r.reduce((function(e,t){return e+Math.pow(Math.abs(t-l),2)}),0)/(r.length||1);return Math.sqrt(u)}else switch(e){case"COUNT":case"AVERAGE":case"STDEVP":return 0;case"SUM":return"duration"===o?g.default.stringifyDuration(g.default.makeDuration(0)):0;case"MIN":case"MAX":switch(o){case"number":case"percent":case"decimal":case"price":case"changecounter":return 0;case"duration":return g.default.stringifyDuration(g.default.makeDuration(0));default:return null}default:return null}return null}},{key:"runMathRounding",value:function(e,t){var a=t[0].value;if(null!=a&&""!==a){var n=Number(a);switch(e){case"ROUND":return Math.round(n);case"FLOOR":return Math.floor(n);case"CEILING":return Math.ceil(n)}}return null}},{key:"runMathLog",value:function(e){var t=e[0].value;if(null!=t){var a=Number(t),n=10;if(e.length>1){var r=e[1].value;null!=r&&(n=Number(r))}var i=0;try{i=Math.log(a)/Math.log(n)}catch(e){i=NaN}return isNaN(i)?0:i}return null}},{key:"runMathMod",value:function(e){var t=e[0].value,a=e[1].value;if(null!=t&&null!=a){var n=Number(t),r=Number(a);return 0===r?0:n%r}return null}},{key:"runMathPower",value:function(e){var t=e[0].value,a=e[1].value;if(null!=t&&null!=a){var n=Number(t),r=Number(a);return Math.pow(n,r)}return null}},{key:"runMathAbs",value:function(e){var t=e[0].value;if(null!=t){var a=Number(t);return Math.abs(a)}return null}},{key:"runMathSqrt",value:function(e){var t=e[0].value;if(null!=t){var a=Number(t);return Math.sqrt(a)}return null}},{key:"runMathRandBetween",value:function(e){var t=e[0].value,a=e[1].value;if(null!=t&&null!=a){var n=Number(t),r=Number(a);return r<=n?n:Math.floor(Math.random()*(r+1-n))+n}return null}},{key:"runLen",value:function(e){var t=e[0].value;return null===t?0:t.hasOwnProperty("length")?t.length:String(t).length}},{key:"runNumber",value:function(e){var t=e[0].value;if(!t)return null;var a=Math.round(Number(t));return isNaN(a)?null:a}},{key:"runDecimal",value:function(e){var t=e[0].value;if(!t)return null;var a=Number(t);return isNaN(a)?null:a}},{key:"runLeft",value:function(e){var t=e[0].value,a=e[1].value;return t&&a?String(t).substr(0,Number(a)):null}},{key:"runRight",value:function(e){var t=e[0].value,a=e[1].value;return t&&a?String(t).substr(String(t).length-Number(a)):null}},{key:"runMid",value:function(e){if(!p.default.isArray(e)||3!==e.length)return null;var t=e[0].value?String(e[0].value):"",a=e[1].value,n=e[2].value;return p.default.isInteger(a)&&p.default.isInteger(n)?a<=0||a>t.length?null:t.substr(a-1,n):null}},{key:"runFind",value:function(e){var t=e[0].value,a=e[1].value;return null==t||null==a?0:String(a).indexOf(String(t))+1}},{key:"runInitials",value:function(e){var t=e[0].value;return t?String(t).split(/\s+/).filter((function(e){return e})).map((function(e){return e[0]})).join(""):null}},{key:"runTrim",value:function(e){var t=e[0].value;if(!t)return null;try{return String(t).replace(/(^ +)|( +$)|( +(?= ))/g,"")}catch(e){return t}}},{key:"runText",value:function(e){var t,a=e[0].value;if(!a&&0!==a)return null;if(2===e.length&&"string"==typeof(null===(t=e[1])||void 0===t?void 0:t.value))return function(e,t){var a=t.replace(/[YMDHS]/g,(function(e){return e.toLowerCase()})),n=/(AM\/PM)|(A\/P)/gi;n.test(a)||(a=a.replace(/h/g,"H"));var r=a.replace(n,"A").replace(/[^ymdhHs0A]+/g,(function(e){return"[".concat(e,"]")})).replace(/y/g,"Y").replace(/(^|[^d])(d{1,2})(?!d)/g,(function(e,t,a){return"".concat(t).concat(a.toUpperCase())})).replace(/0/g,"S").replace(/m/g,"M").replace(/(M{1,2})(?=[^dhHy]*s)/g,(function(e){return e.toLowerCase()})).replace(/([hH][^M]*)(M{1,2})/g,(function(e,t,a){return"".concat(t).concat(a.toLowerCase())})),i=e.format(r);return/(A\/P)/gi.test(t)&&(i=e.hour()>=12?i.replace("PM","P"):i.replace("AM","A")),i}((0,h.default)(a),e[1].value);var n=U(e[0]);return e[0].attribute.localizeWireValue(n,{noRefLabel:!0})}},{key:"runApp",value:function(e){return this.runText(e)}},{key:"runContext",value:function(e,t){var n,r,i,o,l,u,s,c,d,f,h,v=U(e[0]).toLowerCase(),m=null,g=null,y=null===(n=t.uiContext)||void 0===n?void 0:n.viewStateKey;if(y){var b=(0,a(673275).getUIStateByKey)(y);m=b.Root,g=b.ControlName||""}else m=null===(i=null===(r=null===window||void 0===window?void 0:window.AppState)||void 0===r?void 0:r.CurrentUIState)||void 0===i?void 0:i.Root,g=(null===(l=null===(o=null===window||void 0===window?void 0:window.AppState)||void 0===o?void 0:o.CurrentUIState)||void 0===l?void 0:l.ControlName)||"";switch(v){case"host":return T.default.InMobileWebView()?"Device":"Browser";case"view":return g;case"viewtype":switch(m){case"fastTable":return"table";case"google-map":return"map";default:return m||""}case"device":return p.default.isFunction(null===(u=null==t?void 0:t.appModel)||void 0===u?void 0:u.GetClientId)?t.appModel.GetClientId():"";case"table":return null===(s=null==t?void 0:t.tableSchema)||void 0===s?void 0:s.sourceTableName();case"appname":return null===(d=null===(c=t.appModel)||void 0===c?void 0:c.appTemplate)||void 0===d?void 0:d.name();case"owneremail":return null===(h=null===(f=t.appModel)||void 0===f?void 0:f.appTemplate)||void 0===h?void 0:h.ownerEmail}return null}},{key:"runUpper",value:function(e){if(!e[0].value)return null;var t=U(e[0]);return t?t.toUpperCase():t}},{key:"runLower",value:function(e){if(!e[0].value)return null;var t=U(e[0]);return t?t.toLowerCase():t}},{key:"runDomainOf",value:function(e){if(!e[0].value)return null;var t=U(e[0]),a=t.lastIndexOf("@");return a<0?null:t?t.substring(a+1).toLowerCase():t}},{key:"runSubstitute",value:function(e){var t=e[0].value;if(!t)return null;var a=e[1].value;if(!a)return t;var n=e[2].value;return n||(n=""),t="string"==typeof t?t:U(e[0]),a="string"==typeof a?a:U(e[1]),n="string"==typeof n?n:U(e[2]),t.replace(new RegExp(g.default.regexEscape(a),"g"),n)}},{key:"runSplit",value:function(e){if(0===e.length)return null;var t=String(e[0].value),a=[];1===e.length?a=[" "]:a=e.slice(1).map((function(e){return e.value})).filter((function(e){return e}));var n,r=[t],i=x(a);try{var o=function(){var e=n.value;r=r.flatMap((function(t){return"string"==typeof t?t.split(e):Array.isArray(t)?t:[t]}))};for(i.s();!(n=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}return r}},{key:"runConcatenate",value:function(e){return e.reduce((function(e,t){return e+U(t)}),"")}},{key:"runHyperlink",value:function(e){var t=U(e[0]),a=U(e[1]);return new C.default(t,a)}},{key:"runLinkText",value:function(e){var t=e[0].value.linkText||"";return String(t)}},{key:"runLinkUrl",value:function(e){var t=e[0].value.url||"";return String(t)}},{key:"runLat",value:function(e){var t=e[0].value;return(null==t?void 0:t.latitude)?t.latitude:(null==t?void 0:t.x)?t.x:null!==E.default.fromString(t)?E.default.fromString(t).latitude:0}},{key:"runLong",value:function(e){var t=e[0].value;return(null==t?void 0:t.longitude)?t.longitude:(null==t?void 0:t.y)?t.y:null!==E.default.fromString(t)?E.default.fromString(t).longitude:0}},{key:"runLatLong",value:function(e){var t=e[0].value,a=e[1].value;return new E.default(t,a)}},{key:"runXY",value:function(e){var t=e[0].value,a=e[1].value;return new k.default(t,a)}},{key:"runDistance",value:function(e){if(2!==e.length)return 0;var t=e[0],a=e[1];if(!t.attribute.yieldsOneOf(["LatLong","ChangeLocation"])||!a.attribute.yieldsOneOf(["LatLong","ChangeLocation"]))return 0;var n=e[0].value||E.defaultLatLong,r=e[1].value||E.defaultLatLong;return S.default.kmDistance(n.latitude,n.longitude,r.latitude,r.longitude)}},{key:"runEncodeUrl",value:function(e){if(1!==e.length)return"";var t=e[0],a=t.attribute,n=t.value,r=a.valueToWireFormat(n);return(a.isImageType()||"File"===a.type())&&(r=(0,g.getTableFileQueryParsed)(r).fileName||r||""),encodeURIComponent(r)}},{key:"runLinkToForm",value:function(e){var t=window.encodeURIComponent(e[0].value||""),a="",n=[];e.length%2==0?(a=window.encodeURIComponent(p.default.last(e).value||""),n=p.default.slice(e,1,e.length-1)):n=p.default.slice(e,1,e.length);var r=n.filter((function(e,t){return t%2==0})),o=n.filter((function(e,t){return t%2==1})),l={};return p.default.zip(r,o).forEach((function(e){var t=(0,i.default)(e,2),a=t[0],n=t[1],r=a.attribute.valueToWireFormat(a.value),o=n.attribute.valueToWireFormat(n.value);l[r]=o})),a+"#control="+t+"&defaults="+window.encodeURIComponent(JSON.stringify(l))}},{key:"runContains",value:function(e){var t=e[0].value,a=e[1].value;return null!=t&&null!=a&&(t=String(t),!((a=String(a)).length>t.length)&&t.toLowerCase().indexOf(a.toLowerCase())>=0)}},{key:"runStartsWith",value:function(e){var t=U(e[0]),a=U(e[1]);return t.toLowerCase().startsWith(a.toLowerCase())}},{key:"runEndsWith",value:function(e){var t=U(e[0]),a=U(e[1]);return t.toLowerCase().endsWith(a.toLowerCase())}},{key:"runUniqueId",value:function(e){if(null==e){var t=/^\d+[eE]\d{1,6}$/,a=/^0+\d*$/,n="";do{n=g.default.uuid(8,16).toLowerCase()}while(n.match(t)||n.match(a));return n}return"packeduuid"===String(e[0].value).toLowerCase()?g.default.uuid(22):"uuid"!==String(e[0].value).toLowerCase()||e.length>1?null:g.default.uuid()}},{key:"runIsBlank",value:function(e){return H(e[0].value)}},{key:"runList",value:function(e){return null==e?[]:e.map((function(e){return e.value}))}},{key:"runWorkday",value:function(e){if(!p.default.isArray(e))return null;if(e.length<2||e.length>3)return null;var t=e[0].value,a=e[1].value,n=[];3===e.length&&(n=p.default.compact(e[2].value).map((function(e){return e.valueOf()})));if(!p.default.isDate(t))return null;if(!p.default.isNumber(a))return null;if(!n.every(p.default.isNumber))return null;for(var r=a<0?-1:1,i=Math.abs(a),o=new Date(t),l=0;l<i;l++)do{o.setDate(o.getDate()+r)}while(6===o.getDay()||0===o.getDay()||n.indexOf(o.valueOf())>=0);return o}},{key:"runEndOfMonth",value:function(e){var t=e[0].value,a=e[1].value,n=(0,h.default)(t).add(a,"M").endOf("month").toDate();return n.setHours(0,0,0,0),n}},{key:"runEndWeekdayOfMonth",value:function(e){var t=e[0].value,a=e[1].value,n=(0,h.default)(t).add(a,"M").endOf("month").toDate();return 0===n.getDay()?n.setDate(n.getDate()-2):6===n.getDay()&&n.setDate(n.getDate()-1),n.setHours(0,0,0,0),n}},{key:"runEndOfWeek",value:function(e){var t=(0,h.default)(e[0].value),a=this.runWeekday(e.slice(0,1)),n=t.add(7,"d").add(0-a,"d").toDate();return n.setHours(0,0,0,0),n}},{key:"runOcr",value:function(e,t,a){var n=t.appModel.appTemplate,r=e[0].value,i=n.findOcrModel(r);if(!i)return b.default.ReportErrorOnce({errorMessage:"could not find OCR model"}),null;var o=n.findOcrExtractor(r);if(!o)return b.default.ReportErrorOnce({errorMessage:"could not find OCR extractor"}),null;var l=e[1].value,u=i.table(),s=O.default.from(l,u),c=e[2].value;if(o.hasCachedValue(s)){var d=o.getCachedValue(s);return d.success()?d.getExtractedValue(c):(b.default.ReportErrorOnce({errorMessage:"unable to run OCR extractor",nestedErrorMessage:d.errorMessage()}),null)}return o.extract(s).then((function(e){if(e.success()){var t=e.getExtractedValue(c);a.asyncCallback(t)}else b.default.ReportErrorOnce({errorMessage:"unable to run OCR extractor",nestedErrorMessage:e.errorMessage()})})).catch((function(e){b.default.ReportErrorOnce({errorMessage:"Error caught in OCR extractor",error:e})})),null}},{key:"runOcrText",value:function(e,t,a){var n=t.appModel.appTemplate.ocrTextExtractor(),r=t.tableSchema.sourceTableName(),i=e[0].value,o=O.default.from(i,r);if(n.hasCachedValue(o)){var l=n.getCachedValue(o);return l.success()?l.getExtractedValue("_Text"):(b.default.ReportErrorOnce({errorMessage:"unable to run OCRTEXT extractor",nestedErrorMessage:l.errorMessage()}),null)}return n.extract(o,r).then((function(e){if(e.success()){var t=e.getExtractedValue("_Text");a.asyncCallback(t)}else b.default.ReportErrorOnce({errorMessage:"unable to run OCRTEXT extractor",nestedErrorMessage:e.errorMessage()})})).catch((function(e){b.default.ReportErrorOnce({errorMessage:"Error caught in OCRTEXT extractor",error:e})})),null}},{key:"runPredict",value:function(e,t){var a=e[0].value,n=t.appModel.appTemplate.findPredictor(a);if(!n)return b.default.ReportErrorOnce({errorMessage:"expected predictor"}),null;var r=new I.default(t,[t.rowData]);return n.predict(r)[0]}},{key:"runSort",value:function(e){if(null==e)return[];var t=e[0].attribute.nestedAttribute(),a=!1;2===e.length&&(a=e[1].value);var n=[].concat(e[0].value);return R.default.sort(n,(function(e,n){var r=t.valueComparer(w.ValueFormat.Native)(e,n);return 0!==r?a?-1*r:r:0})),n}},{key:"runIndex",value:function(e){var t=e[0],a=e[1];if(null!=t.value&&null!=a.value){var n=Array.isArray(t.value)?t.value:null,r=Number(a.value);if(n&&n.length>=r&&r>0)return n[r-1]}return null}},{key:"runIf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.children[0].run(e,t);return a?this.children[1].run(e,t):this.children[2].run(e,t)}},{key:"runIfS",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0;a<this.children.length;a+=2){var n=this.children[a].run(e,t);if(n&&a+1<this.children.length)return this.children[a+1].run(e,t)}return null}},{key:"runSwitch",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.children[0],n=a.run(e,t),r=a.resultAttribute(),i=r.basestType(),o=function(e,t){var a=t.basestType();return(0,M.getTypedChildValue)(n,r,a,!1)===(0,M.getTypedChildValue)(e,t,i,!1)},l=1;l<this.children.length-2;l+=2){var u=this.children[l],s=u.run(e,t),c=u.resultAttribute();if(o(s,c))return this.children[l+1].run(e,t)}return this.children[this.children.length-1].run(e,t)}},{key:"runLinkToFilteredView",value:function(e){if(null==e)return null;var t=e.appModel.appTemplate,a=String(this.children[0].Value),n=t.findControl(a);if(!n)return null;var r=n.TableOrFolderName,i=t.findRootSchemaForTable(r),o=e.makeNestedContext(i),l=this.children[1].curry(o),u=m.default.makeCompactEvaluatable(l),s=encodeURIComponent(a),c=JSON.stringify(u);return"#control="+s+"&filter="+encodeURIComponent(c)}},{key:"runSelect",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==e||"function"!=typeof e.getTableColumnSet)return[];var r=this.children[0],i=r.TableName,o=r.RowListAttrName,l=r.RowListAttrIndex,u=r.ColumnIndex,s=r.ContextLevel,c=this.children[1],d=3===this.children.length&&this.children[2].run(e,a),f=n.maxEntries,p=this.resultAttribute(),h=p.nestedAttribute(),v=e.getTableColumnSet(i,u,c,d,f,l,o,s).map((function(e){return(h||p).valueFromWireFormat(e)})),m=h.basestAttribute().type();return v.map((function(e){return t.handleRefImageValue(e,m,i)}))}},{key:"runOrderBy",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==e||"function"!=typeof e.sortData)return[];var n=this.children[0].resultAttribute(),r=n.nestedAttribute(),i=null==r?void 0:r.referencedTableName(),o=this.children[0].run(e,t);if(null==o)return null;if(0===o.length)return[];for(var l=[],u=1;u<this.children.length;u+=2)l.push({sortExpression:this.children[u],descending:u+1<this.children.length&&this.children[u+1].run(e,t)});return e.sortData(o,i,l,a.maxEntries)}},{key:"runAny",value:function(e,t){var a=this.children[0].run(e,t,{maxEntries:1});return a.length>0?a[0]:null}},{key:"runTop",value:function(e,t){var a=this.children[1].run(e,t),n=this.children[0].run(e,t,{maxEntries:a});return n?n.slice(0,a):null}},{key:"curryLazy",value:function(e){var t;switch(this.FunctionName){case"SELECT":return(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("currySelect"))?this.currySelectRollout(e):this.currySelect(e);case"ORDERBY":return this.curryOrderBy(e);default:return(0,s.default)((0,f.default)(n.prototype),"curry",this).call(this,e)}}},{key:"currySelect",value:function(e){var t=!0,a=this.children[2]&&this.children[2].curry(e);if(this.children[0].RowListAttrIndex)t=!1;else if(a&&"CONSTANT"!==a.evalType())t=!1;else{var n=this.makeFakeFilterContext(e,"");"CONSTANT"!==this.children[1].curry(n).evalType()&&(t=!1)}return t?this.convertToConstant(e):a?v.default.create(p.default.extend({},this.model,{Children:[this.children[0].model,this.children[1].model,a.model]})):this}},{key:"currySelectRollout",value:function(e){var t=(0,i.default)(this.children,3),a=t[0],n=t[1],r=t[2],l=a.TableName,u=e.appModel.findTableCollection(l).tableSchema;if(null==u)return this;var s=e.makeNestedContext(u),c=n.curry(s),d=null==r?void 0:r.curry(e),f=this;if(c!==n||d!==r){var p=(0,o.default)(this.children);p[1]=c,d&&(p[2]=d),f=this.withCurriedChildren(p)}var h=a.RowListAttrName,v=a.RowListAttrIndex,m=a.RowListContextLevel,g=null!=h&&null!=v,y=g?e.getColumnValue(h,v,m):void 0,b=!g||null!=y,T=null==d||d.isConstant;if(b&&T){var S=this.makeFakeFilterContext(e,"");if(c.curry(S).isConstant)return f.convertToConstant(e)}return f}},{key:"makeFakeFilterContext",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new A.default(e.appModel,e.tableSchema);return(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("currySelect"))&&n.setParentContext(e),n.getColumnValue=function(t,n,r){return 0===r?a:e.getColumnValue(t,n,r-1)},n.isFakeContext=!0,n}},{key:"currySelectFilterOnly",value:function(e){var t=this.makeFakeFilterContext(e,null);return this.children[1].curry(t)}},{key:"curryOrderBy",value:function(e){var t=v.default.create(p.default.extend({},this.model));return t.model.Children=[],null!=this.children&&(t.children=this.children.map((function(a,n){var r=n%2==0?a.curry(e):a;return t.model.Children[n]=r.model,r}))),t.children.map((function(e,t){return t%2!=0||"CONSTANT"===e.model.EvalType})).every((function(e){return e}))?this.convertToConstant(e):t}},{key:"curryThis",value:function(e){var t;return(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))?(0,s.default)((0,f.default)(n.prototype),"curryThis",this).call(this,e):this.children&&0!==this.children.filter((function(e){return"CONSTANT"!==e.model.EvalType})).length?this:this.convertToConstant(e)}}]),n}(m.default);t.default=W},426204:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(861655)),l=n(a(994993)),u=n(a(73808));function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}var c=function(e){(0,o.default)(a,e);var t=s(a);function a(e,n){var i;return(0,r.default)(this,a),(i=t.call(this,e,n)).Name=e.Name,i}return(0,i.default)(a,[{key:"runEval",value:function(e,t){var a;if(null!=t){var n=t.getInputParameterValue(this.Name);if(null!==n)return n}return null===(a=e[0])||void 0===a?void 0:a.value}}]),a}(n(a(189491)).default);t.default=c},888861:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.create=A,t.createAnd=x,t.createColFilter=_,t.createColumnLookup=w,t.createColumnSet=k,t.createCompositeBoolean=P,t.createConcatenate=G,t.createConstantValue=C,t.createConstantValueNative=E,t.createEquals=O,t.createFilter=M,t.createIn=N,t.createIsBlank=I,t.createKeyInListFilter=D,t.createNot=R,t.createOr=F,t.createRefsFilter=V,t.createSelect=L,t.default=void 0,t.getFilterDefaults=U,t.getFilterDefaultsAndFullyMapped=B;var r=n(a(627424)),i=n(a(600861)),o=n(a(496486)),l=n(a(593186)),u=n(a(565722)),s=n(a(85945)),c=n(a(17601)),d=n(a(98705)),f=n(a(397013)),p=n(a(213082)),h=n(a(50757)),v=n(a(426204)),m=a(166089);function g(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var b={FUNCTION:u.default,CONSTANT:s.default,COLUMN:c.default,DEREF:d.default,ARITHMETIC:f.default,BOOLEAN:p.default,COLUMNSET:h.default,PARAM:v.default};function T(e){return A(e)}function S(e){var t;return null===(t=e.Children)||void 0===t?void 0:t.map(T)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,a=e.EvalType,n=b[a];return n?new n(e,t):(l.default.warnToDevConsole("No evaluation tree class found for ",a),null)}function w(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return A({ResultType:t.type(),ResultTypeQualifier:t.auxData(),EvalType:"COLUMN",ColName:t.name(),ColIndex:e.findAttributeIndex(t.name()),ColumnsReferenced:[e.findAttributeIndex(t.name())],ContextLevel:a})}function C(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return A({ResultType:t,ResultTypeQualifier:a,EvalType:"CONSTANT",ConstantValue:e})}function E(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return A({ResultType:t,ResultTypeQualifier:a,EvalType:"CONSTANT",NativeValue:e})}function k(e,t,a,n){return A({ResultType:"List",ResultTypeQualifier:t.isKey()?{ElementType:"Ref",ElementTypeQualifier:JSON.stringify({ReferencedType:t.type(),ReferencedTableName:e.tableOrSliceName(),ReferencedTypeQualifier:t.auxDataString()})}:{ElementType:t.type(),ElementTypeQualifier:t.auxDataString()},EvalType:"COLUMNSET",IsPure:!0,ColIndex:e.findAttributeIndex(t.name()),ColName:t.name(),TableName:e.tableOrSliceName(),RowListAttrName:null==a?void 0:a.name(),RowListAttrIndex:n})}function R(e){return A({ResultType:"Yes/No",EvalType:"BOOLEAN",BoolType:"NOT",IsAtomic:!1,Children:[e.model]})}function I(e){return A({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"ISBLANK",Children:[e.model]})}function O(e,t,a){return A({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"Equals",IsAtomic:!0,Children:[e.model,t.model],SourceExpr:a})}function M(e,t){return null!=e&&null!=t?O(C(e,t.resultType(),t.resultTypeQualifier()),t):null}function N(e,t,a){return A({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"IN",Children:[e.model,t.model],SourceExpr:a})}function _(e,t,a){var n;return a&&null!=a.name()&&null!=e?a&&"EnumList"===a.type()&&""!==e?N(C(e,null!==(n=a.nestedType())&&void 0!==n?n:"Text",a.baseTypeQualifier()),w(t,a)):O(C(e,a.basestType(),a.baseTypeQualifier()),w(t,a)):null}function D(e,t,a){return a instanceof u.default&&"SELECT"===a.FunctionName?A(a.children[1].model):N(A({ResultType:e,ResultTypeQualifier:t,EvalType:"COLUMN",ColName:"_THISROW"}),a)}function L(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;return A({ResultType:e.resultType(),ResultTypeQualifier:e.resultTypeQualifier(),EvalType:"FUNCTION",FunctionName:"SELECT",Children:[e.model,t.model,C(a?"Y":"N","Yes/No").model],SourceExpr:n})}function P(e,t){var a=o.default.compact(e),n=o.default.map(a,"model");switch(a.length){case 0:return null;case 1:return a[0];default:return A({ResultType:"Yes/No",EvalType:"BOOLEAN",BoolType:t,IsAtomic:!1,Children:n})}}function x(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return P(t,"AND")}function F(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return P(t,"OR")}function G(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return A({ResultType:"Text",EvalType:"FUNCTION",FunctionName:"CONCATENATE",Children:o.default.map(t,"model")})}function V(e,t,a){var n=[];o.default.forEach(e,(function(e,r){var i=t.refAttributesToTable(r).filter((function(e){return a.findTableCollection(e.referencedTableName(),!0).tableSchema.name()!==t.name()}));i.length&&n.push({refAttribute:i[0],columnValue:e})}));var r=n.map((function(e){var a=e.refAttribute;return _(e.columnValue,t,a)}));return x.apply(void 0,(0,i.default)(r))}function B(e){var t,a=[],n=!1;if(null==e?void 0:e.children)if(null===(t=m.AppGlobals.AppModel)||void 0===t?void 0:t.inRollout("curryNativeValue")){if("BOOLEAN"===e.evalType()&&e.isAtomic()&&"Equals"===e.operatorName()){var i=function(e){var t,a=g(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(c.default.is(n)&&0===n.ContextLevel)return n}}catch(e){a.e(e)}finally{a.f()}}(e.children),o=function(e){var t,a=g(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(s.default.is(n))return n}}catch(e){a.e(e)}finally{a.f()}}(e.children);i&&o&&(a.push({ColumnName:i.colName(),ColumnValue:o.constantValue()}),n=!0)}else if("BOOLEAN"===e.evalType()&&!e.isAtomic()&&"AND"===e.boolType()){n=!0;for(var l=0;l<e.children.length;l++){var u=B(e.children[l]),d=(0,r.default)(u,2),f=d[0],p=d[1];a=a.concat(f),n=n&&p}}}else{var h=e.model;if("BOOLEAN"===h.EvalType&&h.IsAtomic&&"Equals"===h.OperatorName)"COLUMN"===h.Children[0].EvalType&&"CONSTANT"===h.Children[1].EvalType?(a.push({ColumnName:h.Children[0].ColName,ColumnValue:h.Children[1].ConstantValue}),n=!0):"COLUMN"===h.Children[1].EvalType&&"CONSTANT"===h.Children[0].EvalType&&(a.push({ColumnName:h.Children[1].ColName,ColumnValue:h.Children[0].ConstantValue}),n=!0);else if("FUNCTION"===h.EvalType&&"IN"===h.FunctionName)"COLUMN"===h.Children[1].EvalType&&"CONSTANT"===h.Children[0].EvalType&&(a.push({ColumnName:h.Children[1].ColName,ColumnValue:h.Children[0].ConstantValue}),n=!0);else if("BOOLEAN"===h.EvalType&&!h.IsAtomic&&"AND"===h.BoolType){n=!0;for(var v=0;v<e.children.length;v++){var y=B(e.children[v]),b=(0,r.default)(y,2),T=b[0],S=b[1];a=a.concat(T),n=n&&S}}}return[a,n]}function U(e){return B(e)[0]}var H=Object.assign(Object.assign({},b),{create:A,createColumnLookup:w,createColumnSet:k,createSelect:L,createConstantValue:C,createConstantValueNative:E,createEquals:O,createNot:R,createIn:N,createIsBlank:I,createFilter:M,createColFilter:_,createKeyInListFilter:D,createCompositeBoolean:P,createAnd:x,createOr:F,createConcatenate:G,createRefsFilter:V,getFilterDefaults:U,getFilterDefaultsAndFullyMapped:B});t.default=H},32913:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(593186)),u=function(){function e(t){var a=t.timeoutSec;(0,r.default)(this,e),o.default.isNumber(a)?this.cacheTimeoutSec=a:this.cacheTimeoutSec=30,this.cache={}}return(0,i.default)(e,[{key:"makeRequestKey",value:function(e){return e.resolve()}},{key:"addToCache",value:function(e,t){var a=this;this.cache[e]={timestamp:new Date,object:{promise:t,value:null}},t&&t.then((function(t){a.cache[e]&&(a.cache[e].object.value=t)})).catch((function(e){return l.default.ReportErrorOnce({errorMessage:"Error in addToCache",error:e})})),this.cleanupCache()}},{key:"getFromCache",value:function(e){return this.cache[e]?this.tryEvict(e)?null:this.cache[e].object:null}},{key:"tryEvict",value:function(e){if(!this.cache[e])return!1;var t=this.cache[e],a=new Date,n=t.timestamp;return(a.getTime()-n.getTime())/1e3>this.cacheTimeoutSec&&(delete this.cache[e],!0)}},{key:"cleanupCache",value:function(){var e=this;o.default.keys(this.cache).forEach((function(t){return e.tryEvict(t)}))}}]),e}();t.default=u},747286:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t){(0,r.default)(this,e),this._model=t}return(0,i.default)(e,[{key:"success",value:function(){return this._model.Success}},{key:"errorMessage",value:function(){return this._model.ErrorMessage}},{key:"getExtractedValue",value:function(e){return this.success()?this._model.Extraction[e]:null}}]),e}();t.default=o},738628:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(747286)),u=n(a(32913)),s=a(34531),c=function(){function e(t){var a=t.appId,n=t.ocrModel,i=t.cacheTimeoutSec,l=t.extractFn;(0,r.default)(this,e),this.appId=a,this.ocrModel=n,this.cache=new u.default({timeoutSec:i}),o.default.isFunction(l)?this.extractFn=l:this.extractFn=s.makeOcrRequest,this.makeRequest=this.makeRequest.bind(this)}return(0,i.default)(e,[{key:"extract",value:function(e){var t=this;return(0,s.getImageData)(e).then((function(){return t.extractHelper(e)}))}},{key:"extractHelper",value:function(e){var t=this.cache.makeRequestKey(e),a=this.cache.getFromCache(t);if(a)return a.promise;var n=(0,s.getImageData)(e).then(this.makeRequest);return this.cache.addToCache(t,n),n}},{key:"hasCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),a=this.cache.getFromCache(t);return!!(null==a?void 0:a.value)}},{key:"getCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),a=this.cache.getFromCache(t);return a?a.value:null}},{key:"makeRequest",value:function(e){var t=this.appId,a=this.ocrModel.name(),n=this.extractFn(t,a,e);return Promise.resolve(n).then((function(e){return new l.default(e)}))}}]),e}();t.default=c},455842:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"name",value:function(){return this.model.Name}},{key:"table",value:function(){return this.model.Table}}]),e}();t.default=o},81873:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=n(a(747286)),u=n(a(32913)),s=a(34531),c=function(){function e(t){var a=t.appId,n=t.cacheTimeoutSec,i=t.extractFn;(0,r.default)(this,e),this.appId=a,this.cache=new u.default({timeoutSec:n}),o.default.isFunction(i)?this.extractFn=i:this.extractFn=s.makeOcrTextRequest,this.makeRequest=this.makeRequest.bind(this)}return(0,i.default)(e,[{key:"extract",value:function(e,t){var a=this;return(0,s.getImageData)(e).then((function(){return a.extractHelper(e,t)}))}},{key:"extractHelper",value:function(e,t){var a=this,n=this.cache.makeRequestKey(e),r=this.cache.getFromCache(n);if(r)return r.promise;var i=(0,s.getImageData)(e).then((function(e){return a.makeRequest(e,t)}));return this.cache.addToCache(n,i),i}},{key:"hasCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),a=this.cache.getFromCache(t);return!!(null==a?void 0:a.value)}},{key:"getCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),a=this.cache.getFromCache(t);return a?a.value:null}},{key:"makeRequest",value:function(e,t){var a=this.appId,n=this.extractFn(a,e,t);return Promise.resolve(n).then((function(e){return new l.default(e)}))}}]),e}();t.default=c},34531:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getImageData=function(e){return new Promise((function(t,a){e.getBase64OrWebUrl((function(e,n){e?a(e):t(n)}))}))},t.makeOcrRequest=function(e,t,a){var l={ImageData:a},u="/api/template/".concat(e,"/ocrExtract/").concat(t);if(i.dynamicRollouts.includeByUserId("AjaxToFetchEditor"))return(0,o.ajaxPost)(u,l,{contentType:"json"}).then((function(e){return e=e||{},n.logger.logEvent(new r.OcrEvent(e.Success)),e}));var s=new Promise((function(e,t){$.postJSON(u,l,e,t)}));return s.then((function(e){e=e||{},n.logger.logEvent(new r.OcrEvent(e.Success))})),s},t.makeOcrTextRequest=function(e,t,a){var l={ImageData:t},u="/api/template/".concat(e,"/ocrText/").concat(a);if(i.dynamicRollouts.includeByUserId("AjaxToFetchEditor"))return(0,o.ajaxPost)(u,l,{contentType:"json"}).then((function(e){return e=e||{},n.logger.logEvent(new r.OcrTextEvent(e.Success)),e}));var s=new Promise((function(e,t){$.postJSON(u,l,e,t)}));return s.then((function(e){e=e||{},n.logger.logEvent(new r.OcrTextEvent(e.Success))})),s};var n=a(318926),r=a(804758),i=a(44617),o=a(635672)},308048:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(){(0,r.default)(this,e),this.columnNames=[],this._columnValues={}}return(0,i.default)(e,[{key:"addColumn",value:function(e,t){this.columnNames.push(e),this._columnValues[e]=t}},{key:"columnValues",value:function(e){return this._columnValues[e]}},{key:"createBagOfWords",value:function(e,t){var a=this;if(null!=this.columnNames){for(var n=[],r=function(t){var r=[];e.forEach((function(e){r.push(a._columnValues[e.model.Name][t])})),n.push(r.join(" "))},i=0;i<this._columnValues[this.columnNames[0]].length;i++)r(i);this.addColumn(t,n)}}}]),e}();t.default=o},944589:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(308048)),l=function(){function e(t){(0,r.default)(this,e),this._colDefs=t}return(0,i.default)(e,[{key:"buildFrom",value:function(e){var t=this._colDefs,a=new o.default,n=e.rows,r=e.singleDataContext;return t.forEach((function(e){var t=e.name(),i=e.formulaEvalTree(),o=[];n.forEach((function(e){r.rowData=e;var t=i.run(r);o.push(t)})),a.addColumn(t,o)})),a}}]),e}();t.default=l},372502:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t){(0,r.default)(this,e),this.name=t}return(0,i.default)(e,[{key:"columnName",value:function(){return this.name}},{key:"standardize",value:function(e){return e}}]),e}();t.default=o},663207:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ALL_TEXT_FEATURES=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(888861));t.ALL_TEXT_FEATURES="all_text_features";var l=function(){function e(t){(0,r.default)(this,e),this.model=t,this._evalTreeLookup={}}return(0,i.default)(e,[{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.model.ExprLookup||{};try{this._evalTreeLookup[e]=o.default.create(t[e])}catch(t){console.warn("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"formulaEvalTree",value:function(){return this.evalTreeLookup("Formula")}},{key:"name",value:function(){return this.model.Name}},{key:"type",value:function(){return this.model.Type}}]),e}();t.default=l},116898:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(947787)),l=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,null,[{key:"create",value:function(e,t){if("SUPERVISED"===e)return new o.default(t);throw Error("Unknown model type")}}]),e}();t.default=l},973289:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(116898)),l=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"name",value:function(){return this.model.Name}},{key:"modelType",value:function(){return this.model.ModelType}},{key:"settings",value:function(){return this._settings||(this._settings=o.default.create(this.modelType(),this.model.Settings)),this._settings}},{key:"colDefs",value:function(){return this.settings().allDefinitions()}},{key:"inputColDefs",value:function(){return this.settings().inputDefinitions()}},{key:"outputColDef",value:function(){return this.settings().outputDefinition()}},{key:"predictorReady",value:function(){var e=this.model;return!e.NeedsTraining&&e.Id&&(e.JobId||e.TrainOperationName)}},{key:"id",value:function(){return this.model.Id}},{key:"isLegacy",value:function(){return null==this.model.TrainOperationName}}]),e}();t.default=l},317473:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(805491)),l=n(a(736306)),u=n(a(372502)),s=a(663207),c=function(){function e(t,a){if((0,r.default)(this,e),this.model=t,this.legacy=a,a)this._vocabAssets=t.vocab_assets.map((function(e){return new o.default(e)})),this._stdAssets=t.standardizer_assets.map((function(e){return new l.default(e)})),this._internalColumnNames={};else{for(var n in this._bagOfWords=t.InputProcessing.ApplyBagOfWords,this._assets=new Map,this._internalColumnNames=t.InternalColumnNames,t.InputProcessing.ColumnProcessing){var i=t.InputProcessing.ColumnProcessing[n];1===i.Encoding||2===i.Encoding?this._assets.set(n,new o.default({col_name:n,tokens:i.OrderedVocabulary})):3===i.Encoding?this._assets.set(n,new l.default({col_name:n,mean:i.Mean,std:i.Stdev})):this._assets.set(n,new u.default(n))}1===t.OutputProcessing.Transform&&this._assets.set("output_column",new o.default({col_name:"output_column",tokens:t.OutputProcessing.OutputValues}))}}return(0,i.default)(e,[{key:"getVocabAsset",value:function(e){return this.legacy?this._vocabAssets.find((function(t){return t.columnName()===e})):this._assets.get(e)}},{key:"getStandardizerAsset",value:function(e){return this.legacy?this._stdAssets.find((function(t){return t.columnName()===e})):this._assets.get(e)}},{key:"hasInternalColumnNames",value:function(){return!!this._internalColumnNames&&Object.keys(this._internalColumnNames).length>0}},{key:"getInternalColumnName",value:function(e){if(e===s.ALL_TEXT_FEATURES)return e;var t=this._internalColumnNames[e];if(void 0===t)throw new Error("column not found");return t}}]),e}();t.default=c},985341:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(364687)),i=n(a(856690)),o=n(a(689728)),l=a(635672),u=n(a(317473)),s=n(a(944589)),c=n(a(738181)),d=n(a(593186)),f=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},p=function(){function e(t){var a=t.predictiveModel,n=t.modelAssets,r=t.tfjsModel,o=t.tf;(0,i.default)(this,e),this.tf=o,this.predictiveModel=a,this.tfjsModel=r,this.modelAssets=n,this.legacy=a.isLegacy(),this.vectorizer=new c.default(a,n);var l=this.predictiveModel.settings().inputDefinitions();this.datasetBuilder=new s.default(l),this.predict=this.predict.bind(this),this.inputTensors=this.inputTensors.bind(this),this.tensorLength=this.tensorLength.bind(this)}return(0,o.default)(e,[{key:"predict",value:function(e){var t=this.tfjsModel;try{var a=this.inputTensors(e),n=t.predict(a);return this.vectorizer.predictionsToValues(n)}catch(e){return d.default.ReportErrorOnce({errorMessage:"Error running predictive model"}),""}}},{key:"inputTensors",value:function(e){var t=this,a=this.datasetBuilder.buildFrom(e),n=this.vectorizer.vectorize(a);return this.legacy?this.tf.tensor2d(n):n.map((function(e){return t.tf.tensor2d(e,[1,t.tensorLength(e)])}))}},{key:"tensorLength",value:function(e){return Array.isArray(e)?e.length:1}}],[{key:"fromDefinition",value:function(t,n){return f(this,void 0,void 0,r.default.mark((function i(){var o,s,c,d,p,h,v,m,g;return r.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([a.e("vendors-node_modules_tensorflow_tfjs_dist_index_js"),a.e("_4434-_126c-_a298-_181a-_19e2")]).then(a.t.bind(a,843081,23));case 2:return o=i.sent,s=t.Id,c=n.id(),d="/predictiveModels/".concat(s,"/").concat(c,"/tfjs/model.json"),p="/predictiveModels/".concat(s,"/").concat(c,"/assets.json"),h="/api/template/".concat(s,"/trainingJobInfo/").concat(c),i.next=10,new Promise((function(e,t){!function a(n){return f(this,void 0,void 0,r.default.mark((function i(){var o,u,s;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,l.ajaxGet)(h);case 2:(o=r.sent).Success||t("Failed to fetch predictive model ".concat(n," status")),u=o.TrainingJobInfo,"ERROR"!==(s=u.TrainingStatus)&&"FINISHED"!==s?(5e3,setTimeout(a,5e3,n)):e(void 0);case 7:case"end":return r.stop()}}),i)})))}(c)}));case 10:return i.next=12,o.loadLayersModel(d);case 12:return v=i.sent,i.next=15,(0,l.ajaxGet)(p);case 15:return m=i.sent,g=new u.default(m,n.isLegacy()),i.abrupt("return",new e({predictiveModel:n,modelAssets:g,tfjsModel:v,tf:o}));case 18:case"end":return i.stop()}}),i)})))}}]),e}();t.default=p},736306:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"columnName",value:function(){return this.model.col_name}},{key:"mean",value:function(){return this.model.mean}},{key:"std",value:function(){return this.model.std}},{key:"standardize",value:function(e){var t=this.mean(),a=this.std();return a<=0?0:(e-t)/a}}]),e}();t.default=o},947787:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(663207)),l=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"type",value:function(){return this.model.Type}},{key:"inputDefinitions",value:function(){return this._inputDefs||(this._inputDefs=this.model.InputDefinitions.map((function(e){return new o.default(e)}))),this._inputDefs}},{key:"outputDefinition",value:function(){return this._outputDef||(this._outputDef=new o.default(this.model.OutputDefinition)),this._outputDef}},{key:"allDefinitions",value:function(){var e=this.inputDefinitions();return e.push(this.outputDefinition()),e}}]),e}();t.default=l},738181:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a(856690)),o=n(a(689728)),l=n(a(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(663207));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}var c=function(){function e(t,a){(0,i.default)(this,e),this.predictiveModel=t,this.assets=a,this.legacy=t.isLegacy()}return(0,o.default)(e,[{key:"vectorize",value:function(e){var t=this,a=this.predictiveModel.settings().inputDefinitions(),n={};if(!this.legacy&&this.assets._bagOfWords){var r=[],i=[];a.forEach((function(e){"TEXT"===e.model.Type?i.push(e):r.push(e)})),i.length>0&&(r.push(new u.default({Name:u.ALL_TEXT_FEATURES,Type:"TEXT"})),e.createBagOfWords(i,u.ALL_TEXT_FEATURES)),a=r}a.forEach((function(a){var r=a.name(),i=e.columnValues(r).map((function(e){return t.createValues(a,e)}));n[r]=i}));var o=l.default.max(l.default.values(n).map((function(e){return e.length})));if(this.legacy){for(var s=[],c=function(e){var t=[];a.forEach((function(a){var r=a.name(),i=n[r][e];t=t.concat(i)})),s.push(t)},d=0;d<o;d++)c(d);return s}var f=[];return a.forEach((function(e){for(var t=[],a=0;a<o;a++){var r=e.name(),i=n[r][a];t=t.concat(i)}f.push(t)})),f}},{key:"predictionsToValues",value:function(e){switch(this.predictiveModel.outputColDef().type()){case"BOOLEAN":return this.booleanToResults(e);case"NUMERIC":return this.numericToResults(e);case"CATEGORICAL":return this.categoricalToResults(e);default:return[]}}},{key:"booleanToResults",value:function(e){var t=e.dataSync();return Array.from(t).map((function(e){return e>.5}))}},{key:"numericToResults",value:function(e){var t=e.dataSync();return Array.from(t)}},{key:"categoricalToResults",value:function(e){var t=e.argMax(1).dataSync(),a=Array.from(t),n="output_column",r=this.predictiveModel.outputColDef();this.legacy&&r&&null!=r.model.Name&&(n=r.model.Name);var i=this.assets.getVocabAsset(n).tokens();return a.map((function(e){return i[e]}))}},{key:"createValues",value:function(e,t){switch(e.type()){case"NUMERIC":return[this.standardize(e,t)];case"CATEGORICAL":return this.oneHotEncode(e,t);case"BOOLEAN":return this.booleanEncode(e,t);case"TEXT":return this.countTermVector(e,t);default:return[]}}},{key:"normalize",value:function(e){return null==e?this.legacy?this.zeros(1):"[UNK]":String(e||"").toLowerCase().trim()}},{key:"zeros",value:function(e){return l.default.times(e,l.default.constant(0))}},{key:"countTermVector",value:function(e,t){var a=this.normalizeName(e),n=this.assets.getVocabAsset(a).tokens(),r=this.zeros(500);return this.normalize(t).split(/[^a-z0-9]/).forEach((function(e){var t=n.indexOf(e);t<0||t>=500||r[t]++})),r}},{key:"oneHotEncode",value:function(e,t){var a=this.normalizeName(e),n=this.assets.getVocabAsset(a).tokens(),r=this.zeros(n.length),i=this.normalize(t),o=n.indexOf(i);return o>=0&&(r[o]=1),r}},{key:"booleanEncode",value:function(e,t){return this.legacy?[1*t]:null==t?[1,0,0]:t?[0,0,1]:[0,1,0]}},{key:"standardize",value:function(e,t){if(null==t)return this.zeros(1);var a=this.normalizeName(e);return this.assets.getStandardizerAsset(a).standardize(t)}},{key:"normalizeName",value:function(e){var t,a=e.name();return this.legacy?a:(null===(t=this.assets)||void 0===t?void 0:t.hasInternalColumnNames())?this.assets.getInternalColumnName(a):a.replace(/[^A-Za-z0-9_.\-/]+/gi,"_")}}]),e}();t.default=c},805491:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(496486)),l=function(){function e(t){(0,r.default)(this,e),this.model=t,this._lookup={},this.buildLookup()}return(0,i.default)(e,[{key:"buildLookup",value:function(){var e=this._lookup;this.tokens().forEach((function(t,a){e[t]=a}))}},{key:"tokenIndex",value:function(e){var t=this._lookup[e];return o.default.isNumber(t)?t:-1}},{key:"tokens",value:function(){return this.model.tokens}},{key:"columnName",value:function(){return this.model.col_name}}]),e}();t.default=l},249825:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicRolloutContainer=void 0,t.isDevBuild=l;var r=n(a(600861)),i=n(a(856690)),o=n(a(689728));function l(){return null==window.AppSheetJSVersion||window.AppSheetJSVersion.endsWith("-dev")}var u=function(){function e(){(0,i.default)(this,e),this.ownerDynamicRollouts=new Set,this.userDynamicRollouts=new Set}return(0,o.default)(e,[{key:"getStorageFormat",value:function(){return{ownerDynamicRollouts:(0,r.default)(this.ownerDynamicRollouts),userDynamicRollouts:(0,r.default)(this.userDynamicRollouts)}}},{key:"restoreFromStorage",value:function(e){var t=e.ownerDynamicRollouts,a=void 0===t?[]:t,n=e.userDynamicRollouts,r=void 0===n?[]:n;this.ownerDynamicRollouts=new Set(a),this.userDynamicRollouts=new Set(r)}},{key:"update",value:function(e){var t=this,a=e.upstreamAppSheetJSVersion,n=e.ownerDynamicRollouts,r=e.userDynamicRollouts;a===window.AppSheetJSVersion||l()?(this.ownerDynamicRollouts=new Set(n),this.userDynamicRollouts=new Set(r)):(this.ownerDynamicRollouts=new Set(n.filter((function(e){return t.ownerDynamicRollouts.has(e)}))),this.userDynamicRollouts=new Set(r.filter((function(e){return t.userDynamicRollouts.has(e)}))))}},{key:"byOwner",value:function(e){return this.ownerDynamicRollouts.has(e)}},{key:"byUser",value:function(e){return this.userDynamicRollouts.has(e)}}]),e}();t.DynamicRolloutContainer=u},169457:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ReactAppUrlHandlerInstance=t.ReactAppUrlHandler=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(280129)),l=a(398171),u=n(a(819433)),s=a(397866),c=a(287024);var d={setHash:function(e){window.location.hash=e},get prefixedHash(){return window.location.hash},get unprefixedHash(){return this.prefixedHash.substring(1)},registerHashChangeCallback:function(e){window.addEventListener("hashchange",e)}},f=function(){function e(){var t=this;(0,r.default)(this,e),this.hashInterface=d,this.lastHashSeen="",this.hashHandlers=new Map,this.onHashChange=function(){var e=t.hashInterface.unprefixedHash;e!==t.lastHashSeen&&t.applyHash(e)},this.getCurrentHashState=function(){return t.parse(t.hashInterface.unprefixedHash)}}return(0,i.default)(e,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;this.hashInterface=e,this.hashInterface.registerHashChangeCallback(this.onHashChange)}},{key:"parse",value:function(e){var t={};try{var a=o.default.parse(e);return Object.assign(Object.assign({},t),a)}catch(e){return t}}},{key:"applyHash",value:function(e){var t=(0,u.default)(),a=t.dispatch,n=t.getState;this.lastHashSeen=e;var r=this.parse(e),i=!1;this.hashHandlers.forEach((function(t,a){var o=t.beforeHashToSlice;o&&(i||(i=o(n()[a],r,e)))})),i||(!function(e){return!Object.keys(e).includes("viewStack")&&!!Object.keys(e).length}(r)?a((0,c.replaceStateForHashMiddleware)(r)):a((0,s.navigateToLegacyHash)("#".concat(e))))}},{key:"register",value:function(e,t){this.hashHandlers.set(e,t)}},{key:"unprefixedHash",get:function(){return this.hashInterface.unprefixedHash}},{key:"updateHash",value:function(e){var t={};this.hashHandlers.forEach((function(a,n){a.sliceToHash(t,e[n])}));var a=o.default.stringify(t,{encode:!1}),n=new URL("".concat(location.origin,"#").concat(a)).hash.substring(1);this.lastHashSeen=n,this.hashInterface.setHash(n)}}]),e}();t.ReactAppUrlHandler=f;var p=new f;t.ReactAppUrlHandlerInstance=p;var h=function(e){return function(t){return function(a){t(a);var n=e.getState();(0,l.getAppModelLastUpdated)(n)&&p.updateHash(e.getState())}}};t.default=h},287024:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceStateForHashMiddleware=void 0;var n=(0,a(829829).createAction)("replaceStateForHashMiddleware");t.replaceStateForHashMiddleware=n},613834:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(829829),r=a(287024),i=function(e,t){var i=e.initialState;return a(169457).ReactAppUrlHandlerInstance.register(e.name,t),(0,n.createSlice)({name:e.name,initialState:i,reducers:e.reducers,extraReducers:function(a){a.addCase(r.replaceStateForHashMiddleware,(function(e,a){t.hashToSlice(e,a.payload)})),e.extraReducers instanceof Function&&e.extraReducers(a)}})};t.default=i},907673:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Proxy(e,g)};var r=n(a(23279)),i=a(351101),o=a(398171),l=a(994885),u=a(449456),s=n(a(819433)),c=a(95483),d=a(692479),f=a(166089),p=a(557310),h=a(21870),v=a(289276),m=(0,r.default)((function(e){return(0,s.default)().dispatch((0,o.setDataLastUpdated)(e))}),200),g={get:function(e,t){var a,n,r,m,g,y;if(!0===window.APPSHEET_TEST_CONTEXT&&!p.ReactRootUIConfig.isReactRoot())return e[t];switch(t){case"dataStamp":return(0,o.getDataModelLastUpdated)((0,s.default)().getState());case"sideMenuOpen":return(0,l.getSideMenuOpen)((0,s.default)().getState());case"hashState":var b=(0,c.getTopStack)((0,s.default)().getState()).identifier;return{general:{ControlName:"Control"===b.Type?b.Name:void 0}};case"isWideScreen":return(null===(a=null===document||void 0===document?void 0:document.body)||void 0===a?void 0:a.clientWidth)>768;case"setAppTemplate":return function(){};case"headerHeight":case"drawerOpenWidth":case"drawerCloseWidth":return 0;case"widescreenBreakpoint":return 768;case"windowWidth":return null!==(r=null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.clientWidth)&&void 0!==r?r:0;case"windowHeight":return null!==(g=null===(m=null===document||void 0===document?void 0:document.body)||void 0===m?void 0:m.clientHeight)&&void 0!==g?g:0;case"footerEntries":var T=(0,o.getAppModelHook)((0,s.default)().getState()),S=(null===(y=null==T?void 0:T.appTemplate)||void 0===y?void 0:y.viewControls())||[],A=function(e){return f.AppGlobals.AppModel.POSITIONS_ORDERED.indexOf(e)};return S.filter((function(e){return e.IsValid&&e.Position!==f.AppGlobals.AppModel.POSITION_MENU&&e.Position!==f.AppGlobals.AppModel.POSITION_REF})).sort((function(e,t){return A(e.Position)-A(t.Position)}));case"syncQueueCount":return(0,i.getAppModel)().NumDelayedActions()+(0,i.getAppModel)().NumProcessingActions();case"syncState":return{get initiatedBy(){return(0,o.getSyncInitiatedBy)((0,s.default)().getState())},get ui(){return(0,o.getSyncUI)((0,s.default)().getState())},get visibility(){var e,t=null!==(e=(0,o.getSyncUI)((0,s.default)().getState()))&&void 0!==e?e:h.SyncUI.Hidden;return h.SyncUI[t]},get notification(){var e;return null!==(e=(0,o.getSyncNotification)((0,s.default)().getState()))&&void 0!==e?e:void 0},get error(){var e;return null!==(e=(0,o.getSyncErrorMessage)((0,s.default)().getState()))&&void 0!==e?e:void 0},set error(e){(0,s.default)().dispatch((0,o.setSyncErrorMessage)(null!=e?e:null))}};case"syncProgressHandle":return(0,v.getReactAppSyncProgressHandle)();case"setCachingProgress":return function(e){return(0,s.default)().dispatch((0,u.setOfflineCacheProgress)(e))};case"totalFilesToCache":return(0,u.getCacheProgress)((0,s.default)().getState()).totalFilesToCache;case"filesCached":return(0,u.getCacheProgress)((0,s.default)().getState()).filesCached;case"filesWithError":return(0,u.getCacheProgress)((0,s.default)().getState()).filesWithError;case"showResetDash":return!1;case"navigateToPreviousHashState":return function(){(0,s.default)().dispatch((0,d.popView)())}}return e[t]},set:function(e,t,a){if(!0===window.APPSHEET_TEST_CONTEXT&&!p.ReactRootUIConfig.isReactRoot())return e[t]=a,!0;switch(t){case"dataStamp":return m(a),!0;case"sideMenuOpen":return(0,s.default)().dispatch((0,l.setSideMenuOpen)(a)),!0;case"headerHeight":return!0}return e[t]=a,!0}}},783252:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SPECIFIC_STATE_NAME_MAP=void 0;t.SPECIFIC_STATE_NAME_MAP={card:"ListUIState",table:"FastTableUIState",fastTable:"FastTableUIState",dashboard:"DashboardUIState",search:"SearchUIState",deck:"DeckUIState",gallery:"GalleryUIState",slideshow:"SlideshowUIState",detail:"SlideshowUIState",map:"MapUIState","google-map":"MapUIState",chart:"GraphUIState",graph:"GraphUIState",form:"FormUIState",onboarding:"OnboardingUIState",calendar:"CalendarUIState"}},673275:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.generateFilterExpressions=m,t.getCurrentUIState=void 0,t.getUIStateByKey=function(e){var t=(0,c.default)().getState(),a=(0,u.getViewStack)(t),n=b(t),r=(0,u.getSearchTerm)(t),i=(0,u.getGlobalUserDefinedFilters)(t);return g(e?(0,d.findViewStackEntry)(a,e):n,r,i)};var r=n(a(238416)),i=n(a(496486)),o=a(829829),l=a(173399),u=a(95483),s=a(398171),c=n(a(819433)),d=a(307074),f=a(695882),p=a(783252),h=a(319598),v=n(a(888861));function m(e){var t,a=[],n=(0,h.getFilterQuery)(e.Root,e.TableName||void 0,e.UserDefinedFilters).toExpression();a.push(n);try{if(null==e?void 0:e.filterExprString){var r=JSON.parse(e.filterExprString);a.push(v.default.create(r))}}catch(e){}return null!==(t=v.default.createAnd.apply(v.default,a))&&void 0!==t?t:void 0}function g(e,t,a){var n,o,u=(0,l.mapViewStackToControl)(e),s=u.control,d=u.navState,h=u.action,v=i.default.cloneDeep(null!=d?d:{});if(v.UserDefinedFilters=a,v.Root=h,null!=d){var g=m(d);v.FilterExpr=g}var y=h?p.SPECIFIC_STATE_NAME_MAP[h]:null,b=(0,c.default)(),T=Object.assign({Root:h,ControlName:null==s?void 0:s.Name,SearchTerm:t},void 0===b&&{AppTemplateName:null===(o=(0,f.getCurrentAppHook)(null===(n=(0,c.default)())||void 0===n?void 0:n.getState()))||void 0===o?void 0:o.Name});return y?Object.assign(Object.assign({},T),(0,r.default)({},y,v)):T}var y,b=function(e){var t,a=(0,u.getViewStackGroups)(e),n=a.focusedViewGroup;return null!==(t=a.formViews[0])&&void 0!==t?t:n[n.length-1]};function T(){return(0,o.createSelector)([b,u.getSearchTerm,u.getGlobalUserDefinedFilters,s.getAppModelLastUpdated],g)}t.getCurrentUIState=function(){return y||(y=T()),y.apply(void 0,arguments)}},95483:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.getViewStackGroups=t.getViewStack=t.getTopStack=t.getSyncRequestDataStamp=t.getSearchTerm=t.getIsInExpandMode=t.getGlobalUserDefinedFilters=t.getFocusedViewGroup=t.getFocusedView=t.breakViewStackIntoGroups=t.STACKABLE_VIEW_TYPES=t.FULLSCREEN_VIEW_TYPES=void 0;var r=n(a(496486)),i=a(829829),o=a(166089),l=a(557310);function u(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var c=["slideshow","detail","form","onboarding"];t.STACKABLE_VIEW_TYPES=c;var d=["map","dashboard"];function f(e,t){var a=t.identifier;return"Control"===a.Type?e.FindControl(a.Name):void 0}function p(e,t){var a,n=t.identifier;return"Control"===n.Type?null===(a=f(e,t))||void 0===a?void 0:a.Action:n.Action}t.FULLSCREEN_VIEW_TYPES=d;var h=function(e){return e.uiState.viewStack};t.getViewStack=h;var v=function(e){return e.uiState.focusedView};t.getFocusedView=v;var m=function(e){return e.uiState.isInExpandMode};t.getIsInExpandMode=m;t.getSyncRequestDataStamp=function(e){return e.uiState.syncRequestDataStamp};var g=function(e,t,a,n){var i,o,l;if(!e)return{parentViewGroups:[],focusedViewGroup:[],formViews:[]};var s=r.default.findLastIndex(t,(function(e){return!!e.parentEntriesHidden}));s>0&&(t=t.slice(s));var h=t.findIndex((function(t,a){return"form"===p(e,t)&&0!==a})),v=t,m=[];-1!==h&&(v=t.slice(0,h),m=t.slice(h));var g,y=[],b=[y],T=u(v);try{for(T.s();!(g=T.n()).done;){var S=g.value,A=p(e,S),w=a||d.includes(p(e,S))||"Full screen"===(null===(o=null===(i=f(e,S))||void 0===i?void 0:i.ViewDefinition)||void 0===o?void 0:o.DesktopSplitMode),C=!w&&!c.includes(A);w?(b.push([S]),y=[],b.push(y)):C&&y.length?(y=[S],b.push(y)):y.push(S)}}catch(e){T.e(e)}finally{T.f()}var E=(b=b.filter((function(e){return e.length}))).findIndex((function(e){return e.some((function(e){return e.viewStateKey===n}))}));return-1===E&&(E=b.length-1),{parentViewGroups:b.slice(0,E),focusedViewGroup:null!==(l=b[E])&&void 0!==l?l:[],formViews:m}};t.breakViewStackIntoGroups=g;var y=(0,i.createSelector)([function(){return o.AppGlobals.AppModel},h,m,v],g);t.getViewStackGroups=y;var b=(0,i.createSelector)([y],(function(e){return e.focusedViewGroup}));t.getFocusedViewGroup=b;t.getTopStack=function(e){if(!l.ReactRootUIConfig.isInDesktopExperience())return e.uiState.viewStack[e.uiState.viewStack.length-1];var t=y(e).focusedViewGroup;return t[t.length-1]};t.getSearchTerm=function(e){return e.searchState.searchTerm};t.getGlobalUserDefinedFilters=function(e){return e.searchState.userDefinedFilters}},29827:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getControlName=function(e){var t=e.identifier;return"Control"===t.Type?t.Name:null},t.getInSelectionMode=void 0,t.getMutableState=l,t.getSelectedRowIds=t.getPendingTransaction=void 0,t.getTableName=function(e){var t,a=(0,r.getAppModel)(),n=e.identifier;if("View"===n.Type)return n.TableName;var i=null==a?void 0:a.FindControl(n.Name);return null!==(t=null==i?void 0:i.TableOrFolderName)&&void 0!==t?t:void 0},t.getViewInPendingTransactionById=t.getViewInPendingTransaction=t.getViewInEditMode=void 0,t.getViewLabel=function(e,t){var a,n,r,o,l,u=e.identifier;if("View"===u.Type)return u.TableName;var s=null!==(a=u.Name.replace(/_/g," "))&&void 0!==a?a:"View";if(!t)return s;var c=t.FindControl(u.Name);if(!c)return s;var d=t.appTemplate.getView(c.Name);if(!d)return s;var f=d.table(),p=t.findTableCollection(f),h=p.rootTable,v=p.rootTableSchema,m=null!==(r=null===(n=e.mutableState)||void 0===n?void 0:n.RowKey)&&void 0!==r?r:null===(o=e.mutableState)||void 0===o?void 0:o.row;if(d.hasDisplayName()){var g=m?null===(l=null==h?void 0:h.lookupTableRow(m))||void 0===l?void 0:l.values:void 0;return d.displayName(t,v,g,{viewStateKey:e.viewStateKey})}var y=d.name().replace(/_/g," ")||s;if(!f)return y;if(!h||!v||!m)return y;var b=h.labelTextForId(m);if(!b)return y;var T=v.labelBasicAttribute();if("Enum"===(null==T?void 0:T.type())||"EnumList"===(null==T?void 0:T.type())){return(0,i.getLabelValueFromRefRow)({attribute:T,value:b})}return b},t.getViewStackIndex=void 0,t.getViewType=s,t.isBehindFormOverlay=void 0;var n=a(496486),r=a(351101),i=a(178314),o=a(398171);function l(e){var t;return null!==(t=e.mutableState)&&void 0!==t?t:{}}t.getViewStackIndex=function(e,t){return t};var u=function(e){return l(e).selected};t.getSelectedRowIds=u;function s(e){var t,a=(0,r.getAppModel)(),n=e.identifier;if("View"===n.Type)return n.Action;var i=null==a?void 0:a.FindControl(n.Name);return null!==(t=null==i?void 0:i.Action)&&void 0!==t?t:void 0}t.getInSelectionMode=function(){return Array.isArray(u.apply(void 0,arguments))};t.getPendingTransaction=function(e,t,a){var n=(0,o.getAppModelHook)(a);return null==n?void 0:n.dataManager.getTransaction(l(e).transactionId)};t.getViewInEditMode=function(e){return e.uiState.viewStack.find((function(e){return!!e.mutableState.isInEditMode}))};t.getViewInPendingTransaction=function(e){return e.uiState.viewStack.find((function(e){return null!=e.mutableState.transactionId}))};t.getViewInPendingTransactionById=function(e,t){return t.uiState.viewStack.find((function(t){return t.mutableState.transactionId===e}))};t.isBehindFormOverlay=function(e,t,a){return(0,n.some)(a.uiState.viewStack,(function(e,a){return a>t&&"form"===s(e)}))}},398171:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setTotalActions=t.setSyncTotalActions=t.setSyncProgressPercentage=t.setSyncProgress=t.setSyncErrorMessage=t.setNonRecoverableErrorMsg=t.setIsOnline=t.setDataLastUpdated=t.onSyncStart=t.onSyncError=t.onSyncComplete=t.getSyncUI=t.getSyncTotalActions=t.getSyncStatusText=t.getSyncSeverity=t.getSyncProgressPercentage=t.getSyncNotification=t.getSyncInitiatedBy=t.getSyncIcon=t.getSyncErrorMessage=t.getNonRecoverableErrorMsg=t.getIsOnline=t.getIsLiveAppSynced=t.getIsLiveApp=t.getInSync=t.getDataModelLastUpdated=t.getAppModelLastUpdated=t.getAppModelHook=t.default=t.appModelStateSlice=void 0;var r=a(829829),i=a(351101),o=a(692479),l=n(a(571524)),u=a(629503),s=a(21870),c=n(a(819433)),d={nonRecoverableErrorMsg:null,appLastUpdated:null,dataLastUpdated:null,syncProgressPercentage:null,syncProgress:null,syncErrorMessage:null,syncInitiatedBy:null,syncNotification:null,syncUI:null,isOnline:!0,isLiveApp:!1,isLiveAppSynced:!1,syncTotalActions:0},f=(0,r.createSlice)({name:"appModelState",initialState:d,reducers:{setIsOnline:function(e,t){e.isOnline=t.payload},setTotalActions:function(e,t){e.syncTotalActions=t.payload},setDataLastUpdated:function(e,t){e.dataLastUpdated=t.payload},setNonRecoverableErrorMsg:function(e,t){e.nonRecoverableErrorMsg=t.payload},setSyncProgressPercentage:function(e,t){e.syncProgressPercentage=t.payload},setSyncProgress:function(e,t){e.syncProgress=t.payload},setSyncTotalActions:function(e,t){e.syncTotalActions=t.payload},setSyncErrorMessage:function(e,t){e.syncErrorMessage=t.payload},onSyncStart:function(e,t){var a,n;e.syncProgressPercentage=0,e.syncInitiatedBy=t.payload.initiatedBy,e.syncUI=null!==(a=t.payload.preferredUI)&&void 0!==a?a:s.SyncUI.Subtle,e.syncNotification=null!==(n=t.payload.notification)&&void 0!==n?n:null},onSyncComplete:function(e){e.syncProgressPercentage=null,e.syncErrorMessage=null,e.syncInitiatedBy=null,e.syncUI=null,e.syncNotification=null},onSyncError:function(e,t){e.syncProgressPercentage=null,e.syncErrorMessage=t.payload,e.syncInitiatedBy=null,e.syncUI=null,e.syncNotification=null}},extraReducers:function(e){e.addCase(o.appModelUpdated,(function(e,t){var a,n=(0,i.getAppModel)().appTemplateModel;e.appLastUpdated=Date.now(),document.title=n.ShortName||"",$(".DeepHeader .AppInfo .AppName").text(n.Title||""),$(".DeepHeader .AppInfo .AppVersion").text(n.Version||""),$("#AppDetails").attr("href",(null===(a=n.Behavior.Description)||void 0===a?void 0:a.AboutUrl)||""),l.default.IsAndroidBrowser()||l.default.InAndroidWebView()||($('link[rel="shortcut icon"]').attr("href",u.Common.FlexImageUrl(n.Presentation.LogoUrl)||""),$('link[rel="icon"]').attr("href",u.Common.FlexImageUrl(n.Presentation.LogoUrl)||""))})).addCase(o.appModelUnloaded,(function(){return Object.assign({},d)}))}});t.appModelStateSlice=f;var p=f.actions,h=p.setNonRecoverableErrorMsg,v=p.setDataLastUpdated,m=p.setSyncProgressPercentage,g=p.setSyncProgress,y=p.onSyncStart,b=p.onSyncComplete,T=p.onSyncError,S=p.setIsOnline,A=p.setTotalActions,w=p.setSyncTotalActions,C=p.setSyncErrorMessage;t.setSyncErrorMessage=C,t.setSyncTotalActions=w,t.setTotalActions=A,t.setIsOnline=S,t.onSyncError=T,t.onSyncComplete=b,t.onSyncStart=y,t.setSyncProgress=g,t.setSyncProgressPercentage=m,t.setDataLastUpdated=v,t.setNonRecoverableErrorMsg=h;t.getAppModelHook=function(e){return e.appModel.appLastUpdated?(0,i.getAppModel)():null};t.getAppModelLastUpdated=function(e){return e.appModel.appLastUpdated};t.getDataModelLastUpdated=function(e){return e.appModel.dataLastUpdated};t.getNonRecoverableErrorMsg=function(e){return e.appModel.nonRecoverableErrorMsg};t.getSyncProgressPercentage=function(e){return e.appModel.syncProgressPercentage};t.getSyncErrorMessage=function(e){return e.appModel.syncErrorMessage};t.getSyncInitiatedBy=function(e){return e.appModel.syncInitiatedBy};t.getSyncNotification=function(e){return e.appModel.syncNotification};t.getSyncUI=function(e){return e.appModel.syncUI};t.getInSync=function(e){return null!=e.appModel.syncProgressPercentage};t.getIsOnline=function(e){return e.appModel.isOnline};t.getIsLiveApp=function(e){return e.appModel.isLiveApp};t.getIsLiveAppSynced=function(e){return e.appModel.isLiveAppSynced};t.getSyncTotalActions=function(e){return e.appModel.syncTotalActions};t.getSyncSeverity=function(e){return e.appModel.isOnline?e.appModel.syncErrorMessage?"Error":e.appModel.syncTotalActions?"Warning":"Info":"Offline"};t.getSyncStatusText=function(){var e,t=(0,c.default)().getState().appModel;return t.isOnline?null!=t.syncProgressPercentage?"Syncing":(null===(e=(0,i.getAppModel)())||void 0===e?void 0:e.lastSyncedWithin(3e3))?"SyncedRecently":"":"Offline"};t.getSyncIcon=function(e){return e.appModel.isOnline?e.appModel.syncErrorMessage?"Error":e.appModel.isLiveAppSynced?"LiveAppSynced":e.appModel.isLiveApp?"LiveAppNotSynced":"":"Offline"};var E=f.reducer;t.default=E},695882:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.updateCurrentAppForAppLoadThunk=t.pushCurrentAppForAppLoadThunk=t.popCurrentAppForAppLoadThunk=t.getPreviousAppHook=t.getInvokingAppsHook=t.getCurrentAppHook=t.default=t.appStackSlice=void 0;var r=n(a(593186)),i=n(a(613834)),o=a(369332),l=n(a(819433)),u=a(166089),s=(0,i.default)({name:"appStackState",initialState:{appStack:[{Id:"c37bc8a4-6b53-4e71-812c-2348072cbf2e",Name:"AppGallery-10305",DisplayName:"App Gallery"}]},reducers:{pushCurrentAppForAppLoadThunk:function(e,t){e.appStack.push(t.payload)},popCurrentAppForAppLoadThunk:function(e){e.appStack.length>1&&e.appStack.pop()},updateCurrentAppForAppLoadThunk:function(e,t){e.appStack.length>0?e.appStack[e.appStack.length-1]=t.payload:(e.appStack.push(t.payload),r.default.warnToDevConsole("appStack empty when attempting to update CurrentApp in appStackStateSlice"))}}},{hashToSlice:function(){},sliceToHash:function(e,t){e.appName=t.appStack[t.appStack.length-1].Name},beforeHashToSlice:function(e,t,a){var n=e.appStack,r=n[n.length-1];return!(u.AppGlobals.IsInAppsheetTestContext||!(null==r?void 0:r.Name)||!t.appName||(null==r?void 0:r.Name)===t.appName)&&((0,l.default)().dispatch((0,o.reactAppLoadAppAction)(t.appName,void 0,void 0,a)),!0)}});t.appStackSlice=s;var c=s.actions,d=c.pushCurrentAppForAppLoadThunk,f=c.popCurrentAppForAppLoadThunk,p=c.updateCurrentAppForAppLoadThunk;t.updateCurrentAppForAppLoadThunk=p,t.popCurrentAppForAppLoadThunk=f,t.pushCurrentAppForAppLoadThunk=d;t.getCurrentAppHook=function(e){var t;return null!==(t=e.appStackState.appStack[e.appStackState.appStack.length-1])&&void 0!==t?t:null};t.getPreviousAppHook=function(e){var t;return null!==(t=e.appStackState.appStack[e.appStackState.appStack.length-2])&&void 0!==t?t:null};t.getInvokingAppsHook=function(e){var t=e.appStackState.appStack.slice(0,e.appStackState.appStack.length-1);return t.length>0?t:e.appStackState.appStack.slice(0)};var h=s.reducer;t.default=h},250617:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelEditMode=void 0,t.checkForUnsavedChanges=c,t.startEditMode=t.setPendingTransaction=t.saveAndCloseEditMode=t.mutateViewInEditMode=void 0;var r=n(a(364687)),i=a(166089),o=a(980574),l=a(515128),u=a(692479),s=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))};t.saveAndCloseEditMode=function(e){return function(t){return s(void 0,void 0,void 0,r.default.mark((function a(){return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i.AppGlobals.AppModel.dataManager.currentTransaction.commitAsync();case 3:return t((0,u.mutateView)({ViewState:{isInEditMode:!1,transactionId:void 0},ViewStateKey:e})),a.abrupt("return",!0);case 7:return a.prev=7,a.t0=a.catch(0),t((0,o.showFailedToSave)((0,l.asError)(a.t0).message)),a.abrupt("return",!1);case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))}};t.cancelEditMode=function(e){return function(t){i.AppGlobals.AppModel.dataManager.abortCurrentTransaction(),t((0,u.mutateView)({ViewState:{isInEditMode:!1,transactionId:void 0},ViewStateKey:e}))}};function c(e){var t=function(){var t=a(397930),n=t.checkForUnsavedChangesThunk,r=e.apply(void 0,arguments),i=n(r);return i.onConfirmAction=r,i};return t.onConfirm=e,t}t.setPendingTransaction=function(e,t){return(0,u.mutateView)({ViewState:{transactionId:t},ViewStateKey:e})};var d=c((function(e){return function(t){var a=i.AppGlobals.AppModel.dataManager.currentTransaction;a.startGroup({startedBy:e}),t((0,u.mutateView)({ViewState:{isInEditMode:!0,transactionId:a.id},ViewStateKey:e}))}}));t.startEditMode=d;t.mutateViewInEditMode=function(e){return function(t){var a=i.AppGlobals.AppModel.dataManager.currentTransaction;a.startGroup(),t((0,u.mutateView)({ViewStateKey:e,ViewState:{isInEditMode:!0,transactionId:a.id}}))}}},835288:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.EditorEmulatorId=void 0;var n,r=a(673275),i=a(783252);t.EditorEmulatorId=n,function(e){e.TableName="EmulatorTableName",e.ViewName="EmulatorViewName"}(n||(t.EditorEmulatorId=n={}));var o=function(e){return function(t){return function(a){t(a);var o=(0,r.getCurrentUIState)(e.getState()),l=window.parent.document.getElementById(n.ViewName),u=window.parent.document.getElementById(n.TableName);if(l&&(l.textContent=(null==o?void 0:o.ControlName)||(null==o?void 0:o.Root)||""),u){var s=o.Root||"",c=o[i.SPECIFIC_STATE_NAME_MAP[s]];u.textContent=(null==c?void 0:c.TableName)||""}}}};t.default=o},307074:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ViewStateKey=void 0,t.createViewStateSelector=T,t.findViewStackEntry=function(e,t){return e[b(e,t)]},t.findViewStackIndex=b,t.getParentViews=t.getParentView=t.getChildViews=t.getChildView=void 0,t.useDataContext=w,t.usePendingTransaction=function(){return S(u.getPendingTransaction)},t.useReactAppSelector=t.useReactAppDispatch=void 0,t.useRows=function(e){var t=g(s.getAppModelHook),a=A(),n=w(),o=function(e){var t=(0,i.useRef)(void 0);(0,r.isEqual)(t.current,e)||(t.current=e);return t.current}(e);return(0,i.useMemo)((function(){return null==a?void 0:a.table.queryRowValues(o||{},t,n)}),[a,o,t,n])},t.useTableCollection=A,t.useTriggerForceSync=function(){var e,t=m(),a=g(d.getSyncRequestDataStamp),n=null!==(e=h.AppGlobals.AppModel.lastSuccessfulSyncTimeMs())&&void 0!==e?e:0;(0,i.useEffect)((function(){a&&a>n&&t((0,f.reactAppSyncAction)({initiatedBy:"User",preferredUI:p.SyncUI.Blocking}))}),[a,n,t])},t.useView=function(){var e=g(s.getAppModelHook),t=S(u.getControlName);return t?e.appTemplate.getView(t):null},t.useViewLabel=function(e){var t=g(s.getAppModelLastUpdated),a=g(s.getAppModelHook);return(0,i.useMemo)((function(){return(0,u.getViewLabel)(e,a)}),[e,t])},t.useViewLabels=function(){var e=g(s.getAppModelLastUpdated),t=g(s.getAppModelHook),a=g(d.getViewStack);return(0,i.useMemo)((function(){var e,n={},r=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}(a);try{for(r.s();!(e=r.n()).done;){var i=e.value;n[i.viewStateKey]=(0,u.getViewLabel)(i,t)}}catch(e){r.e(e)}finally{r.f()}return n}),[a,e])},t.useViewStackEntry=function(){var e=(0,i.useContext)(y);if(void 0===e)throw new Error("useViewStateSelector called outside a ViewStateKey provider");return(0,o.useSelector)(T(e,(function(e){return e})))},t.useViewStateDispatch=function(){var e=(0,i.useContext)(y);if(void 0===e)throw new Error("useViewStateDispatch called outside a ViewStateKey provider");var t=(0,o.useDispatch)();return function(a){return t(Object.assign(Object.assign({},a),{payload:Object.assign(Object.assign({},a.payload),{ViewStateKey:e})}))}},t.useViewStateSelector=S,t.useViewStateSelectorAll=function(e){return g((function(t){for(var a=(0,d.getViewStack)(t),n={},r=0;r<a.length;r++){var i=a[r];n[i.viewStateKey]=e(i,r,t)}return n}))};var r=a(496486),i=a(667294),o=a(197170),l=n(a(385857)),u=a(29827),s=a(398171),c=a(173399),d=a(95483),f=a(289276),p=a(21870),h=a(166089);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var m=function(){return(0,o.useDispatch)()};t.useReactAppDispatch=m;var g=o.useSelector;t.useReactAppSelector=g;var y=(0,i.createContext)(void 0);function b(e,t){var a=e.findIndex((function(e){return e.viewStateKey===t}));if(-1===a){var n=e.map((function(e){return e.viewStateKey})).join(", ");throw new Error('failed to find viewStack entry with key "'.concat(t,'", the view stack has the following keys: ').concat(n))}return a}function T(e,t){return function(a){var n=(0,d.getViewStack)(a),r=b(n,e),i=n[r];return t(i,r,a)}}function S(e){var t=(0,i.useContext)(y);if(void 0===t)throw new Error("useViewStateSelector called outside a ViewStateKey provider");return(0,o.useSelector)(T(t,e))}t.ViewStateKey=y;t.getParentViews=function(e,t,a){return a.uiState.viewStack.slice(0,t)};t.getParentView=function(e,t,a){return a.uiState.viewStack[t-1]};t.getChildViews=function(e,t,a){return a.uiState.viewStack.slice(t+1)};function A(){var e=g(s.getAppModelHook),t=S((function(e){return(0,c.mapViewStackToControl)(e).tableName}));return(0,i.useMemo)((function(){return t?e.findTableCollection(t,!0):null}),[e,t])}function w(){var e=g(s.getAppModelHook),t=A(),a=(0,i.useContext)(y);return(0,i.useMemo)((function(){return new l.default(e,null==t?void 0:t.tableSchema,void 0,void 0,void 0,void 0,{viewStateKey:a})}),[e,t,a])}t.getChildView=function(e,t,a){return a.uiState.viewStack[t+1]}},994885:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSideMenuOpen=t.setAboutPageOpen=t.getSideMenuOpen=t.getAboutPageOpen=t.default=t.ReactAppLayoutChromeStateSlice=void 0;var n=(0,a(829829).createSlice)({name:"layoutChromeState",initialState:{isSideMenuOpen:!1,isAboutPageOpen:!1},reducers:{setSideMenuOpen:function(e,t){e.isSideMenuOpen=t.payload},setAboutPageOpen:function(e,t){e.isAboutPageOpen=t.payload}}});t.ReactAppLayoutChromeStateSlice=n;var r=n.actions,i=r.setSideMenuOpen,o=r.setAboutPageOpen;t.setAboutPageOpen=o,t.setSideMenuOpen=i;t.getSideMenuOpen=function(e){return e.layoutChromeState.isSideMenuOpen};t.getAboutPageOpen=function(e){return e.layoutChromeState.isAboutPageOpen};var l=n.reducer;t.default=l},369332:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.reactAppLoadInvokingAppAction=t.reactAppLoadAppAction=t.chooseStartControl=void 0;var r=n(a(364687)),i=a(695882),o=a(692479),l=n(a(593186)),u=a(166089),s=a(398171),c=n(a(351101)),d=a(469534),f=n(a(956073)),p=a(717696),h=a(250617),v=a(173399),m=a(629503),g=a(169457),y=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},b=function(){var e,t=u.AppGlobals.AppModel,a=t.appTemplateModel.Presentation.Controls,n=t.appTemplateModel.Presentation.DefaultStartView,r=t.appTemplateModel.Presentation.ExprLookup;(null==r?void 0:r.StartView)&&(n=t.RunExpression(r.StartView));var i=[t.POSITION_FAR_LEFT,t.POSITION_LEFT,t.POSITION_RIGHT,t.POSITION_FAR_RIGHT,t.POSITION_CENTER,t.POSITION_MENU],o=a.filter((function(e){return e.IsValid&&i.includes(e.Position)})).sort((function(e,t){return i.indexOf(e.Position)-i.indexOf(t.Position)}));return n||(null===(e=o[0])||void 0===e?void 0:e.Name)};t.chooseStartControl=b;var T=function(e,t){return y(void 0,void 0,void 0,r.default.mark((function t(){var a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c.default.reset(),a=new Promise((function(e,t){u.AppGlobals.AppModel.Initialize(void 0,e,t)})),t.next=4,a.then((function(t){if(!t.IsRunnable)throw"The ".concat(t.ShortName," app is in an invalid state. Please contact the app creator.");(0,p.recordAppStartMetrics)(),m.Common.InitializingApp=!0,u.AppGlobals.AppModel.OnAppTemplateLoad(t),m.Common.InitializingApp=!1,e((0,v.updateAppStartControl)(b())),e((0,i.updateCurrentAppForAppLoadThunk)({Name:u.AppGlobals.AppModel.AppTemplate.Name,Id:u.AppGlobals.AppModel.AppTemplate.Id,Version:u.AppGlobals.AppModel.AppTemplate.Version,DisplayName:u.AppGlobals.AppModel.AppTemplate.ShortName})),(0,f.default)(t),(0,d.maybeSubscribeToPunctual)(t)})).catch((function(t){l.default.warnToDevConsole("Error loading app,",t),e((0,s.setNonRecoverableErrorMsg)(t))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))},S=(0,h.checkForUnsavedChanges)((function(){return function(e,t){return y(void 0,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e((0,o.appModelUnloaded)()),e((0,i.popCurrentAppForAppLoadThunk)()),t.next=4,T(e);case 4:e((0,o.appModelUpdated)());case 5:case"end":return t.stop()}}),t)})))}}));t.reactAppLoadInvokingAppAction=S;var A=(0,h.checkForUnsavedChanges)((function(e,t,a,n){return function(l,u){return y(void 0,void 0,void 0,r.default.mark((function u(){return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l((0,o.appModelUnloaded)()),r.next=3,l((0,i.pushCurrentAppForAppLoadThunk)({Id:t,Name:e,Version:a}));case 3:return r.next=5,T(l);case 5:n&&g.ReactAppUrlHandlerInstance.applyHash(n),l((0,o.appModelUpdated)());case 7:case"end":return r.stop()}}),u)})))}}));t.reactAppLoadAppAction=A},334304:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(649431),r=a(318926),i=function(){return function(e){return function(t){e(t),r.logger.logEvent(new n.ReduxActionEvent(t.type))}}};t.default=i},980574:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFailedToSave=t.reactAppModalCallbackAction=t.confirmDiscard=void 0;var n=a(351101),r=a(362556);t.reactAppModalCallbackAction=function(e,t){return function(a,n){null==e||e(),t&&a((0,r.closeMessageModal)())}};t.confirmDiscard=function(e){return(0,r.openMessageModal)({title:(0,n.mapActionName)("Discard changes?"),message:(0,n.mapActionName)("Any edits will be lost"),buttons:[{name:(0,n.mapActionName)("Continue editing"),dismiss:!0},{name:(0,n.mapActionName)("Discard"),callback:e,dismiss:!0}]})};t.showFailedToSave=function(e){return(0,r.openMessageModal)({title:(0,n.mapActionName)("Unable to save changes"),message:e,buttons:[{name:(0,n.mapActionName)("OK"),dismiss:!0}]})}},362556:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFormModalError=t.setMessageModalIsProcessing=t.openMessageModal=t.openFormModal=t.getModalState=t.default=t.closeMessageModal=t.closeFormModal=t.ReactAppModalSlice=void 0;var n=(0,a(829829).createSlice)({name:"modal",initialState:{},reducers:{openMessageModal:function(e,t){e.messageModal=t.payload},setMessageModalIsProcessing:function(e,t){e.messageModal&&(e.messageModal.processing=t.payload)},closeMessageModal:function(e){return Object.assign(Object.assign({},e),{messageModal:void 0})},openFormModal:function(e,t){e.formModal=t.payload},showFormModalError:function(e,t){e.formModal&&(e.formModal.errorMessage=t.payload)},closeFormModal:function(e){return Object.assign(Object.assign({},e),{formModal:void 0})}}});t.ReactAppModalSlice=n;var r=n.actions,i=r.openMessageModal,o=r.setMessageModalIsProcessing,l=r.closeMessageModal,u=r.openFormModal,s=r.showFormModalError,c=r.closeFormModal;t.closeFormModal=c,t.showFormModalError=s,t.openFormModal=u,t.closeMessageModal=l,t.setMessageModalIsProcessing=o,t.openMessageModal=i;t.getModalState=function(e){return e.modal};var d=n.reducer;t.default=d},449456:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setOfflineCacheProgress=t.offlineCacheProgressSlice=t.getCacheProgress=t.default=void 0;var n=a(829829),r=a(692479),i={totalFilesRequested:null,totalFilesToCache:null,filesCached:null,filesWithError:null},o=(0,n.createSlice)({name:"offlineCacheProgress",initialState:i,reducers:{setOfflineCacheProgress:function(e,t){Object.assign(e,t.payload)}},extraReducers:function(e){e.addCase(r.appModelUnloaded,(function(e){return Object.assign(e,i)}))}});t.offlineCacheProgressSlice=o;var l=o.actions.setOfflineCacheProgress;t.setOfflineCacheProgress=l;t.getCacheProgress=function(e){return e.offlineCacheProgress};var u=o.reducer;t.default=u},966488:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setUserDefinedFilters=t.setSearchTerm=t.searchStateSlice=t.default=void 0;var r=a(692479),i=a(351101),o=n(a(613834));function l(e,t){"newViewStack"===t.type&&(e.searchTerm="",e.tableNameToFilterOn=null);var a=t.payload.Identifier;if("Control"===a.Type){var n=(0,i.getAppModel)().FindControl(a.Name);(null==n?void 0:n.TableOrFolderName)!==e.tableNameToFilterOn&&(e.userDefinedFilters=[],e.tableNameToFilterOn=null,e.searchTerm=null)}}var u={searchTerm:null,userDefinedFilters:[],tableNameToFilterOn:null},s=(0,o.default)({name:"searchState",initialState:u,reducers:{setSearchTerm:function(e,t){e.searchTerm=t.payload.searchTerm,e.tableNameToFilterOn=t.payload.tableNameToFilterOn||null},setUserDefinedFilters:function(e,t){e.userDefinedFilters=t.payload.userDefinedFilters,e.tableNameToFilterOn=t.payload.tableNameToFilterOn}},extraReducers:function(e){e.addCase(r.pushView.onConfirm,l).addCase(r.newViewStack.onConfirm,l).addCase(r.appModelUnloaded,(function(){return Object.assign({},u)}))}},{hashToSlice:function(e,t){e.searchTerm=t.searchTerm||null,e.tableNameToFilterOn=t.tableNameToFilterOn||null,e.userDefinedFilters=t.userDefinedFilters||[]},sliceToHash:function(e,t){var a;t.searchTerm&&(e.searchTerm=t.searchTerm),t.tableNameToFilterOn&&(e.tableNameToFilterOn=t.tableNameToFilterOn),(null===(a=t.userDefinedFilters)||void 0===a?void 0:a.length)>0&&(e.userDefinedFilters=t.userDefinedFilters)}});t.searchStateSlice=s;var c=s.actions,d=c.setSearchTerm,f=c.setUserDefinedFilters;t.setUserDefinedFilters=f,t.setSearchTerm=d;var p=s.reducer;t.default=p},692479:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceView=t.pushView=t.popView=t.newViewStack=t.mutateView=t.isViewIdentifierEqual=t.focusView=t.appModelUpdated=t.appModelUnloaded=void 0;var n=a(829829),r=a(250617),i=(0,n.createAction)("appModelUpdated");t.appModelUpdated=i;var o=(0,n.createAction)("appModelUnloaded");t.appModelUnloaded=o;t.isViewIdentifierEqual=function(e,t){return"Control"===e.Type&&"Control"===t.Type?e.Name===t.Name:"View"===e.Type&&"View"===t.Type&&(e.Action===t.Action&&e.TableName===t.TableName)};var l=(0,r.checkForUnsavedChanges)((0,n.createAction)("popView"));t.popView=l;var u=(0,r.checkForUnsavedChanges)((0,n.createAction)("pushView"));t.pushView=u;var s=(0,r.checkForUnsavedChanges)((0,n.createAction)("newViewStack"));t.newViewStack=s;var c=(0,n.createAction)("replaceView");t.replaceView=c;var d=(0,n.createAction)("mutateView");t.mutateView=d;var f=(0,n.createAction)("focusView");t.focusView=f},819433:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setStoreForTesting=t.generateStore=t.default=void 0;var r=a(829829),i=n(a(398171)),o=n(a(695882)),l=n(a(173399)),u=n(a(315437)),s=n(a(966488)),c=n(a(169457)),d=n(a(835288)),f=n(a(449456)),p=n(a(571524)),h=n(a(994885)),v=a(557310),m=n(a(362556)),g=a(166089),y=n(a(593186)),b=n(a(334304)),T=function(e,t){var a=e.preloadedState;return(0,r.configureStore)({reducer:{appModel:i.default,userInformation:u.default,uiState:l.default,appStackState:o.default,searchState:s.default,offlineCacheProgress:f.default,layoutChromeState:h.default,modal:m.default},middleware:function(e){return e({serializableCheck:{ignoredActions:["modal/openMessageModal"],ignoredPaths:["modal.config.buttons"]}}).concat(null!=t?t:[])},preloadedState:a})};t.generateStore=T;var S=null;t.setStoreForTesting=function(e){S=e};var A=function(){if(S)return S;if(!v.ReactRootUIConfig.isReactRoot())return y.default.ReportErrorOnce({errorMessage:"Attempted access redux store in non-reactroot."}),null;var e=[];return p.default.IsEditorIFramePreview()?e.push(d.default):g.AppGlobals.IsInAppsheetTestContext?e.push(c.default):e.push(c.default,b.default),S=T({},e)};t.default=A},289276:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.reactAppSyncAction=t.reactAppDiscardUnsyncedChangesAction=t.getReactAppSyncProgressHandle=void 0;var r=n(a(364687)),i=a(166089),o=n(a(455127)),l=a(398171),u=a(250617),s=a(692479),c=n(a(819433)),d=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,c.default)().dispatch;return new o.default({onProgress:function(t){t.percentDone&&e((0,l.setSyncProgressPercentage)(t.percentDone))},onStart:function(t){e((0,l.onSyncStart)(t))},onFinish:function(){e((0,l.onSyncComplete)()),e(s.appModelUpdated)},onWarning:function(e){},onError:function(t){e((0,l.onSyncError)(t)),e((0,l.setSyncProgressPercentage)(null))},close:function(){},onSyncingStatus:function(e){}})};t.getReactAppSyncProgressHandle=f;var p=(0,u.checkForUnsavedChanges)((function(e){return function(t,a){return d(void 0,void 0,void 0,r.default.mark((function a(){return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:i.AppGlobals.AppModel.SyncData(f(t),e,(function(){}),(function(){}));case 2:case"end":return a.stop()}}),a)})))}}));t.reactAppSyncAction=p;var h=(0,u.checkForUnsavedChanges)((function(e){return function(t,a){return d(void 0,void 0,void 0,r.default.mark((function a(){var n;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(n=i.AppGlobals.AppModel).ClearPersistedActions(),n.ClearLocalState(),t(p(e));case 4:case"end":return a.stop()}}),a)})))}}));t.reactAppDiscardUnsyncedChangesAction=h},173399:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.collapseView=t.closeView=t.ReactAppUIStateSlice=void 0,t.deserializeMutableState=M,t.expandView=void 0,t.generateViewStateKey=T,t.getControlForIdentifier=E,t.mapViewStackToControl=t.isChildFormTransition=void 0,t.resetViewStateKeysForTests=function(){b=0},t.serializeMutableState=O,t.updateAppStartControl=t.setSyncRequestDataStamp=void 0;var r=n(a(600861)),i=n(a(627424)),o=n(a(150361)),l=n(a(639693)),u=n(a(288306)),s=n(a(535937)),c=n(a(610928)),d=a(351101),f=a(692479),p=n(a(613834)),h=n(a(593186)),v=a(166089),m=a(95483),g=a(250617),y=a(29827),b=0;function T(e){return b++,"Control"===e.Type?"".concat(e.Name,"-").concat(b):"".concat(e.Action,"-").concat(e.TableName.replace(/\s/g,"_"),"-").concat(b)}var S={viewStack:[],isInExpandMode:!1},A=function(e,t){return function(e){var t;return"type"in e&&"pushView"===e.type&&!!(null===(t=e.payload.ViewState)||void 0===t?void 0:t.referenceRelationship)}(e)||function(e,t){var a,n;return"type"in e&&"popView"===e.type&&!!(null===(n=null===(a=(0,c.default)(t.viewStack))||void 0===a?void 0:a.mutableState)||void 0===n?void 0:n.referenceRelationship)}(e,t)};t.isChildFormTransition=A;var w=function(e,t){var a,n,r,i=v.AppGlobals.AppModel;if(null==i?void 0:i.appTemplateModel.IsValid){var o=i.appTemplateModel.Presentation.Controls,u=new Set;if(e.viewStack=(0,l.default)(e.viewStack.map((function(e){var t=e.mutableState.transactionId;if(t){if(null==i.dataManager.getTransaction(t)){if(u.has(t))return null;delete e.mutableState.isInEditMode,delete e.mutableState.transactionId}u.add(t)}var a=e.identifier;if("Control"===a.Type){if(null==o.find((function(e){return e.Name===a.Name})))return null}else if(null==i.FindTable(a.TableName))return null;return e}))),0===e.viewStack.length){var s=t?(0,y.getControlName)(t):void 0,c=s?o.filter((function(e){return e.Name!==s})):void 0,d={Type:"Control",Name:(null!==(r=null!==(n=null!==(a=null==c?void 0:c.find((function(t){return t.Name===e.startControl})))&&void 0!==a?a:null==c?void 0:c[0])&&void 0!==n?n:o.find((function(t){return t.Name===e.startControl})))&&void 0!==r?r:o[0]).Name},f={viewStateKey:T(d),identifier:d,mutableState:{}};e.viewStack=[f],e.focusedView=f.viewStateKey,e.isInExpandMode=!1}}};function C(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Error("UIStateSlice reducer is recovering from a bad state");try{t=(0,o.default)(e)}catch(a){t=e}setTimeout((function(){h.default.ReportError(Object.assign(Object.assign({},a),{state:t,error:n,errorMessage:n.message}))}),0),w(e)}function E(e){var t,a=(0,d.getAppModel)();if("Control"===e.Type)return null!==(t=a.FindControl(e.Name))&&void 0!==t?t:void 0;if("View"===e.Type)return a.FindControlsForTable(e.TableName,e.Action,!1)[0];throw new Error("Bad identifier. Expected ControlIdentifier | ViewIdentifier, got ".concat(e))}function k(e,t){var a;if(!t)return{};var n=(0,d.getAppModel)().NavStateForView(e,null!==(a=e.TableOrFolderName)&&void 0!==a?a:"");return(0,s.default)(t,(function(e,t){return n[t]!==e}))}var R=["isInEditMode","ShowLegend","showActionBar","interactiveMode","showTabs","UseCardLayout"],I=["MaxNestedRows","Zoom","CurrentLat","CurrentLng"];function O(e){for(var t={},a=0,n=Object.entries(e);a<n.length;a++){var r=(0,i.default)(n[a],2),o=r[0],l=r[1];R.includes(o)?t[o]=!0===l?"true":void 0:t[o]=l}return t}function M(e){for(var t={},a=0,n=Object.entries(e);a<n.length;a++){var r=(0,i.default)(n[a],2),o=r[0],l=r[1];if(R.includes(o))"true"===l&&(t[o]=!0),"false"===l&&(t[o]=!1);else if(I.includes(o)){var u=Number(l);isNaN(u)||(t[o]=u)}else t[o]=l}return t}function N(e){var t,a=null===(t=(0,m.breakViewStackIntoGroups)((0,d.getAppModel)(),e.viewStack,e.isInExpandMode,e.focusedView).focusedViewGroup.at(-1))||void 0===t?void 0:t.viewStateKey,n=e.viewStack.findIndex((function(e){return e.viewStateKey===a}));e.viewStack=e.viewStack.slice(0,n+1)}function _(e){var t=e.viewStack.pop();e.viewStack.length?e.focusedView=e.viewStack[e.viewStack.length-1].viewStateKey:w(e,t),e.viewStack.length<2&&(e.isInExpandMode=!1)}function D(e,t){var a=(0,d.getAppModel)(),n=t.payload.ViewState,r=t.payload.Identifier,i=E(r);if(i)n=k(i,n),r={Type:"Control",Name:i.Name};else if("Control"===r.Type||null==a.FindTable(r.TableName))return void C(e,{action:t});var o=T(r),l={viewStateKey:o,identifier:r,mutableState:null!=n?n:{}};e.viewStack=[l],e.focusedView=o,e.isInExpandMode=!1}function L(e,t){var a,n,i,o=(0,d.getAppModel)(),l=t.payload.ViewState,u=null,s=t.payload.Identifier,c=e.viewStack.findIndex((function(e){return"form"===(0,y.getViewType)(e)})),p=void 0;c>=0&&!A(t,e)?p=c-1:t.payload.ViewStateKey&&(p=e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload.ViewStateKey})));var h=void 0!==p?e.viewStack[p]:void 0;t.payload.RetainFilter&&h&&(l=Object.assign({filterExprString:h.mutableState.filterExprString},l));var v=E(s);if(v)l=k(v,l),u=v.Action,s={Type:"Control",Name:v.Name};else{if("Control"===s.Type||null==(null==o?void 0:o.FindTable(s.TableName)))return void C(e,{action:t});u=s.Action}var m,g={viewStateKey:T(s),identifier:s,mutableState:null!=l?l:{},parentEntriesHidden:null!==(i=null===(n=null===(a=t.payload)||void 0===a?void 0:a.options)||void 0===n?void 0:n.hideParentEntries)&&void 0!==i?i:void 0},b=e.viewStack.find((function(e){return(0,f.isViewIdentifierEqual)(e.identifier,g.identifier)&&e.mutableState.RowKey===g.mutableState.RowKey&&e.mutableState.filterExprString===g.mutableState.filterExprString})),S=e.viewStack.findIndex((function(e){return(0,f.isViewIdentifierEqual)(e.identifier,g.identifier)}));b?(m=b.viewStateKey,b.mutableState=Object.assign(Object.assign({},b.mutableState),l)):-1===S||void 0!==p&&p<S?void 0!==p?(e.viewStack=e.viewStack=[].concat((0,r.default)(e.viewStack.slice(0,p+1)),[g]),m=g.viewStateKey):(e.viewStack=[].concat((0,r.default)(e.viewStack),[g]),m=g.viewStateKey):(e.viewStack=[].concat((0,r.default)(e.viewStack.slice(0,S)),[g]),m=g.viewStateKey),"form"!==u&&(e.focusedView=m,N(e))}function P(e,t){var a,n,r=(0,d.getAppModel)(),i=t.payload;if(!i.ViewStateKey)throw new Error("changeViewReducer called without a ViewStateKey. Dispatch replaceView actions with useViewStateDispatch or provide a ViewStateKey manually.");var o=e.viewStack.findIndex((function(e){return e.viewStateKey===i.ViewStateKey})),l=e.viewStack[o].identifier;if("View"===l.Type){if(null==(null==r?void 0:r.FindTable(l.TableName)))return void C(e,{action:t});e.viewStack[o].mutableState=i.ViewState}else{var u=null!==(a=r.FindControl(l.Name))&&void 0!==a?a:void 0;if(!u)return void C(e,{action:t});var s="replaceView"===t.type?i.ViewState:Object.assign(Object.assign({},e.viewStack[o].mutableState),i.ViewState);e.viewStack[o].mutableState=k(u,s)}(null===(n=i.options)||void 0===n?void 0:n.discardChildren)&&(e.viewStack=e.viewStack.slice(0,o+1))}function x(e,t){e.viewStack.find((function(e){return e.viewStateKey===t.payload}))?(e.focusedView=t.payload,N(e)):C(e,{action:t})}var F=(0,u.default)((function(e){var t;if(!e)return{control:null,navState:null};var a=(0,d.getAppModel)(),n=e.identifier,r=null,i=e.mutableState,o=null,l=null;if("Control"===n.Type){r=a.FindControl(n.Name);var u=a.NavStateForView(r,null!==(t=null==r?void 0:r.TableOrFolderName)&&void 0!==t?t:"");i=Object.assign(Object.assign({controlGroupBy:null==u?void 0:u.GroupBy},u),i),o=null==r?void 0:r.TableOrFolderName,l=null==r?void 0:r.Action}else o=n.TableName,l=n.Action;return{control:r,tableName:o,action:l,navState:i}}));t.mapViewStackToControl=F;var G=(0,p.default)({name:"uiState",initialState:S,reducers:{closeView:function(e,t){var a=e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload}));a>=0&&(a<=e.viewStack.findIndex((function(t){return t.viewStateKey===e.focusedView}))&&(e.focusedView=e.viewStack[a-1].viewStateKey),e.viewStack.splice(a),1===e.viewStack.length&&(e.isInExpandMode=!1))},expandView:function(e,t){var a=e.viewStack.find((function(e){return e.viewStateKey===t.payload}));a&&(e.focusedView=null==a?void 0:a.viewStateKey,e.isInExpandMode=!0,N(e))},collapseView:function(e,t){var a,n=(0,d.getAppModel)();if(-1!==e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload}))){e.focusedView=t.payload,e.isInExpandMode=!1;var r=(0,m.breakViewStackIntoGroups)(n,e.viewStack,e.isInExpandMode,e.focusedView).focusedViewGroup;e.focusedView=null===(a=r.at(-1))||void 0===a?void 0:a.viewStateKey}},updateAppStartControl:function(e,t){e.startControl=t.payload},setSyncRequestDataStamp:function(e,t){e.syncRequestDataStamp=t.payload}},extraReducers:function(e){e.addCase(f.popView.onConfirm,_).addCase(f.pushView.onConfirm,L).addCase(f.newViewStack.onConfirm,D).addCase(f.replaceView,P).addCase(f.mutateView,P).addCase(f.focusView,x).addCase(f.appModelUpdated,(function(e){F.cache.clear&&F.cache.clear(),w(e)})).addCase(f.appModelUnloaded,(function(){return F.cache.clear&&F.cache.clear(),Object.assign({},S)}))}},{hashToSlice:function(e,t){var a,n=(t.viewStack||[]).map((function(e){if(!e.identifier)return null;var t={identifier:e.identifier,mutableState:M(e.mutableState||{}),viewStateKey:e.viewStateKey||T(e.identifier)};return void 0!==e.parentEntriesHidden&&(t.parentEntriesHidden=e.parentEntriesHidden),t})).filter((function(e){return null!=e}));t.at&&(e.syncRequestDataStamp=Math.min(Date.now(),new Date(t.at).valueOf())),e.viewStack=n,e.focusedView=null===(a=n[n.length-1])||void 0===a?void 0:a.viewStateKey,w(e)},sliceToHash:function(e,t){var a=t.viewStack.map((function(e){return Object.assign(Object.assign({},e),{mutableState:O(e.mutableState),viewStateKey:void 0})}));e.viewStack=a}});t.ReactAppUIStateSlice=G;var V=G.actions,B=V.expandView,U=V.collapseView,H=V.updateAppStartControl,W=V.setSyncRequestDataStamp;t.setSyncRequestDataStamp=W,t.updateAppStartControl=H,t.collapseView=U,t.expandView=B;var j=(0,g.checkForUnsavedChanges)(G.actions.closeView);t.closeView=j;var q=G.reducer;t.default=q},315437:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userInformationSlice=t.getUserInformationHook=t.default=void 0;var n=a(829829),r=(0,a(27401).ReadUserInfoFromUStore)(),i=(0,n.createSlice)({name:"userInformation",initialState:r,reducers:{}});t.userInformationSlice=i;t.getUserInformationHook=function(e){return e.userInformation};var o=i.reducer;t.default=o},397930:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.checkForUnsavedChangesThunk=void 0;var r=n(a(364687)),i=a(197170),o=a(29827),l=a(398171),u=a(692479),s=a(250617),c=a(980574),d=a(173399),f=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))};t.checkForUnsavedChangesThunk=function(e){return function(t,a){return f(void 0,void 0,void 0,r.default.mark((function n(){var p,h,v,m,g;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(p=a(),h=(0,l.getAppModelHook)(p),v=(0,o.getViewInPendingTransaction)(p),m="type"in e&&(0,d.isChildFormTransition)(e,p.uiState),!h||!v||m){n.next=15;break}if(g=function(){return f(void 0,void 0,void 0,r.default.mark((function a(){return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(0,i.batch)((function(){t((0,s.cancelEditMode)(v.viewStateKey)),t(e)}));case 1:case"end":return a.stop()}}),a)})))},!h.dataManager.currentTransaction.hasUserEdits){n.next=11;break}t((0,u.focusView)(v.viewStateKey)),t((0,c.confirmDiscard)(g)),n.next=13;break;case 11:return n.next=13,g();case 13:n.next=16;break;case 15:t(e);case 16:case"end":return n.stop()}}),n)})))}}},397866:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.navigateToLegacyHash=void 0;var r=n(a(364687)),i=n(a(627424)),o=n(a(365914)),l=a(695882),u=a(369332),s=a(759265),c=a(783252),d=n(a(593186)),f=a(173399),p=a(692479),h=a(75212),v=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))};t.navigateToLegacyHash=function(e,t){return function(a,n){return v(void 0,void 0,void 0,r.default.mark((function v(){var m,g,y,b,T,S,A,w,C,E,k,R,I,O,M,N;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(y=e.split("#"),b=(0,i.default)(y,2),T=b[0],S=b[1],A=(0,h.parseHash)(S),w=T||A.appName||A.appId,C=o.default.isGuid(w),E=C?void 0:w,k=C?w:"AppGallery-10305"===E?"c37bc8a4-6b53-4e71-812c-2348072cbf2e":void 0,R=(0,l.getCurrentAppHook)(n()),!(w&&w!==(null==R?void 0:R.Id)&&w!==(null==R?void 0:R.Name)||A.version&&A.version!==(null==R?void 0:R.Version))){r.next=13;break}return r.next=11,a((0,u.reactAppLoadAppAction)(E,k,void 0,null!=S?S:""));case 11:r.next=23;break;case 13:if(I=(0,s.hashStringToUIState)("#"+S),(null==(O=null==I?void 0:I[c.SPECIFIC_STATE_NAME_MAP[I.Root]])?void 0:O.FilterExpr)&&(O.filterExprString=JSON.stringify(O.FilterExpr.toJSON()),delete O.FilterExpr),O){r.next=19;break}return d.default.errorToDevConsole(new Error("Failed to decode hash in StateReflector.SwitchApp(".concat(JSON.stringify(e),", ").concat(t,")"))),r.abrupt("return");case 19:I.syncRequestDataStamp&&a((0,f.setSyncRequestDataStamp)(I.syncRequestDataStamp)),M=I.ControlName,N=M?{Type:"Control",Name:M}:{Type:"View",Action:null!==(m=O.Root)&&void 0!==m?m:"",TableName:null!==(g=O.TableName)&&void 0!==g?g:""},a(t?(0,p.pushView)({Identifier:N,ViewState:O,ViewStateKey:t}):(0,p.newViewStack)({Identifier:N,ViewState:O}));case 23:case"end":return r.stop()}}),v)})))}}},759265:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.hashStringToUIState=void 0;var r,i,o,l,u=n(a(238416)),s=n(a(150361)),c=a(351101),d=n(a(888861)),f=n(a(593186)),p=a(75212),h=a(783252),v={card:"card",table:"fastTable",dashboard:"dashboard",deck:"deck",gallery:"gallery",slideshow:"detail",detail:"detail",map:"google-map",chart:"graph",form:"form",search:"search",calendar:"calendar",onboarding:"onboarding",iframe:"iframe"};!function(e){e.Defaults="defaults",e.Filter="filter",e.Group="group",e.MapColumn="mapcolumn",e.QuickEdit="quickedit",e.Row="row",e.Selected="selected",e.Sort="sort",e.Table="table"}(i||(i={})),function(e){e.Filter="_filterExpr",e.Group="_groupBy",e.Row="_row",e.Sort="_sortBy",e.Table="_table"}(o||(o={})),function(e){e.DefaultValues="DefaultValues",e.FilterExpr="FilterExpr",e.GroupBy="GroupBy",e.MapColumn="MapCol",e.QuickEdit="isInEditMode",e.RowKey="RowKey",e.Selected="selected",e.SortBy="SortBy",e.TableName="TableName"}(l||(l={}));var m=(r={},(0,u.default)(r,o.Row,l.RowKey),(0,u.default)(r,o.Table,l.TableName),(0,u.default)(r,o.Filter,l.FilterExpr),(0,u.default)(r,o.Group,l.GroupBy),(0,u.default)(r,o.Sort,l.SortBy),(0,u.default)(r,i.Defaults,l.DefaultValues),(0,u.default)(r,i.Filter,l.FilterExpr),(0,u.default)(r,i.Group,l.GroupBy),(0,u.default)(r,i.QuickEdit,l.QuickEdit),(0,u.default)(r,i.Row,l.RowKey),(0,u.default)(r,i.Selected,l.Selected),(0,u.default)(r,i.Sort,l.SortBy),(0,u.default)(r,i.Table,l.TableName),(0,u.default)(r,i.MapColumn,l.MapColumn),r),g=function(e){try{return JSON.parse(e)}catch(t){return f.default.warnToDevConsole(t),e}};t.hashStringToUIState=function(e){var t,a,n;if(e){var r=(0,c.getAppModel)(),o=(0,p.parseHash)(e),l={};l.ControlName=null!==(t=o.view)&&void 0!==t?t:o.control;var u=o.page||(null===(a=r.FindControl(l.ControlName))||void 0===a?void 0:a.Action)||"table";l.Root=v[u]||u,l.DataStamp=r.DataStamp,l.SearchTerm=o.search,o.at&&(l.syncRequestDataStamp=Math.min(Date.now(),new Date(o.at).valueOf()));var f=null!==(n=o.table)&&void 0!==n?n:o._table;if(f&&!l.ControlName){var y=r.FindControlsForTable(f,u,!1);"map"===u&&o.mapcolumn&&(y=y.filter((function(e){var t=r.appTemplate.getViewDefinition(e.Name);return!!t&&(o.mapcolumn===t.MapColumn||f===t.SecondaryTable&&o.mapcolumn===t.SecondaryColumn)}))),y.length&&(l.ControlName=y[0].Name)}return l[h.SPECIFIC_STATE_NAME_MAP[u]]=function(e,t){var a=[i.Table,i.Row,i.MapColumn],n=[i.Selected,i.Defaults,i.Group,i.Sort,i.QuickEdit],r=(0,s.default)(t);if(a.forEach((function(t){if(t in e){var a=m[t];void 0!==e[t]&&(r[a]=e[t])}})),n.forEach((function(t){if(t in e){var a=m[t],n=g(e[t]);void 0!==n&&(r[a]=n)}})),i.Filter in e){var o=g(e[i.Filter]);r.FilterExpr=d.default.create(o)}return r}(o,l),l}return null}},956073:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=i.default.applyQueryTheme(e.Presentation.DisplayTheme);r.AppGlobals.ViewManager.theme.setTheme(t,e);var a=r.AppGlobals.AppModel.appTemplate.normalizedFontSize();null!=a&&$("html, body").css("font-size","".concat(a,"px"));if(!window.APPSHEET_TEST_CONTEXT&&null!=e.Presentation.FontFamily){var n=$("body").css("font-family");n&&!n.startsWith(e.Presentation.FontFamily)&&$("body").css("font-family",'"'+e.Presentation.FontFamily+'", '+n)}};var r=a(166089),i=n(a(266522))},717696:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.recordAppStartMetrics=function(){var e;s.appStartsMetric.record(d),l.logger.logAppEvent(u.AppEventName.AppStart,void 0,!0),r.default.isFunction(window.ga)&&window.ga("send",{hitType:"event",eventCategory:"App",eventAction:"AppStart",eventLabel:null===(e=l.logger.getScenario())||void 0===e?void 0:e.scenarioName});var t=(0,i.default)();window.APP_START_TIME=t.toISOString();var a=t.subtract(window.AppSheetPageLoadTime,"ms").valueOf();s.appStartMsMetric.record(a,d)},t.recordBootstrapMetrics=function(){var e=(0,i.default)().subtract(window.AppSheetPageLoadTime,"ms").valueOf();s.appBootstrapMsMetric.record(e,d)};var r=n(a(496486)),i=n(a(730381)),o=n(a(571524)),l=a(318926),u=a(218546),s=a(354632),c=a(557310),d={Device:o.default.GetMetricDevice(),Platform:c.ReactRootUIConfig.isReactRoot()?"react root":"legacy"}},772414:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAppsScriptTask=function(e){return"AppsScript"===(null==e?void 0:e.Type)},t.isCallProcessForEachRowNode=function(e){return"CALL_PROCESS_FOR_EACH_ROW"===(null==e?void 0:e.NodeType)},t.isCallProcessNode=function(e){return"CALL_PROCESS"===(null==e?void 0:e.NodeType)},t.isChatTask=function(e){return"Chat"===(null==e?void 0:e.Type)},t.isCompositeAction=function(e,t){return null!=t&&"COMPOSITE"===e.ActionType},t.isIfElseNode=function(e){return"IF_ELSE"===(null==e?void 0:e.NodeType)},t.isRunActionNode=function(e){return"RUN_ACTION"===(null==e?void 0:e.NodeType)},t.isRunTaskNode=function(e){return"RUN_TASK"===(null==e?void 0:e.NodeType)},t.isSendEmailTask=function(e){return"Email"===(null==e?void 0:e.Type)},t.isTakeActionTask=function(e){return"TakeAction"===(null==e?void 0:e.Type)},t.isWaitNode=function(e){return"WAIT"===(null==e?void 0:e.NodeType)},t.isWebhookTask=function(e){return"Webhook"===(null==e?void 0:e.Type)}},540554:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(856690)),i=n(a(689728)),o=n(a(667294)),l=n(a(496486)),u=a(532499),s=a(596179),c=a(239855),d=a(188709),f=a(251347),p=[{label:"Daily",value:"daily",icon:o.default.createElement(c.CalendarTodayIcon,null)},{label:"Weekly",value:"weekly",icon:o.default.createElement(s.DateRangeIcon,null)},{label:"Monthly",value:"monthly",icon:o.default.createElement(u.TodayIcon,null)},{label:"Monthly\n(by week)",value:"monthlyByWeek",icon:o.default.createElement(d.EventAvailableIcon,null)}],h=p.map((function(e){return e.value})),v=[{label:"Sun",value:"0"},{label:"Mon",value:"1"},{label:"Tue",value:"2"},{label:"Wed",value:"3"},{label:"Thu",value:"4"},{label:"Fri",value:"5"},{label:"Sat",value:"6"}],m=[{label:"S",value:"0"},{label:"M",value:"1"},{label:"T",value:"2"},{label:"W",value:"3"},{label:"T",value:"4"},{label:"F",value:"5"},{label:"S",value:"6"}],g=v.map((function(e){return e.value})),y=l.default.range(1,32).map((function(e){return{label:l.default.toString(e),value:l.default.toString(e)}})).concat([{label:"Last day of the month",value:"L"},{label:"Last weekday of the month",value:"LW"}]),b=y.map((function(e){return e.value})),T=new Map(y.map((function(e){return[e.value,e]}))),S=[{label:"1st",value:"#1"},{label:"2nd",value:"#2"},{label:"3rd",value:"#3"},{label:"4th",value:"#4"},{label:"5th",value:"#5"},{label:"Last",value:"L"}],A=S.map((function(e){return e.value})),w=new Map(S.map((function(e){return[e.value,e]})));var C=function(){function e(t){(0,r.default)(this,e),this.fromCron(t)}return(0,i.default)(e,[{key:"frequency",get:function(){return this._frequency},set:function(e){var t;(t=h,f.dynamicRollouts.includeByOwnerId("HourlyAutomationBot")&&t.push("hourly"),t).includes(e)||(e="monthly"),this._frequency=e}},{key:"min",get:function(){return this._min},set:function(e){e=l.default.toInteger(e),e=l.default.clamp(e,0,59),this._min=e}},{key:"hour",get:function(){return this._hour},set:function(e){e=l.default.toInteger(e),e=l.default.clamp(e,0,23),this._hour=e}},{key:"day",get:function(){return this._day},set:function(e){e=l.default.toString(e),b.includes(e)||(e="1"),this._day=e}},{key:"daysOfWeek",get:function(){return this._daysOfWeek},set:function(e){l.default.isArray(e)||(e=[]),e=(e=e.filter((function(e){return g.includes(e)}))).sort(),this._daysOfWeek=e}},{key:"whichWeek",get:function(){return this._whichWeek},set:function(e){A.includes(e)||(e=l.default.first(A)),this._whichWeek=e}},{key:"reset",value:function(){this.frequency="monthly",this.min=0,this.hour=12,this.day=l.default.first(b),this.daysOfWeek=["1"],this.whichWeek=l.default.first(A)}},{key:"fromCron",value:function(e){this.reset();var t=l.default.toString(e).split(" ");if(5!==t.length)return!1;var a=t[1];this.min=t[0],this.hour=a;var n=t[2],r=t[4];if("*"===a)this.frequency="hourly";else if("*"===n&&"*"===r)this.frequency="daily";else if("*"!==n&&"*"===r)this.frequency="monthly",this.day=n;else{if("*"!==n||"*"===r)return!1;var i=A.find((function(e){return r.endsWith(e)}));i?(this.frequency="monthlyByWeek",this.whichWeek=i,this.daysOfWeek=r.replace(i,"").split(",")):(this.frequency="weekly",this.daysOfWeek=r.split(","))}return!0}},{key:"toCron",value:function(){var e;if("daily"===this.frequency)e=[this.min,this.hour,"*","*","*"];else if("weekly"===this.frequency){var t=l.default.join(this.daysOfWeek,",");e=[this.min,this.hour,"*","*",t]}else if("monthly"===this.frequency)e=[this.min,this.hour,this.day,"*","*"];else if("monthlyByWeek"===this.frequency){var a=(l.default.first(this.daysOfWeek)||"1")+this.whichWeek;e=[this.min,this.hour,"*","*",a]}else e="hourly"===this.frequency?[this.min,"*","*","*","*"]:[this.min,this.hour,this.day,"*","*"];return l.default.join(e," ")}},{key:"timeString",value:function(){return e.timeToString({hour:this.hour,min:this.min})}},{key:"daysOfWeekString",value:function(){return this.daysOfWeek.map((function(e){return v[e].label}))}},{key:"whichWeekObject",value:function(){return w.get(this.whichWeek)}},{key:"dayOfMonth",value:function(){return T.get(this.day)}}],[{key:"frequencyOptions",value:function(){return f.dynamicRollouts.includeByOwnerId("HourlyAutomationBot")?[{label:"Hourly",value:"hourly",icon:o.default.createElement(u.TodayIcon,null)}].concat(p):p}},{key:"dayOfWeekOptions",value:function(){return v}},{key:"dayOfWeekSimpleOptions",value:function(){return m}},{key:"dayOptions",value:function(){return y}},{key:"whichWeekOptions",value:function(){return S}},{key:"parseTimeString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=/(\d{1,2})\s*\:?\s*(\d{0,2})\s*($|am|pm|AM|PM)/,a=e.match(t)||["","","",""],n=l.default.toInteger(a[1]||"0"),r=l.default.toInteger(a[2]||"0"),i=l.default.lowerCase(a[3]||"");return"am"===i&&12===n&&(n=0),"pm"===i&&n<12&&(n+=12),{hour:n=l.default.clamp(n,0,23),min:r=l.default.clamp(r,0,59)}}},{key:"timeToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var a=e||{},n=a.min,r=void 0===n?0:n;return r=l.default.clamp(r,0,59)}if(!e||!l.default.isInteger(e.hour)||!l.default.isInteger(e.min))return"12:00 pm";var i=e.hour,o=e.min,u="am";i>=12&&(i-=12,u="pm"),0===i&&(i=12),i=l.default.clamp(i,1,12),o=l.default.clamp(o,0,59);var s=i+":"+(o=l.default.padStart(o,2,"0"))+" "+u;return s}},{key:"normalizeTimeString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.parseTimeString(e),a=this.timeToString(t);return a}}]),e}();t.default=C},629503:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.Common=void 0;var i=n(a(856690)),o=n(a(689728)),l=n(a(496486));a(671734),a(222820);var u,s=n(a(112368)),c=n(a(571524)),d=a(318926),f=a(881219),p=a(218546),h=a(737351),v=n(a(593186)),m=a(365914),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=N(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(351101)),y=a(895466),b=a(714067),T=a(429815),S=a(862858),A=a(263198),w=n(a(440587)),C=a(469534),E=a(892148),k=a(166089),R=a(386350),I=n(a(27401)),O=a(717696),M=a(44617);function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(N=function(e){return e?a:t})(e)}t.Common=u;var _="";$(document).on("mouseup","a",(function(e){_=e.currentTarget.href,setTimeout((function(){_=null}),500)}));var D=window.onbeforeunload?window.onbeforeunload:function(){};window.onbeforeunload=function(){u.IsPopupUrl(_)||(D.call(window),v.default.AddTraceContext("BeforeWindowUnload"),d.logger.endAllScenarios({result:S.ScenarioResult.Abandon,abandonReason:S.ScenarioAbandonReason.UserNavigatedAway}))};var L=window.onfocus?window.onfocus:function(){};window.onfocus=function(){L.call(window),window.QuiesceApp=!1,v.default.AddTraceContext("AfterWindowLoad")};var P=function(){function e(){(0,i.default)(this,e),this.FADE_IN_DURATION_MS=300,this.FADE_OUT_DURATION_MS=400,this.InitializingApp=!1,this.PhoneWidth=480,this.TabletWidth=768,this.SmallDesktopWidth=992,this.RunningInTestFramework=!1,this.PrivilegedUsers={25410:!0,25411:!0},this.imageCache={},this.uploadRequests={},this.awaitingUploadRequests={}}return(0,o.default)(e,[{key:"DeployVersion",get:function(){return window.AppSheetJSVersion}},{key:"OnLocalHost",value:function(){return E.WindowWrapper.location.hostname.indexOf("localhost")>=0}},{key:"rescaleCanvas",value:function(e){var t=parseInt($(e).attr("width"),10)/$(e).width();e.getContext("2d").setTransform(t,0,0,t,0,0)}},{key:"StartBackendCall",value:function(){$("#header").trigger("startBackendCall.appsheet")}},{key:"FinishBackendCall",value:function(){$("#header").trigger("finishBackendCall.appsheet")}},{key:"IsPopupUrl",value:function(e){if("string"!=typeof e)return!1;var t=e.toLowerCase();return 0===t.indexOf("mailto:")||0===t.indexOf("tel:")||0===t.indexOf("sms:")}},{key:"Show1TrackHelp",value:function(e,t){var a=this;if($("#GetStartedList").hide(),e){var n=$("#"+t);n.dialog({create:function(e){$(e.target).parent().css("position","fixed")},open:function(){$("#FullScreenOverlay").show(),a.FixDialogPosition(n)},close:function(){$("#FullScreenOverlay").hide()},zIndex:10005,position:"center",width:500,title:$("#"+t).attr("dialogTitle")})}}},{key:"FixDialogPosition",value:function(e,t){var a=e.outerWidth(),n=e.outerHeight();a<=1&&(a=t),n<=1&&(n=500);var r=e.offset(),i=$(window);if(r.left<i.scrollLeft()||r.left+a>i.scrollLeft()+i.width()){var o=i.width()/2-a/2;"absolute"===e.parents(".ui-dialog").css("position")&&(o+=i.scrollLeft()),e.parents(".ui-dialog").css("left",o)}if(r.top<i.scrollTop()||r.top+n>i.scrollTop()+i.height()){var l=i.height()/2-n/2;"absolute"===e.parents(".ui-dialog").css("position")&&(l+=i.scrollTop()),e.parents(".ui-dialog").css("top",l)}}},{key:"BeginOfflineCaching",value:function(){k.AppGlobals.ViewManager.ShowStorageInProgress()}},{key:"FinishedCachingCallback",value:function(){k.AppGlobals.ViewManager.HideStorageInProgress()}},{key:"FlexImageUrl",value:function(e,t){var a,n,r;if(!e)return" ";if("string"!=typeof e)return(0,y.isImageHandle)(e)?null!==(a=y.ImageHandle.from(e).getUrlForImgSrc())&&void 0!==a?a:" ":e instanceof w.default?null!==(n=e.url)&&void 0!==n?n:" ":(v.default.ReportErrorOnce({errorMessage:"Unexpected imageUrl type in FlexImageUrl",stringified:null===(r=JSON.stringify(e))||void 0===r?void 0:r.slice(0,100)}),e);if("data:"===e.substr(0,5))return e;var i=e.includes("?")?"&":"?",o=b.GETIMAGEURL_PATTERN.test(e)||b.GETREMOTEIMAGEURL_PATTERN.test(e);if(/\.svg($|[\?#])|format=svg/.test(e)||e.indexOf("quickchart.io")>0||e.indexOf("drive.google.com")>0||e.indexOf("placeholder.pics")>0||e.indexOf("robohash.org")>0||e.indexOf("avataaars.io")>0||e.indexOf("pixelixe.com")>0)return e;if(!(!o&&e.indexOf("jeenee")<0&&e.indexOf("appsheetios")<0&&e.indexOf(b.REMOTE_URL_BASE)<0&&e.indexOf("gettablefileurl")<0&&e.indexOf(b.CLOUDFLARE_URL_BASE)<0&&e.indexOf("content.force.com")<0&&e.indexOf("via.placeholder.com")<0))return 0===e.indexOf(b.CLOUDFLARE_URL_BASE)?(e.indexOf("&w=")<0&&(e+="".concat(i,"w=").concat(null!=t?t:600)),e):e.indexOf("gettablefileurl")>0?e+="".concat(i,"resizeImage=true&imageWidth=").concat(null!=t?t:600):o?(e.indexOf("width=")<0&&(e+="".concat(i,"width=").concat(null!=t?t:600)),e):e.toLowerCase().indexOf("fsimage")>=0?(0===e.indexOf("http://")&&(e=e.replace("http://","https://")),e):(0,m.normalizeTextIconUrl)(e);try{return b.GETREMOTEIMAGEURL_BASE+"?url="+encodeURIComponent(decodeURIComponent(e))+"&width="+(null==t?600:t)}catch(t){return e}}},{key:"InitializeApp",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{this.InitializingApp=!0,k.AppGlobals.AppState.Initialize(a,r),k.AppGlobals.AppState.AppTemplate={Id:e,Name:a,Version:r},k.AppGlobals.ViewManager.Initialize(),window.InputHandler.Initialize(),A.JeeneeBrowserAPI.notifyJavaScriptLoaded(),A.JeeneeBrowserAPI.setNativeLocalizationStrings&&A.JeeneeBrowserAPI.setNativeLocalizationStrings([]),k.AppGlobals.AppState.UserInformation.Id!==k.AppGlobals.AppState.GuestUserInformation.Id&&(s.default.IsAndroidAppWithMinVersion()&&!c.default.IsUnsupportedAndroidVersion()?window.JeeneeAndroid.setOnTokenRefreshListener("JeeneeBrowserAPI.onNewNotificationToken('{0}')"):s.default.IsAndroidAppWithMinVersion(10.5)&&!c.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.setOnTokenRefreshListener("JeeneeBrowserAPI.onNewNotificationToken('{0}', '{1}', '{2}')"),s.default.IsIOSAppWithMinVersion(10.6)?A.JeeneeBrowserAPI.setOnTokenRefreshListenerIOS({listener:"JeeneeBrowserAPI.onNewNotificationToken('{0}', '{1}', '{2}')"}):s.default.IsIOSAppWithMinVersion(9.9)&&$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setOnTokenRefreshListener",data:{listener:"JeeneeBrowserAPI.onNewNotificationToken('{0}')"}}));var i=function(){v.default.AddTraceContext("Common.fetchDataAndStart",{appId:e,appName:a}),(0,f.abortOutstandingCalls)(),k.AppGlobals.AppModel.discardPendingAppModel(),c.default.IsAndroid4()&&$("body").addClass("IsAndroid4");k.AppGlobals.ViewManager.ShowDataLoadModal({syncOrStartup:"startup",hideUI:!1},(function(e){k.AppGlobals.AppModel.Initialize(e,(function(e){v.default.AddTraceContext("Common.appTemplateSuccess",{appName:e.Name}),(0,h.installOrUpdateServiceWorker)(),A.JeeneeBrowserAPI.setCurrentApp(e),(0,C.maybeSubscribeToPunctual)(e),StateReflector.Initialize(),null!=e&&(e.IsRunnable?(k.AppGlobals.AppModel.OnAppTemplateLoad(e),n&&k.AppGlobals.AppState.SetLocationHash(n),A.JeeneeBrowserAPI.OnAppTemplateLoad(e),k.AppGlobals.ViewManager.OnAppTemplateLoad(e,!0),k.AppGlobals.AppState.OnAppTemplateLoad(e),k.AppGlobals.AppModel.IsWhitelabelApp()||k.AppGlobals.AppState.SetLastRunApp(e.Name)):k.AppGlobals.ViewManager.ShowErrorScreen("The "+e.ShortName+" app is in an invalid state. Please contact the app creator."),a&&(0,O.recordAppStartMetrics)()),t.InitializingApp=!1,(0,R.sendEditorMessage)("app-initialized",{appId:e.Id})}),(function(e){if(!(window.ignoreAbort&&e&&e.indexOf("abort")>=0))throw k.AppGlobals.ViewManager.ShowErrorScreen("The "+a+" app did not load successfully. Please contact the app creator.",e),t.InitializingApp=!1,k.AppGlobals.AppState.SetLastRunApp(null),a&&d.logger.logAppEvent(p.AppEventName.AppStart),new Error("Error initializing AppModel: "+(e||""))}))}))};try{i()}catch(e){v.default.AddTraceContext("ERROR in fetchDataAndStart - retrying with new AppModel"),k.AppGlobals.AppModel.ClearTemplateData(),I.default.clearUserRollouts(),g.default.reset(),i()}}catch(e){this.InitializingApp=!1,k.AppGlobals.AppState.SetLastRunApp(null)}}},{key:"EvaluateExtensionMethod",value:function(e,t,a){if("AppGallery-10305"!==k.AppGlobals.AppState.AppTemplate.Name)return a(!1,null);if("chooseControl"===e){if(!l.default.isNil(t)&&!l.default.isNil(t.controls)){for(var n=null,r=null,i=null,o=0;o<t.controls.length;o++)switch(t.controls[o].Name){case"Public":i=t.controls[o];break;case"My Apps":n=t.controls[o];break;case"Shared":r=t.controls[o]}if(!l.default.isNil(n)&&0<n._rowCount)return a(!0,n.Name);if(!l.default.isNil(r)&&0<r._rowCount)return a(!0,r.Name);if(!l.default.isNil(i)&&0<i._rowCount)return a(!0,i.Name)}return a(!1,null)}return a(!1,null)}},{key:"MemWarning",value:function(e){v.default.warnToDevConsole(e)}},{key:"processFileInputHandle",value:function(e,t,a){var n=e.file,r="WebFileReader"===e.type();if(null!=n){var i=function(e){"function"==typeof a&&a("Error with filereader: "+e.target.error.message),setTimeout((function(){throw e.target.error}),0)},o=e.preferredWidth||(0,T.getMaxImageResolution)();if(r||o===b.NO_RESIZE_WIDTH){var l=new FileReader;l.onloadend=function(e){t(e.target.result)},l.onerror=i,l.readAsDataURL(n)}else try{$.canvasResize(n,{width:o,height:0,crop:!1,quality:90,callback:function(e){t(e)},onError:i,disableSubsamplingDetection:M.dynamicRollouts.includeByOwnerId("DisableSubsamplingDetectionInCanvasResize")})}catch(e){"function"==typeof a&&a("An error occurred during image resize: "+e.toString())}}else t((0,A.missingImageError)("The selected image could not be found."))}},{key:"makeFileInputHandle",value:function(e,t,a){var n=String(Math.floor(1e6*Math.random()+1)),r=y.ImageHandle.from({type:t?"WebFileReader":"WebImageReader",value:n,preferredWidth:a});return r.setFileInput(e),r}},{key:"registerUploadRequest",value:function(e,t){t&&e&&("function"==typeof this.awaitingUploadRequests[e]?(this.awaitingUploadRequests[e](t),delete this.awaitingUploadRequests[e]):this.uploadRequests[e]=t)}},{key:"unregisterUploadRequest",value:function(e){var t=this.uploadRequests;e&&setTimeout((function(){delete t[e]}),6e4)}},{key:"awaitUploadRequest",value:function(e,t){var a=this.uploadRequests[e];a?(t(a),delete this.uploadRequests[e]):this.awaitingUploadRequests[e]=t}},{key:"finishImageRead",value:function(e,t){e?t?t.value()?"function"==typeof e.CallbackFn&&e.CallbackFn(t):v.default.ReportError({errorMessage:"finishImageRead was called with null imageHandle.value"}):v.default.ReportError({errorMessage:"finishImageRead was called with null imageHandle"}):v.default.ReportError({errorMessage:"finishImageRead was called with null uploadRequest"})}},{key:"processImage",value:function(e,t,a){var n,r=this;if(e.isBlank())t("");else{var i=function(a,n){if(a&&!a.startsWith(A.UNABLE_TO_LOAD_IMAGE_PREFIX))return n||r.setCachedImage(e,a),void t(a);var i=r.getCachedImage(e);i?(v.default.ReportError({errorMessage:"Common.imageCache avoided losing an image",imageHandleType:e.type()}),t(i)):t(a)};switch(e.type()){case"WebFileReader":case"WebImageReader":var o=k.AppGlobals.AppModel.GetFromImageCache(e.value());o?i(o,!0):this.processFileInputHandle(e,i,a);break;case"Url":case"Data":i(null!==(n=e.value())&&void 0!==n?n:"");break;case"IOS":A.JeeneeBrowserAPI.getBase64DataIOS(e,i);break;case"Android":A.JeeneeBrowserAPI.getBase64DataAndroid(e,i)}}}},{key:"setCachedImage",value:function(e,t){e=y.ImageHandle.from(e);var a=(0,g.getAppModel)().inDynamicRolloutByOwnerId("ClientSkipCommonImageCache");switch(e.type()){case"IOS":case"Android":a||(this.imageCache[e.value()]=t);break;case"Data":case"Url":break;case"WebFileReader":case"WebImageReader":a||(this.imageCache[e.value()]=t),k.AppGlobals.AppModel.AddToImageCache(e.value(),t)}}},{key:"getCachedImage",value:function(e){e=y.ImageHandle.from(e);var t=this.imageCache[e.value()];if(t)return t;switch(e.type()){case"IOS":case"Android":case"Data":case"Url":break;case"WebFileReader":case"WebImageReader":return k.AppGlobals.AppModel.GetFromImageCache(e.value())}return null}}]),e}();t.Common=u=new P},422339:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultProvider=void 0,t.initializeDefaultProvider=function(){JeeneeNamespace.DefaultProvider=f};var r=n(a(689728)),i=n(a(856690)),o=n(a(190644)),l=n(a(571524)),u=n(a(593186)),s=a(431335),c=n(a(496486)),d=a(166089),f=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this._get=function(e,t,a,n,r){$.getJSONUnsigned(e,t,(function(t,n){c.default.isNil(t)||!t.LoginRequired?c.default.isFunction(a)&&a(t,n):d.AppGlobals.AppState.SwitchToLoginPage(t.LoginProvider," GET from "+e+" response indicates that login is required")}),(function(e,t){c.default.isFunction(n)&&n(e,t)}),r)},this._post=function(e,t,a,n){$.postJSON(e,t,(function(t){c.default.isNil(t)||!t.LoginRequired?c.default.isFunction(a)&&a(t):d.AppGlobals.AppState.SwitchToLoginPage(t.LoginProvider," POST to "+e+" response indicates that login is required")}),(function(e,t){c.default.isFunction(n)&&n(e,t)}))},this._postPromise=function(e,a){return new Promise((function(n,r){t._post(e,a,n,(function(e,t){var a=new Error(e);a.statusCode=t,r(a)}))}))},this.ReadTable=function(e,a,n,r,i,l,u,f){var p,h,v=null!==(h=null===(p=null===o.default||void 0===o.default?void 0:o.default.lastPosition)||void 0===p?void 0:p.coords)&&void 0!==h?h:{},m=v.latitude,g=v.longitude,y=null!=m&&null!=g?o.default.stringifyLatLng(m,g):null,b=d.AppGlobals.AppModel?d.AppGlobals.AppModel.GetUserSettings(e):null,T={providerName:r,tableName:n,nestedPath:l,tzOffset:(new Date).getTimezoneOffset(),locale:navigator.languages?navigator.languages[0]:navigator.language,settings:b?JSON.stringify(b):null,version:a,location:y},S=d.AppGlobals.AppModel.FindTable(n),A=encodeURIComponent(e),w="/api/template/".concat(A,"/tableV2");t._get(w,T,(function(e,t){if(304===t)"function"==typeof u&&u(n,S.Rows,S.Timestamp,S.ETag);else if(c.default.isNil(e))c.default.isFunction(f)&&f("Empty table");else if(e.Success){var a=s.CSV.parse(e.DataSet);"function"==typeof u&&u(c.default.isNil(i)?n:i,a,e.Timestamp)}else c.default.isFunction(f)&&f(e.ErrorDescription)}),(function(e,t){c.default.isFunction(f)&&f(e,t)}),(function(e){c.default.isNil(S)||e.setRequestHeader("If-Modified-Since",S.Timestamp)}))},this.makeQueryString=function(e){var t,a=d.AppGlobals.AppModel,n=o.default&&o.default.lastPosition||{},r=o.default?o.default.stringifyLatLng(n.lat,n.lng):null;a&&"function"==typeof a.NeedsUsageScopesConsent&&a.NeedsUsageScopesConsent()&&(r="");var i=e.userSettings||(a&&"function"==typeof a.GetUserSettings?a.GetUserSettings():null),u=l.default&&l.default.IsIFramePreview(),s="?tzOffset="+(new Date).getTimezoneOffset()+"&settings="+encodeURIComponent(JSON.stringify(i))+"&apiLevel="+((null==a?void 0:a.API_LEVEL)||1)+"&isPreview="+u+"&checkCache="+!!e.checkCache+"&locale="+(navigator.languages?navigator.languages[0]:navigator.language)+"&location="+encodeURIComponent(r)+"&appTemplateVersion="+e.appVersion+"&localVersion="+((null===(t=null==a?void 0:a.AppTemplate)||void 0===t?void 0:t.Version)||"")+"&timestamp="+encodeURIComponent(e.timestamp||"")+"&requestStartTime="+encodeURIComponent((new Date).toISOString())+"&lastSyncTime="+encodeURIComponent(a&&"function"==typeof a.lastSuccessfulSyncTime&&a.lastSuccessfulSyncTime()||"")+"&appStartTime="+encodeURIComponent(window.APP_START_TIME||"")+"&dataStamp="+encodeURIComponent((null==a?void 0:a.DataStamp)||"")+"&clientId="+(a&&"function"==typeof a.GetClientId&&a.GetClientId()||"")+"&build="+window.AppSheetJSBuild+"&requestId="+e.requestId;return e.mechanism&&(s+="&mechanism="+encodeURIComponent(e.mechanism)),e.viewName&&(s+="&viewName="+encodeURIComponent(e.viewName)),e.actionName&&(s+="&actionName="+encodeURIComponent(e.actionName)),e.syncToken&&(s+="&syncToken="+encodeURIComponent(e.syncToken)),s},this.AddTableRow=function(e,a,n,r,i){u.default.AddTraceContext("DefaultDataProvider.AddTableRow",{requestId:a.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(a.tableName)+"/row"+t.makeQueryString(a),n,r,i)},this.UpdateTableRow=function(e,a,n,r,i){u.default.AddTraceContext("DefaultDataProvider.UpdateTableRow",{requestId:a.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(a.tableName)+"/row/update"+t.makeQueryString(a),n,r,i)},this.DeleteTableRow=function(e,a,n,r,i){u.default.AddTraceContext("DefaultDataProvider.DeleteTableRow",{requestId:a.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(a.tableName)+"/row/delete"+t.makeQueryString(a),n,r,i)},this.RecordRecoveryData=function(e,a){var n="/api/template/".concat(encodeURIComponent(e),"/recovery");return t._postPromise(n,a)}}));t.DefaultProvider=f},796326:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_ERROR_MESSAGE=void 0,t.getAjaxErrorString=l,t.initializeJsonHelpers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onAjaxResult,a=void 0===t?function(e){}:t,n=e.onPostResult,r=void 0===n?function(e){}:n,u=e.isConnected,s=void 0===u?function(){return!0}:u,c=e.autoDisconnect,d=void 0===c?function(){}:c;function f(e,t){$.getJSONUnsigned("/api/refreshtoken",null,(function(t){window.VerifiedAjaxPostToken=t.token,e()}),t)}$.getJSONUnsigned=function(e,t,n,r,u){if(s()){var c=OneTrackProtocol+"//"+OneTrackHost+e;$.ajax({url:c,dataType:"json",data:t,beforeSend:u,success:function(e,t,r){a(e),"function"==typeof n&&n(e,r.status)},error:function(t,n,u){if(a(t),"function"==typeof r){var s=l(t,n,u);s===o&&d(),r(s,t.status)}i.default.ReportJqueryAjaxError("get",e,t,n,u)}})}else"function"==typeof r&&r("Not connected")},$.postJSONAsync=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Promise((function(i){$.postJSON(e,t,(function(e,t){return i({success:!0,response:e,httpStatus:t})}),(function(e,t){return i({success:!1,responseText:e,httpStatus:t})}),a,n,r)}))},$.postJSON=function(e,t,a,n,u){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(s()){var h=OneTrackProtocol+"//"+OneTrackHost+e;window.verifiedAjaxPost({url:h,type:"post",processData:!1,data:JSON.stringify(t),timeout:3e5,contentType:"application/json",beforeSend:u,success:function(i,o,l){(null==i?void 0:i.TokenIsInvalid)&&0===c?f((function(){$.postJSON(e,t,a,n,u,c+1,p)}),n):(r(i),"function"==typeof a&&a(i,l.status))},error:function(r,s,f){if("function"==typeof n){var h=l(r,s,f);if(h===o){if(2===p){var v=null!=r?r:{},m=v.readyState,g=v.status,y=v.statusText;i.default.ReportError({errorMessage:"NETWORK_ERROR",textStatus:s,errorThrown:f,readyState:m,status:g,statusText:y,tokenRetryCount:c,networkErrorRetryCount:p})}if(p<2)return void setTimeout((function(){$.postJSON(e,t,a,n,u,c,p+1)}),1e3);d()}else i.default.ReportJqueryAjaxError("post",e,r,s,f);n(h,r.status)}}})}else"function"==typeof n&&n("Not connected")}},t.isSuccessResponse=t.isFailureResponse=void 0,t.printableJSON=function e(t,a){var n="";if(null==t)return n;if(a>3)return"";"object"===(0,r.default)(t)?(n+="{ \n",$.each(t,(function(t,r){n+=u(a)+String(t)+":\t"+e(r,a+1)+"\n"})),n+=u(a)+" } \n"):n+=null!=t&&"function"==typeof t.substring?t.substring(0,500):t;return n};var r=n(a(918698)),i=n(a(593186));t.isSuccessResponse=function(e){return!0===e.success};t.isFailureResponse=function(e){return!1===e.success};var o="Network error. Please check connectivity and try again.";t.NETWORK_ERROR_MESSAGE=o;function l(e,t,a){return null!=e.responseText&&e.responseText.length>0?e.responseText:"timeout"===a?"__:Connection timed out. Please wait a moment and try again.":null!=a&&a.length>0&&"error"!==a?"__:"+a:null!=t&&t.length>0&&"error"!==t?"__:"+t:o}function u(e){for(var t="",a=0;a<e;a++)t+="\t";return t}},249633:(e,t,a)=>{"use strict";var n=a(564836),r=a(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.UserSettings=t.NativeProvider=t.AppSuggestions=t.AppSettings=void 0,t.initializeNativeProvider=function(){JeeneeNamespace.NativeProvider=T};var i=n(a(689728)),o=n(a(856690)),l=n(a(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(593186)),s=n(a(150198)),c=a(318926),d=a(804758),f=a(149313),p=a(714067);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}function v(e,t){var a;if(null===(a=null==e?void 0:e.AppTemplate)||void 0===a?void 0:a.AppData){var n=e.AppTemplate.AppData.DataSets;return l.default.find(n,t)}}function m(e,t){var a={};return t.forEach((function(t){var n=new s.default(t),r=e[t.Name],i=n.valueFromWireFormat(r);a[t.Name]=i})),a}var g=(0,i.default)((function e(t){var a=this;(0,o.default)(this,e),this._appWithoutPreview=null,this._suggestionsTableDefn=function(){return v(a._appModel,(function(e){return"native"===e.ProviderName&&"_Internal_SuggestionsTable"===e.Name}))},this._suggestionsSchema=function(){var e=a._suggestionsTableDefn();return e?a._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return a._appModel&&a._suggestionsTableDefn()&&a._suggestionsSchema()},this.HasTable=function(e){var t=a._suggestionsTableDefn();return a._isValid()&&t.Name===e},this.Update=function(e){if(a._isValid()){var t=e.tableName,n=e.row,r=e.oldRow,i=a._suggestionsTableDefn(),o=a._suggestionsSchema();if(t===i.Name){(0,f.$TSFixMeMaybeNull)(o);var l=m(n,o.Attributes),u=m(r,o.Attributes),s=!u.Accepted&&l.Accepted,c=!u.Previewing&&l.Previewing,d=!u.Rejected&&l.Rejected;s?a._acceptSuggestion(n):c?a._previewSuggestion(n):d&&a._rejectSuggestion(n)}}},this._getNonPreviewApp=function(){return l.default.cloneDeep(a._appWithoutPreview||a._appModel.AppTemplate)},this._updateSettings=function(e){e.Presentation.Controls.forEach((function(e){e.Settings=JSON.stringify(e.ViewDefinition)}))},this._rejectSuggestion=function(e){var t=a._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("reject",t.Descriptor.Category));var n=a._getNonPreviewApp();a._appModel.setAppTemplate(n)},this._acceptSuggestion=function(e){var t=a._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("accept",t.Descriptor.Category));var n=a._getNonPreviewApp();t.Commands.forEach((function(e){a._applyCommand(e,n)})),a._updateSettings(n),a._appModel.setAppTemplate(n),a._appWithoutPreview=l.default.cloneDeep(n)},this._previewSuggestion=function(e){var t=a._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("preview",t.Descriptor.Category)),a._appWithoutPreview||(a._appWithoutPreview=l.default.cloneDeep(a._appModel.AppTemplate));var n=a._getNonPreviewApp();t.Commands.forEach((function(e){a._applyCommand(e,n)})),a._updateSettings(n),a._appModel.setAppTemplate(n)},this._getSuggestion=function(e){var t=e.SerializedSuggestion;try{return JSON.parse(t)}catch(t){return a._reportError("Failed to deserialize commands for "+e.SuggestionId),{Commands:[],Descriptor:{}}}},this._applyCommand=function(e,t){var n,r=e.Type,i=e.Path.ExpressionString,o=a._getValue(e);switch(r){case"ADD":if(n=l.default.get(t,i),!l.default.isArray(n))return void a._reportError("Expected array at '"+i+"'");n.push(o);break;case"CHANGE":l.default.set(t,i,o);break;default:a._reportError("Unexpected command type: "+r)}},this._getValue=function(e){if(!e)return null;var t=e.Value;if(!t)return t;var a=t.$type;return a&&String(a).startsWith("System.Collections.Generic.List")?t.$values:t},this._reportError=function(e){u.default.ReportError({errorMessage:e})},this._appModel=t}));t.AppSuggestions=g;var y=(0,i.default)((function e(t,a){var n=this;(0,o.default)(this,e),this._settingsTableDefn=function(){return v(n._appModel,(function(e){return"native"===e.ProviderName&&e.Name&&e.Name.startsWith("Settings_")}))},this._settingsSchema=function(){var e=n._settingsTableDefn();return e?n._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return n._appModel&&n._settingsTableDefn()&&n._settingsSchema()},this._objectPathCols=function(){var e=n._settingsSchema();return(0,f.$TSFixMeMaybeNull)(e),l.default.chain(e.Attributes).filter((function(e){return e.Name.endsWith("_ObjectPath")})).keyBy((function(e){return e.Name.replace("_ObjectPath","")})).value()},this._objectValueCols=function(){var e=n._settingsSchema();return(0,f.$TSFixMeMaybeNull)(e),l.default.chain(e.Attributes).filter((function(e){return e.Name.endsWith("_ObjectValue")})).keyBy((function(e){return e.Name.replace("_ObjectValue","")})).value()},this.HasTable=function(e){return n._isValid()&&e===n._settingsTableDefn().Name},this.Update=function(e){if(n._isValid()){var t=n._getSettingsChanges(e);n._stateReflector.ChangeAndRedisplay(t,!1,!0)}},this._getSettingsChanges=function(e){var t=e.row,a=n._appModel,r=n._objectPathCols(),i=n._objectValueCols();return l.default.keys(r).map((function(e){var n,o=r[e],l=i[e],u=t[l.Name],c=new s.default(l);if("Ref"===l.Type){var d=c.referencedTableName(),p=a.findTableCollection(d),h=p.table,v=p.tableSchema,m=h&&h.findRow(u);if(m)(0,f.$TSFixMeMaybeNull)(v),n=v.findAttributeByName("ObjectValue").valueFromWireFormat(m.ObjectValue)}else n=c.valueFromWireFormat(u);return{ObjectPath:t[o.Name],ObjectValue:n}}))},this._appModel=t,this._stateReflector=a||window.StateReflector}));t.AppSettings=y;var b=(0,i.default)((function e(t,a){var n=this;(0,o.default)(this,e),this._settingsTableDefn=function(){return v(n._appModel,(function(e){return"native"===e.ProviderName&&e.Name&&e.Name.startsWith(p.userSettingsTableName)}))},this._settingsSchema=function(){var e=n._settingsTableDefn();return e?n._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return n._appModel&&n._settingsTableDefn()&&n._settingsSchema()},this.HasTable=function(e){return n._isValid()&&e===n._settingsTableDefn().Name},this.Update=function(e){n._isValid()&&(n._localUserSettings=e.row,e.nextSteps.immediateSync=!0,e.nextSteps.enqueueChanges=!1)},this._appModel=t,this._stateReflector=a||window.StateReflector}));t.UserSettings=b;var T=(0,i.default)((function e(t){var a=this;(0,o.default)(this,e),this.Name="native",this._getTableManager=function(e){return l.default.find(a._tableManagers,(function(t){return t&&"function"==typeof t.HasTable&&t.HasTable(e)}))},this.OnLocalUpdateRow=function(e){if(e){e.tableName!==p.userSettingsTableName&&(0,u.doWeEverHitThis)("Unexpected native table update: ".concat(e.tableName));var t=a._getTableManager(e.tableName);return t?(e.nextSteps.updateAppTemplate=!0,t.Update(e)):void 0}},this.AppModel=t,this._tableManagers=[new y(t),new g(t),new b(t)]}));t.NativeProvider=T},946094:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.StatePropsThatDontImplyNavigation=t.StateModel=void 0,t.getPreviewAsEmail=function(){var e;try{if(null===(e=window.parent)||void 0===e?void 0:e.getPreviewAsEmail)return window.parent.getPreviewAsEmail();var t=(0,y.parseUrlQuery)();if(t.hasOwnProperty("previewAs"))return t.previewAs}catch(e){}return""},t.initializeStateModel=function(){JeeneeNamespace.StateModel=Q,JeeneeNamespace.Controllers=[]};var r=n(a(238416)),i=n(a(856690)),o=n(a(689728)),l=n(a(600861)),u=n(a(496486)),s=n(a(836808)),c=a(672023),d=n(a(571524)),f=n(a(180818)),p=n(a(112368)),h=n(a(593186)),v=n(a(143249)),m=n(a(365914)),g=n(a(498967)),y=a(646317),b=n(a(343625)),T=n(a(888861)),S=n(a(150198)),A=n(a(962553)),w=a(319598),C=a(307827),E=a(714067),k=a(263198),R=a(351101),I=a(75212),O=n(a(190644)),M=a(892148),N=a(166089),_=a(149313),D=a(557310),L=a(783252),P=a(864510);t.StatePropsThatDontImplyNavigation=["RowKey","selected","FilterExpr","UserDefinedFilters","UserDefinedFilterExpression"];var x={PAGE_PARAM:"page",TABLE_PARAM:"table",ROW_PARAM:"row",FILTER_PARAM:"filter",USER_DEFINED_FILTERS_PARAM:"userfilters",DEFAULTS_PARAM:"defaults",SORT_PARAM:"sort",GROUP_PARAM:"group",SELECTED_PARAM:"selected",QUICKEDIT_PARAM:"quickedit",VFE_FOCUSCOLUMN_PARAM:"vfe_focuscolumn",VFE_TIMESTAMP_PARAM:"vfe_ts",FreshControllerState:function(e){if(e||(e={}),e.TableName&&e.RefKeyAttr&&e.RefKeyValue){h.default.warnToDevConsole("View was initialized with RefKeyAttr/RefKeyValue, something needs migrating",e);var t=N.AppGlobals.AppModel.FindTableDefinition(e.TableName);if(!t)return;var a=N.AppGlobals.AppModel.FindSchema(t.SchemaName);if(!a)return;var n=a.Attributes.find((function(t){var a;return t&&t.IsValid&&t.Name.toLowerCase()===(null===(a=e.RefKeyAttr)||void 0===a?void 0:a.toLowerCase())}));e.FilterExpr=T.default.createColFilter(e.RefKeyValue,a,n?new S.default(n):void 0)}if(e.SortAttr&&!e.SortBy){h.default.warnToDevConsole("View was initialized with SortAttr, (likely the apptemplate is using old view options) ",e);var r=A.default.findByName(e.TableName).tableSchema;if(!r)return;var i=g.default.findSortInfo(r,e.SortAttr);(null==i?void 0:i.attribute)&&i.attribute.name()&&(e.SortBy=[{Column:i.attribute.name(),Order:i.inverted?"Descending":"Ascending"}])}return e.ItemId&&(e.RowKey=e.ItemId),e.isPopulated=!1,u.default.pick(e,["TableName","RowKey","FilterExpr","DefaultValues","GroupBy","SortBy","isPopulated"])},HashStateToControllerState:function(e,t){if("_table"in e&&(t.TableName=e._table),"_row"in e&&(t.RowKey=e._row),"_filterExpr"in e)try{var a=JSON.parse(e._filterExpr);t.FilterExpr=T.default.create(a)}catch(e){}if("_groupBy"in e)try{t.GroupBy=JSON.parse(e._groupBy)}catch(e){}if("_sortBy"in e)try{t.SortBy=JSON.parse(e._sortBy)}catch(e){}if(this.TABLE_PARAM in e&&(t.TableName=e[this.TABLE_PARAM]),this.ROW_PARAM in e&&(t.RowKey=e[this.ROW_PARAM]),this.SELECTED_PARAM in e)try{t.selected=JSON.parse(e[this.SELECTED_PARAM])}catch(e){}var n=[];if(this.FILTER_PARAM in e)try{var r=JSON.parse(e[this.FILTER_PARAM]);n.push(T.default.create(r))}catch(e){}if(this.USER_DEFINED_FILTERS_PARAM in e&&"dashboard"!==e[this.PAGE_PARAM])try{t.UserDefinedFilters=JSON.parse(e[this.USER_DEFINED_FILTERS_PARAM]);var i=(0,w.getFilterQuery)(null==t?void 0:t.Root,null==t?void 0:t.TableName,null==t?void 0:t.UserDefinedFilters).toExpression();n.push(i),t.UserDefinedFilterExpression=i}catch(e){h.default.ReportError({errorMessage:"Error in HashStateToControllerState",error:e})}if(t.FilterExpr=T.default.createAnd.apply(T.default,n),this.DEFAULTS_PARAM in e)try{var o=JSON.parse(e[this.DEFAULTS_PARAM]);t.DefaultValues=o}catch(e){}if(this.GROUP_PARAM in e)try{t.GroupBy=JSON.parse(e[this.GROUP_PARAM])}catch(e){}if(this.SORT_PARAM in e)try{t.SortBy=JSON.parse(e[this.SORT_PARAM])}catch(e){}if(this.QUICKEDIT_PARAM in e)try{t.QuickEdit=JSON.parse(e[this.QUICKEDIT_PARAM])}catch(e){}if(this.VFE_FOCUSCOLUMN_PARAM in e)try{t.vfeFocusColumn=e[this.VFE_FOCUSCOLUMN_PARAM]}catch(e){}if(this.VFE_TIMESTAMP_PARAM in e)try{t.vfeTimestamp=e[this.VFE_TIMESTAMP_PARAM]}catch(e){}},ControllerStateToHashState:function(e,t){var a;null!=e.TableName&&(t[this.TABLE_PARAM]=e.TableName),null!=e.RowKey&&(t[this.ROW_PARAM]=e.RowKey),null!=e.selected&&(t[this.SELECTED_PARAM]=e.selected);var n=e.FilterExpr,r=e.UserDefinedFilterExpression;if(null!=r&&null!=n){var i=null!==(a=n.children)&&void 0!==a?a:[];e.UserDefinedFilterExpression.isEqualTo(n)?n=null:"AND"===n.BoolType&&i.length&&(n=T.default.createAnd.apply(T.default,(0,l.default)(i.filter((function(e){return!e.isEqualTo(r)})))))}Array.isArray(e.UserDefinedFilters)&&e.UserDefinedFilters.length>0&&(t[this.USER_DEFINED_FILTERS_PARAM]=JSON.stringify(e.UserDefinedFilters)),null!=n&&(t[this.FILTER_PARAM]=JSON.stringify(n)),null!=e.DefaultValues&&(t[this.DEFAULTS_PARAM]=JSON.stringify(e.DefaultValues)),null!=e.GroupBy&&(t[this.GROUP_PARAM]=JSON.stringify(e.GroupBy)),null!=e.SortBy&&(t[this.SORT_PARAM]=JSON.stringify(e.SortBy)),null!=e.QuickEdit&&(t[this.QUICKEDIT_PARAM]=JSON.stringify(e.QuickEdit)),null!=e.vfeFocusColumn&&(t[this.VFE_FOCUSCOLUMN_PARAM]=e.vfeFocusColumn),null!=e.vfeTimestamp&&(t[this.VFE_TIMESTAMP_PARAM]=e.vfeTimestamp)},PopulateControllerStateFromControl:function(e,t,a){if(t&&(t.isPopulated=!0,e)){var n=N.AppGlobals.AppModel.NavStateForView(e,t.TableName);n&&(t.TableName||(t.TableName=n.TableName),t.TableName===n.TableName&&(t.RowKey||(t.RowKey=n.RowKey),t.FilterExpr||(t.FilterExpr=n.FilterExpr),t.GroupBy||(t.GroupBy=n.GroupBy),t.SortBy||(t.SortBy=n.SortBy),"function"==typeof a&&a(n)))}}},F="card",G="table",V="dashboard",B="search",U="deck",H="gallery",W="slideshow",j="detail",q="chart",Y="form",z="calendar",K="onboarding",J="iframe",Q=function(){function e(){var t;(0,i.default)(this,e),this.STATE_CHANGE_FORWARD=1,this.STATE_CHANGE_BACKWARD=2,this.CHANGE_MODE_PUSH="push",this.CHANGE_MODE_PUSH_RETAIN_SEARCH="push-retain-search",this.CHANGE_MODE_REPLACE="replace",this.CHANGE_MODE_REPLACE_BACK="replaceback",this.CHANGE_MODE_RESET="reset",this.SHOW_DRILLDOWN=F,this.SHOW_FASTTABLE=G,this.SHOW_DASHBOARD=V,this.SHOW_SEARCH=B,this.SHOW_DECK=U,this.SHOW_GALLERY=H,this.SHOW_SLIDESHOW=W,this.SHOW_DETAIL=j,this.SHOW_MAP="map",this.SHOW_CHART=q,this.SHOW_FORM=Y,this.SHOW_CALENDAR=z,this.SHOW_ONBOARDING=K,this.SHOW_IFRAME=J,this.CloseAfterNextSync=!1,this.GuestUserInformation={Id:0,Name:"Guest",AuthUserId:"guest",AuthUserEmail:"guest",AuthSource:"native",UserRole:"User"},this.SamplesUserInformation={Id:1,Name:"Justin A. Sample",AuthUserId:"sample",AuthUserEmail:"justin@sample.com",AuthSource:"native",UserRole:"User"},this.ControllerLookup=(t={},(0,r.default)(t,F,"card"),(0,r.default)(t,G,"fastTable"),(0,r.default)(t,V,"dashboard"),(0,r.default)(t,U,"deck"),(0,r.default)(t,H,"gallery"),(0,r.default)(t,W,"detail"),(0,r.default)(t,j,"detail"),(0,r.default)(t,"map","google-map"),(0,r.default)(t,q,"graph"),(0,r.default)(t,Y,"form"),(0,r.default)(t,B,"search"),(0,r.default)(t,z,"calendar"),(0,r.default)(t,K,"onboarding"),(0,r.default)(t,J,"iframe"),t),this.KnownStates={},this.NavigationStack=[],this.InvokingAppArray=[{displayName:"App Gallery",appName:E.APP_GALLERY_NAME,appId:E.APP_GALLERY_ID}],this.DefaultStateDefinition=x,this.ForceWipeUserData=!1,this.ForceRefreshAppDefinition=!1,this.UserInformation=void 0,this.CurrentUIState=void 0,this.AppTemplate=void 0,this.inAppStartup=!1,this.freshAppTemplateLoad=!1,this.removePageParameterRollout=!1,this.ReadUserInfoFromUStore(),void 0!==window.OTURLParams.wipe&&(this.ForceWipeUserData=!0),void 0!==window.OTURLParams.refresh&&(this.ForceRefreshAppDefinition=!0);for(var a=0;a<JeeneeNamespace.Controllers.length;a++){var n=JeeneeNamespace.Controllers[a];if(null==n)throw new Error("Invalid controller "+a);this.KnownStates[n.Name]=new n.StateDefinition}this.GoogleMapStateDef=this.KnownStates[this.ControllerLookup[this.SHOW_MAP]]}return(0,o.default)(e,[{key:"isLegacyAuthSource",value:function(){return"linkedin"===this.UserInformation.AuthSource||"native"===this.UserInformation.AuthSource}},{key:"getPreviousNavigationStackItem",value:function(){if(this.NavigationStack.length>=2){var e=this.NavigationStack[this.NavigationStack.length-2];return this.ParseStateFromHash(e.HashState)}return null}},{key:"getPreviousGroupByArray",value:function(e){return e&&(null==e?void 0:e.FastTableUIState)?e.FastTableUIState.GroupBy:null}},{key:"getPreviousGroupByColumnName",value:function(e){e||(e=this.getPreviousNavigationStackItem());var t=this.getPreviousGroupByArray(e);return t&&t.length>0?t[0].Column:null}},{key:"GetLastRunApp",value:function(){var e=b.default.getItem("LastRunApp");return null!=e&&""!==e&&"null"!==e?e:null}},{key:"SetLastRunApp",value:function(e){b.default.setItem("LastRunApp",e)}},{key:"Initialize",value:function(e,t){this.ReadUserInfoFromUStore(),N.AppGlobals.ViewManager.Clear(this.PreviousUIState),this.PreviousUIState=this.CurrentUIState,this.CurrentUIState={AppTemplateName:e},N.AppGlobals.ViewManager.Clear(this.PreviousUIState),this.PreviousUIState={},this.NavigationStack=[],this.AppTemplate={Name:e,Version:t},this.inAppStartup=!0}},{key:"SetDataContext",value:function(e){this.NavigationStack&&this.NavigationStack.length>0?this.NavigationStack[this.NavigationStack.length-1].DataContext=e:h.default.logToDevConsole("Setting data context with an empty nav stack!")}},{key:"DebugPrint",value:function(){var e="\t AppTemplate:: "+(this.AppTemplate&&this.AppTemplate.Name);return e+="\t UserInfo:: Id= "+this.UserInformation.Id+"\n",e+="\t UIState:: "+JSON.stringify(this.CurrentUIState)+"\n",e+="\t Location:: "+M.WindowWrapper.location+"\n"}},{key:"SetActiveControl",value:function(e,t,a){if(null!=e){"slideshow"===e.Action&&(e.Action="detail");var n=(0,R.getAppModel)(),r=n.FindTable(e.TableOrFolderName);if(null!=r){N.AppGlobals.AppState.ActiveControl=e;var i=t(e,n.NavStateForView(e,r.Name));"form"===e.Action||a?N.AppGlobals.AppState.PushState(i):N.AppGlobals.AppState.ResetState(i)}}}},{key:"AugmentCurrentState",value:function(e,t){var a=this.NavigationStack.length;if(a>0){var n=this.NavigationStack[a-1],r=this.ParseHash(n.HashState);r[e]!==t&&(r[e]=t,n.HashState=(0,y.sortedParams)(r),this.SetLocationHash(n.HashState,N.AppGlobals.AppState.CHANGE_MODE_REPLACE))}}},{key:"AugmentCurrentStateWithSearch",value:function(e,t){t=t||{};var a=this.NavigationStack.length;if(a>0){var n=this.NavigationStack[a-1],r=this.ParseHash(n.HashState);r.search!==e&&(r.search=e,n.HashState=(0,y.sortedParams)(r),t.updateHash&&this.SetLocationHash(n.HashState,N.AppGlobals.AppState.CHANGE_MODE_REPLACE))}}},{key:"GetCurrentStateSelection",value:function(){var e=this.NavigationStack.length;if(e>0){var t=this.NavigationStack[e-1],a=this.ParseHash(t.HashState).selected;if(!a)return null;try{return JSON.parse(a)}catch(e){return null}}return null}},{key:"AugmentCurrentStateWithSelection",value:function(e){var t=this.NavigationStack.length;if(t>0){var a=this.NavigationStack[t-1],n=this.ParseHash(a.HashState);n.selected=JSON.stringify(e);var r=(0,y.sortedParams)(n);this.SetLocationHash(r,N.AppGlobals.AppState.CHANGE_MODE_REPLACE)}}},{key:"ChoosePreviousState",value:function(e){this.StateChangeDirection=this.STATE_CHANGE_BACKWARD;var t=N.AppGlobals.AppState.CurrentUIState.Root;this.NavigationStack.pop();var a=this.NavigationStack[this.NavigationStack.length-1],n=(null==a?void 0:a.HashState)||"",r=this.ParseHash(n),i=r.page;if(""!==n&&(null!=i&&"empty"!==i||r.view))a.AppTemplateName!==N.AppGlobals.AppModel.AppTemplate.Name?this.PushState({Root:"empty"}):(a.scrollTop&&(this.restoreScrollPosition=a.scrollTop),this.SetWindowHash(a.HashState));else if("form"===t)if(e)this.ActiveControl=null,this.ResetState({});else{var o,l,u,s,c;N.AppGlobals.AppModel.AppTemplate.Presentation.Controls.filter((function(e){return e.IsValid&&"form"!==e.Action&&null!=N.AppGlobals.AppModel.DisplayActions[e.Action]})).forEach((function(e){e.Name===N.AppGlobals.AppModel.AppTemplate.Presentation.DefaultStartView&&(o=e),e.Position===N.AppGlobals.AppModel.POSITION_LEFT&&(l=e),e.Position===N.AppGlobals.AppModel.POSITION_RIGHT&&(u=e),e.Position===N.AppGlobals.AppModel.POSITION_CENTER&&(s=e),e.Position===N.AppGlobals.AppModel.POSITION_MENU&&(c=e)}));var d=o||l||u||s||c;d?N.AppGlobals.AppState.SetActiveControl(d,InputHandler.rootStateForControl):(this.ActiveControl=null,this.ResetState({Root:"empty"}))}else this.ActiveControl=null,this.ResetState({Root:"empty"})}},{key:"ComputeStringHash",value:function(e){return c.sha256.hmac("1234567890",""+e).substr(0,6)}},{key:"InvokingAppVisibilityMode",value:function(){var e,t=u.default.last(this.InvokingAppArray);return(null==t?void 0:t.appId)!==E.APP_GALLERY_ID?"visible":d.default.IsEditorIFramePreview()?"disabled":p.default.IsWhitelabelBrowser()||(null===(e=N.AppGlobals.AppModel)||void 0===e?void 0:e.IsWhitelabelApp())?"hidden":"visible"}},{key:"SwitchToLoginPage",value:function(e,t,a){if(t&&h.default.logToDevConsole("Switching to login page: "+t),d.default.IsIFrame())h.default.ReportErrorOnce({errorMessage:"Unexpected SwitchToLoginPage from iframe preview"});else{this.ClearUserInfoInUStore(),window.QuiesceApp=!0,null!=N.AppGlobals.ViewManager&&N.AppGlobals.ViewManager.ShowLoginInfoPage();var n=this.GetLocationHash();n.indexOf("mainprotocol")<0&&(null!=n&&""!==n&&(n+="&"),n+="_mainprotocol="+OneTrackProtocol);var r="?returnUrl="+encodeURIComponent(M.WindowWrapper.location.pathname+M.WindowWrapper.location.search);null!=e&&e.length>0&&(r+="&provider="+e),a&&(r+="&appId="+a),null!=p.default.IsIOSAppWithMinVersion&&p.default.IsIOSAppWithMinVersion(6.3)&&k.JeeneeBrowserAPI.clearCookiesIOS(),null!=p.default.IsAndroidAppWithMinVersion&&p.default.IsAndroidAppWithMinVersion(6.4)&&!d.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.clearCookies(),O.default.removeAllListeners(),M.WindowWrapper.location.href="//"+M.WindowWrapper.location.host+"/Account/Login"+r+"#"+n}}},{key:"SaveUserInfoToUStore",value:function(){if(1!==this.UserInformation.Id){var e=new Date,t=m.default.addDays(e,28),a={UserInfo:this.UserInformation,ExpiryTime:t},n=JSON.stringify(a);b.default.setItem("JeeneeUserInfo",n)}}},{key:"SaveUserRole",value:function(e){this.UserInformation.UserRole=e,null!=(0,P.readUserInfoFromCookie)()?(0,P.updateUserInfoCookie)(this.UserInformation):this.SaveUserInfoToUStore()}},{key:"ReadUserInfoFromUStore",value:function(){var e=(0,P.readUserInfoFromCookie)();if(null==e){var t=b.default.getItem("JeeneeUserInfo");if(null==t||""===t||"null"===t){var a=s.default.get("STARTWITHTOKEN");if(a){var n=(0,y.parseQuery)(a);this.UserInformation={Id:n.id,Name:n.name,AuthUserId:n.email,AuthUserEmail:n.email,AuthSource:"native"}}else this.SetGuestUser()}else{var r=JSON.parse(t);null!=r.UserInfo.AuthTokenExpiryTime&&(r.UserInfo.AuthTokenExpiryTime=new Date(r.UserInfo.AuthTokenExpiryTime+" UTC")),this.UserInformation=r.UserInfo}}else this.UserInformation=e}},{key:"SetGuestUser",value:function(){this.UserInformation=this.GuestUserInformation}},{key:"SetSamplesUser",value:function(){this.UserInformation=this.SamplesUserInformation}},{key:"ClearUserInfoInUStore",value:function(){b.default.setItem("JeeneeUserInfo",null),this.DeleteCookie()}},{key:"IsAuthenticatedUser",value:function(e){var t=this.UserInformation;return null!=t&&"Id"in t&&"Name"in t&&"AuthUserId"in t&&"AuthUserEmail"in t&&(0!==t.Id||!e)}},{key:"DeleteCookie",value:function(){s.default.remove(""),(0,P.removeUserInfoCookie)()}},{key:"GetLocationHash",value:function(){return this.ExtractHashFromUrl(M.WindowWrapper.location.href)}},{key:"ExtractHashFromUrl",value:function(e){return e.split("#")[1]||""}},{key:"SetCurrentTemplate",value:function(e){this.AppTemplate.Id!==e.Id&&(this.AppTemplate.Id=e.Id),this.AppTemplate.Name!==e.Name&&(this.AppTemplate.Name=e.Name)}},{key:"LogUserIdentity",value:function(e){try{if(0!==this.UserInformation.Id){var t=e.Behavior.AuthRequired?this.UserInformation.Id.toString():null;null!=f.default.LogNewUser&&f.default.LogNewUser(t),t?f.default.identify(t,{$email:this.UserInformation.AuthUserEmail,$last_login:new Date,$name:this.UserInformation.Name,$username:this.UserInformation.Id,AuthSource:this.UserInformation.AuthSource,AuthUserId:this.UserInformation.AuthUserEmail}):null!=f.default.ForgetUserIdentity&&f.default.ForgetUserIdentity(null)}}catch(e){h.default.warnToDevConsole(e)}}},{key:"OnAppTemplateLoad",value:function(e){h.default.AddTraceContext("AppState.OnAppTemplateLoad",{Id:e.Id,Name:e.Name}),this.inAppStartup=!1,this.freshAppTemplateLoad=!0,this.LogUserIdentity(e),this.SetCurrentTemplate(e),this.removePageParameterRollout=v.default.get("removePageParameter").includeByOwner(e),C.onAppTemplateLoadCallbacks.run()}},{key:"SetLocationHash",value:function(e,t){var a,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.freshAppTemplateLoad&&(this.freshAppTemplateLoad=!1),this.inAppStartup)this.inAppStartup=!1;else{var r={HashState:e,AppTemplateName:N.AppGlobals.AppModel.AppTemplate.Name};if("reset"===t||0===this.NavigationStack.length)this.NavigationStack=[r];else if(t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE||t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK)this.NavigationStack[this.NavigationStack.length-1]=r;else{var i,o,l=$(".ActivePage").data("reactView");if((null===(a=null==l?void 0:l.component)||void 0===a?void 0:a.getScrollContainer)&&(o=null==(i=l.component.getScrollContainer())?void 0:i.scrollTop),o){var u=this.NavigationStack[this.NavigationStack.length-1];u&&(u.scrollTop=o)}this.NavigationStack.push(r)}}this.StateChangeDirection=t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK?this.STATE_CHANGE_BACKWARD:this.STATE_CHANGE_FORWARD,n&&this.SetWindowHash(e)}},{key:"SetWindowHash",value:function(e){if(d.default.IsIFramePreview()){var t=(null===parent||void 0===parent?void 0:parent.window)?parent.window.pageYOffset:0;M.WindowWrapper.location.replace(M.WindowWrapper.location.href.split("#")[0]+"#"+e),(null===parent||void 0===parent?void 0:parent.window)&&parent.window.scrollTo(parent.window.pageXOffset,t)}else M.WindowWrapper.location.hash=e}},{key:"ComputeHash",value:function(e){var t,a,n={},r=e;if(null!=r){null==r.Root||this.removePageParameterRollout&&null!=r.ControlName||(n.page=r.Root),null!=r.ControlName&&(n.view=r.ControlName),null!=r.AppTemplateName&&(n.appName=r.AppTemplateName),null!=r.SearchTerm&&(n.search=r.SearchTerm),null!=r.MinDataStamp&&(n.at=r.MinDataStamp);var i=null===(t=this.GetSpecificState(r))||void 0===t?void 0:t.UserDefinedFilters;null!=i&&(n[this.DefaultStateDefinition.USER_DEFINED_FILTERS_PARAM]=JSON.stringify(i));var o=N.AppGlobals.AppState.KnownStates[r.Root];void 0!==o?"function"==typeof o.FillStateObject&&o.FillStateObject(r,n):D.ReactRootUIConfig.isReactRoot()&&x.ControllerStateToHashState(null!==(a=r[L.SPECIFIC_STATE_NAME_MAP[r.Root]])&&void 0!==a?a:{},n)}return(0,y.sortedParams)(n)}},{key:"MutateState",value:function(e,t,a,n){if(null==this.UserInformation||null==this.UserInformation.Id)return alert("Unauthenticated user ---- cannot proceed. Login as a valid user."),void this.SwitchToLoginPage(null,"user information not available",this.AppTemplate.Id);t===N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH&&(e.SearchTerm=N.AppGlobals.AppState.CurrentUIState.SearchTerm,t=N.AppGlobals.AppState.CHANGE_MODE_PUSH),e.SearchTerm||StateReflector.EndSearch(!0);var r=this.CurrentUIState?this.GetSpecificState(this.CurrentUIState):null,i=e?this.GetSpecificState(e):null,o=(null==r?void 0:r.TableName)===(null==i?void 0:i.TableName),l=Boolean((null==r?void 0:r.UserDefinedFilters)&&!(null==i?void 0:i.UserDefinedFilters)),u="dashboard"===(null==e?void 0:e.Root);o&&l&&i&&!u&&(i.UserDefinedFilters=null==r?void 0:r.UserDefinedFilters),e.AppTemplateName=this.AppTemplate.Name;var s=this.ComputeHash(e);this.ChangeRawUrlHash(s,t,a)}},{key:"PushState",value:function(e,t){this.MutateState(e,t?N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH:N.AppGlobals.AppState.CHANGE_MODE_PUSH)}},{key:"ReplaceState",value:function(e,t){this.MutateState(e,t?N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK:N.AppGlobals.AppState.CHANGE_MODE_REPLACE)}},{key:"ResetState",value:function(e,t){this.MutateState(e,N.AppGlobals.AppState.CHANGE_MODE_RESET,t)}},{key:"PushViewForResult",value:function(e,t,a,n,r,i,o){var l=this.NavigationStack[this.NavigationStack.length-1];l&&(l.pendingResult={context:e,requestId:t}),this.PushView(a,n,r,i,o)}},{key:"ReturnResult",value:function(e){var t=this.NavigationStack[this.NavigationStack.length-2];if(null==t?void 0:t.pendingResult){var a=t.pendingResult.context;a&&"function"==typeof a.onPushViewResult&&a.onPushViewResult(t.pendingResult.requestId,e),delete t.pendingResult}}},{key:"PushView",value:function(e,t,a,n,r,i){var o=i||(n?N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH:N.AppGlobals.AppState.CHANGE_MODE_PUSH);if(a.TableName){var l=r;if(!l){var u=N.AppGlobals.AppModel.FindControlsForTable(a.TableName,e,t);u.length&&(l=u[0])}if(l){var s=N.AppGlobals.AppModel.FindTable(a.TableName);if(s){var c=N.AppGlobals.AppModel.NavStateForView(l,s.Name),d=this.ExtendAppState(c,a),f=InputHandler.rootStateForControl(l,d);return void this.MutateState(f,o)}}var p=N.AppGlobals.AppState.KnownStates[e].CreateRootState(a);this.MutateState(p,o)}else h.default.warnToDevConsole("No TableName was given to MutateView",a)}},{key:"ExtendAppState",value:function(e,t){var a=u.default.pick(t,["ItemId","GroupBy","SortBy","FilterExpr","DefaultValues","CurrentLat","CurrentLng","RefKeyAttr","RefKeyValue","RowKey","detailContentColumn"]);return u.default.extend(u.default.clone(t),e,a)}},{key:"IsTopLevel",value:function(){return this.NavigationStack.length<=1}},{key:"ChangeRawUrlHash",value:function(e,t,a){this.GetLocationHash()!==e?this.SetLocationHash(e,t,a):$("#header").trigger("staterefresh")}},{key:"ResetCurrentUIState",value:function(){var e=this.GetLocationHash(),t=this.SetCurrentUIStateFromHash(e),a=(0,R.getAppModel)();if(e&&!this.NavigationStack.length){var n={HashState:e,AppTemplateName:a.AppTemplate.Name};this.NavigationStack=[n]}return t}},{key:"ParseHash",value:function(e){return(0,I.parseHash)(e)}},{key:"SetCurrentUIStateFromHash",value:function(e){return this.PreviousUIState=this.CurrentUIState,e?(this.CurrentUIState=this.ParseStateFromHash(e),this.CurrentUIState):null}},{key:"ParseStateFromHash",value:function(e){var t={};if(!e)return null;var a=this.ParseHash(e);if(t.Hash=e,t.DataStamp=AppModel.DataStamp,null!=a.view?t.ControlName=a.view:null!=a.control?t.ControlName=a.control:null!=a._control&&(t.ControlName=a._control),t.Root=a.page,null!=a._page&&(t.Root=a._page),"slideshow"===t.Root&&(t.Root="detail"),a.table&&!t.ControlName){var n=N.AppGlobals.AppModel.FindControlsForTable(a.table,t.Root,!1);"map"===t.Root&&a.mapcolumn&&(n=n.filter((function(e){var t=N.AppGlobals.AppModel.appTemplate.getViewDefinition(e.Name);return!!t&&(a.mapcolumn===t.MapColumn||a.table===t.SecondaryTable&&a.mapcolumn===t.SecondaryColumn)}))),n.length&&(t.ControlName=n[0].Name)}if(!t.Root&&(t.Root=this.SHOW_FASTTABLE,t.ControlName)){var r=N.AppGlobals.AppModel.FindControl(t.ControlName);r&&((0,_.$TSFixMeMaybeNull)(r.Action),t.Root=this.ControllerLookup[r.Action])}t.Root&&this.ControllerLookup[t.Root]&&(t.Root=this.ControllerLookup[t.Root]),t.SearchTerm=a.search,null!=a._searchTerm&&(t.SearchTerm=a._searchTerm),null!=a.appName&&(t.AppTemplateName=a.appName),null!=a._appName&&(t.AppTemplateName=a._appName),null!=a.at&&(t.MinDataStamp=a.at);var i=N.AppGlobals.AppState.KnownStates[t.Root];return void 0!==i&&("function"==typeof i.ResetUIState&&i.ResetUIState(t),"function"==typeof i.ProcessStateObject&&i.ProcessStateObject(t,a)),t}},{key:"GetSpecificState",value:function(e){var t,a=N.AppGlobals.AppState.KnownStates[null!==(t=e.Root)&&void 0!==t?t:""];return void 0!==a&&"function"==typeof a.GetSpecificState?a.GetSpecificState(e):null}},{key:"SetPendingFormState",value:function(e,t){this.pendingFormState=e,this.pendingFormCancelFn=t}},{key:"ClearPendingFormState",value:function(){delete this.pendingFormState,delete this.pendingFormCancelFn}}]),e}();t.StateModel=Q},276585:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.batch=function(e,t){var a,n=this,u=[],s=t.minSize||1,c=t.wait||0,d=function(){return l(n,void 0,void 0,r.default.mark((function n(){var o,l;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=u,u=[],n.prev=2,n.next=5,e.apply(void 0,[o].concat((0,i.default)(a)));case 5:n.next=12;break;case 7:if(n.prev=7,n.t0=n.catch(2),(l=u).push.apply(l,(0,i.default)(o)),t.dontThrow){n.next=12;break}throw n.t0;case 12:case"end":return n.stop()}}),n,null,[[2,7]])})))},f=d,p=o.default.throttle(d,c,{leading:!1});function h(){0===c?f():p.flush()}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o;(a=n,Array.isArray(e))?(o=u).push.apply(o,(0,i.default)(e)):u.push(e);0!==c&&p(),u.length>=s&&h()}return v.flush=h,v};var r=n(a(364687)),i=n(a(600861)),o=n(a(496486)),l=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))}},390678:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"batch",{enumerable:!0,get:function(){return n.batch}});var n=a(276585)},419638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JS_VERSION=t.JS_BUILD=t.COMMIT_HASH=void 0;var a={COMMIT_HASH:"dummycommithash",JS_VERSION:"".concat(Date.now(),"-test"),JS_BUILD:"dummyjsbuild"},n=(a={COMMIT_HASH:"1839ac8e0f1855cba44740dcb44cf595b73ed0be",JS_VERSION:"'20230403'.1",JS_BUILD:"aaaaaaaaaaaaaaaaaaaa-1680615695803-1839ac8e"}).COMMIT_HASH;t.COMMIT_HASH=n;var r=a.JS_VERSION;t.JS_VERSION=r;var i=a.JS_BUILD;t.JS_BUILD=i},399713:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Drz=void 0,t.getDrz=function(){if("eu.appsheet.com"===r.WindowWrapper.location.hostname)return n.EU;return n.GLOBAL};var n,r=a(892148);t.Drz=n,function(e){e.EU="EU",e.GLOBAL="GLOBAL"}(n||(t.Drz=n={}))},287375:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setModals=t.setModalInProgress=t.pushModal=t.popModal=t.clearModalsUntil=t.ModalSettingsActionTypes=void 0;var a={PUSH_MODAL:"PUSH_MODAL",POP_MODAL:"POP_MODAL",SET_MODALS:"SET_MODALS",SET_MODAL_IN_PROGRESS:"SET_MODAL_IN_PROGRESS",CLEAR_MODALS_UNTIL:"CLEAR_MODALS_UNTIL"};t.ModalSettingsActionTypes=a;t.pushModal=function(e){return Object.assign({type:a.PUSH_MODAL},e)};t.popModal=function(){return{type:a.POP_MODAL}};t.setModals=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{modals:[]},t=e.modals;return{type:a.SET_MODALS,modals:t}};t.clearModalsUntil=function(e){return{type:a.CLEAR_MODALS_UNTIL,predicate:e}};t.setModalInProgress=function(e){return{type:a.SET_MODAL_IN_PROGRESS,value:e}}},235049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoConnect=function(){a=!0},t.autoDisconnect=function(){a=!1},t.isConnected=function(){return a};var a=!0},84690:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeHref=function(e){if(function(e){return/^[^:]*([/?#]|$)/.test(e)}(e=(e||"").trim()))return e;var t=e.indexOf(":"),a=e.slice(0,t).toLowerCase();if(!a||/[^a-z]/.test(a)||i.has(a))return"http"+e.slice(t);o.has(a)||r.default.ReportErrorOnce({errorMessage:"Unknown scheme in sanitizeHref",scheme:a,href:e});return e};var r=n(a(593186));var i=new Set(["javascript"]),o=new Set(["comgooglemapsurl","deapp","http","https","intent","mailto","oneqa","sms","tel","whatsapp"])},149313:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$TSFixMeMaybeNull=function(e){}},882901:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.addIsOpen=function(e,t){var a;return Object.assign(Object.assign({},e),{isOpen:(null===(a=r.default.get(t,e._path,{}))||void 0===a?void 0:a.isOpen)||!1})};var r=n(a(496486))},244306:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.getRunTaskSummary=t.getCardSummaryForNode=t.getCardSummaryForEvent=void 0;var r=n(a(600861)),i=a(729633),o=n(a(496486)),l=a(772414),u=n(a(540554)),s=function(e){if(!e)return"";var t;switch(null==e?void 0:e.Type){case"Email":var a=e;if(t=a.TableName?a.TableName:"No Table",a.ToList&&a.ToList.length>0){var n="";a.ToList.forEach((function(e){e&&(n+=("="===e.charAt(0)?e.slice(1):e)+", ")})),n&&(t+=" / To: "+n.slice(0,-2))}"EmbeddedAppView"===a.EmailType?a.ViewName&&(t+=" / View: "+a.ViewName):a.Subject&&(t+=" / Subject: "+a.Subject);break;case"Notification":var r=e;if(t=r.TableName?r.TableName:"No Table",r.ToList&&r.ToList.length>0){var i="";r.ToList.forEach((function(e){e&&(i+=("="===e.charAt(0)?e.slice(1):e)+", ")})),i&&(t+=" / To: "+i.slice(0,-2))}break;case"SMS":var l=e;if(t=l.TableName?l.TableName:"No Table",l.ToList&&l.ToList.length>0){var u="";l.ToList.forEach((function(e){e&&(u+=("="===e.charAt(0)?e.slice(1):e)+", ")})),u&&(t+=" / To: "+u.slice(0,-2))}break;case"Webhook":var s=e;t=s.TableName?s.TableName:"No Table",t+=s.Preset?" / "+s.Preset:"",t+=s.AsyncExec?" / Run asynchronously":"";break;case"MakeDoc":var c=e;t=c.TableName?c.TableName:"No Table",t+=c.ContentType?" / "+o.default.startCase(c.ContentType.toLowerCase()):"";break;case"AppsScript":var d=e;t=d.TableName?d.TableName:"No Table",t+=d.ScriptId?" / "+d.ScriptId:"",t+=d.FunctionName?" / "+d.FunctionName:"";break;case"Chat":var f=e;t=f.TableName?f.TableName:"No Table",t+=f.SpaceIdList&&f.SpaceIdList.length>0?" / Chat space":"",t+=f.ViewName?" / View: "+f.ViewName:"";break;default:t="Define the actions at this step"}return t};t.getRunTaskSummary=s;var c=function(e,t){var a,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=function(e){return e?e.map((function(e){return"".concat(e.ColumnToEdit," ").concat((null==e?void 0:e.NewColumnValue)?null==e?void 0:e.NewColumnValue:"")})):[]};if((0,l.isRunActionNode)(t)&&i){var s="",c=e.getProcessForNode(i);(null==c?void 0:c.InputSchemaName)&&(s=null!==(n=null===(a=e.tableForSchema(null==c?void 0:c.InputSchemaName))||void 0===a?void 0:a.Name)&&void 0!==n?n:"");var d=e.findDataAction(t.Action,s);if(d)return[o.default.startCase(o.default.toLower(d.ActionType.replace("_"," "))),d.Table?d.Table:""].concat((0,r.default)(["SET_COLUMN_VALUE","ADD_RECORD_TO"].includes(d.ActionType)?u(d.ActionDefinition.Assignments):[])).join(" / ")}return""};t.getCardSummaryForNode=function(e,t){var a,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t){if((0,l.isRunTaskNode)(t))return s(e.entityByName(i.TemplatePath.Tasks,t.Task));var u;switch(t.NodeType){case"WAIT":var d=t;u="WaitForCondition"===d.WaitNodeType?"Wait for a condition"+(d.Condition?" / "+("="===d.Condition.charAt(0)?d.Condition.slice(1):d.Condition):""):"Wait for a period"+(d.Period?" / "+("="===d.Period.charAt(0)?d.Period.slice(1):d.Period):"");break;case"RUN_ACTION":""===(u=c(e,t,r))&&(u="Define the actions at this step");break;case"IF_ELSE":var f=t;u="Branch on a condition"+(f.Condition?" / "+("="===f.Condition.charAt(0)?f.Condition.slice(1):f.Condition):"");break;case"CALL_PROCESS":var p=t,h=e.entityByName(i.TemplatePath.Processes,null==p?void 0:p.ProcessName);u=null==p.ProcessName?"Call a process":(null==p?void 0:p.ProcessName)+((null==h?void 0:h.InputSchemaName)?" / "+o.default.startCase(null===(a=null==p?void 0:p.CallMode)||void 0===a?void 0:a.toLowerCase()):"");break;case"RETURN":var v=t.ReturnValues;if(null==v||0===v.length)u="returns values";else{u="";for(var m=0;m<v.length&&m<3;m++)v[m].ColumnToEdit&&v[m].NewColumnValue&&(u+=v[m].ColumnToEdit+" = "+(null===(n=v[m].NewColumnValue)||void 0===n?void 0:n.slice(1))+", ");u=u.slice(0,-2)}break;case"CALL_PROCESS_FOR_EACH_ROW":var g=t;u=null==g?"Call a process for each row":"Call "+g.ProcessName+" for each row"+(g.Table?" / "+g.Table+(g.FilterCondition?" / "+g.FilterCondition.slice(1):""):"");break;default:u="Define the actions at this step"}return u}};t.getCardSummaryForEvent=function(e,t){if(e){var a="Define your event trigger";if("Scheduled"===(null==e?void 0:e.EventType)){var n=new u.default(e.AppEventDefinition.Schedule);switch(n.frequency){case"daily":a=o.default.startCase(n.frequency)+" / "+n.timeString();break;case"weekly":a=o.default.startCase(n.frequency);var r=n.daysOfWeekString();if(r.length>0){a+=" / "+r[0];for(var i=1;i<r.length;i++)a+=", "+r[i];a+=" / "+n.timeString()}break;case"monthly":a=o.default.startCase(n.frequency);var l=n.dayOfMonth();void 0!==l&&(a+=" / ","L"!==l.value&&"LW"!==l.value&&(a+="Day "),a+=l.label+" / "+n.timeString());break;case"monthlyByWeek":a=o.default.startCase(n.frequency);var s=n.whichWeekObject();if(void 0!==s){a+=" / "+s.label+" week";var c=n.daysOfWeekString();c.length>0&&(a+=" / "+c[0]+" / "+n.timeString())}}}else if("Change"===e.EventType)a=t+" / "+o.default.capitalize(o.default.toString(e.AppEventDefinition.ChangeEvent).replace(/_+/g," "));else if("Chat"===e.EventType){var d=e.AppEventDefinition;if("SLASH_COMMAND"===d.EventType){var f=d.SlashCommand;a=f&&f.Name?"via "+f.Name:"Slash command"}else a=o.default.capitalize(o.default.toString(d.EventType).replace(/_+/g," "))}return a}}},894002:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"UiEntityWithIsOpen",{enumerable:!0,get:function(){return r.UiEntityWithIsOpen}}),Object.defineProperty(t,"addIsOpen",{enumerable:!0,get:function(){return r.addIsOpen}}),Object.defineProperty(t,"getCardSummaryForEvent",{enumerable:!0,get:function(){return o.getCardSummaryForEvent}}),Object.defineProperty(t,"getCardSummaryForNode",{enumerable:!0,get:function(){return o.getCardSummaryForNode}}),Object.defineProperty(t,"getRunTaskSummary",{enumerable:!0,get:function(){return o.getRunTaskSummary}}),Object.defineProperty(t,"isEntityEmbedded",{enumerable:!0,get:function(){return i.isEntityEmbedded}}),Object.defineProperty(t,"openReferenceModal",{enumerable:!0,get:function(){return n.openReferenceModal}});var n=a(871198),r=a(882901),i=a(40011),o=a(244306)},871198:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openReferenceModal=void 0;var n=a(287375);t.openReferenceModal=function(e,t,a){a.length>0&&(e.stopPropagation(),t((0,n.pushModal)({component:"REFERENCE_LINKS_MODAL",subtitle:"The following processes and bots use this component. Edits to the component may break the following instances.",skipStyleReset:!0,hideHeaderCloseButton:!0,props:{references:a},modalProps:{maxWidth:"sm"}})))}},40011:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEntityEmbedded=void 0;t.isEntityEmbedded=function(e){return"LOCAL"===e||"PROCESS"===e}},239855:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.CalendarTodayIcon=void 0;var r=n(a(667294)),i=(0,a(697211).createSvgIcon)(r.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},r.default.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),r.default.createElement("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"})),"CalendarTodayIcon");t.CalendarTodayIcon=i},596179:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DateRangeIcon=void 0;var r=n(a(667294)),i=(0,a(697211).createSvgIcon)(r.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},r.default.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),r.default.createElement("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM8 11c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4 0c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4 0c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"})),"DateRangeIcon");t.DateRangeIcon=i},188709:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.EventAvailableIcon=void 0;var r=n(a(667294)),i=(0,a(697211).createSvgIcon)(r.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},r.default.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),r.default.createElement("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zm-3.4-9.4L17 12l-5.99 6-4-4 1.4-1.4 2.6 2.6 4.59-4.6z"})),"EventAvailableIcon");t.EventAvailableIcon=i},532499:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.TodayIcon=void 0;var r=n(a(667294)),i=(0,a(697211).createSvgIcon)(r.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},r.default.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),r.default.createElement("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 9.5c-1.38 0-2.5 1.12-2.5 2.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5S10.38 9.5 9 9.5z"})),"TodayIcon");t.TodayIcon=i},729633:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.TemplatePath=void 0,t.TemplatePath=a,function(e){e.Bots="Behavior.AppBots",e.DataActions="AppData.DataActions",e.Events="Behavior.AppEvents",e.FormatRules="Presentation.FormatRules",e.OcrModels="Behavior.AppOcrModels",e.PredictiveModels="Behavior.AppPredictiveModels",e.Processes="Behavior.AppProcesses",e.Schemas="AppData.DataSchemas",e.Slices="AppData.TableSlices",e.Tables="AppData.DataSets",e.Tasks="Behavior.Tasks",e.UserRoles="UserRoles",e.Views="Presentation.Controls",e.WorkflowRules="Behavior.AppWorkflowRules"}(a||(t.TemplatePath=a={}))},449977:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.protoTransportProvider=t.batchSendMonitoringData=t.MonitoringClient=void 0;var r=n(a(364687)),i=n(a(496486)),o=a(579911),l=a(390678),u=a(419638),s=a(462790),c=n(a(593186)),d=a(998182),f=a(635672),p=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function l(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}u((n=n.apply(e,t||[])).next())}))},h=function(e){return function(t,a,n){var r=e.url,i=o.base64.stringify(a);(0,f.ajaxPost)(r,i,{headers:{Accept:"text/proto-base64","Content-Type":"text/proto-base64"},timeout:(null==e?void 0:e.timeout)||0}).then((function(e){var t=o.base64.parse(e);n(null,t)})).catch((function(e){n(e,null)}))}};t.protoTransportProvider=h;var v=s.MonitoringProto.FrontendMonitoringService.create(h({url:"/api/monitoring/collect"}));t.MonitoringClient=v;var m=(0,l.batch)((function(e,t){return p(void 0,void 0,void 0,r.default.mark((function a(){var n,o,l,f,p,h,m;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e&&0!==e.length){a.next=2;break}return a.abrupt("return",s.MonitoringProto.CollectMonitoringDataResponse.create({}));case 2:n=s.MonitoringProto.MonitoringSourceType.MONITORING_SOURCE_TYPE_UNKNOWN,a.t0=t.source,a.next="editor"===a.t0?6:8;break;case 6:return n=s.MonitoringProto.MonitoringSourceType.EDITOR,a.abrupt("break",8);case 8:return o={appId:t.appId,pageLoadSessionId:t.pageLoadSessionId,sourceType:n},l=i.default.groupBy(e,(function(e){return e.key})),f=i.default.mapValues(l,(function(e){return e.map((function(e){return e.value}))})),(p=i.default.merge(o,f)).commitHash=u.COMMIT_HASH,p.counterMetricEvents&&(p.counterMetricEvents=(0,d.aggregateCounters)(p.counterMetricEvents)),h=s.MonitoringProto.CollectMonitoringDataRequest.create(p),c.default.logToDevConsole("FrontendMonitoring request-",h),a.prev=16,a.next=19,v.collectMonitoringData(h);case 19:return a.abrupt("return",a.sent);case 22:a.prev=22,a.t1=a.catch(16),null!=a.t1&&(m="Error thrown by monitoring client",c.default.logToDevConsole(m,a.t1),c.default.ReportErrorOnce({errorMessage:m,request:JSON.stringify(h),err:a.t1}));case 25:return a.abrupt("return",s.MonitoringProto.CollectMonitoringDataResponse.create({}));case 26:case"end":return a.stop()}}),a,null,[[16,22]])})))}),{minSize:25,wait:5e4});t.batchSendMonitoringData=m},998182:(e,t,a)=>{"use strict";var n=a(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DistributionMetric=t.CounterMetric=void 0,t.aggregateCounters=function(e){var t,a=e.reduce((function(e,t){var a=t.name,n=t.value,r=t.labels;(0,s.assert)(null!=a),(0,s.assert)(null!=n),(0,s.assert)(null!=r);var i=e.get(a);void 0===i&&(i=new Map,e.set(a,i));var o,l=((o=new URLSearchParams(r)).sort(),o.toString()),u=i.get(l);return void 0===u&&(u=0),i.set(l,u+n),e}),new Map),n=[],r=c(a.entries());try{for(r.s();!(t=r.n()).done;){var i,u=(0,o.default)(t.value,2),d=u[0],f=c(u[1].entries());try{for(f.s();!(i=f.n()).done;){var h=(0,o.default)(i.value,2),v=h[0],m=h[1],g=p(v);n.push(l.MonitoringProto.CounterMetricEvent.create({name:d,value:m,labels:g}))}}catch(e){f.e(e)}finally{f.f()}}}catch(e){r.e(e)}finally{r.f()}return n},t.getMetricCount=function(){return f};var r=n(a(856690)),i=n(a(689728)),o=n(a(627424)),l=a(462790),u=a(449977),s=a(766333);function c(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var f=0;function p(e){return Object.fromEntries(new URLSearchParams(e))}var h=function(){function e(t){(0,r.default)(this,e),this.name=t,++f}return(0,i.default)(e,[{key:"record",value:function(e){!function(e,t){(0,u.batchSendMonitoringData)({key:"counterMetricEvents",value:l.MonitoringProto.CounterMetricEvent.create({name:e,labels:t,value:1})},{})}(this.name,null!=e?e:{})}}]),e}();t.CounterMetric=h;var v=function(){function e(t){(0,r.default)(this,e),this.name=t,f+=2}return(0,i.default)(e,[{key:"record",value:function(e,t){!function(e,t,a){(0,u.batchSendMonitoringData)({key:"distributionMetricEvents",value:l.MonitoringProto.DistributionMetricEvent.create({name:e,labels:a,value:t})},{})}(this.name,e,null!=t?t:{})}}]),e}();t.DistributionMetric=v},458279:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appStartsMetric=t.appStartMsMetric=t.appBootstrapMsMetric=void 0;var n=a(998182),r=new n.CounterMetric("app_starts");t.appStartsMetric=r;var i=new n.DistributionMetric("app_bootstrap_ms");t.appBootstrapMsMetric=i;var o=new n.DistributionMetric("app_start_ms");t.appStartMsMetric=o},599185:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterTimeMetric=void 0;var n=new(a(998182).DistributionMetric)("filter_time");t.filterTimeMetric=n},435113:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchTimeMetric=void 0;var n=new(a(998182).DistributionMetric)("search_time");t.searchTimeMetric=n},5206:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncTimeMetric=t.syncStalenessMetric=t.syncCountMetric=t.recordSyncMetrics=void 0;var n=a(998182),r=new n.DistributionMetric("sync_time");t.syncTimeMetric=r;var i=new n.DistributionMetric("sync_staleness");t.syncStalenessMetric=i;var o=new n.CounterMetric("sync_count");t.syncCountMetric=o;t.recordSyncMetrics=function(e,t,a){o.record(a),r.record(Date.now()-e.getTime(),a),t&&i.record(Date.now()-t,a)}},637491:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wasmLatencyMetric=t.recordWasmLatency=void 0;var n=new(a(998182).DistributionMetric)("wasm_latency");t.wasmLatencyMetric=n;t.recordWasmLatency=function(e,t){var a=performance.now()-e;n.record(a,t)}},79837:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wasmLoadMetric=void 0;var n=new(a(998182).DistributionMetric)("wasm");t.wasmLoadMetric=n},926794:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wasmMemoryUsageMbMetric=void 0;var n=new(a(998182).DistributionMetric)("wasm_memory_usage_mb");t.wasmMemoryUsageMbMetric=n},354632:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"appBootstrapMsMetric",{enumerable:!0,get:function(){return n.appBootstrapMsMetric}}),Object.defineProperty(t,"appStartMsMetric",{enumerable:!0,get:function(){return n.appStartMsMetric}}),Object.defineProperty(t,"appStartsMetric",{enumerable:!0,get:function(){return n.appStartsMetric}}),Object.defineProperty(t,"filterTimeMetric",{enumerable:!0,get:function(){return i.filterTimeMetric}}),Object.defineProperty(t,"recordSyncMetrics",{enumerable:!0,get:function(){return s.recordSyncMetrics}}),Object.defineProperty(t,"searchTimeMetric",{enumerable:!0,get:function(){return r.searchTimeMetric}}),Object.defineProperty(t,"syncCountMetric",{enumerable:!0,get:function(){return s.syncCountMetric}}),Object.defineProperty(t,"syncStalenessMetric",{enumerable:!0,get:function(){return s.syncStalenessMetric}}),Object.defineProperty(t,"syncTimeMetric",{enumerable:!0,get:function(){return s.syncTimeMetric}}),Object.defineProperty(t,"wasmLatencyMetric",{enumerable:!0,get:function(){return u.wasmLatencyMetric}}),Object.defineProperty(t,"wasmLoadMetric",{enumerable:!0,get:function(){return o.wasmLoadMetric}}),Object.defineProperty(t,"wasmMemoryUsageMbMetric",{enumerable:!0,get:function(){return l.wasmMemoryUsageMbMetric}});var n=a(458279),r=a(435113),i=a(599185),o=a(79837),l=a(926794),u=a(637491),s=a(5206)},161171:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionSettingsOption=void 0,t.ExpressionSettingsOption=a,function(e){e[e.Legacy=0]="Legacy",e[e.Consistent=1]="Consistent"}(a||(t.ExpressionSettingsOption=a={}))},506871:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.NumberDivisionOption=void 0,t.NumberDivisionOption=a,function(e){e[e.Number=0]="Number",e[e.Decimal=1]="Decimal"}(a||(t.NumberDivisionOption=a={}))},417751:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateModeEnum=void 0,t.UpdateModeEnum=a,function(e){e[e.READ_ONLY=0]="READ_ONLY",e[e.UPDATES_ONLY=1]="UPDATES_ONLY",e[e.ADDS_ONLY=2]="ADDS_ONLY",e[e.ADDS_AND_UPDATES=3]="ADDS_AND_UPDATES",e[e.DELETES_ONLY=4]="DELETES_ONLY",e[e.UPDATES_AND_DELETES=5]="UPDATES_AND_DELETES",e[e.ADDS_AND_DELETES=6]="ADDS_AND_DELETES",e[e.ALL_CHANGES=7]="ALL_CHANGES",e[e.UNASSIGNED=8]="UNASSIGNED"}(a||(t.UpdateModeEnum=a={}))},222820:()=>{"use strict";!function(e){var t="canvasResize",a={newsize:function(e,t,a,n,r){var i=r?"h":"";if(a&&e>a||n&&t>n){var o=e/t;(o>=1||0===n)&&a&&!r?(e=a,t=a/o>>0):r&&o<=a/n?(e=a,t=a/o>>0,i="w"):(e=n*o>>0,t=n)}return{width:e,height:t,cropped:i}},dataURLtoBlob:function(e){for(var t=e.split(",")[0].split(":")[1].split(";")[0],a=atob(e.split(",")[1]),n=new ArrayBuffer(a.length),r=new Uint8Array(n),i=0;i<a.length;i++)r[i]=a.charCodeAt(i);var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return o?((o=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)).append(n),o.getBlob(t)):o=new Blob([n],{type:t})},detectSubsampling:function(e){var t=e.width;if(t*e.height>1048576){var a=document.createElement("canvas");a.width=a.height=1;var n=a.getContext("2d");return n.drawImage(e,1-t,0),0===n.getImageData(0,0,1,1).data[3]}return!1},rotate:function(e,t){var a={1:{90:6,180:3,270:8},2:{90:7,180:4,270:5},3:{90:8,180:1,270:6},4:{90:5,180:2,270:7},5:{90:2,180:7,270:4},6:{90:3,180:8,270:1},7:{90:4,180:5,270:2},8:{90:1,180:6,270:3}};return a[e][t]?a[e][t]:e},transformCoordinate:function(e,t,a,n){switch(n){case 5:case 6:case 7:case 8:e.width=a,e.height=t;break;default:e.width=t,e.height=a}var r=e.getContext("2d");switch(n){case 1:default:break;case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,a),r.rotate(Math.PI);break;case 4:r.translate(0,a),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-a);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-a),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}},detectVerticalSquash:function(e,t,a){var n=document.createElement("canvas");n.width=1,n.height=a;var r=n.getContext("2d");r.drawImage(e,0,0);for(var i=r.getImageData(0,0,1,a).data,o=0,l=a,u=a;u>o;){0===i[4*(u-1)+3]?l=u:o=u,u=l+o>>1}var s=u/a;return 0===s?1:s},callback:function(e){return e}},n={width:300,height:0,crop:!1,quality:80,callback:a.callback,disableSubsamplingDetection:!1};function r(a,r){this.file=a,this.options=e.extend({},n,r),this._defaults=n,this._name=t,this.init()}r.prototype={init:function(){var t=this,n=this.file,r=new FileReader;r.onloadend=function(r){var i=r.target.result,o=new Image;o.onload=function(r){e(o).exifLoadFromDataURL((function(){var r=e(o).exif("Orientation")[0]||1,i=document.querySelector("img");i&&("from-image"===getComputedStyle(i).imageOrientation&&(r=1));var l=(r=a.rotate(r,t.options.rotate))>=5&&r<=8?a.newsize(o.height,o.width,t.options.width,t.options.height,t.options.crop):a.newsize(o.width,o.height,t.options.width,t.options.height,t.options.crop),u=o.width,s=o.height,c=l.width,d=l.height,f=document.createElement("canvas"),p=f.getContext("2d");p.save(),a.transformCoordinate(f,c,d,r),!t.options.disableSubsamplingDetection&&a.detectSubsampling(o)&&(u/=2,s/=2);var h=1024,v=document.createElement("canvas");v.width=v.height=h;for(var m=v.getContext("2d"),g=0;g<s;){for(var y=g+h>s?s-g:h,b=0;b<u;){var T=b+h>u?u-b:h;m.clearRect(0,0,h,h),m.drawImage(o,-b,-g);var S=Math.floor(b*c/u),A=Math.ceil(T*c/u),w=Math.floor(g*d/s/1),C=Math.ceil(y*d/s/1);p.drawImage(v,0,0,T,y,S,w,A,C),b+=h}g+=h}p.restore(),v=m=null;var E=document.createElement("canvas");E.width="h"===l.cropped?d:c,E.height="w"===l.cropped?c:d;var k="h"===l.cropped?.5*(d-c):0,R="w"===l.cropped?.5*(c-d):0;if(E.getContext("2d").drawImage(f,k,R,c,d),"image/png"===n.type)var I=E.toDataURL(n.type);else I=E.toDataURL("image/jpeg",.01*t.options.quality);t.options.callback(I,c,d)}))},o.src=i},"function"==typeof t.options.onError&&(r.onerror=t.options.onError),r.readAsDataURL(n)}},e[t]=function(e,t){if("string"==typeof e)return a[e](t);new r(e,t)}}(jQuery)},671734:(e,t,a)=>{"use strict";var n,r,i,o=a(564836)(a(918698));n=function(e,t,a){var n=e,r=t||0,i=0;this.getRawData=function(){return n},"string"==typeof e&&(i=a||n.length,this.getByteAt=function(e){return 255&n.charCodeAt(e+r)}),this.getLength=function(){return i},this.getSByteAt=function(e){var t=this.getByteAt(e);return t>127?t-256:t},this.getShortAt=function(e,t){var a=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return a<0&&(a+=65536),a},this.getSShortAt=function(e,t){var a=this.getShortAt(e,t);return a>32767?a-65536:a},this.getLongAt=function(e,t){var a=this.getByteAt(e),n=this.getByteAt(e+1),r=this.getByteAt(e+2),i=this.getByteAt(e+3),o=t?(((a<<8)+n<<8)+r<<8)+i:(((i<<8)+r<<8)+n<<8)+a;return o<0&&(o+=4294967296),o},this.getSLongAt=function(e,t){var a=this.getLongAt(e,t);return a>2147483647?a-4294967296:a},this.getStringAt=function(e,t){for(var a=[],n=e,r=0;n<e+t;n++,r++)a[r]=String.fromCharCode(this.getByteAt(n));return a.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))},this.toBase64=function(){return window.btoa(n)},this.fromBase64=function(e){n=window.atob(e)}},r=function(){function e(){var e=null;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e}function t(t,a,r,i,o,l){var u=e();if(u){var s=0;i&&!o&&(s=i[0]);var c=0;i&&(c=i[1]-i[0]+1),a&&(void 0!==u.onload?u.onload=function(){"200"==u.status||"206"==u.status||"0"==u.status?(this.binaryResponse=new n(this.responseText,s,c),this.fileSize=l||this.getResponseHeader("Content-Length"),a(this)):r&&r(),u=null}:u.onreadystatechange=function(){4==u.readyState&&("200"==u.status||"206"==u.status||"0"==u.status?(this.binaryResponse=new n(u.responseBody,s,c),this.fileSize=l||this.getResponseHeader("Content-Length"),a(this)):r&&r(),u=null)}),u.open("GET",t,!0),u.overrideMimeType&&u.overrideMimeType("text/plain; charset=x-user-defined"),i&&o&&u.setRequestHeader("Range","bytes="+i[0]+"-"+i[1]),u.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),u.send(null)}else r&&r()}return function(a,n,r,i){i?function(t,a,n){var r=e();r?(a&&(void 0!==r.onload?r.onload=function(){"200"==r.status?a(this):n&&n(),r=null}:r.onreadystatechange=function(){4==r.readyState&&("200"==r.status?a(this):n&&n(),r=null)}),r.open("HEAD",t,!0),r.send(null)):n&&n()}(a,(function(e){var o,l,u=parseInt(e.getResponseHeader("Content-Length"),10),s=e.getResponseHeader("Accept-Ranges");o=i[0],i[0]<0&&(o+=u),l=o+i[1]-1,t(a,n,r,[o,l],"bytes"==s,u)})):t(a,n,r)}}(),i={},function(){function e(e){return!!e.exifdata}function t(e){if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return!1;for(var t=2,a=e.getLength();t<a;){if(255!=e.getByteAt(t))return!1;var n=e.getByteAt(t+1);if(22400==n)return u(e,t+4,e.getShortAt(t+2,!0));if(225==n)return u(e,t+4,e.getShortAt(t+2,!0));t+=2+e.getShortAt(t+2,!0)}}function a(e,t,a,n,r){for(var i=e.getShortAt(a,r),o={},u=0;u<i;u++){var s=a+12*u+2,c=n[e.getShortAt(s,r)];o[c]=l(e,s,t,0,r)}return o}function l(e,t,a,n,r){var i=e.getShortAt(t+2,r),o=e.getLongAt(t+4,r),l=e.getLongAt(t+8,r)+a;switch(i){case 1:case 7:if(1==o)return e.getByteAt(t+8,r);for(var u=o>4?l:t+8,s=[],c=0;c<o;c++)s[c]=e.getByteAt(u+c);return s;case 2:var d=o>4?l:t+8;return e.getStringAt(d,o-1);case 3:if(1==o)return e.getShortAt(t+8,r);for(u=o>2?l:t+8,s=[],c=0;c<o;c++)s[c]=e.getShortAt(u+2*c,r);return s;case 4:if(1==o)return e.getLongAt(t+8,r);for(s=[],c=0;c<o;c++)s[c]=e.getLongAt(l+4*c,r);return s;case 5:if(1==o)return e.getLongAt(l,r)/e.getLongAt(l+4,r);for(s=[],c=0;c<o;c++)s[c]=e.getLongAt(l+8*c,r)/e.getLongAt(l+4+8*c,r);return s;case 9:if(1==o)return e.getSLongAt(t+8,r);for(s=[],c=0;c<o;c++)s[c]=e.getSLongAt(l+4*c,r);return s;case 10:if(1==o)return e.getSLongAt(l,r)/e.getSLongAt(l+4,r);for(s=[],c=0;c<o;c++)s[c]=e.getSLongAt(l+8*c,r)/e.getSLongAt(l+4+8*c,r);return s}}function u(e,t,n){if("Exif"!=e.getStringAt(t,4))return!1;var r,o=t+6;if(18761==e.getShortAt(o))r=!1;else{if(19789!=e.getShortAt(o))return!1;r=!0}if(42!=e.getShortAt(o+2,r))return!1;if(8!=e.getLongAt(o+4,r))return!1;var l=a(e,o,o+8,i.TiffTags,r);if(l.ExifIFDPointer){var u=a(e,o,o+l.ExifIFDPointer,i.Tags,r);for(var s in u){switch(s){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":u[s]=i.StringValues[s][u[s]];break;case"ExifVersion":case"FlashpixVersion":u[s]=String.fromCharCode(u[s][0],u[s][1],u[s][2],u[s][3]);break;case"ComponentsConfiguration":u[s]=i.StringValues.Components[u[s][0]]+i.StringValues.Components[u[s][1]]+i.StringValues.Components[u[s][2]]+i.StringValues.Components[u[s][3]]}l[s]=u[s]}}if(l.GPSInfoIFDPointer){var c=a(e,o,o+l.GPSInfoIFDPointer,i.GPSTags,r);for(var s in c)"GPSVersionID"===s&&(c[s]=c[s][0]+"."+c[s][1]+"."+c[s][2]+"."+c[s][3]),l[s]=c[s]}return l}i.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},i.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},i.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},i.getData=function(a,n){return!!a.complete&&(e(a)?n&&n():function(e,a){r(e.src,(function(n){console.log("BINARY",n.binaryResponse);var r=t(n.binaryResponse);e.exifdata=r||{},a&&a()}))}(a,n),!0)},i.getDataFromDataURL=function(a,r){return!!a.complete&&(e(a)?r&&r():function(e,a){var r=atob(e.src.split(",")[1]),i=t(new n(r,0,r.length));e.exifdata=i||{},a&&a()}(a,r),!0)},i.getTag=function(t,a){if(e(t))return t.exifdata[a]},i.getAllTags=function(t){if(!e(t))return{};var a=t.exifdata,n={};for(var r in a)a.hasOwnProperty(r)&&(n[r]=a[r]);return n},i.pretty=function(t){if(!e(t))return"";var a=t.exifdata,n="";for(var r in a)a.hasOwnProperty(r)&&("object"==(0,o.default)(a[r])?n+=r+" : ["+a[r].length+" values]\r\n":n+=r+" : "+a[r]+"\r\n");return n},i.readFromBinaryFile=function(e){return t(e)},jQuery((function(){for(var e,t,a,n=document.getElementsByTagName("img"),r=0;r<n.length;r++)"true"==n[r].getAttribute("exif")&&(n[r].complete?i.getData(n[r]):(e=n[r],t="load",a=function(){i.getData(this)},e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent&&e.attachEvent("on"+t,a)))})),jQuery.fn.exifLoad=function(e){return this.each((function(){i.getData(this,e)}))},jQuery.fn.exifLoadFromDataURL=function(e){return this.each((function(){return i.getDataFromDataURL(this,e),!0}))},jQuery.fn.exif=function(e){var t=[];return this.each((function(){t.push(i.getTag(this,e))})),t},jQuery.fn.exifAll=function(){var e=[];return this.each((function(){e.push(i.getAllTags(this))})),e},jQuery.fn.exifPretty=function(){var e=[];return this.each((function(){e.push(i.pretty(this))})),e}}()},674823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var a=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],n={},r=0;r<a.length;r++)for(var i=a[r].letters,o=0;o<i.length;o++)n[i[o]]=a[r].base;var l=/[^\u0000-\u007E]/g,u=function(e){return n[e]||e},s=function(e){return l.test(e)?e.replace(l,u):e};t.default=s},175042:()=>{}}]);
//# sourceMappingURL=/cloud-sources/prod/dd53cba3d1d1c0876701e2e0a71b630be2b5b4f7b5eb5fe5163324bd535cc44e.map/